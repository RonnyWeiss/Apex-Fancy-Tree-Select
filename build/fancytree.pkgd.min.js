!function(e){e.ui=e.ui||{};e.ui.version="1.12.1";var t=0,n=Array.prototype.slice;e.cleanData=function(t){return function(n){var i,r,o;for(o=0;null!=(r=n[o]);o++)try{(i=e._data(r,"events"))&&i.remove&&e(r).triggerHandler("remove")}catch(e){}t(n)}}(e.cleanData),e.widget=function(t,n,i){var r,o,a,s={},l=t.split(".")[0],d=l+"-"+(t=t.split(".")[1]);return i||(i=n,n=e.Widget),e.isArray(i)&&(i=e.extend.apply(null,[{}].concat(i))),e.expr[":"][d.toLowerCase()]=function(t){return!!e.data(t,d)},e[l]=e[l]||{},r=e[l][t],o=e[l][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,r,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),a=new n,a.options=e.widget.extend({},a.options),e.each(i,function(t,i){e.isFunction(i)?s[t]=function(){function e(){return n.prototype[t].apply(this,arguments)}function r(e){return n.prototype[t].apply(this,e)}return function(){var t,n=this._super,o=this._superApply;return this._super=e,this._superApply=r,t=i.apply(this,arguments),this._super=n,this._superApply=o,t}}():s[t]=i}),o.prototype=e.widget.extend(a,{widgetEventPrefix:r?a.widgetEventPrefix||t:t},s,{constructor:o,namespace:l,widgetName:t,widgetFullName:d}),r?(e.each(r._childConstructors,function(t,n){var i=n.prototype;e.widget(i.namespace+"."+i.widgetName,o,n._proto)}),delete r._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,r,o=n.call(arguments,1),a=0,s=o.length;a<s;a++)for(i in o[a])r=o[a][i],o[a].hasOwnProperty(i)&&void 0!==r&&(e.isPlainObject(r)?t[i]=e.isPlainObject(t[i])?e.widget.extend({},t[i],r):e.widget.extend({},r):t[i]=r);return t},e.widget.bridge=function(t,i){var r=i.prototype.widgetFullName||t;e.fn[t]=function(o){var a="string"==typeof o,s=n.call(arguments,1),l=this;return a?this.length||"instance"!==o?this.each(function(){var n,i=e.data(this,r);return"instance"===o?(l=i,!1):i?e.isFunction(i[o])&&"_"!==o.charAt(0)?(n=i[o].apply(i,s))!==i&&void 0!==n?(l=n&&n.jquery?l.pushStack(n.get()):n,!1):void 0:e.error("no such method '"+o+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+o+"'")}):l=void 0:(s.length&&(o=e.widget.extend.apply(null,[o].concat(s))),this.each(function(){var t=e.data(this,r);t?(t.option(o||{}),t._init&&t._init()):e.data(this,r,new i(o,this))})),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(n,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),this.classesElementLookup={},i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),n),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){var t=this;this._destroy(),e.each(this.classesElementLookup,function(e,n){t._removeClass(n,e)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:e.noop,widget:function(){return this.element},option:function(t,n){var i,r,o,a=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(a={},i=t.split("."),t=i.shift(),i.length){for(r=a[t]=e.widget.extend({},this.options[t]),o=0;o<i.length-1;o++)r[i[o]]=r[i[o]]||{},r=r[i[o]];if(t=i.pop(),1===arguments.length)return void 0===r[t]?null:r[t];r[t]=n}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];a[t]=n}return this._setOptions(a),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return"classes"===e&&this._setOptionClasses(t),this.options[e]=t,"disabled"===e&&this._setOptionDisabled(t),this},_setOptionClasses:function(t){var n,i,r;for(n in t)r=this.classesElementLookup[n],t[n]!==this.options.classes[n]&&r&&r.length&&(i=e(r.get()),this._removeClass(r,n),i.addClass(this._classes({element:i,keys:n,classes:t,add:!0})))},_setOptionDisabled:function(e){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!e),e&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(t){function n(n,o){var a,s;for(s=0;s<n.length;s++)a=r.classesElementLookup[n[s]]||e(),a=e(t.add?e.unique(a.get().concat(t.element.get())):a.not(t.element).get()),r.classesElementLookup[n[s]]=a,i.push(n[s]),o&&t.classes[n[s]]&&i.push(t.classes[n[s]])}var i=[],r=this;return t=e.extend({element:this.element,classes:this.options.classes||{}},t),this._on(t.element,{remove:"_untrackClassesElement"}),t.keys&&n(t.keys.match(/\S+/g)||[],!0),t.extra&&n(t.extra.match(/\S+/g)||[]),i.join(" ")},_untrackClassesElement:function(t){var n=this;e.each(n.classesElementLookup,function(i,r){-1!==e.inArray(t.target,r)&&(n.classesElementLookup[i]=e(r.not(t.target).get()))})},_removeClass:function(e,t,n){return this._toggleClass(e,t,n,!1)},_addClass:function(e,t,n){return this._toggleClass(e,t,n,!0)},_toggleClass:function(e,t,n,i){i="boolean"==typeof i?i:n;var r="string"==typeof e||null===e,o={extra:r?t:n,keys:r?e:t,element:r?this.element:e,add:i};return o.element.toggleClass(this._classes(o),i),this},_on:function(t,n,i){var r,o=this;"boolean"!=typeof t&&(i=n,n=t,t=!1),i?(n=r=e(n),this.bindings=this.bindings.add(n)):(i=n,n=this.element,r=this.widget()),e.each(i,function(i,a){function s(){if(t||!0!==o.options.disabled&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof a?o[a]:a).apply(o,arguments)}"string"!=typeof a&&(s.guid=a.guid=a.guid||s.guid||e.guid++);var l=i.match(/^([\w:-]*)\s*(.*)$/),d=l[1]+o.eventNamespace,c=l[2];c?r.on(d,c,s):n.on(d,s)})},_off:function(t,n){n=(n||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.off(n).off(n),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){var n=this;return setTimeout(function(){return("string"==typeof e?n[e]:e).apply(n,arguments)},t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){this._addClass(e(t.currentTarget),null,"ui-state-hover")},mouseleave:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){this._addClass(e(t.currentTarget),null,"ui-state-focus")},focusout:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-focus")}})},_trigger:function(t,n,i){var r,o,a=this.options[t];if(i=i||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],o=n.originalEvent)for(r in o)r in n||(n[r]=o[r]);return this.element.trigger(n,i),!(e.isFunction(a)&&!1===a.apply(this.element[0],[n].concat(i))||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(i,r,o){"string"==typeof r&&(r={effect:r});var a,s=r?!0===r||"number"==typeof r?n:r.effect||n:t;"number"==typeof(r=r||{})&&(r={duration:r}),a=!e.isEmptyObject(r),r.complete=o,r.delay&&i.delay(r.delay),a&&e.effects&&e.effects.effect[s]?i[t](r):s!==t&&i[s]?i[s](r.duration,r.easing,o):i.queue(function(n){e(this)[t](),o&&o.call(i[0]),n()})}});e.widget;!function(){function t(e,t,n){return[parseFloat(e[0])*(c.test(e[0])?t/100:1),parseFloat(e[1])*(c.test(e[1])?n/100:1)]}function n(t,n){return parseInt(e.css(t,n),10)||0}var i,r=Math.max,o=Math.abs,a=/left|center|right/,s=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,d=/^\w+/,c=/%$/,u=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==i)return i;var t,n,r=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=r.children()[0];return e("body").append(r),t=o.offsetWidth,r.css("overflow","scroll"),n=o.offsetWidth,t===n&&(n=r[0].clientWidth),r.remove(),i=t-n},getScrollInfo:function(t){var n=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),i=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),r="scroll"===n||"auto"===n&&t.width<t.element[0].scrollWidth;return{width:"scroll"===i||"auto"===i&&t.height<t.element[0].scrollHeight?e.position.scrollbarWidth():0,height:r?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),i=e.isWindow(n[0]),r=!!n[0]&&9===n[0].nodeType;return{element:n,isWindow:i,isDocument:r,offset:!i&&!r?e(t).offset():{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:n.outerWidth(),height:n.outerHeight()}}},e.fn.position=function(i){if(!i||!i.of)return u.apply(this,arguments);i=e.extend({},i);var c,f,h,p,g,y,v=e(i.of),m=e.position.getWithinInfo(i.within),x=e.position.getScrollInfo(m),b=(i.collision||"flip").split(" "),C={};return y=function(t){var n=t[0];return 9===n.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(n)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:n.preventDefault?{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}(v),v[0].preventDefault&&(i.at="left top"),f=y.width,h=y.height,p=y.offset,g=e.extend({},p),e.each(["my","at"],function(){var e,t,n=(i[this]||"").split(" ");1===n.length&&(n=a.test(n[0])?n.concat(["center"]):s.test(n[0])?["center"].concat(n):["center","center"]),n[0]=a.test(n[0])?n[0]:"center",n[1]=s.test(n[1])?n[1]:"center",e=l.exec(n[0]),t=l.exec(n[1]),C[this]=[e?e[0]:0,t?t[0]:0],i[this]=[d.exec(n[0])[0],d.exec(n[1])[0]]}),1===b.length&&(b[1]=b[0]),"right"===i.at[0]?g.left+=f:"center"===i.at[0]&&(g.left+=f/2),"bottom"===i.at[1]?g.top+=h:"center"===i.at[1]&&(g.top+=h/2),c=t(C.at,f,h),g.left+=c[0],g.top+=c[1],this.each(function(){var a,s,l=e(this),d=l.outerWidth(),u=l.outerHeight(),y=n(this,"marginLeft"),k=n(this,"marginTop"),w=d+y+n(this,"marginRight")+x.width,_=u+k+n(this,"marginBottom")+x.height,N=e.extend({},g),S=t(C.my,l.outerWidth(),l.outerHeight());"right"===i.my[0]?N.left-=d:"center"===i.my[0]&&(N.left-=d/2),"bottom"===i.my[1]?N.top-=u:"center"===i.my[1]&&(N.top-=u/2),N.left+=S[0],N.top+=S[1],a={marginLeft:y,marginTop:k},e.each(["left","top"],function(t,n){e.ui.position[b[t]]&&e.ui.position[b[t]][n](N,{targetWidth:f,targetHeight:h,elemWidth:d,elemHeight:u,collisionPosition:a,collisionWidth:w,collisionHeight:_,offset:[c[0]+S[0],c[1]+S[1]],my:i.my,at:i.at,within:m,elem:l})}),i.using&&(s=function(e){var t=p.left-N.left,n=t+f-d,a=p.top-N.top,s=a+h-u,c={target:{element:v,left:p.left,top:p.top,width:f,height:h},element:{element:l,left:N.left,top:N.top,width:d,height:u},horizontal:n<0?"left":t>0?"right":"center",vertical:s<0?"top":a>0?"bottom":"middle"};f<d&&o(t+n)<f&&(c.horizontal="center"),h<u&&o(a+s)<h&&(c.vertical="middle"),r(o(t),o(n))>r(o(a),o(s))?c.important="horizontal":c.important="vertical",i.using.call(this,e,c)}),l.offset(e.extend(N,{using:s}))})},e.ui.position={fit:{left:function(e,t){var n,i=t.within,o=i.isWindow?i.scrollLeft:i.offset.left,a=i.width,s=e.left-t.collisionPosition.marginLeft,l=o-s,d=s+t.collisionWidth-a-o;t.collisionWidth>a?l>0&&d<=0?(n=e.left+l+t.collisionWidth-a-o,e.left+=l-n):e.left=d>0&&l<=0?o:l>d?o+a-t.collisionWidth:o:l>0?e.left+=l:d>0?e.left-=d:e.left=r(e.left-s,e.left)},top:function(e,t){var n,i=t.within,o=i.isWindow?i.scrollTop:i.offset.top,a=t.within.height,s=e.top-t.collisionPosition.marginTop,l=o-s,d=s+t.collisionHeight-a-o;t.collisionHeight>a?l>0&&d<=0?(n=e.top+l+t.collisionHeight-a-o,e.top+=l-n):e.top=d>0&&l<=0?o:l>d?o+a-t.collisionHeight:o:l>0?e.top+=l:d>0?e.top-=d:e.top=r(e.top-s,e.top)}},flip:{left:function(e,t){var n,i,r=t.within,a=r.offset.left+r.scrollLeft,s=r.width,l=r.isWindow?r.scrollLeft:r.offset.left,d=e.left-t.collisionPosition.marginLeft,c=d-l,u=d+t.collisionWidth-s-l,f="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,h="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,p=-2*t.offset[0];c<0?((n=e.left+f+h+p+t.collisionWidth-s-a)<0||n<o(c))&&(e.left+=f+h+p):u>0&&((i=e.left-t.collisionPosition.marginLeft+f+h+p-l)>0||o(i)<u)&&(e.left+=f+h+p)},top:function(e,t){var n,i,r=t.within,a=r.offset.top+r.scrollTop,s=r.height,l=r.isWindow?r.scrollTop:r.offset.top,d=e.top-t.collisionPosition.marginTop,c=d-l,u=d+t.collisionHeight-s-l,f="top"===t.my[1]?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,h="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,p=-2*t.offset[1];c<0?((i=e.top+f+h+p+t.collisionHeight-s-a)<0||i<o(c))&&(e.top+=f+h+p):u>0&&((n=e.top-t.collisionPosition.marginTop+f+h+p-l)>0||o(n)<u)&&(e.top+=f+h+p)}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}}}();e.ui.position,e.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},e.fn.scrollParent=function(t){var n=this.css("position"),i="absolute"===n,r=t?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var t=e(this);return(!i||"static"!==t.css("position"))&&r.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==n&&o.length?o:e(this[0].ownerDocument||document)},e.fn.extend({uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}})}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){return function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree.ui-deps"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree.ui-deps"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";function t(t,n){t||(n=n?": "+n:"",e.error("Fancytree assertion failed"+n))}function n(e,t){var n,i,r=window.console?window.console[e]:null;if(r)try{r.apply(window.console,t)}catch(e){for(i="",n=0;n<t.length;n++)i+=t[n];r(i)}}function i(){var t,n,r,o,a,s=arguments[0]||{},l=1,d=arguments.length;if("object"==typeof s||e.isFunction(s)||(s={}),l===d)throw Error("need at least two args");for(;l<d;l++)if(null!=(t=arguments[l]))for(n in t)if(t.hasOwnProperty(n)){if(r=s[n],o=t[n],s===o)continue;o&&e.isPlainObject(o)?(a=r&&e.isPlainObject(r)?r:{},s[n]=i(a,o)):void 0!==o&&(s[n]=o)}return s}function r(e,t,n,i,r){return function(){var n=t[e],o=i[e],a=t.ext[r],s=function(){return n.apply(t,arguments)},l=function(e){return n.apply(t,e)};return function(){var e=t._local,n=t._super,i=t._superApply;try{return t._local=a,t._super=s,t._superApply=l,o.apply(t,arguments)}finally{t._local=e,t._super=n,t._superApply=i}}}()}function o(t,n,i,o){for(var a in i)"function"==typeof i[a]?"function"==typeof t[a]?t[a]=r(a,t,0,i,o):"_"===a.charAt(0)?t.ext[o][a]=r(a,t,0,i,o):e.error("Could not override tree."+a+". Use prefix '_' to create tree."+o+"._"+a):"options"!==a&&(t.ext[o][a]=i[a])}function a(t,n){return void 0===t?e.Deferred(function(){this.resolve()}).promise():e.Deferred(function(){this.resolveWith(t,n)}).promise()}function s(t,n){return void 0===t?e.Deferred(function(){this.reject()}).promise():e.Deferred(function(){this.rejectWith(t,n)}).promise()}function l(e,t){return function(){e.resolveWith(t)}}function d(t){var n=e.extend({},t.data()),i=n.json;return delete n.fancytree,delete n.uiFancytree,i&&(delete n.json,n=e.extend(n,i)),n}function c(e){return(""+e).replace(x,function(e){return k[e]})}function u(e){return e=e.toLowerCase(),function(t){return t.title.toLowerCase().indexOf(e)>=0}}function f(n,i){var r,o,a,s;for(this.parent=n,this.tree=n.tree,this.ul=null,this.li=null,this.statusNodeType=null,this._isLoading=!1,this._error=null,this.data={},r=0,o=D.length;r<o;r++)this[a=D[r]]=i[a];null==this.unselectableIgnore&&null==this.unselectableStatus||(this.unselectable=!0),i.hideCheckbox&&e.error("'hideCheckbox' node option was removed in v2.23.0: use 'checkbox: false'"),i.data&&e.extend(this.data,i.data);for(a in i)O[a]||e.isFunction(i[a])||M[a]||(this.data[a]=i[a]);null==this.key?this.tree.options.defaultKey?(this.key=this.tree.options.defaultKey(this),t(this.key,"defaultKey() must return a unique key")):this.key="_"+y._nextNodeKey++:this.key=""+this.key,i.active&&(t(null===this.tree.activeNode,"only one active node allowed"),this.tree.activeNode=this),i.selected&&(this.tree.lastSelectedNode=this),(s=i.children)?s.length?this._setChildren(s):this.children=this.lazy?[]:null:this.children=null,this.tree._callHook("treeRegisterNode",this.tree,!0,this)}function h(t){this.widget=t,this.$div=t.element,this.options=t.options,this.options&&(void 0!==this.options.lazyload&&e.error("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead."),void 0!==this.options.loaderror&&e.error("The 'loaderror' event was renamed since 2014-07-03. Use 'loadError' (with uppercase E) instead."),void 0!==this.options.fx&&e.error("The 'fx' option was replaced by 'toggleEffect' since 2014-11-30."),void 0!==this.options.removeNode&&e.error("The 'removeNode' event was replaced by 'modifyChild' since 2.20 (2016-09-10).")),this.ext={},this.types={},this.columns={},this.data=d(this.$div),this._id=""+(this.options.treeId||e.ui.fancytree._nextId++),this._ns=".fancytree-"+this._id,this.activeNode=null,this.focusNode=null,this._hasFocus=null,this._tempCache={},this._lastMousedownNode=null,this._enableUpdate=!0,this.lastSelectedNode=null,this.systemFocusElement=null,this.lastQuicksearchTerm="",this.lastQuicksearchTime=0,this.viewport=null,this.statusClassPropName="span",this.ariaPropName="li",this.nodeContainerAttrName="li",this.$div.find(">ul.fancytree-container").remove();var n,i={tree:this};this.rootNode=new f(i,{title:"root",key:"root_"+this._id,children:null,expanded:!0}),this.rootNode.parent=null,n=e("<ul>",{id:"ft-id-"+this._id,class:"ui-fancytree fancytree-container fancytree-plain"}).appendTo(this.$div),this.$container=n,this.rootNode.ul=n[0],null==this.options.debugLevel&&(this.options.debugLevel=y.debugLevel)}{if(!e.ui||!e.ui.fancytree){var p,g,y=null,v=new RegExp(/\.|\//),m=/[&<>"'/]/g,x=/[<>"'/]/g,b="$recursive_request",C="$request_target_invalid",k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},w={16:!0,17:!0,18:!0},_={8:"backspace",9:"tab",10:"return",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},N={16:"shift",17:"ctrl",18:"alt",91:"meta",93:"meta"},S={0:"",1:"left",2:"middle",3:"right"},E="active expanded focus folder lazy radiogroup selected unselectable unselectableIgnore".split(" "),A={},T="columns types".split(" "),D="checkbox expanded extraClasses folder icon iconTooltip key lazy partsel radiogroup refKey selected statusNodeType title tooltip type unselectable unselectableIgnore unselectableStatus".split(" "),O={},I={},M={active:!0,children:!0,data:!0,focus:!0};for(p=0;p<E.length;p++)A[E[p]]=!0;for(p=0;p<D.length;p++)g=D[p],O[g]=!0,g!==g.toLowerCase()&&(I[g.toLowerCase()]=g);return t(e.ui,"Fancytree requires jQuery UI (http://jqueryui.com)"),Date.now||(Date.now=function(){return(new Date).getTime()}),f.prototype={_findDirectChild:function(e){var t,n,i=this.children;if(i)if("string"==typeof e){for(t=0,n=i.length;t<n;t++)if(i[t].key===e)return i[t]}else{if("number"==typeof e)return this.children[e];if(e.parent===this)return e}return null},_setChildren:function(e){t(e&&(!this.children||0===this.children.length),"only init supported"),this.children=[];for(var n=0,i=e.length;n<i;n++)this.children.push(new f(this,e[n]));this.tree._callHook("treeStructureChanged",this.tree,"setChildren")},addChildren:function(n,i){var r,o,a,s=this.getFirstChild(),l=this.getLastChild(),d=null,c=[];for(e.isPlainObject(n)&&(n=[n]),this.children||(this.children=[]),r=0,o=n.length;r<o;r++)c.push(new f(this,n[r]));if(d=c[0],null==i?this.children=this.children.concat(c):(i=this._findDirectChild(i),t((a=e.inArray(i,this.children))>=0,"insertBefore must be an existing child"),this.children.splice.apply(this.children,[a,0].concat(c))),s&&!i){for(r=0,o=c.length;r<o;r++)c[r].render();s!==this.getFirstChild()&&s.renderStatus(),l!==this.getLastChild()&&l.renderStatus()}else(!this.parent||this.parent.ul||this.tr)&&this.render();return 3===this.tree.options.selectMode&&this.fixSelection3FromEndNodes(),this.triggerModifyChild("add",1===c.length?c[0]:null),d},addClass:function(e){return this.toggleClass(e,!0)},addNode:function(e,n){switch(void 0!==n&&"over"!==n||(n="child"),n){case"after":return this.getParent().addChildren(e,this.getNextSibling());case"before":return this.getParent().addChildren(e,this);case"firstChild":var i=this.children?this.children[0]:null;return this.addChildren(e,i);case"child":case"over":return this.addChildren(e)}t(!1,"Invalid mode: "+n)},addPagingNode:function(t,n){var i,r;n=n||"child";{if(!1!==t)return t=e.extend({title:this.tree.options.strings.moreData,statusNodeType:"paging",icon:!1},t),this.partload=!0,this.addNode(t,n);for(i=this.children.length-1;i>=0;i--)"paging"===(r=this.children[i]).statusNodeType&&this.removeChild(r);this.partload=!1}},appendSibling:function(e){return this.addNode(e,"after")},applyCommand:function(e,t){return this.tree.applyCommand(e,this,t)},applyPatch:function(t){if(null===t)return this.remove(),a(this);var n,i,r={children:!0,expanded:!0,parent:!0};for(n in t)t.hasOwnProperty(n)&&(i=t[n],r[n]||e.isFunction(i)||(O[n]?this[n]=i:this.data[n]=i));return t.hasOwnProperty("children")&&(this.removeChildren(),t.children&&this._setChildren(t.children)),this.isVisible()&&(this.renderTitle(),this.renderStatus()),t.hasOwnProperty("expanded")?this.setExpanded(t.expanded):a(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(e,t,n){return e.addNode(this.toDict(!0,n),t)},countChildren:function(e){var t,n,i,r=this.children;if(!r)return 0;if(i=r.length,!1!==e)for(t=0,n=i;t<n;t++)i+=r[t].countChildren();return i},debug:function(e){this.tree.options.debugLevel>=4&&(Array.prototype.unshift.call(arguments,this.toString()),n("log",arguments))},discard:function(){return this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead."),this.resetLazy()},discardMarkup:function(e){var t=e?"nodeRemoveMarkup":"nodeRemoveChildMarkup";this.tree._callHook(t,this)},error:function(e){this.tree.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),n("error",arguments))},findAll:function(t){t=e.isFunction(t)?t:u(t);var n=[];return this.visit(function(e){t(e)&&n.push(e)}),n},findFirst:function(t){t=e.isFunction(t)?t:u(t);var n=null;return this.visit(function(e){if(t(e))return n=e,!1}),n},findRelatedNode:function(e,t){return this.tree.findRelatedNode(this,e,t)},_changeSelectStatusAttrs:function(e){var n=!1,i=this.tree.options,r=y.evalOption("unselectable",this,this,i,!1),o=y.evalOption("unselectableStatus",this,this,i,void 0);switch(r&&null!=o&&(e=o),e){case!1:n=this.selected||this.partsel,this.selected=!1,this.partsel=!1;break;case!0:n=!this.selected||!this.partsel,this.selected=!0,this.partsel=!0;break;case void 0:n=this.selected||!this.partsel,this.selected=!1,this.partsel=!0;break;default:t(!1,"invalid state: "+e)}return n&&this.renderStatus(),n},fixSelection3AfterClick:function(e){var t=this.isSelected();this.visit(function(e){if(e._changeSelectStatusAttrs(t),e.radiogroup)return"skip"}),this.fixSelection3FromEndNodes(e)},fixSelection3FromEndNodes:function(e){function n(e){var t,r,o,a,s,l,d,c,u=e.children;if(u&&u.length){for(l=!0,d=!1,t=0,r=u.length;t<r;t++)a=n(o=u[t]),y.evalOption("unselectableIgnore",o,o,i,!1)||(!1!==a&&(d=!0),!0!==a&&(l=!1));s=!!l||!!d&&void 0}else s=null==(c=y.evalOption("unselectableStatus",e,e,i,void 0))?!!e.selected:!!c;return e.partsel&&!e.selected&&e.lazy&&null==e.children&&(s=void 0),e._changeSelectStatusAttrs(s),s}var i=this.tree.options;t(3===i.selectMode,"expected selectMode 3"),n(this),this.visitParents(function(e){var t,n,r,o,a,s=e.children,l=!0,d=!1;for(t=0,n=s.length;t<n;t++)r=s[t],y.evalOption("unselectableIgnore",r,r,i,!1)||(((o=null==(a=y.evalOption("unselectableStatus",r,r,i,void 0))?!!r.selected:!!a)||r.partsel)&&(d=!0),o||(l=!1));o=!!l||!!d&&void 0,e._changeSelectStatusAttrs(o)})},fromDict:function(t){for(var n in t)O[n]?this[n]=t[n]:"data"===n?e.extend(this.data,t.data):e.isFunction(t[n])||M[n]||(this.data[n]=t[n]);t.children&&(this.removeChildren(),this.addChildren(t.children)),this.renderTitle()},getChildren:function(){if(void 0!==this.hasChildren())return this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return e.inArray(this,this.parent.children)},getIndexHier:function(t,n){t=t||".";var i,r=[];return e.each(this.getParentList(!1,!0),function(e,t){i=""+(t.getIndex()+1),n&&(i=("0000000"+i).substr(-n)),r.push(i)}),r.join(t)},getKeyPath:function(e){var t=this.tree.options.keyPathSeparator;return t+this.getPath(!e,"key",t)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},getNextSibling:function(){if(this.parent){var e,t,n=this.parent.children;for(e=0,t=n.length-1;e<t;e++)if(n[e]===this)return n[e+1]}return null},getParent:function(){return this.parent},getParentList:function(e,t){for(var n=[],i=t?this:this.parent;i;)(e||i.parent)&&n.unshift(i),i=i.parent;return n},getPath:function(t,n,i){t=!1!==t,n=n||"title",i=i||"/";var r,o=[],a=e.isFunction(n);return this.visitParents(function(e){e.parent&&(r=a?n(e):e[n],o.unshift(r))},t),o.join(i)},getPrevSibling:function(){if(this.parent){var e,t,n=this.parent.children;for(e=1,t=n.length;e<t;e++)if(n[e]===this)return n[e-1]}return null},getSelectedNodes:function(e){var t=[];return this.visit(function(n){if(n.selected&&(t.push(n),!0===e))return"skip"}),t},hasChildren:function(){if(this.lazy){if(null==this.children)return;if(0===this.children.length)return!1;if(1===this.children.length&&this.children[0].isStatusNode())return;return!0}return!(!this.children||!this.children.length)},hasClass:function(e){return(" "+(this.extraClasses||"")+" ").indexOf(" "+e+" ")>=0},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},info:function(e){this.tree.options.debugLevel>=3&&(Array.prototype.unshift.call(arguments,this.toString()),n("info",arguments))},isActive:function(){return this.tree.activeNode===this},isBelowOf:function(e){return this.getIndexHier(".",5)>e.getIndexHier(".",5)},isChildOf:function(e){return this.parent&&this.parent===e},isDescendantOf:function(t){if(!t||t.tree!==this.tree)return!1;for(var n=this.parent;n;){if(n===t)return!0;n===n.parent&&e.error("Recursive parent link: "+n),n=n.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var e=this.parent;return!e||e.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var e=this.parent;return!e||e.children[e.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||void 0!==this.hasChildren()},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.isRootNode()},isPartsel:function(){return!this.selected&&!!this.partsel},isPartload:function(){return!!this.partload},isRootNode:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isPagingNode:function(){return"paging"===this.statusNodeType},isTopLevel:function(){return this.tree.rootNode===this.parent},isUndefined:function(){return void 0===this.hasChildren()},isVisible:function(){var e,t,n=this.tree.enableFilter,i=this.getParentList(!1,!1);if(n&&!this.match&&!this.subMatchCount)return!1;for(e=0,t=i.length;e<t;e++)if(!i[e].expanded)return!1;return!0},lazyLoad:function(t){e.error("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead.")},load:function(e){var n,i,r=this,o=this.isExpanded();return t(this.isLazy(),"load() requires a lazy node"),e||this.isUndefined()?(this.isLoaded()&&this.resetLazy(),!1===(i=this.tree._triggerNodeEvent("lazyLoad",this))?a(this):(t("boolean"!=typeof i,"lazyLoad event must return source in data.result"),n=this.tree._callHook("nodeLoadChildren",this,i),o?(this.expanded=!0,n.always(function(){r.render()})):n.always(function(){r.renderStatus()}),n)):a(this)},makeVisible:function(t){var n,i=this,r=[],o=new e.Deferred,a=this.getParentList(!1,!1),s=a.length,l=!(t&&!0===t.noAnimation),d=!(t&&!1===t.scrollIntoView);for(n=s-1;n>=0;n--)r.push(a[n].setExpanded(!0,t));return e.when.apply(e,r).done(function(){d?i.scrollIntoView(l).done(function(){o.resolve()}):o.resolve()}),o.promise()},moveTo:function(n,i,r){void 0===i||"over"===i?i="child":"firstChild"===i&&(n.children&&n.children.length?(i="before",n=n.children[0]):i="child");var o,a=this.tree,s=this.parent,l="child"===i?n:n.parent;if(this!==n){if(this.parent?l.isDescendantOf(this)&&e.error("Cannot move a node to its own descendant"):e.error("Cannot move system root"),l!==s&&s.triggerModifyChild("remove",this),1===this.parent.children.length){if(this.parent===l)return;this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1}else t((o=e.inArray(this,this.parent.children))>=0,"invalid source parent"),this.parent.children.splice(o,1);if(this.parent=l,l.hasChildren())switch(i){case"child":l.children.push(this);break;case"before":t((o=e.inArray(n,l.children))>=0,"invalid target parent"),l.children.splice(o,0,this);break;case"after":t((o=e.inArray(n,l.children))>=0,"invalid target parent"),l.children.splice(o+1,0,this);break;default:e.error("Invalid mode "+i)}else l.children=[this];r&&n.visit(r,!0),l===s?l.triggerModifyChild("move",this):l.triggerModifyChild("add",this),a!==n.tree&&(this.warn("Cross-tree moveTo is experimental!"),this.visit(function(e){e.tree=n.tree},!0)),a._callHook("treeStructureChanged",a,"moveTo"),s.isDescendantOf(l)||s.render(),l.isDescendantOf(s)||l===s||l.render()}},navigate:function(t,n){var i,r=e.ui.keyCode;switch(t){case"left":case r.LEFT:if(this.expanded)return this.setExpanded(!1);break;case"right":case r.RIGHT:if(!this.expanded&&(this.children||this.lazy))return this.setExpanded()}if(i=this.findRelatedNode(t)){try{i.makeVisible({scrollIntoView:!1})}catch(e){}return!1===n?(i.setFocus(),a()):i.setActive()}return this.warn("Could not find related node '"+t+"'."),a()},remove:function(){return this.parent.removeChild(this)},removeChild:function(e){return this.tree._callHook("nodeRemoveChild",this,e)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},removeClass:function(e){return this.toggleClass(e,!1)},render:function(e,t){return this.tree._callHook("nodeRender",this,e,t)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},replaceWith:function(n){var i,r=this.parent,o=e.inArray(this,r.children),a=this;return t(this.isPagingNode(),"replaceWith() currently requires a paging status node"),(i=this.tree._callHook("nodeLoadChildren",this,n)).done(function(e){var t=a.children;for(p=0;p<t.length;p++)t[p].parent=r;r.children.splice.apply(r.children,[o+1,0].concat(t)),a.children=null,a.remove(),r.render()}).fail(function(){a.setExpanded()}),i},resetLazy:function(){this.removeChildren(),this.expanded=!1,this.lazy=!0,this.children=void 0,this.renderStatus()},scheduleAction:function(t,n){this.tree.timer&&(clearTimeout(this.tree.timer),this.tree.debug("clearTimeout(%o)",this.tree.timer)),this.tree.timer=null;var i=this;switch(t){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){i.tree.debug("setTimeout: trigger expand"),i.setExpanded(!0)},n);break;case"activate":this.tree.timer=setTimeout(function(){i.tree.debug("setTimeout: trigger activate"),i.setActive(!0)},n);break;default:e.error("Invalid mode "+t)}},scrollIntoView:function(n,i){if(void 0!==i&&function(e){return!(!e.tree||void 0===e.statusNodeType)}(i))throw Error("scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead.");var r=e.extend({effects:!0===n?{duration:200,queue:!1}:n,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent,topNode:null},i),o=r.scrollParent,s=this.tree.$container,l=s.css("overflow-y");o?o.jquery||(o=e(o)):o=this.tree.tbody?s.scrollParent():"scroll"===l||"auto"===l?s:s.scrollParent(),o[0]!==document&&o[0]!==document.body||(this.debug("scrollIntoView(): normalizing scrollParent to 'window':",o[0]),o=e(window));var d,c,u,f=new e.Deferred,h=this,p=e(this.span).height(),g=r.scrollOfs.top||0,y=r.scrollOfs.bottom||0,v=o.height(),m=o.scrollTop(),x=o,b=o[0]===window,C=r.topNode||null,k=null;return this.isRootNode()||!this.isVisible()?(this.info("scrollIntoView(): node is invisible."),a()):(b?(c=e(this.span).offset().top,d=C&&C.span?e(C.span).offset().top:0,x=e("html,body")):(t(o[0]!==document&&o[0]!==document.body,"scrollParent should be a simple element or `window`, not document or body."),u=o.offset().top,c=e(this.span).offset().top-u+m,d=C?e(C.span).offset().top-u+m:0,v-=Math.max(0,o.innerHeight()-o[0].clientHeight)),c<m+g?k=c-g:c+p>m+v-y&&(k=c+p-v+y,C&&(t(C.isRootNode()||C.isVisible(),"topNode must be visible"),d<k&&(k=d-g))),null===k?f.resolveWith(this):r.effects?(r.effects.complete=function(){f.resolveWith(h)},x.stop(!0).animate({scrollTop:k},r.effects)):(x[0].scrollTop=k,f.resolveWith(this)),f.promise())},setActive:function(e,t){return this.tree._callHook("nodeSetActive",this,e,t)},setExpanded:function(e,t){return this.tree._callHook("nodeSetExpanded",this,e,t)},setFocus:function(e){return this.tree._callHook("nodeSetFocus",this,e)},setSelected:function(e,t){return this.tree._callHook("nodeSetSelected",this,e,t)},setStatus:function(e,t,n){return this.tree._callHook("nodeSetStatus",this,e,t,n)},setTitle:function(e){this.title=e,this.renderTitle(),this.triggerModify("rename")},sortChildren:function(e,t){var n,i,r=this.children;if(r){if(e=e||function(e,t){var n=e.title.toLowerCase(),i=t.title.toLowerCase();return n===i?0:n>i?1:-1},r.sort(e),t)for(n=0,i=r.length;n<i;n++)r[n].children&&r[n].sortChildren(e,"$norender$");"$norender$"!==t&&this.render(),this.triggerModifyChild("sort")}},toDict:function(t,n){var i,r,o,a,s={},l=this;if(e.each(D,function(e,t){(l[t]||!1===l[t])&&(s[t]=l[t])}),e.isEmptyObject(this.data)||(s.data=e.extend({},this.data),e.isEmptyObject(s.data)&&delete s.data),n){if(!1===(a=n(s,l)))return!1;"skip"===a&&(t=!1)}if(t&&e.isArray(this.children))for(s.children=[],i=0,r=this.children.length;i<r;i++)(o=this.children[i]).isStatusNode()||!1!==(a=o.toDict(!0,n))&&s.children.push(a);return s},toggleClass:function(t,n){var i,r,o=t.match(/\S+/g)||[],a=0,s=!1,l=this[this.tree.statusClassPropName],d=" "+(this.extraClasses||"")+" ";for(l&&e(l).toggleClass(t,n);i=o[a++];)if(r=d.indexOf(" "+i+" ")>=0,n=void 0===n?!r:!!n)r||(d+=i+" ",s=!0);else for(;d.indexOf(" "+i+" ")>-1;)d=d.replace(" "+i+" "," ");return this.extraClasses=e.trim(d),s},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"FancytreeNode@"+this.key+"[title='"+this.title+"']"},triggerModifyChild:function(t,n,i){var r,o=this.tree.options.modifyChild;o&&(n&&n.parent!==this&&e.error("childNode "+n+" is not a child of "+this),r={node:this,tree:this.tree,operation:t,childNode:n||null},i&&e.extend(r,i),o({type:"modifyChild"},r))},triggerModify:function(e,t){this.parent.triggerModifyChild(e,this,t)},visit:function(e,t){var n,i,r=!0,o=this.children;if(!0===t&&(!1===(r=e(this))||"skip"===r))return r;if(o)for(n=0,i=o.length;n<i&&!1!==(r=o[n].visit(e,!0));n++);return r},visitAndLoad:function(t,n,i){var r,o,s,l=this;return!t||!0!==n||!1!==(o=t(l))&&"skip"!==o?l.children||l.lazy?(r=new e.Deferred,s=[],l.load().done(function(){for(var n=0,i=l.children.length;n<i;n++){if(!1===(o=l.children[n].visitAndLoad(t,!0,!0))){r.reject();break}"skip"!==o&&s.push(o)}e.when.apply(this,s).then(function(){r.resolve()})}),r.promise()):a():i?o:a()},visitParents:function(e,t){if(t&&!1===e(this))return!1;for(var n=this.parent;n;){if(!1===e(n))return!1;n=n.parent}return!0},visitSiblings:function(e,t){var n,i,r,o=this.parent.children;for(n=0,i=o.length;n<i;n++)if(r=o[n],(t||r!==this)&&!1===e(r))return!1;return!0},warn:function(e){this.tree.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),n("warn",arguments))}},h.prototype={_makeHookContext:function(t,n,i){var r,o;return void 0!==t.node?(n&&t.originalEvent!==n&&e.error("invalid args"),r=t):t.tree?r={node:t,tree:o=t.tree,widget:o.widget,options:o.widget.options,originalEvent:n,typeInfo:o.types[t.type]||{}}:t.widget?r={node:null,tree:t,widget:t.widget,options:t.widget.options,originalEvent:n}:e.error("invalid args"),i&&e.extend(r,i),r},_callHook:function(t,n,i){var r=this._makeHookContext(n),o=this[t],a=Array.prototype.slice.call(arguments,2);return e.isFunction(o)||e.error("_callHook('"+t+"') is not a function"),a.unshift(r),o.apply(this,a)},_setExpiringValue:function(e,t,n){this._tempCache[e]={value:t,expire:Date.now()+(+n||50)}},_getExpiringValue:function(e){var t=this._tempCache[e];return t&&t.expire>Date.now()?t.value:(delete this._tempCache[e],null)},_usesExtension:function(t){return e.inArray(t,this.options.extensions)>=0},_requireExtension:function(n,i,r,o){null!=r&&(r=!!r);var a=this._local.name,s=this.options.extensions,l=e.inArray(n,s)<e.inArray(a,s),d=i&&null==this.ext[n],c=!d&&null!=r&&r!==l;return t(a&&a!==n,"invalid or same name '"+a+"' (require yourself?)"),!d&&!c||(o||(d||i?(o="'"+a+"' extension requires '"+n+"'",c&&(o+=" to be registered "+(r?"before":"after")+" itself")):o="If used together, `"+n+"` must be registered "+(r?"before":"after")+" `"+a+"`"),e.error(o),!1)},activateKey:function(e,t){var n=this.getNodeByKey(e);return n?n.setActive(!0,t):this.activeNode&&this.activeNode.setActive(!1,t),n},addPagingNode:function(e,t){return this.rootNode.addPagingNode(e,t)},applyCommand:function(t,n,i){var r;switch(n=n||this.getActiveNode(),t){case"moveUp":(r=n.getPrevSibling())&&(n.moveTo(r,"before"),n.setActive());break;case"moveDown":(r=n.getNextSibling())&&(n.moveTo(r,"after"),n.setActive());break;case"indent":(r=n.getPrevSibling())&&(n.moveTo(r,"child"),r.setExpanded(),n.setActive());break;case"outdent":n.isTopLevel()||(n.moveTo(n.getParent(),"after"),n.setActive());break;case"remove":r=n.getPrevSibling()||n.getParent(),n.remove(),r&&r.setActive();break;case"addChild":n.editCreateNode("child","");break;case"addSibling":n.editCreateNode("after","");break;case"rename":n.editStart();break;case"down":case"first":case"last":case"left":case"parent":case"right":case"up":return n.navigate(t);default:e.error("Unhandled command: '"+t+"'")}},applyPatch:function(n){var i,r,o,a,s,d,c=n.length,u=[];for(r=0;r<c;r++)t(2===(o=n[r]).length,"patchList must be an array of length-2-arrays"),a=o[0],s=o[1],(d=null===a?this.rootNode:this.getNodeByKey(a))?(i=new e.Deferred,u.push(i),d.applyPatch(s).always(l(i,d))):this.warn("could not find node with key '"+a+"'");return e.when.apply(e,u).promise()},clear:function(e){this._callHook("treeClear",this)},count:function(){return this.rootNode.countChildren()},debug:function(e){this.options.debugLevel>=4&&(Array.prototype.unshift.call(arguments,this.toString()),n("log",arguments))},destroy:function(){this.widget.destroy()},enable:function(e){!1===e?this.widget.disable():this.widget.enable()},enableUpdate:function(e){return e=!1!==e,!!this._enableUpdate==!!e?e:(this._enableUpdate=e,e?(this.debug("enableUpdate(true): redraw "),this._callHook("treeStructureChanged",this,"enableUpdate"),this.render()):this.debug("enableUpdate(false)..."),!e)},error:function(e){this.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),n("error",arguments))},expandAll:function(e,t){var n=this.enableUpdate(!1);e=!1!==e,this.visit(function(n){!1!==n.hasChildren()&&n.isExpanded()!==e&&n.setExpanded(e,t)}),this.enableUpdate(n)},findAll:function(e){return this.rootNode.findAll(e)},findFirst:function(e){return this.rootNode.findFirst(e)},findNextNode:function(e,t){function n(n){if(e(n)&&(i=n),i||n===t)return!1}var i=null,r=this.getFirstChild();return e="string"==typeof e?function(e){var t=new RegExp("^"+e,"i");return function(e){return t.test(e.title)}}(e):e,t=t||r,this.visitRows(n,{start:t,includeSelf:!1}),i||t===r||this.visitRows(n,{start:r,includeSelf:!0}),i},findRelatedNode:function(t,n,i){var r=null,o=e.ui.keyCode;switch(n){case"parent":case o.BACKSPACE:t.parent&&t.parent.parent&&(r=t.parent);break;case"first":case o.HOME:this.visit(function(e){if(e.isVisible())return r=e,!1});break;case"last":case o.END:this.visit(function(e){e.isVisible()&&(r=e)});break;case"left":case o.LEFT:t.expanded?t.setExpanded(!1):t.parent&&t.parent.parent&&(r=t.parent);break;case"right":case o.RIGHT:t.expanded||!t.children&&!t.lazy?t.children&&t.children.length&&(r=t.children[0]):(t.setExpanded(),r=t);break;case"up":case o.UP:this.visitRows(function(e){return r=e,!1},{start:t,reverse:!0,includeSelf:!1});break;case"down":case o.DOWN:this.visitRows(function(e){return r=e,!1},{start:t,includeSelf:!1});break;default:this.tree.warn("Unknown relation '"+n+"'.")}return r},generateFormElements:function(t,n,i){function r(t){d.append(e("<input>",{type:"checkbox",name:a,value:t.key,checked:!0}))}i=i||{};var o,a="string"==typeof t?t:"ft_"+this._id+"[]",s="string"==typeof n?n:"ft_"+this._id+"_active",l="fancytree_result_"+this._id,d=e("#"+l),c=3===this.options.selectMode&&!1!==i.stopOnParents;d.length?d.empty():d=e("<div>",{id:l}).hide().insertAfter(this.$container),!1!==n&&this.activeNode&&d.append(e("<input>",{type:"radio",name:s,value:this.activeNode.key,checked:!0})),i.filter?this.visit(function(e){var t=i.filter(e);if("skip"===t)return t;!1!==t&&r(e)}):!1!==t&&(o=this.getSelectedNodes(c),e.each(o,function(e,t){r(t)}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(){return this.focusNode},getOption:function(e){return this.widget.option(e)},getNodeByKey:function(e,t){var n,i;return!t&&(n=document.getElementById(this.options.idPrefix+e))?n.ftnode?n.ftnode:null:(t=t||this.rootNode,i=null,t.visit(function(t){if(t.key===e)return i=t,!1},!0),i)},getRootNode:function(){return this.rootNode},getSelectedNodes:function(e){return this.rootNode.getSelectedNodes(e)},hasFocus:function(){return!!this._hasFocus},info:function(e){this.options.debugLevel>=3&&(Array.prototype.unshift.call(arguments,this.toString()),n("info",arguments))},isLoading:function(){var e=!1;return this.rootNode.visit(function(t){if(t._isLoading||t._requestId)return e=!0,!1},!0),e},loadKeyPath:function(t,n){var i,r,o,a=this,s=new e.Deferred,l=this.getRootNode(),d=this.options.keyPathSeparator,c=[],u=e.extend({},n);for("function"==typeof n?i=n:n&&n.callback&&(i=n.callback),u.callback=function(e,t,n){i&&i.call(e,t,n),s.notifyWith(e,[{node:t,status:n}])},null==u.matchKey&&(u.matchKey=function(e,t){return e.key===t}),e.isArray(t)||(t=[t]),r=0;r<t.length;r++)(o=t[r]).charAt(0)===d&&(o=o.substr(1)),c.push(o.split(d));return setTimeout(function(){a._loadKeyPathImpl(s,u,l,c).done(function(){s.resolve()})},0),s.promise()},_loadKeyPathImpl:function(t,n,i,r){function o(e,t){var i,r,o=e.children;if(o)for(i=0,r=o.length;i<r;i++)if(n.matchKey(o[i],t))return o[i];return null}function a(e,t,i){n.callback(m,t,"loading"),t.load().done(function(){m._loadKeyPathImpl.call(m,e,n,t,i).always(l(e,m))}).fail(function(i){m.warn("loadKeyPath: error loading lazy "+t),n.callback(m,u,"error"),e.rejectWith(m)})}var s,d,c,u,f,h,p,g,y,v,m=this;for(p={},d=0;d<r.length;d++)for(y=r[d],g=i;y.length;){if(c=y.shift(),!(u=o(g,c))){this.warn("loadKeyPath: key not found: "+c+" (parent: "+g+")"),n.callback(this,c,"error");break}if(0===y.length){n.callback(this,u,"ok");break}if(u.lazy&&void 0===u.hasChildren()){n.callback(this,u,"loaded"),p[c=u.key]?p[c].pathSegList.push(y):p[c]={parent:u,pathSegList:[y]};break}n.callback(this,u,"loaded"),g=u}s=[];for(f in p)p.hasOwnProperty(f)&&(h=p[f],v=new e.Deferred,s.push(v),a(v,h.parent,h.pathSegList));return e.when.apply(e,s).promise()},reactivate:function(e){var t,n=this.activeNode;return n?(this.activeNode=null,t=n.setActive(!0,{noFocus:!0}),e&&n.setFocus(),t):a()},reload:function(e){return this._callHook("treeClear",this),this._callHook("treeLoad",this,e)},render:function(e,t){return this.rootNode.render(e,t)},selectAll:function(e){this.visit(function(t){t.setSelected(e)})},setFocus:function(e){return this._callHook("treeSetFocus",this,e)},setOption:function(e,t){return this.widget.option(e,t)},debugTime:function(e){this.options.debugLevel>=4&&window.console.time(this+" - "+e)},debugTimeEnd:function(e){this.options.debugLevel>=4&&window.console.timeEnd(this+" - "+e)},toDict:function(e,t){var n=this.rootNode.toDict(!0,t);return e?n:n.children},toString:function(){return"Fancytree@"+this._id},_triggerNodeEvent:function(e,t,n,i){var r=this._makeHookContext(t,n,i),o=this.widget._trigger(e,n,r);return!1!==o&&void 0!==r.result?r.result:o},_triggerTreeEvent:function(e,t,n){var i=this._makeHookContext(this,t,n),r=this.widget._trigger(e,t,i);return!1!==r&&void 0!==i.result?i.result:r},visit:function(e){return this.rootNode.visit(e,!1)},visitRows:function(e,t){if(!this.rootNode.hasChildren())return!1;if(t&&t.reverse)return delete t.reverse,this._visitRowsUp(e,t);var n,i,r,o=0,a=!1===(t=t||{}).includeSelf,s=!!t.includeHidden,l=!s&&this.enableFilter,d=t.start||this.rootNode.children[0];for(i=d.parent;i;){for(n=(r=i.children).indexOf(d)+o;n<r.length;n++)if(d=r[n],!l||d.match||d.subMatchCount){if(!a&&!1===e(d))return!1;if(a=!1,d.children&&d.children.length&&(s||d.expanded)&&!1===d.visit(function(t){return!l||t.match||t.subMatchCount?!1!==e(t)&&(s||!t.children||t.expanded?void 0:"skip"):"skip"},!1))return!1}d=i,i=i.parent,o=1}return!0},_visitRowsUp:function(e,t){for(var n,i,r=!!t.includeHidden,o=t.start||this.rootNode.children[0];;){if(i=o.parent,(n=i.children)[0]===o){if(!(o=i).parent)break;n=i.children}else for(o=n[n.indexOf(o)-1];(r||o.expanded)&&o.children&&o.children.length;)i=o,o=(n=o.children)[n.length-1];if((r||o.isVisible())&&!1===e(o))return!1}},warn:function(e){this.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),n("warn",arguments))}},e.extend(h.prototype,{nodeClick:function(e){var t,n,i=e.targetType,r=e.node;if("expander"===i){if(r.isLoading())return void r.debug("Got 2nd click while loading: ignored");this._callHook("nodeToggleExpanded",e)}else if("checkbox"===i)this._callHook("nodeToggleSelected",e),e.options.focusOnSelect&&this._callHook("nodeSetFocus",e,!0);else{if(n=!1,t=!0,r.folder)switch(e.options.clickFolderMode){case 2:n=!0,t=!1;break;case 3:t=!0,n=!0}t&&(this.nodeSetFocus(e),this._callHook("nodeSetActive",e,!0)),n&&this._callHook("nodeToggleExpanded",e)}},nodeCollapseSiblings:function(e,t){var n,i,r,o=e.node;if(o.parent)for(i=0,r=(n=o.parent.children).length;i<r;i++)n[i]!==o&&n[i].expanded&&this._callHook("nodeSetExpanded",n[i],!1,t)},nodeDblclick:function(e){"title"===e.targetType&&4===e.options.clickFolderMode&&this._callHook("nodeToggleExpanded",e),"title"===e.targetType&&e.originalEvent.preventDefault()},nodeKeydown:function(t){var n,i,r,o=t.originalEvent,a=t.node,s=t.tree,l=t.options,d=o.which,c=o.key||String.fromCharCode(d),u=!!(o.altKey||o.ctrlKey||o.metaKey),f=!N[d]&&!_[d]&&!u,h=e(o.target),p=!0,g=!(o.ctrlKey||!l.autoActivate);if(a||(r=this.getActiveNode()||this.getFirstChild())&&(r.setFocus(),(a=t.node=this.focusNode).debug("Keydown force focus on active node")),l.quicksearch&&f&&!h.is(":input:enabled"))return(i=Date.now())-s.lastQuicksearchTime>500&&(s.lastQuicksearchTerm=""),s.lastQuicksearchTime=i,s.lastQuicksearchTerm+=c,(n=s.findNextNode(s.lastQuicksearchTerm,s.getActiveNode()))&&n.setActive(),void o.preventDefault();switch(y.eventToString(o)){case"+":case"=":s.nodeSetExpanded(t,!0);break;case"-":s.nodeSetExpanded(t,!1);break;case"space":a.isPagingNode()?s._triggerNodeEvent("clickPaging",t,o):y.evalOption("checkbox",a,a,l,!1)?s.nodeToggleSelected(t):s.nodeSetActive(t,!0);break;case"return":s.nodeSetActive(t,!0);break;case"home":case"end":case"backspace":case"left":case"right":case"up":case"down":a.navigate(o.which,g);break;default:p=!1}p&&o.preventDefault()},nodeLoadChildren:function(n,i){var r,o,a,s=null,l=!0,d=n.tree,c=n.node,u=c.parent,f="nodeLoadChildren",h=Date.now();return e.isFunction(i)&&(i=i.call(d,{type:"source"},n),t(!e.isFunction(i),"source callback must not return another function")),e.isFunction(i.then)?s=i:i.url?(r=e.extend({},n.options.ajax,i)).debugDelay?(o=r.debugDelay,delete r.debugDelay,e.isArray(o)&&(o=o[0]+Math.random()*(o[1]-o[0])),c.warn("nodeLoadChildren waiting debugDelay "+Math.round(o)+" ms ..."),s=e.Deferred(function(t){setTimeout(function(){e.ajax(r).done(function(){t.resolveWith(this,arguments)}).fail(function(){t.rejectWith(this,arguments)})},o)})):s=e.ajax(r):e.isPlainObject(i)||e.isArray(i)?(s={then:function(e,t){e(i,null,null)}},l=!1):e.error("Invalid source type: "+i),c._requestId&&(c.warn("Recursive load request #"+h+" while #"+c._requestId+" is pending."),c._requestId=h),l&&(d.debugTime(f),d.nodeSetStatus(n,"loading")),a=new e.Deferred,s.then(function(t,r,o){var s,l;if("json"!==i.dataType&&"jsonp"!==i.dataType||"string"!=typeof t||e.error("Ajax request returned a string (did you get the JSON dataType wrong?)."),c._requestId&&c._requestId>h)a.rejectWith(this,[b]);else if(null!==c.parent||null===u){if(n.options.postProcess){try{l=d._triggerNodeEvent("postProcess",n,n.originalEvent,{response:t,error:null,dataType:i.dataType})}catch(e){l={error:e,message:""+e,details:"postProcess failed"}}if(l.error)return s=e.isPlainObject(l.error)?l.error:{message:l.error},s=d._makeHookContext(c,null,s),void a.rejectWith(this,[s]);(e.isArray(l)||e.isPlainObject(l)&&e.isArray(l.children))&&(t=l)}else t&&t.hasOwnProperty("d")&&n.options.enableAspx&&(42===n.options.enableAspx&&d.warn("The default for enableAspx will change to `false` in the fututure. Pass `enableAspx: true` or implement postProcess to silence this warning."),t="string"==typeof t.d?e.parseJSON(t.d):t.d);a.resolveWith(this,[t])}else a.rejectWith(this,[C])},function(e,t,n){var i=d._makeHookContext(c,null,{error:e,args:Array.prototype.slice.call(arguments),message:n,details:e.status+": "+n});a.rejectWith(this,[i])}),a.done(function(i){d.nodeSetStatus(n,"ok");var r,o,a;e.isPlainObject(i)?(t(c.isRootNode(),"source may only be an object for root nodes (expecting an array of child objects otherwise)"),t(e.isArray(i.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),o=i,r=i.children,delete o.children,e.each(T,function(e,t){void 0!==o[t]&&(d[t]=o[t],delete o[t])}),e.extend(d.data,o)):r=i,t(e.isArray(r),"expected array of children"),c._setChildren(r),d.options.nodata&&0===r.length&&(e.isFunction(d.options.nodata)?a=d.options.nodata.call(d,{type:"nodata"},n):!0===d.options.nodata&&c.isRootNode()?a=d.options.strings.noData:"string"==typeof d.options.nodata&&c.isRootNode()&&(a=d.options.nodata),a&&c.setStatus("nodata",a)),d._triggerNodeEvent("loadChildren",c)}).fail(function(e){var t;e!==b?e!==C?(e.node&&e.error&&e.message?t=e:"[object Object]"===(t=d._makeHookContext(c,null,{error:e,args:Array.prototype.slice.call(arguments),message:e?e.message||e.toString():""})).message&&(t.message=""),c.warn("Load children failed ("+t.message+")",t),!1!==d._triggerNodeEvent("loadError",t,null)&&d.nodeSetStatus(n,"error",t.message,t.details)):c.warn("Lazy parent node was removed while loading: discarding response."):c.warn("Ignored response for obsolete load request #"+h+" (expected #"+c._requestId+")")}).always(function(){c._requestId=null,l&&d.debugTimeEnd(f)}),a.promise()},nodeLoadKeyPath:function(e,t){},nodeRemoveChild:function(n,i){var r,o=n.node,a=e.extend({},n,{node:i}),s=o.children;if(1===s.length)return t(i===s[0],"invalid single child"),this.nodeRemoveChildren(n);this.activeNode&&(i===this.activeNode||this.activeNode.isDescendantOf(i))&&this.activeNode.setActive(!1),this.focusNode&&(i===this.focusNode||this.focusNode.isDescendantOf(i))&&(this.focusNode=null),this.nodeRemoveMarkup(a),this.nodeRemoveChildren(a),t((r=e.inArray(i,s))>=0,"invalid child"),o.triggerModifyChild("remove",i),i.visit(function(e){e.parent=null},!0),this._callHook("treeRegisterNode",this,!1,i),s.splice(r,1)},nodeRemoveChildMarkup:function(t){var n=t.node;n.ul&&(n.isRootNode()?e(n.ul).empty():(e(n.ul).remove(),n.ul=null),n.visit(function(e){e.li=e.ul=null}))},nodeRemoveChildren:function(e){var t=e.tree,n=e.node;n.children&&(this.activeNode&&this.activeNode.isDescendantOf(n)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(n)&&(this.focusNode=null),this.nodeRemoveChildMarkup(e),n.triggerModifyChild("remove",null),n.visit(function(e){e.parent=null,t._callHook("treeRegisterNode",t,!1,e)}),n.lazy?n.children=[]:n.children=null,n.isRootNode()||(n.expanded=!1),this.nodeRenderStatus(e))},nodeRemoveMarkup:function(t){var n=t.node;n.li&&(e(n.li).remove(),n.li=null),this.nodeRemoveChildMarkup(t)},nodeRender:function(n,i,r,o,a){var s,l,d,c,u,f,h,p=n.node,g=n.tree,y=n.options,v=y.aria,m=!1,x=p.parent,b=!x,C=p.children,k=null;if(!1!==g._enableUpdate&&(b||x.ul)){if(t(b||x.ul,"parent UL must exist"),b||(p.li&&(i||p.li.parentNode!==p.parent.ul)&&(p.li.parentNode===p.parent.ul?k=p.li.nextSibling:this.debug("Unlinking "+p+" (must be child of "+p.parent+")"),this.nodeRemoveMarkup(n)),p.li?this.nodeRenderStatus(n):(m=!0,p.li=document.createElement("li"),p.li.ftnode=p,p.key&&y.generateIds&&(p.li.id=y.idPrefix+p.key),p.span=document.createElement("span"),p.span.className="fancytree-node",v&&!p.tr&&e(p.li).attr("role","treeitem"),p.li.appendChild(p.span),this.nodeRenderTitle(n),y.createNode&&y.createNode.call(g,{type:"createNode"},n)),y.renderNode&&y.renderNode.call(g,{type:"renderNode"},n)),C){if(b||p.expanded||!0===r){for(p.ul||(p.ul=document.createElement("ul"),(!0!==o||a)&&p.expanded||(p.ul.style.display="none"),v&&e(p.ul).attr("role","group"),p.li?p.li.appendChild(p.ul):p.tree.$div.append(p.ul)),c=0,u=C.length;c<u;c++)h=e.extend({},n,{node:C[c]}),this.nodeRender(h,i,r,!1,!0);for(s=p.ul.firstChild;s;)(d=s.ftnode)&&d.parent!==p?(p.debug("_fixParent: remove missing "+d,s),f=s.nextSibling,s.parentNode.removeChild(s),s=f):s=s.nextSibling;for(s=p.ul.firstChild,c=0,u=C.length-1;c<u;c++)(l=C[c])===(d=s.ftnode)?s=s.nextSibling:p.ul.insertBefore(l.li,d.li)}}else p.ul&&(this.warn("remove child markup for "+p),this.nodeRemoveChildMarkup(n));b||m&&x.ul.insertBefore(p.li,k)}},nodeRenderTitle:function(t,n){var i,r,o,a,s,l,d,u=t.node,f=t.tree,h=t.options,p=h.aria,g=u.getLevel(),m=[];void 0!==n&&(u.title=n),u.span&&!1!==f._enableUpdate&&(s=p&&!1!==u.hasChildren()?" role='button'":"",g<h.minExpandLevel?(u.lazy||(u.expanded=!0),g>1&&m.push("<span "+s+" class='fancytree-expander fancytree-expander-fixed'></span>")):m.push("<span "+s+" class='fancytree-expander'></span>"),(i=y.evalOption("checkbox",u,u,h,!1))&&!u.isStatusNode()&&(s=p?" role='checkbox'":"",r="fancytree-checkbox",("radio"===i||u.parent&&u.parent.radiogroup)&&(r+=" fancytree-radio"),m.push("<span "+s+" class='"+r+"'></span>")),void 0!==u.data.iconClass&&(u.icon?e.error("'iconClass' node option is deprecated since v2.14.0: use 'icon' only instead"):(u.warn("'iconClass' node option is deprecated since v2.14.0: use 'icon' instead"),u.icon=u.data.iconClass)),!1!==(o=y.evalOption("icon",u,u,h,!0))&&(s=p?" role='presentation'":"",d=(d=y.evalOption("iconTooltip",u,u,h,null))?" title='"+c(d)+"'":"","string"==typeof o?v.test(o)?(o="/"===o.charAt(0)?o:(h.imagePath||"")+o,m.push("<img src='"+o+"' class='fancytree-icon'"+d+" alt='' />")):m.push("<span "+s+" class='fancytree-custom-icon "+o+"'"+d+"></span>"):o.text?m.push("<span "+s+" class='fancytree-custom-icon "+(o.addClass||"")+"'"+d+">"+y.escapeHtml(o.text)+"</span>"):o.html?m.push("<span "+s+" class='fancytree-custom-icon "+(o.addClass||"")+"'"+d+">"+o.html+"</span>"):m.push("<span "+s+" class='fancytree-icon'"+d+"></span>")),a="",h.renderTitle&&(a=h.renderTitle.call(f,{type:"renderTitle"},t)||""),a||(!0===(l=y.evalOption("tooltip",u,u,h,null))&&(l=u.title),a="<span class='fancytree-title'"+(l=l?" title='"+c(l)+"'":"")+(h.titlesTabbable?" tabindex='0'":"")+">"+(h.escapeTitles?y.escapeHtml(u.title):u.title)+"</span>"),m.push(a),u.span.innerHTML=m.join(""),this.nodeRenderStatus(t),h.enhanceTitle&&(t.$title=e(">span.fancytree-title",u.span),a=h.enhanceTitle.call(f,{type:"enhanceTitle"},t)||""))},nodeRenderStatus:function(t){var n,i=t.node,r=t.tree,o=t.options,a=i.hasChildren(),s=i.isLastSibling(),l=o.aria,d=o._classNames,c=[],u=i[r.statusClassPropName];u&&!1!==r._enableUpdate&&(l&&(n=e(i.tr||i.li)),c.push(d.node),r.activeNode===i&&c.push(d.active),r.focusNode===i&&c.push(d.focused),i.expanded&&c.push(d.expanded),l&&(!1===a?n.removeAttr("aria-expanded"):n.attr("aria-expanded",Boolean(i.expanded))),i.folder&&c.push(d.folder),!1!==a&&c.push(d.hasChildren),s&&c.push(d.lastsib),i.lazy&&null==i.children&&c.push(d.lazy),i.partload&&c.push(d.partload),i.partsel&&c.push(d.partsel),y.evalOption("unselectable",i,i,o,!1)&&c.push(d.unselectable),i._isLoading&&c.push(d.loading),i._error&&c.push(d.error),i.statusNodeType&&c.push(d.statusNodePrefix+i.statusNodeType),i.selected?(c.push(d.selected),l&&n.attr("aria-selected",!0)):l&&n.attr("aria-selected",!1),i.extraClasses&&c.push(i.extraClasses),!1===a?c.push(d.combinedExpanderPrefix+"n"+(s?"l":"")):c.push(d.combinedExpanderPrefix+(i.expanded?"e":"c")+(i.lazy&&null==i.children?"d":"")+(s?"l":"")),c.push(d.combinedIconPrefix+(i.expanded?"e":"c")+(i.folder?"f":"")),u.className=c.join(" "),i.li&&e(i.li).toggleClass(d.lastsib,s))},nodeSetActive:function(n,i,r){r=r||{};var o,l=n.node,d=n.tree,c=n.options,u=!0===r.noEvents,f=!0===r.noFocus,h=!1!==r.scrollIntoView;return i=!1!==i,l===d.activeNode===i?a(l):i&&!u&&!1===this._triggerNodeEvent("beforeActivate",l,n.originalEvent)?s(l,["rejected"]):(i?(d.activeNode&&(t(d.activeNode!==l,"node was active (inconsistency)"),o=e.extend({},n,{node:d.activeNode}),d.nodeSetActive(o,!1),t(null===d.activeNode,"deactivate was out of sync?")),c.activeVisible&&l.makeVisible({scrollIntoView:h}),d.activeNode=l,d.nodeRenderStatus(n),f||d.nodeSetFocus(n),u||d._triggerNodeEvent("activate",l,n.originalEvent)):(t(d.activeNode===l,"node was not active (inconsistency)"),d.activeNode=null,this.nodeRenderStatus(n),u||n.tree._triggerNodeEvent("deactivate",l,n.originalEvent)),a(l))},nodeSetExpanded:function(t,n,i){i=i||{};var r,o,l,d,c,u,f=t.node,h=t.tree,p=t.options,g=!0===i.noAnimation,y=!0===i.noEvents;if(n=!1!==n,f.expanded&&n||!f.expanded&&!n)return a(f);if(n&&!f.lazy&&!f.hasChildren())return a(f);if(!n&&f.getLevel()<p.minExpandLevel)return s(f,["locked"]);if(!y&&!1===this._triggerNodeEvent("beforeExpand",f,t.originalEvent))return s(f,["rejected"]);if(g||f.isVisible()||(g=i.noAnimation=!0),o=new e.Deferred,n&&!f.expanded&&p.autoCollapse){c=f.getParentList(!1,!0),u=p.autoCollapse;try{for(p.autoCollapse=!1,l=0,d=c.length;l<d;l++)this._callHook("nodeCollapseSiblings",c[l],i)}finally{p.autoCollapse=u}}return o.done(function(){var e=f.getLastChild();n&&p.autoScroll&&!g&&e&&h._enableUpdate?e.scrollIntoView(!0,{topNode:f}).always(function(){y||t.tree._triggerNodeEvent(n?"expand":"collapse",t)}):y||t.tree._triggerNodeEvent(n?"expand":"collapse",t)}),r=function(i){var r,o,a=p._classNames,s=p.toggleEffect;if(f.expanded=n,h._callHook("treeStructureChanged",t,n?"expand":"collapse"),h._callHook("nodeRender",t,!1,!1,!0),f.ul)if(r="none"!==f.ul.style.display,o=!!f.expanded,r===o)f.warn("nodeSetExpanded: UL.style.display already set");else{if(s&&!g)return e(f.li).addClass(a.animating),void(e.isFunction(e(f.ul)[s.effect])?e(f.ul)[s.effect]({duration:s.duration,always:function(){e(this).removeClass(a.animating),e(f.li).removeClass(a.animating),i()}}):(e(f.ul).stop(!0,!0),e(f.ul).parent().find(".ui-effects-placeholder").remove(),e(f.ul).toggle(s.effect,s.options,s.duration,function(){e(this).removeClass(a.animating),e(f.li).removeClass(a.animating),i()})));f.ul.style.display=f.expanded||!parent?"":"none"}i()},n&&f.lazy&&void 0===f.hasChildren()?f.load().done(function(){o.notifyWith&&o.notifyWith(f,["loaded"]),r(function(){o.resolveWith(f)})}).fail(function(e){r(function(){o.rejectWith(f,["load failed ("+e+")"])})}):r(function(){o.resolveWith(f)}),o.promise()},nodeSetFocus:function(t,n){var i,r=t.tree,o=t.node,a=r.options,s=!!t.originalEvent&&e(t.originalEvent.target).is(":input");if(n=!1!==n,r.focusNode){if(r.focusNode===o&&n)return;i=e.extend({},t,{node:r.focusNode}),r.focusNode=null,this._triggerNodeEvent("blur",i),this._callHook("nodeRenderStatus",i)}if(n){this.hasFocus()||(o.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",t,!0,{calledByNode:!0})),o.makeVisible({scrollIntoView:!1}),r.focusNode=o,a.titlesTabbable&&(s||e(o.span).find(".fancytree-title").focus()),a.aria&&e(r.$container).attr("aria-activedescendant",e(o.tr||o.li).uniqueId().attr("id")),this._triggerNodeEvent("focus",t);document.activeElement===r.$container.get(0)||e(document.activeElement,r.$container).length>=1||e(r.$container).focus(),a.autoScroll&&o.scrollIntoView(),this._callHook("nodeRenderStatus",t)}},nodeSetSelected:function(e,t,n){n=n||{};var i=e.node,r=e.tree,o=e.options,a=!0===n.noEvents,s=i.parent;if(t=!1!==t,!y.evalOption("unselectable",i,i,o,!1)){if(i._lastSelectIntent=t,!!i.selected===t&&(3!==o.selectMode||!i.partsel||t))return t;if(!a&&!1===this._triggerNodeEvent("beforeSelect",i,e.originalEvent))return!!i.selected;t&&1===o.selectMode?(r.lastSelectedNode&&r.lastSelectedNode.setSelected(!1),i.selected=t):3!==o.selectMode||!s||s.radiogroup||i.radiogroup?s&&s.radiogroup?i.visitSiblings(function(e){e._changeSelectStatusAttrs(t&&e===i)},!0):i.selected=t:(i.selected=t,i.fixSelection3AfterClick(n)),this.nodeRenderStatus(e),r.lastSelectedNode=t?i:null,a||r._triggerNodeEvent("select",e)}},nodeSetStatus:function(t,n,i,r){function o(n,i){var r=a.children?a.children[0]:null;return r&&r.isStatusNode()?(e.extend(r,n),r.statusNodeType=i,s._callHook("nodeRenderTitle",r)):(a._setChildren([n]),s._callHook("treeStructureChanged",t,"setStatusNode"),a.children[0].statusNodeType=i,s.render()),a.children[0]}var a=t.node,s=t.tree;switch(n){case"ok":!function(){var e=a.children?a.children[0]:null;if(e&&e.isStatusNode()){try{a.ul&&(a.ul.removeChild(e.li),e.li=null)}catch(e){}1===a.children.length?a.children=[]:a.children.shift(),s._callHook("treeStructureChanged",t,"clearStatusNode")}}(),a._isLoading=!1,a._error=null,a.renderStatus();break;case"loading":a.parent||o({title:s.options.strings.loading+(i?" ("+i+")":""),checkbox:!1,tooltip:r},n),a._isLoading=!0,a._error=null,a.renderStatus();break;case"error":o({title:s.options.strings.loadError+(i?" ("+i+")":""),checkbox:!1,tooltip:r},n),a._isLoading=!1,a._error={message:i,details:r},a.renderStatus();break;case"nodata":o({title:i||s.options.strings.noData,checkbox:!1,tooltip:r},n),a._isLoading=!1,a._error=null,a.renderStatus();break;default:e.error("invalid node status "+n)}},nodeToggleExpanded:function(e){return this.nodeSetExpanded(e,!e.node.expanded)},nodeToggleSelected:function(e){var t=e.node,n=!t.selected;return t.partsel&&!t.selected&&!0===t._lastSelectIntent&&(n=!1,t.selected=!0),t._lastSelectIntent=n,this.nodeSetSelected(e,n)},treeClear:function(e){var t=e.tree;t.activeNode=null,t.focusNode=null,t.$div.find(">ul.fancytree-container").empty(),t.rootNode.children=null,t._callHook("treeStructureChanged",e,"clear")},treeCreate:function(e){},treeDestroy:function(e){this.$div.find(">ul.fancytree-container").remove(),this.$source&&this.$source.removeClass("fancytree-helper-hidden")},treeInit:function(t){var n=t.tree,i=n.options;n.$container.attr("tabindex",i.tabindex),e.each(T,function(e,t){void 0!==i[t]&&(n.info("Move option "+t+" to tree"),n[t]=i[t],delete i[t])}),i.checkboxAutoHide&&n.$container.addClass("fancytree-checkbox-auto-hide"),i.rtl?n.$container.attr("DIR","RTL").addClass("fancytree-rtl"):n.$container.removeAttr("DIR").removeClass("fancytree-rtl"),i.aria&&(n.$container.attr("role","tree"),1!==i.selectMode&&n.$container.attr("aria-multiselectable",!0)),this.treeLoad(t)},treeLoad:function(n,i){var r,o,a,s=n.tree,l=n.widget.element,c=e.extend({},n,{node:this.rootNode});if(s.rootNode.children&&this.treeClear(n),i=i||this.options.source)"string"==typeof i&&e.error("Not implemented");else switch(o=l.data("type")||"html"){case"html":(a=l.find(">ul").not(".fancytree-container").first()).length?(a.addClass("ui-fancytree-source fancytree-helper-hidden"),i=e.ui.fancytree.parseHtml(a),this.data=e.extend(this.data,d(a))):(y.warn("No `source` option was passed and container does not contain `<ul>`: assuming `source: []`."),i=[]);break;case"json":i=e.parseJSON(l.text()),l.contents().filter(function(){return 3===this.nodeType}).remove(),e.isPlainObject(i)&&(t(e.isArray(i.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),r=i,i=i.children,delete r.children,e.each(T,function(e,t){void 0!==r[t]&&(s[t]=r[t],delete r[t])}),e.extend(s.data,r));break;default:e.error("Invalid data-type: "+o)}return s._triggerTreeEvent("preInit",null),this.nodeLoadChildren(c,i).done(function(){s._callHook("treeStructureChanged",n,"loadChildren"),s.render(),3===n.options.selectMode&&s.rootNode.fixSelection3FromEndNodes(),s.activeNode&&s.options.activeVisible&&s.activeNode.makeVisible(),s._triggerTreeEvent("init",null,{status:!0})}).fail(function(){s.render(),s._triggerTreeEvent("init",null,{status:!1})})},treeRegisterNode:function(e,t,n){e.tree._callHook("treeStructureChanged",e,t?"addNode":"removeNode")},treeSetFocus:function(t,n,i){var r;(n=!1!==n)!==this.hasFocus()&&(this._hasFocus=n,!n&&this.focusNode?this.focusNode.setFocus(!1):!n||i&&i.calledByNode||e(this.$container).focus(),this.$container.toggleClass("fancytree-treefocus",n),this._triggerTreeEvent(n?"focusTree":"blurTree"),n&&!this.activeNode&&(r=this._lastMousedownNode||this.getFirstChild())&&r.setFocus())},treeSetOption:function(t,n,i){var r=t.tree,o=!0,a=!1,s=!1;switch(n){case"aria":case"checkbox":case"icon":case"minExpandLevel":case"tabindex":a=!0,s=!0;break;case"checkboxAutoHide":r.$container.toggleClass("fancytree-checkbox-auto-hide",!!i);break;case"escapeTitles":case"tooltip":s=!0;break;case"rtl":!1===i?r.$container.removeAttr("DIR").removeClass("fancytree-rtl"):r.$container.attr("DIR","RTL").addClass("fancytree-rtl"),s=!0;break;case"source":o=!1,r._callHook("treeLoad",r,i),s=!0}r.debug("set option "+n+"="+i+" <"+typeof i+">"),o&&(this.widget._super?this.widget._super.call(this.widget,n,i):e.Widget.prototype._setOption.call(this.widget,n,i)),a&&r._callHook("treeCreate",r),s&&r.render(!0,!1)},treeStructureChanged:function(e,t){}}),e.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!0,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,debugLevel:null,disabled:!1,enableAspx:42,escapeTitles:!1,extensions:[],toggleEffect:{effect:"slideToggle",duration:200},generateIds:!1,icon:!0,idPrefix:"ft_",focusOnSelect:!1,keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,nodata:!0,quicksearch:!1,rtl:!1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading...",loadError:"Load error!",moreData:"More...",noData:"No data."},tabindex:"0",titlesTabbable:!1,tooltip:!1,treeId:null,_classNames:{node:"fancytree-node",folder:"fancytree-folder",animating:"fancytree-animating",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",lazy:"fancytree-lazy",focused:"fancytree-focused",partload:"fancytree-partload",partsel:"fancytree-partsel",radio:"fancytree-radio",unselectable:"fancytree-unselectable",lastsib:"fancytree-lastsib",loading:"fancytree-loading",error:"fancytree-error",statusNodePrefix:"fancytree-statusnode-"},lazyLoad:null,postProcess:null},_deprecationWarning:function(e){var t=this.tree;t&&t.options.debugLevel>=3&&t.warn("$().fancytree('"+e+"') is deprecated (see https://wwwendt.de/tech/fancytree/doc/jsdoc/Fancytree_Widget.html")},_create:function(){this.tree=new h(this),this.$source=this.source||"json"===this.element.data("type")?this.element:this.element.find(">ul").first();var n,r,a,s=this.options,l=s.extensions;this.tree;for(a=0;a<l.length;a++)r=l[a],(n=e.ui.fancytree._extensions[r])||e.error("Could not apply extension '"+r+"' (it is not registered, did you forget to include it?)"),this.tree.options[r]=i({},n.options,this.tree.options[r]),t(void 0===this.tree.ext[r],"Extension name must not exist as Fancytree.ext attribute: '"+r+"'"),this.tree.ext[r]={},o(this.tree,0,n,r),n;void 0!==s.icons&&(!0===s.icon?(this.tree.warn("'icons' tree option is deprecated since v2.14.0: use 'icon' instead"),s.icon=s.icons):e.error("'icons' tree option is deprecated since v2.14.0: use 'icon' only instead")),void 0!==s.iconClass&&(s.icon?e.error("'iconClass' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'iconClass' tree option is deprecated since v2.14.0: use 'icon' instead"),s.icon=s.iconClass)),void 0!==s.tabbable&&(s.tabindex=s.tabbable?"0":"-1",this.tree.warn("'tabbable' tree option is deprecated since v2.17.0: use 'tabindex='"+s.tabindex+"' instead")),this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree),this._bind()},_setOption:function(e,t){return this.tree._callHook("treeSetOption",this.tree,e,t)},_destroy:function(){this._unbind(),this.tree._callHook("treeDestroy",this.tree)},_unbind:function(){var t=this.tree._ns;this.element.off(t),this.tree.$container.off(t),e(document).off(t)},_bind:function(){var t=this,n=this.options,i=this.tree,r=i._ns;this._unbind(),i.$container.on("focusin"+r+" focusout"+r,function(t){var n=y.getNode(t),r="focusin"===t.type;if(!r&&n&&e(t.target).is("a"))n.debug("Ignored focusout on embedded <a> element.");else{if(r){if(i._getExpiringValue("focusin"))return void i.debug("Ignored double focusin.");i._setExpiringValue("focusin",!0,50),n||(n=i._getExpiringValue("mouseDownNode"))&&i.debug("Reconstruct mouse target for focusin from recent event.")}n?i._callHook("nodeSetFocus",i._makeHookContext(n,t),r):i.tbody&&e(t.target).parents("table.fancytree-container > thead").length?i.debug("Ignore focus event outside table body.",t):i._callHook("treeSetFocus",i,r)}}).on("selectstart"+r,"span.fancytree-title",function(e){e.preventDefault()}).on("keydown"+r,function(e){if(n.disabled||!1===n.keyboard)return!0;var t,r=i.focusNode,o=i._makeHookContext(r||i,e),a=i.phase;try{return i.phase="userEvent","preventNav"===(t=r?i._triggerNodeEvent("keydown",r,e):i._triggerTreeEvent("keydown",e))?t=!0:!1!==t&&(t=i._callHook("nodeKeydown",o)),t}finally{i.phase=a}}).on("mousedown"+r,function(e){var t=y.getEventTarget(e);i._lastMousedownNode=t?t.node:null,i._setExpiringValue("mouseDownNode",i._lastMousedownNode)}).on("click"+r+" dblclick"+r,function(e){if(n.disabled)return!0;var i,r=y.getEventTarget(e),o=r.node,a=t.tree,s=a.phase;if(!o)return!0;i=a._makeHookContext(o,e);try{switch(a.phase="userEvent",e.type){case"click":return i.targetType=r.type,o.isPagingNode()?!0===a._triggerNodeEvent("clickPaging",i,e):!1!==a._triggerNodeEvent("click",i,e)&&a._callHook("nodeClick",i);case"dblclick":return i.targetType=r.type,!1!==a._triggerNodeEvent("dblclick",i,e)&&a._callHook("nodeDblclick",i)}}finally{a.phase=s}})},getActiveNode:function(){return this._deprecationWarning("getActiveNode"),this.tree.activeNode},getNodeByKey:function(e){return this._deprecationWarning("getNodeByKey"),this.tree.getNodeByKey(e)},getRootNode:function(){return this._deprecationWarning("getRootNode"),this.tree.rootNode},getTree:function(){return this._deprecationWarning("getTree"),this.tree}}),y=e.ui.fancytree,e.extend(e.ui.fancytree,{version:"2.35.0",buildType:"production",debugLevel:3,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:h,_FancytreeNodeClass:f,jquerySupports:{positionMyOfs:function(t,n,i,r){var o,a,s,l=e.map(e.trim(t).split("."),function(e){return parseInt(e,10)}),d=e.map(Array.prototype.slice.call(arguments,1),function(e){return parseInt(e,10)});for(o=0;o<d.length;o++)if(a=l[o]||0,s=d[o]||0,a!==s)return a>s;return!0}(e.ui.version,1,9)},assert:function(e,n){return t(e,n)},createTree:function(t,n){var i=e(t).fancytree(n);return y.getTree(i)},debounce:function(e,t,n,i){var r;return 3===arguments.length&&"boolean"!=typeof n&&(i=n,n=!1),function(){var o=arguments;i=i||this,n&&!r&&t.apply(i,o),clearTimeout(r),r=setTimeout(function(){n||t.apply(i,o),r=null},e)}},debug:function(t){e.ui.fancytree.debugLevel>=4&&n("log",arguments)},error:function(t){e.ui.fancytree.debugLevel>=1&&n("error",arguments)},escapeHtml:function(e){return(""+e).replace(m,function(e){return k[e]})},fixPositionOptions:function(t){if((t.offset||(""+t.my+t.at).indexOf("%")>=0)&&e.error("expected new position syntax (but '%' is not supported)"),!e.ui.fancytree.jquerySupports.positionMyOfs){var n=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(t.my),i=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(t.at),r=(n[2]?+n[2]:0)+(i[2]?+i[2]:0),o=(n[4]?+n[4]:0)+(i[4]?+i[4]:0);t=e.extend({},t,{my:n[1]+" "+n[3],at:i[1]+" "+i[3]}),(r||o)&&(t.offset=r+" "+o)}return t},getEventTarget:function(t){var n,i=t&&t.target?t.target.className:"",r={node:this.getNode(t.target),type:void 0};return/\bfancytree-title\b/.test(i)?r.type="title":/\bfancytree-expander\b/.test(i)?r.type=!1===r.node.hasChildren()?"prefix":"expander":/\bfancytree-checkbox\b/.test(i)?r.type="checkbox":/\bfancytree(-custom)?-icon\b/.test(i)?r.type="icon":/\bfancytree-node\b/.test(i)?r.type="title":t&&t.target&&((n=e(t.target)).is("ul[role=group]")?((r.node&&r.node.tree||y).debug("Ignoring click on outer UL."),r.node=null):n.closest(".fancytree-title").length?r.type="title":n.closest(".fancytree-checkbox").length?r.type="checkbox":n.closest(".fancytree-expander").length&&(r.type="expander")),r},getEventTargetType:function(e){return this.getEventTarget(e).type},getNode:function(t){if(t instanceof f)return t;for(t instanceof e?t=t[0]:void 0!==t.originalEvent&&(t=t.target);t;){if(t.ftnode)return t.ftnode;t=t.parentNode}return null},getTree:function(t){var n,i=t;return t instanceof h?t:(void 0===t&&(t=0),"number"==typeof t?t=e(".fancytree-container").eq(t):"string"==typeof t?(t=e("#ft-id-"+i).eq(0)).length||(t=e(i).eq(0)):t instanceof Element||t instanceof HTMLDocument?t=e(t):t instanceof e?t=t.eq(0):void 0!==t.originalEvent&&(t=e(t.target)),t=t.closest(":ui-fancytree"),(n=t.data("ui-fancytree")||t.data("fancytree"))?n.tree:null)},evalOption:function(t,n,i,r,o){var a,s,l=n.tree,d=r[t],c=i[t];return e.isFunction(d)?(a={node:n,tree:l,widget:l.widget,options:l.widget.options,typeInfo:l.types[n.type]||{}},null==(s=d.call(l,{type:t},a))&&(s=c)):s=null==c?d:c,null==s&&(s=o),s},setSpanIcon:function(t,n,i){var r=e(t);"string"==typeof i?r.attr("class",n+" "+i):(i.text?r.text(""+i.text):i.html&&(t.innerHTML=i.html),r.attr("class",n+" "+(i.addClass||"")))},eventToString:function(e){var t=e.which,n=e.type,i=[];return e.altKey&&i.push("alt"),e.ctrlKey&&i.push("ctrl"),e.metaKey&&i.push("meta"),e.shiftKey&&i.push("shift"),"click"===n||"dblclick"===n?i.push(S[e.button]+n):"wheel"===n?i.push(n):w[t]||i.push(_[t]||String.fromCharCode(t).toLowerCase()),i.join("+")},info:function(t){e.ui.fancytree.debugLevel>=3&&n("info",arguments)},keyEventToString:function(e){return this.warn("keyEventToString() is deprecated: use eventToString()"),this.eventToString(e)},overrideMethod:function(t,n,i,r){var o,a=t[n]||e.noop;t[n]=function(){var e=r||this;try{return o=e._super,e._super=a,i.apply(e,arguments)}finally{e._super=o}}},parseHtml:function(t){var n,i,r,o,a,s,l,c,u=[];return t.find(">li").each(function(){var f,h,p=e(this),g=p.find(">span",this).first(),y=g.length?null:p.find(">a").first(),v={tooltip:null,data:{}};for(g.length?v.title=g.html():y&&y.length?(v.title=y.html(),v.data.href=y.attr("href"),v.data.target=y.attr("target"),v.tooltip=y.attr("title")):(v.title=p.html(),(a=v.title.search(/<ul/i))>=0&&(v.title=v.title.substring(0,a))),v.title=e.trim(v.title),o=0,s=E.length;o<s;o++)v[E[o]]=void 0;for(n=this.className.split(" "),r=[],o=0,s=n.length;o<s;o++)i=n[o],A[i]?v[i]=!0:r.push(i);if(v.extraClasses=r.join(" "),(l=p.attr("title"))&&(v.tooltip=l),(l=p.attr("id"))&&(v.key=l),p.attr("hideCheckbox")&&(v.checkbox=!1),(f=d(p))&&!e.isEmptyObject(f)){for(h in I)f.hasOwnProperty(h)&&(f[I[h]]=f[h],delete f[h]);for(o=0,s=D.length;o<s;o++)l=D[o],null!=(c=f[l])&&(delete f[l],v[l]=c);e.extend(v.data,f)}(t=p.find(">ul").first()).length?v.children=e.ui.fancytree.parseHtml(t):v.children=v.lazy?void 0:null,u.push(v)}),u},registerExtension:function(n){t(null!=n.name,"extensions must have a `name` property."),t(null!=n.version,"extensions must have a `version` property."),e.ui.fancytree._extensions[n.name]=n},unescapeHtml:function(e){var t=document.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue},warn:function(t){e.ui.fancytree.debugLevel>=2&&n("warn",arguments)}}),e.ui.fancytree}e.ui.fancytree.warn("Fancytree: ignored duplicate include")}}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";return e.ui.fancytree._FancytreeClass.prototype.countSelected=function(e){this.options;return this.getSelectedNodes(e).length},e.ui.fancytree._FancytreeNodeClass.prototype.updateCounters=function(){var t=e("span.fancytree-childcounter",this.span),n=this.tree.options.childcounter,i=this.countChildren(n.deep);this.data.childCounter=i,!i&&n.hideZeros||this.isExpanded()&&n.hideExpanded?t.remove():(t.length||(t=e("<span class='fancytree-childcounter'/>").appendTo(e("span.fancytree-icon,span.fancytree-custom-icon",this.span))),t.text(i)),!n.deep||this.isTopLevel()||this.isRootNode()||this.parent.updateCounters()},e.ui.fancytree.prototype.widgetMethod1=function(e){this.tree;return e},e.ui.fancytree.registerExtension({name:"childcounter",version:"2.35.0",options:{deep:!0,hideZeros:!0,hideExpanded:!1},foo:42,_appendCounter:function(e){},treeInit:function(e){e.options,e.options.childcounter;this._superApply(arguments),this.$container.addClass("fancytree-ext-childcounter")},treeDestroy:function(e){this._superApply(arguments)},nodeRenderTitle:function(t,n){var i=t.node,r=t.options.childcounter,o=null==i.data.childCounter?i.countChildren(r.deep):+i.data.childCounter;this._super(t,n),!o&&r.hideZeros||i.isExpanded()&&r.hideExpanded||e("span.fancytree-icon,span.fancytree-custom-icon",i.span).append(e("<span class='fancytree-childcounter'/>").text(o))},nodeSetExpanded:function(e,t,n){var i=e.tree;e.node;return this._superApply(arguments).always(function(){i.nodeRenderTitle(e)})}}),e.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";function t(t,n){t||(n=n?": "+n:"",e.error("Assertion failed"+n))}function n(e,t,n){for(var i,r,o=3&e.length,a=e.length-o,s=n,l=3432918353,d=0;d<a;)r=255&e.charCodeAt(d)|(255&e.charCodeAt(++d))<<8|(255&e.charCodeAt(++d))<<16|(255&e.charCodeAt(++d))<<24,++d,s=27492+(65535&(i=5*(65535&(s=(s^=r=461845907*(65535&(r=(r=(65535&r)*l+(((r>>>16)*l&65535)<<16)&4294967295)<<15|r>>>17))+((461845907*(r>>>16)&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(i>>>16)&65535)<<16);switch(r=0,o){case 3:r^=(255&e.charCodeAt(d+2))<<16;case 2:r^=(255&e.charCodeAt(d+1))<<8;case 1:s^=r=461845907*(65535&(r=(r=(65535&(r^=255&e.charCodeAt(d)))*l+(((r>>>16)*l&65535)<<16)&4294967295)<<15|r>>>17))+((461845907*(r>>>16)&65535)<<16)&4294967295}return s^=e.length,s^=s>>>16,s=2246822507*(65535&s)+((2246822507*(s>>>16)&65535)<<16)&4294967295,s^=s>>>13,s=3266489909*(65535&s)+((3266489909*(s>>>16)&65535)<<16)&4294967295,s^=s>>>16,t?("0000000"+(s>>>0).toString(16)).substr(-8):s>>>0}return e.ui.fancytree._FancytreeNodeClass.prototype.getCloneList=function(t){var n,i=this.tree,r=i.refMap[this.refKey]||null,o=i.keyMap;return r&&(n=this.key,t?r=e.map(r,function(e){return o[e]}):(r=e.map(r,function(e){return e===n?null:o[e]})).length<1&&(r=null)),r},e.ui.fancytree._FancytreeNodeClass.prototype.isClone=function(){var e=this.refKey||null,t=e&&this.tree.refMap[e]||null;return!!(t&&t.length>1)},e.ui.fancytree._FancytreeNodeClass.prototype.reRegister=function(t,n){t=null==t?null:""+t,n=null==n?null:""+n;var i=this.tree,r=this.key,o=this.refKey,a=i.keyMap,s=i.refMap,l=s[o]||null,d=!1;return null!=t&&t!==this.key&&(a[t]&&e.error("[ext-clones] reRegister("+t+"): already exists: "+this),delete a[r],a[t]=this,l&&(s[o]=e.map(l,function(e){return e===r?t:e})),this.key=t,d=!0),null!=n&&n!==this.refKey&&(l&&(1===l.length?delete s[o]:s[o]=e.map(l,function(e){return e===r?null:e})),s[n]?s[n].append(t):s[n]=[this.key],this.refKey=n,d=!0),d},e.ui.fancytree._FancytreeNodeClass.prototype.setRefKey=function(e){return this.reRegister(null,e)},e.ui.fancytree._FancytreeClass.prototype.getNodesByRef=function(t,n){var i=this.keyMap,r=this.refMap[t]||null;return r&&(r=n?e.map(r,function(e){var t=i[e];return t.isDescendantOf(n)?t:null}):e.map(r,function(e){return i[e]})).length<1&&(r=null),r},e.ui.fancytree._FancytreeClass.prototype.changeRefKey=function(e,t){var n,i=this.keyMap,r=this.refMap[e]||null;if(r){for(n=0;n<r.length;n++)i[r[n]].refKey=t;delete this.refMap[e],this.refMap[t]=r}},e.ui.fancytree.registerExtension({name:"clones",version:"2.35.0",options:{highlightActiveClones:!0,highlightClones:!1},treeCreate:function(e){this._superApply(arguments),e.tree.refMap={},e.tree.keyMap={}},treeInit:function(i){this.$container.addClass("fancytree-ext-clones"),t(null==i.options.defaultKey),i.options.defaultKey=function(t){return function(t){var i,r=e.map(t.getParentList(!1,!0),function(e){return e.refKey||e.key});return r=r.join("/"),"id_"+(i=n(r,!0))+n(i+r,!0)}(t)},this._superApply(arguments)},treeClear:function(e){return e.tree.refMap={},e.tree.keyMap={},this._superApply(arguments)},treeRegisterNode:function(n,i,r){var o,a,s=n.tree,l=s.keyMap,d=s.refMap,c=r.key,u=r&&null!=r.refKey?""+r.refKey:null;if(r.isStatusNode())return this._super(n,i,r);if(i){if(null!=l[r.key]){var f=l[r.key],h="clones.treeRegisterNode: duplicate key '"+r.key+"': /"+r.getPath(!0)+" => "+f.getPath(!0);s.error(h),e.error(h)}l[c]=r,u&&((o=d[u])?(o.push(c),2===o.length&&n.options.clones.highlightClones&&l[o[0]].renderStatus()):d[u]=[c])}else null==l[c]&&e.error("clones.treeRegisterNode: node.key not registered: "+r.key),delete l[c],u&&(o=d[u])&&((a=o.length)<=1?(t(1===a),t(o[0]===c),delete d[u]):(!function(e,t){var n;for(n=e.length-1;n>=0;n--)if(e[n]===t)return e.splice(n,1),!0}(o,c),2===a&&n.options.clones.highlightClones&&l[o[0]].renderStatus()));return this._super(n,i,r)},nodeRenderStatus:function(t){var n,i,r=t.node;return i=this._super(t),t.options.clones.highlightClones&&(n=e(r[t.tree.statusClassPropName])).length&&r.isClone()&&n.addClass("fancytree-clone"),i},nodeSetActive:function(t,n,i){var r,o=t.tree.statusClassPropName,a=t.node;return r=this._superApply(arguments),t.options.clones.highlightActiveClones&&a.isClone()&&e.each(a.getCloneList(!0),function(t,i){e(i[o]).toggleClass("fancytree-active-clone",!1!==n)}),r}}),e.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";function t(){_=null,T=null,S=null,E=null,N=null,C=null,k=null,w&&w.removeClass(u+" "+f),w=null,b&&b.hide(),l&&(l.remove(),l=null)}function n(e){return 0===e?"":e>0?"+"+e:""+e}function i(e,t){var n=t.tree,i=t.dataTransfer;"dragstart"===e.type?(t.effectAllowed=n.options.dnd5.effectAllowed,t.dropEffect=n.options.dnd5.dropEffectDefault):(t.effectAllowed=E,t.dropEffect=S),t.dropEffectSuggested=function(e,t,n){var i=n;return c?t.metaKey&&t.altKey?i="link":t.ctrlKey?i="link":t.metaKey?i="move":t.altKey&&(i="copy"):t.ctrlKey?i="copy":t.shiftKey?i="move":t.altKey&&(i="link"),i!==N&&e.info("evalEffectModifiers: "+t.type+" - evalEffectModifiers(): "+N+" -> "+i),N=i,i}(n,e,n.options.dnd5.dropEffectDefault),t.isMove="move"===t.dropEffect,t.files=i.files||[]}function r(e,t,n){var i=t.tree,r=t.dataTransfer;return"dragstart"!==e.type&&E!==t.effectAllowed&&i.warn("effectAllowed should only be changed in dragstart event: "+e.type+": data.effectAllowed changed from "+E+" -> "+t.effectAllowed),!1===n&&(i.info("applyDropEffectCallback: allowDrop === false"),t.effectAllowed="none",t.dropEffect="none"),t.isMove="move"===t.dropEffect,E=t.effectAllowed,S=t.dropEffect,r.effectAllowed=E,r.dropEffect=S,S}function o(t,o){if(o.options.dnd5.scroll&&function(t,n){var i,r,o=t.options.dnd5,a=t.$scrollParent[0],s=o.scrollSensitivity,l=o.scrollSpeed,d=0;a!==document&&"HTML"!==a.tagName?(i=t.$scrollParent.offset(),r=a.scrollTop,i.top+a.offsetHeight-n.pageY<s?a.scrollHeight-t.$scrollParent.innerHeight()-r>0&&(a.scrollTop=d=r+l):r>0&&n.pageY-i.top<s&&(a.scrollTop=d=r-l)):(r=e(document).scrollTop())>0&&n.pageY-r<s?(d=r-l,e(document).scrollTop(d)):e(window).height()-(n.pageY-r)<s&&(d=r+l,e(document).scrollTop(d)),d&&t.debug("autoScroll: "+d+"px")}(o.tree,t),!o.node)return o.tree.warn("Ignored dragover for non-node"),A;var a,s,l,c,u=null,f=o.tree,x=f.options,C=x.dnd5,k=o.node,w=o.otherNode,N="center",S=e(k.span),E=S.find("span.fancytree-title");if(!1===_)return f.debug("Ignored dragover, since dragenter returned false."),!1;if("string"==typeof _&&e.error("assert failed: dragenter returned string"),s=S.offset(),c=(t.pageY-s.top)/S.height(),_.after&&c>.75?u="after":!_.over&&_.after&&c>.5?u="after":_.before&&c<=.25?u="before":!_.over&&_.before&&c<=.5?u="before":_.over&&(u="over"),C.preventVoidMoves&&"move"===o.dropEffect&&(k===w?(k.debug("Drop over source node prevented."),u=null):"before"===u&&w&&k===w.getNextSibling()?(k.debug("Drop after source node prevented."),u=null):"after"===u&&w&&k===w.getPrevSibling()?(k.debug("Drop before source node prevented."),u=null):"over"===u&&w&&w.parent===k&&w.isLastSibling()&&(k.debug("Drop last child over own parent prevented."),u=null)),o.hitMode=u,u&&C.dragOver){i(t,o),C.dragOver(k,o);r(t,o,!!u),u=o.hitMode}if(A=u,"after"===u||"before"===u||"over"===u){switch(a=C.dropMarkerOffsetX||0,u){case"before":N="top",a+=C.dropMarkerInsertOffsetX||0;break;case"after":N="bottom",a+=C.dropMarkerInsertOffsetX||0}l={my:"left"+n(a)+" center",at:"left "+N,of:E},x.rtl&&(l.my="right"+n(-a)+" center",l.at="right "+N),b.toggleClass(p,"after"===u).toggleClass(y,"over"===u).toggleClass(g,"before"===u).show().position(d.fixPositionOptions(l))}else b.hide();return e(k.span).toggleClass(m,"after"===u||"before"===u||"over"===u).toggleClass(p,"after"===u).toggleClass(g,"before"===u).toggleClass(h,"over"===u).toggleClass(v,!1===u),u}function a(n){var a,s,l,c,u=this.options.dnd5,f=null,p=d.getNode(n),g=n.dataTransfer||n.originalEvent.dataTransfer,m={tree:this,node:p,options:this.options,originalEvent:n.originalEvent,widget:this.widget,hitMode:_,dataTransfer:g,otherNode:C||null,otherNodeList:k||null,otherNodeData:null,useDefaultImage:!0,dropEffect:void 0,dropEffectSuggested:void 0,effectAllowed:void 0,files:null,isCancelled:void 0,isMove:void 0};switch(n.type){case"dragenter":if(T=null,!p){this.debug("Ignore non-node "+n.type+": "+n.target.tagName+"."+n.target.className),_=!1;break}if(e(p.span).addClass(y).removeClass(h+" "+v),l=e.inArray(x,g.types)>=0,u.preventNonNodes&&!l){p.debug("Reject dropping a non-node."),_=!1;break}if(u.preventForeignNodes&&(!C||C.tree!==p.tree)){p.debug("Reject dropping a foreign node."),_=!1;break}if(u.preventSameParent&&m.otherNode&&m.otherNode.tree===p.tree&&p.parent===m.otherNode.parent){p.debug("Reject dropping as sibling (same parent)."),_=!1;break}if(u.preventRecursion&&m.otherNode&&m.otherNode.tree===p.tree&&p.isDescendantOf(m.otherNode)){p.debug("Reject dropping below own ancestor."),_=!1;break}if(u.preventLazyParents&&!p.isLoaded()){p.warn("Drop over unloaded target node prevented."),_=!1;break}b.show(),i(n,m),c=function(t){var n;return!!t&&(n=e.isPlainObject(t)?{over:!!t.over,before:!!t.before,after:!!t.after}:e.isArray(t)?{over:e.inArray("over",t)>=0,before:e.inArray("before",t)>=0,after:e.inArray("after",t)>=0}:{over:!0===t||"over"===t,before:!0===t||"before"===t,after:!0===t||"after"===t},0!==Object.keys(n).length&&n)}(u.dragEnter(p,m)),_=c,r(n,m,f=c&&(c.over||c.before||c.after));break;case"dragover":if(!p){this.debug("Ignore non-node "+n.type+": "+n.target.tagName+"."+n.target.className);break}i(n,m),f=!!(A=o(n,m)),("over"===A||!1===A)&&!p.expanded&&!1!==p.hasChildren()?T?!(u.autoExpandMS&&Date.now()-T>u.autoExpandMS)||p.isLoading()||u.dragExpand&&!1===u.dragExpand(p,m)||p.setExpanded():T=Date.now():T=null;break;case"dragleave":if(!p){this.debug("Ignore non-node "+n.type+": "+n.target.tagName+"."+n.target.className);break}if(!e(p.span).hasClass(y)){p.debug("Ignore dragleave (multi).");break}e(p.span).removeClass(y+" "+h+" "+v),p.scheduleAction("cancel"),u.dragLeave(p,m),b.hide();break;case"drop":if(e.inArray(x,g.types)>=0&&(s=g.getData(x),this.info(n.type+": getData('application/x-fancytree-node'): '"+s+"'")),s||(s=g.getData("text"),this.info(n.type+": getData('text'): '"+s+"'")),s)try{void 0!==(a=JSON.parse(s)).title&&(m.otherNodeData=a)}catch(e){}this.debug(n.type+": nodeData: '"+s+"', otherNodeData: ",m.otherNodeData),e(p.span).removeClass(y+" "+h+" "+v),m.hitMode=A,i(n,m),m.isCancelled=!A;var w=C&&C.span,N=C&&C.tree;u.dragDrop(p,m),n.preventDefault(),w&&!document.body.contains(w)&&(N===this?(this.debug("Drop handler removed source element: generating dragEnd."),u.dragEnd(C,m)):this.warn("Drop handler removed source element: dragend event may be lost.")),t()}if(f)return n.preventDefault(),!1}var s,l,d=e.ui.fancytree,c=/Mac/.test(navigator.platform),u="fancytree-drag-source",f="fancytree-drag-remove",h="fancytree-drop-accept",p="fancytree-drop-after",g="fancytree-drop-before",y="fancytree-drop-over",v="fancytree-drop-reject",m="fancytree-drop-target",x="application/x-fancytree-node",b=null,C=null,k=null,w=null,_=null,N=null,S=null,E=null,A=null,T=null;return e.ui.fancytree.getDragNodeList=function(){return k||[]},e.ui.fancytree.getDragNode=function(){return C},e.ui.fancytree.registerExtension({name:"dnd5",version:"2.35.0",options:{autoExpandMS:1500,dropMarkerInsertOffsetX:-16,dropMarkerOffsetX:-24,multiSource:!1,effectAllowed:"all",dropEffectDefault:"move",preventForeignNodes:!1,preventLazyParents:!0,preventNonNodes:!1,preventRecursion:!0,preventSameParent:!1,preventVoidMoves:!0,scroll:!0,scrollSensitivity:20,scrollSpeed:5,setTextTypeJson:!1,dragStart:null,dragDrag:e.noop,dragEnd:e.noop,dragEnter:null,dragOver:e.noop,dragExpand:e.noop,dragDrop:e.noop,dragLeave:e.noop},treeInit:function(n){var o,c=n.tree,h=n.options,p=h.glyph||null,g=h.dnd5;e.inArray("dnd",h.extensions)>=0&&e.error("Extensions 'dnd' and 'dnd5' are mutually exclusive."),g.dragStop&&e.error("dragStop is not used by ext-dnd5. Use dragEnd instead."),null!=g.preventRecursiveMoves&&e.error("preventRecursiveMoves was renamed to preventRecursion."),g.dragStart&&d.overrideMethod(n.options,"createNode",function(e,t){this._super.apply(this,arguments),t.node.span?t.node.span.draggable=!0:t.node.warn("Cannot add `draggable`: no span tag")}),this._superApply(arguments),this.$container.addClass("fancytree-ext-dnd5"),o=e("<span>").appendTo(this.$container),this.$scrollParent=o.scrollParent(),o.remove(),(b=e("#fancytree-drop-marker")).length||(b=e("<div id='fancytree-drop-marker'></div>").hide().css({"z-index":1e3,"pointer-events":"none"}).prependTo("body"),p&&d.setSpanIcon(b[0],p.map._addClass,p.map.dropMarker)),b.toggleClass("fancytree-rtl",!!h.rtl),g.dragStart&&c.$container.on("dragstart drag dragend",function(n){var o,a=this,c=a.options.dnd5,h=d.getNode(n),p=n.dataTransfer||n.originalEvent.dataTransfer,g={tree:a,node:h,options:a.options,originalEvent:n.originalEvent,widget:a.widget,dataTransfer:p,useDefaultImage:!0,dropEffect:void 0,dropEffectSuggested:void 0,effectAllowed:void 0,files:void 0,isCancelled:void 0,isMove:void 0};switch(n.type){case"dragstart":if(!h)return a.info("Ignored dragstart on a non-node."),!1;C=h,!1===c.multiSource?k=[h]:!0===c.multiSource?(k=a.getSelectedNodes(),h.isSelected()||k.unshift(h)):k=c.multiSource(h,g),(w=e(e.map(k,function(e){return e.span}))).addClass(u);var y=h.toDict();y.treeId=h.tree._id,o=JSON.stringify(y);try{p.setData(x,o),p.setData("text/html",e(h.span).html()),p.setData("text/plain",h.title)}catch(e){a.warn("Could not set data (IE only accepts 'text') - "+e)}return c.setTextTypeJson?p.setData("text",o):p.setData("text",h.title),i(n,g),!1===c.dragStart(h,g)?(t(),!1):(r(n,g),l=null,g.useDefaultImage&&(s=e(h.span).find(".fancytree-title"),k&&k.length>1&&(l=e("<span class='fancytree-childcounter'/>").text("+"+(k.length-1)).appendTo(s)),p.setDragImage&&p.setDragImage(s[0],-10,-10)),!0);case"drag":i(n,g),c.dragDrag(h,g),r(n,g),w.toggleClass(f,g.isMove);break;case"dragend":i(n,g),t(),g.isCancelled=!A,c.dragEnd(h,g,!A)}}.bind(c)),g.dragEnter&&c.$container.on("dragenter dragover dragleave drop",a.bind(c))}}),e.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";var t=/Mac/.test(navigator.platform),n=e.ui.fancytree.escapeHtml,i=e.ui.fancytree.unescapeHtml;return e.ui.fancytree._FancytreeNodeClass.prototype.editStart=function(){var t,n=this,r=this.tree,o=r.ext.edit,a=r.options.edit,s=e(".fancytree-title",n.span),l={node:n,tree:r,options:r.options,isNew:e(n[r.statusClassPropName]).hasClass("fancytree-edit-new"),orgTitle:n.title,input:null,dirty:!1};if(!1===a.beforeEdit.call(n,{type:"beforeEdit"},l))return!1;e.ui.fancytree.assert(!o.currentNode,"recursive edit"),o.currentNode=this,o.eventData=l,r.widget._unbind(),o.lastDraggableAttrValue=n.span.draggable,o.lastDraggableAttrValue&&(n.span.draggable=!1),e(document).on("mousedown.fancytree-edit",function(t){e(t.target).hasClass("fancytree-edit-input")||n.editEnd(!0,t)}),t=e("<input />",{class:"fancytree-edit-input",type:"text",value:r.options.escapeTitles?l.orgTitle:i(l.orgTitle)}),o.eventData.input=t,null!=a.adjustWidthOfs&&t.width(s.width()+a.adjustWidthOfs),null!=a.inputCss&&t.css(a.inputCss),s.html(t),t.focus().change(function(e){t.addClass("fancytree-edit-dirty")}).on("keydown",function(t){switch(t.which){case e.ui.keyCode.ESCAPE:n.editEnd(!1,t);break;case e.ui.keyCode.ENTER:return n.editEnd(!0,t),!1}t.stopPropagation()}).blur(function(e){return n.editEnd(!0,e)}),a.edit.call(n,{type:"edit"},l)},e.ui.fancytree._FancytreeNodeClass.prototype.editEnd=function(t,i){var r,o=this,a=this.tree,s=a.ext.edit,l=s.eventData,d=a.options.edit,c=e(".fancytree-title",o.span).find("input.fancytree-edit-input");return d.trim&&c.val(e.trim(c.val())),r=c.val(),l.dirty=r!==o.title,l.originalEvent=i,!1===t?l.save=!1:l.isNew?l.save=""!==r:l.save=l.dirty&&""!==r,!1!==d.beforeClose.call(o,{type:"beforeClose"},l)&&((!l.save||!1!==d.save.call(o,{type:"save"},l))&&(c.removeClass("fancytree-edit-dirty").off(),e(document).off(".fancytree-edit"),l.save?(o.setTitle(a.options.escapeTitles?r:n(r)),o.setFocus()):l.isNew?(o.remove(),o=l.node=null,s.relatedNode.setFocus()):(o.renderTitle(),o.setFocus()),s.eventData=null,s.currentNode=null,s.relatedNode=null,a.widget._bind(),o&&s.lastDraggableAttrValue&&(o.span.draggable=!0),e(a.$container).focus(),l.input=null,d.close.call(o,{type:"close"},l),!0))},e.ui.fancytree._FancytreeNodeClass.prototype.editCreateNode=function(t,n){var i,r=this.tree,o=this;t=t||"child",null==n?n={title:""}:"string"==typeof n?n={title:n}:e.ui.fancytree.assert(e.isPlainObject(n)),"child"!==t||this.isExpanded()||!1===this.hasChildren()?((i=this.addNode(n,t)).match=!0,e(i[r.statusClassPropName]).removeClass("fancytree-hide").addClass("fancytree-match"),i.makeVisible().done(function(){e(i[r.statusClassPropName]).addClass("fancytree-edit-new"),o.tree.ext.edit.relatedNode=o,i.editStart()})):this.setExpanded().done(function(){o.editCreateNode(t,n)})},e.ui.fancytree._FancytreeClass.prototype.isEditing=function(){return this.ext.edit?this.ext.edit.currentNode:null},e.ui.fancytree._FancytreeNodeClass.prototype.isEditing=function(){return!!this.tree.ext.edit&&this.tree.ext.edit.currentNode===this},e.ui.fancytree.registerExtension({name:"edit",version:"2.35.0",options:{adjustWidthOfs:4,allowEmpty:!1,inputCss:{minWidth:"3em"},triggerStart:["f2","mac+enter","shift+click"],trim:!0,beforeClose:e.noop,beforeEdit:e.noop,close:e.noop,edit:e.noop,save:e.noop},currentNode:null,treeInit:function(e){var t=e.tree;this._superApply(arguments),this.$container.addClass("fancytree-ext-edit").on("fancytreebeforeupdateviewport",function(e,n){var i=t.isEditing();i&&(i.info("Cancel edit due to scroll event."),i.editEnd(!1,e))})},nodeClick:function(t){var n=e.ui.fancytree.eventToString(t.originalEvent),i=t.options.edit.triggerStart;return"shift+click"===n&&e.inArray("shift+click",i)>=0&&t.originalEvent.shiftKey?(t.node.editStart(),!1):"click"===n&&e.inArray("clickActive",i)>=0&&t.node.isActive()&&!t.node.isEditing()&&e(t.originalEvent.target).hasClass("fancytree-title")?(t.node.editStart(),!1):this._superApply(arguments)},nodeDblclick:function(t){return e.inArray("dblclick",t.options.edit.triggerStart)>=0?(t.node.editStart(),!1):this._superApply(arguments)},nodeKeydown:function(n){switch(n.originalEvent.which){case 113:if(e.inArray("f2",n.options.edit.triggerStart)>=0)return n.node.editStart(),!1;break;case e.ui.keyCode.ENTER:if(e.inArray("mac+enter",n.options.edit.triggerStart)>=0&&t)return n.node.editStart(),!1}return this._superApply(arguments)}}),e.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";function t(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var n="__not_found__",i=e.ui.fancytree.escapeHtml;return e.ui.fancytree._FancytreeClass.prototype._applyFilterImpl=function(r,o,a){var s,l,d,c,u,f,h=0,p=this.options,g=p.escapeTitles,y=p.autoCollapse,v=e.extend({},p.filter,a),m="hide"===v.mode,x=!!v.leavesOnly&&!o;if("string"==typeof r){if(""===r)return this.warn("Fancytree passing an empty string as a filter is handled as clearFilter()."),void this.clearFilter();s=v.fuzzy?r.split("").reduce(function(e,t){return e+"[^"+t+"]*"+t}):t(r),d=new RegExp(".*"+s+".*","i"),c=new RegExp(t(r),"gi"),r=function(t){if(!t.title)return!1;var n=g?t.title:function(t){return t.indexOf(">")>=0?e("<div/>").html(t).text():t}(t.title),r=!!d.test(n);return r&&v.highlight&&(g?(u=n.replace(c,function(e){return"\ufff7"+e+"\ufff8"}),t.titleWithHighlight=i(u).replace(/\uFFF7/g,"<mark>").replace(/\uFFF8/g,"</mark>")):t.titleWithHighlight=n.replace(c,function(e){return"<mark>"+e+"</mark>"})),r}}return this.enableFilter=!0,this.lastFilterArgs=arguments,f=this.enableUpdate(!1),this.$div.addClass("fancytree-ext-filter"),m?this.$div.addClass("fancytree-ext-filter-hide"):this.$div.addClass("fancytree-ext-filter-dimm"),this.$div.toggleClass("fancytree-ext-filter-hide-expanders",!!v.hideExpanders),this.rootNode.subMatchCount=0,this.visit(function(e){delete e.match,delete e.titleWithHighlight,e.subMatchCount=0}),(l=this.getRootNode()._findDirectChild(n))&&l.remove(),p.autoCollapse=!1,this.visit(function(e){if(!x||null==e.children){var t=r(e),n=!1;if("skip"===t)return e.visit(function(e){e.match=!1},!0),"skip";t||!o&&"branch"!==t||!e.parent.match||(t=!0,n=!0),t&&(h++,e.match=!0,e.visitParents(function(t){t!==e&&(t.subMatchCount+=1),!v.autoExpand||n||t.expanded||(t.setExpanded(!0,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),t._filterAutoExpanded=!0)},!0))}}),p.autoCollapse=y,0===h&&v.nodata&&m&&(l=v.nodata,e.isFunction(l)&&(l=l()),!0===l?l={}:"string"==typeof l&&(l={title:l}),l=e.extend({statusNodeType:"nodata",key:n,title:this.options.strings.noData},l),this.getRootNode().addNode(l).match=!0),this._callHook("treeStructureChanged",this,"applyFilter"),this.enableUpdate(f),h},e.ui.fancytree._FancytreeClass.prototype.filterNodes=function(e,t){return"boolean"==typeof t&&(t={leavesOnly:t},this.warn("Fancytree.filterNodes() leavesOnly option is deprecated since 2.9.0 / 2015-04-19. Use opts.leavesOnly instead.")),this._applyFilterImpl(e,!1,t)},e.ui.fancytree._FancytreeClass.prototype.filterBranches=function(e,t){return this._applyFilterImpl(e,!0,t)},e.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){var t,i=this.getRootNode()._findDirectChild(n),r=this.options.escapeTitles,o=this.options.enhanceTitle,a=this.enableUpdate(!1);i&&i.remove(),delete this.rootNode.match,delete this.rootNode.subMatchCount,this.visit(function(n){n.match&&n.span&&(t=e(n.span).find(">span.fancytree-title"),r?t.text(n.title):t.html(n.title),o&&o({type:"enhanceTitle"},{node:n,$title:t})),delete n.match,delete n.subMatchCount,delete n.titleWithHighlight,n.$subMatchBadge&&(n.$subMatchBadge.remove(),delete n.$subMatchBadge),n._filterAutoExpanded&&n.expanded&&n.setExpanded(!1,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),delete n._filterAutoExpanded}),this.enableFilter=!1,this.lastFilterArgs=null,this.$div.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide"),this._callHook("treeStructureChanged",this,"clearFilter"),this.enableUpdate(a)},e.ui.fancytree._FancytreeClass.prototype.isFilterActive=function(){return!!this.enableFilter},e.ui.fancytree._FancytreeNodeClass.prototype.isMatched=function(){return!(this.tree.enableFilter&&!this.match)},e.ui.fancytree.registerExtension({name:"filter",version:"2.35.0",options:{autoApply:!0,autoExpand:!1,counter:!0,fuzzy:!1,hideExpandedCounter:!0,hideExpanders:!1,highlight:!0,leavesOnly:!1,nodata:!0,mode:"dimm"},nodeLoadChildren:function(e,t){var n=e.tree;return this._superApply(arguments).done(function(){n.enableFilter&&n.lastFilterArgs&&e.options.filter.autoApply&&n._applyFilterImpl.apply(n,n.lastFilterArgs)})},nodeSetExpanded:function(e,t,n){var i=e.node;return delete i._filterAutoExpanded,!t&&e.options.filter.hideExpandedCounter&&i.$subMatchBadge&&i.$subMatchBadge.show(),this._superApply(arguments)},nodeRenderStatus:function(t){var n,i=t.node,r=t.tree,o=t.options.filter,a=e(i.span).find("span.fancytree-title"),s=e(i[r.statusClassPropName]),l=t.options.enhanceTitle,d=t.options.escapeTitles;return n=this._super(t),s.length&&r.enableFilter?(s.toggleClass("fancytree-match",!!i.match).toggleClass("fancytree-submatch",!!i.subMatchCount).toggleClass("fancytree-hide",!(i.match||i.subMatchCount)),!o.counter||!i.subMatchCount||i.isExpanded()&&o.hideExpandedCounter?i.$subMatchBadge&&i.$subMatchBadge.hide():(i.$subMatchBadge||(i.$subMatchBadge=e("<span class='fancytree-childcounter'/>"),e("span.fancytree-icon, span.fancytree-custom-icon",i.span).append(i.$subMatchBadge)),i.$subMatchBadge.show().text(i.subMatchCount)),!i.span||i.isEditing&&i.isEditing.call(i)||(i.titleWithHighlight?a.html(i.titleWithHighlight):d?a.text(i.title):a.html(i.title),l&&l({type:"enhanceTitle"},{node:i,$title:a})),n):n}}),e.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";function t(t,n,i,r){var o=i.map,a=o[r],s=e(t),l=s.find(".fancytree-childcounter"),d=n+" "+(o._addClass||"");"string"==typeof a?(t.innerHTML="",s.attr("class",d+" "+a).append(l)):a&&(a.text?t.textContent=""+a.text:a.html?t.innerHTML=a.html:t.innerHTML="",s.attr("class",d+" "+(a.addClass||"")).append(l))}var n=e.ui.fancytree,i={awesome3:{_addClass:"",checkbox:"icon-check-empty",checkboxSelected:"icon-check",checkboxUnknown:"icon-check icon-muted",dragHelper:"icon-caret-right",dropMarker:"icon-caret-right",error:"icon-exclamation-sign",expanderClosed:"icon-caret-right",expanderLazy:"icon-angle-right",expanderOpen:"icon-caret-down",loading:"icon-refresh icon-spin",nodata:"icon-meh",noExpander:"",radio:"icon-circle-blank",radioSelected:"icon-circle",doc:"icon-file-alt",docOpen:"icon-file-alt",folder:"icon-folder-close-alt",folderOpen:"icon-folder-open-alt"},awesome4:{_addClass:"fa",checkbox:"fa-square-o",checkboxSelected:"fa-check-square-o",checkboxUnknown:"fa-square fancytree-helper-indeterminate-cb",dragHelper:"fa-arrow-right",dropMarker:"fa-long-arrow-right",error:"fa-warning",expanderClosed:"fa-caret-right",expanderLazy:"fa-angle-right",expanderOpen:"fa-caret-down",loading:{html:"<span class='fa fa-spinner fa-pulse' />"},nodata:"fa-meh-o",noExpander:"",radio:"fa-circle-thin",radioSelected:"fa-circle",doc:"fa-file-o",docOpen:"fa-file-o",folder:"fa-folder-o",folderOpen:"fa-folder-open-o"},awesome5:{_addClass:"",checkbox:"far fa-square",checkboxSelected:"far fa-check-square",checkboxUnknown:"fas fa-square fancytree-helper-indeterminate-cb",radio:"far fa-circle",radioSelected:"fas fa-circle",radioUnknown:"far fa-dot-circle",dragHelper:"fas fa-arrow-right",dropMarker:"fas fa-long-arrow-alt-right",error:"fas fa-exclamation-triangle",expanderClosed:"fas fa-caret-right",expanderLazy:"fas fa-angle-right",expanderOpen:"fas fa-caret-down",loading:"fas fa-spinner fa-pulse",nodata:"far fa-meh",noExpander:"",doc:"far fa-file",docOpen:"far fa-file",folder:"far fa-folder",folderOpen:"far fa-folder-open"},bootstrap3:{_addClass:"glyphicon",checkbox:"glyphicon-unchecked",checkboxSelected:"glyphicon-check",checkboxUnknown:"glyphicon-expand fancytree-helper-indeterminate-cb",dragHelper:"glyphicon-play",dropMarker:"glyphicon-arrow-right",error:"glyphicon-warning-sign",expanderClosed:"glyphicon-menu-right",expanderLazy:"glyphicon-menu-right",expanderOpen:"glyphicon-menu-down",loading:"glyphicon-refresh fancytree-helper-spin",nodata:"glyphicon-info-sign",noExpander:"",radio:"glyphicon-remove-circle",radioSelected:"glyphicon-ok-circle",doc:"glyphicon-file",docOpen:"glyphicon-file",folder:"glyphicon-folder-close",folderOpen:"glyphicon-folder-open"},material:{_addClass:"material-icons",checkbox:{text:"check_box_outline_blank"},checkboxSelected:{text:"check_box"},checkboxUnknown:{text:"indeterminate_check_box"},dragHelper:{text:"play_arrow"},dropMarker:{text:"arrow-forward"},error:{text:"warning"},expanderClosed:{text:"chevron_right"},expanderLazy:{text:"last_page"},expanderOpen:{text:"expand_more"},loading:{text:"autorenew",addClass:"fancytree-helper-spin"},nodata:{text:"info"},noExpander:{text:""},radio:{text:"radio_button_unchecked"},radioSelected:{text:"radio_button_checked"},doc:{text:"insert_drive_file"},docOpen:{text:"insert_drive_file"},folder:{text:"folder"},folderOpen:{text:"folder_open"}}};return e.ui.fancytree.registerExtension({name:"glyph",version:"2.35.0",options:{preset:null,map:{}},treeInit:function(t){var r=t.tree,o=t.options.glyph;o.preset?(n.assert(!!i[o.preset],"Invalid value for `options.glyph.preset`: "+o.preset),o.map=e.extend({},i[o.preset],o.map)):r.warn("ext-glyph: missing `preset` option."),this._superApply(arguments),r.$container.addClass("fancytree-ext-glyph")},nodeRenderStatus:function(i){var r,o,a,s=i.node,l=e(s.span),d=i.options.glyph;return o=this._super(i),s.isRootNode()?o:((a=l.children("span.fancytree-expander").get(0))&&t(a,"fancytree-expander",d,s.expanded&&s.hasChildren()?"expanderOpen":s.isUndefined()?"expanderLazy":s.hasChildren()?"expanderClosed":"noExpander"),(a=s.tr?e("td",s.tr).find("span.fancytree-checkbox").get(0):l.children("span.fancytree-checkbox").get(0))&&(r=n.evalOption("checkbox",s,s,d,!1),s.parent&&s.parent.radiogroup||"radio"===r?t(a,"fancytree-checkbox fancytree-radio",d,s.selected?"radioSelected":"radio"):t(a,"fancytree-checkbox",d,s.selected?"checkboxSelected":s.partsel?"checkboxUnknown":"checkbox")),(a=l.children("span.fancytree-icon").get(0))&&t(a,"fancytree-icon",d,s.statusNodeType?s.statusNodeType:s.folder?s.expanded&&s.hasChildren()?"folderOpen":"folder":s.expanded?"docOpen":"doc"),o)},nodeSetStatus:function(n,i,r,o){var a,s,l=n.options.glyph,d=n.node;return a=this._superApply(arguments),"error"!==i&&"loading"!==i&&"nodata"!==i||(d.parent?(s=e("span.fancytree-expander",d.span).get(0))&&t(s,"fancytree-expander",l,i):(s=e(".fancytree-statusnode-"+i,d[this.nodeContainerAttrName]).find("span.fancytree-icon").get(0))&&t(s,"fancytree-icon",l,i)),a}}),e.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree","./jquery.fancytree.table"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree.table"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";function t(t,n){var i,r=null,o=0;return t.children().each(function(){if(o>=n)return r=e(this),!1;i=e(this).prop("colspan"),o+=i||1}),r}function n(n,r){var o,a,s=n.closest("td"),l=null;switch(r){case i.LEFT:l=s.prev();break;case i.RIGHT:l=s.next();break;case i.UP:case i.DOWN:for(a=function(t,n){var i,r=n.get(0),o=0;return t.children().each(function(){if(this===r)return!1;i=e(this).prop("colspan"),o+=i||1}),o}(o=s.parent(),s);(o=r===i.UP?o.prev():o.next()).length&&(o.is(":hidden")||!(l=t(o,a))||!l.find(":input,a").length););}return l}var i=e.ui.keyCode,r={text:[i.UP,i.DOWN],checkbox:[i.UP,i.DOWN,i.LEFT,i.RIGHT],link:[i.UP,i.DOWN,i.LEFT,i.RIGHT],radiobutton:[i.UP,i.DOWN,i.LEFT,i.RIGHT],"select-one":[i.LEFT,i.RIGHT],"select-multiple":[i.LEFT,i.RIGHT]};return e.ui.fancytree.registerExtension({name:"gridnav",version:"2.35.0",options:{autofocusInput:!1,handleCursorKeys:!0},treeInit:function(t){this._requireExtension("table",!0,!0),this._superApply(arguments),this.$container.addClass("fancytree-ext-gridnav"),this.$container.on("focusin",function(n){var i,r=e.ui.fancytree.getNode(n.target);r&&!r.isActive()&&(i=t.tree._makeHookContext(r,n),t.tree._callHook("nodeSetActive",i,!0))})},nodeSetActive:function(t,n,i){var r=t.options.gridnav,o=t.node,a=t.originalEvent||{},s=e(a.target).is(":input");n=!1!==n,this._superApply(arguments),n&&(t.options.titlesTabbable?(s||(e(o.span).find("span.fancytree-title").focus(),o.setFocus()),t.tree.$container.attr("tabindex","-1")):r.autofocusInput&&!s&&e(o.tr||o.span).find(":input:enabled").first().focus())},nodeKeydown:function(t){var i,o,a,s=t.options.gridnav,l=t.originalEvent,d=e(l.target);return d.is(":input:enabled")?i=d.prop("type"):d.is("a")&&(i="link"),i&&s.handleCursorKeys?!((o=r[i])&&e.inArray(l.which,o)>=0&&(a=n(d,l.which))&&a.length&&(a.find(":input:enabled,a").focus(),1)):this._superApply(arguments)}}),e.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";return e.ui.fancytree.registerExtension({name:"multi",version:"2.35.0",options:{allowNoSelect:!1,mode:"sameParent"},treeInit:function(t){this._superApply(arguments),this.$container.addClass("fancytree-ext-multi"),1===t.options.selectMode&&e.error("Fancytree ext-multi: selectMode: 1 (single) is not compatible.")},nodeClick:function(t){var n=t.tree,i=t.node,r=n.getActiveNode()||n.getFirstChild(),o="checkbox"===t.targetType,a="expander"===t.targetType;switch(e.ui.fancytree.eventToString(t.originalEvent)){case"click":if(a)break;o||(n.selectAll(!1),i.setSelected());break;case"shift+click":n.visitRows(function(e){if(e.setSelected(),e===i)return!1},{start:r,reverse:r.isBelowOf(i)});break;case"ctrl+click":case"meta+click":return void i.toggleSelected()}return this._superApply(arguments)},nodeKeydown:function(t){var n=t.tree,i=t.node,r=t.originalEvent;switch(e.ui.fancytree.eventToString(r)){case"up":case"down":n.selectAll(!1),i.navigate(r.which,!0),n.getActiveNode().setSelected();break;case"shift+up":case"shift+down":i.navigate(r.which,!0),n.getActiveNode().setSelected()}return this._superApply(arguments)}}),e.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";function t(n,i,r,o,s){var l,d,c,u,f=!1,h=n.options.persist.expandOpts,p=[],g=[];for(r=r||[],s=s||e.Deferred(),l=0,c=r.length;l<c;l++)d=r[l],(u=n.getNodeByKey(d))?o&&u.isUndefined()?(f=!0,n.debug("_loadLazyNodes: "+u+" is lazy: loading..."),"expand"===o?p.push(u.setExpanded(!0,h)):p.push(u.load())):(n.debug("_loadLazyNodes: "+u+" already loaded."),u.setExpanded(!0,h)):(g.push(d),n.debug("_loadLazyNodes: "+u+" was not yet found."));return e.when.apply(e,p).always(function(){if(f&&g.length>0)t(n,i,g,o,s);else{if(g.length)for(n.warn("_loadLazyNodes: could not load those keys: ",g),l=0,c=g.length;l<c;l++)d=r[l],i._appendKey(a,r[l],!1);s.resolve()}}),s}var n=null,i=window.localStorage?{get:function(e){return window.localStorage.getItem(e)},set:function(e,t){window.localStorage.setItem(e,t)},remove:function(e){window.localStorage.removeItem(e)}}:null,r=window.sessionStorage?{get:function(e){return window.sessionStorage.getItem(e)},set:function(e,t){window.sessionStorage.setItem(e,t)},remove:function(e){window.sessionStorage.removeItem(e)}}:null,o=e.ui.fancytree.assert,a="expanded",s="selected";return"function"==typeof Cookies?n={get:Cookies.get,set:function(e,t){Cookies.set(e,t,this.options.persist.cookie)},remove:Cookies.remove}:e&&"function"==typeof e.cookie&&(n={get:e.cookie,set:function(t,n){e.cookie.set(t,n,this.options.persist.cookie)},remove:e.removeCookie}),e.ui.fancytree._FancytreeClass.prototype.clearPersistData=function(e){var t=this.ext.persist,n=t.cookiePrefix;(e=e||"active expanded focus selected").indexOf("active")>=0&&t._data(n+"active",null),e.indexOf(a)>=0&&t._data(n+a,null),e.indexOf("focus")>=0&&t._data(n+"focus",null),e.indexOf(s)>=0&&t._data(n+s,null)},e.ui.fancytree._FancytreeClass.prototype.clearCookies=function(e){return this.warn("'tree.clearCookies()' is deprecated since v2.27.0: use 'clearPersistData()' instead."),this.clearPersistData(e)},e.ui.fancytree._FancytreeClass.prototype.getPersistData=function(){var e=this.ext.persist,t=e.cookiePrefix,n=e.cookieDelimiter,i={};return i.active=e._data(t+"active"),i[a]=(e._data(t+a)||"").split(n),i[s]=(e._data(t+s)||"").split(n),i.focus=e._data(t+"focus"),i},e.ui.fancytree.registerExtension({name:"persist",version:"2.35.0",options:{cookieDelimiter:"~",cookiePrefix:void 0,cookie:{raw:!1,expires:"",path:"",domain:"",secure:!1},expandLazy:!1,expandOpts:void 0,fireActivate:!0,overrideSource:!0,store:"auto",types:"active expanded focus selected"},_data:function(e,t){var n=this._local.store;if(void 0===t)return n.get.call(this,e);null===t?n.remove.call(this,e):n.set.call(this,e,t)},_appendKey:function(t,n,i){n=""+n;var r=this._local,o=this.options.persist.cookieDelimiter,a=r.cookiePrefix+t,s=r._data(a),l=s?s.split(o):[],d=e.inArray(n,l);d>=0&&l.splice(d,1),i&&l.push(n),r._data(a,l.join(o))},treeInit:function(l){var d=l.tree,c=l.options,u=this._local,f=this.options.persist;return u.cookiePrefix=f.cookiePrefix||"fancytree-"+d._id+"-",u.storeActive=f.types.indexOf("active")>=0,u.storeExpanded=f.types.indexOf(a)>=0,u.storeSelected=f.types.indexOf(s)>=0,u.storeFocus=f.types.indexOf("focus")>=0,u.store=null,"auto"===f.store&&(f.store=i?"local":"cookie"),e.isPlainObject(f.store)?u.store=f.store:"cookie"===f.store?u.store=n:"local"===f.store?u.store="local"===f.store?i:r:"session"===f.store&&(u.store="local"===f.store?i:r),o(u.store,"Need a valid store."),d.$div.on("fancytreeinit",function(n){if(!1!==d._triggerTreeEvent("beforeRestore",null,{})){var i,r,o,l,h=u._data(u.cookiePrefix+"focus"),p=!1===f.fireActivate;i=u._data(u.cookiePrefix+a),o=i&&i.split(f.cookieDelimiter),(u.storeExpanded?t(d,u,o,!!f.expandLazy&&"expand",null):(new e.Deferred).resolve()).done(function(){if(u.storeSelected){if(i=u._data(u.cookiePrefix+s))for(o=i.split(f.cookieDelimiter),r=0;r<o.length;r++)(l=d.getNodeByKey(o[r]))?(void 0===l.selected||f.overrideSource&&!1===l.selected)&&(l.selected=!0,l.renderStatus()):u._appendKey(s,o[r],!1);3===d.options.selectMode&&d.visit(function(e){if(e.selected)return e.fixSelection3AfterClick(),"skip"})}u.storeActive&&(!(i=u._data(u.cookiePrefix+"active"))||!c.persist.overrideSource&&d.activeNode||(l=d.getNodeByKey(i))&&(l.debug("persist: set active",i),l.setActive(!0,{noFocus:!0,noEvents:p}))),u.storeFocus&&h&&(l=d.getNodeByKey(h))&&(d.options.titlesTabbable?e(l.span).find(".fancytree-title").focus():e(d.$container).focus()),d._triggerTreeEvent("restore",null,{})})}}),this._superApply(arguments)},nodeSetActive:function(e,t,n){var i,r=this._local;return t=!1!==t,i=this._superApply(arguments),r.storeActive&&r._data(r.cookiePrefix+"active",this.activeNode?this.activeNode.key:null),i},nodeSetExpanded:function(e,t,n){var i,r=e.node,o=this._local;return t=!1!==t,i=this._superApply(arguments),o.storeExpanded&&o._appendKey(a,r.key,t),i},nodeSetFocus:function(e,t){var n,i=this._local;return t=!1!==t,n=this._superApply(arguments),i.storeFocus&&i._data(i.cookiePrefix+"focus",this.focusNode?this.focusNode.key:null),n},nodeSetSelected:function(t,n,i){var r,o,a=t.tree,l=t.node,d=this._local;return n=!1!==n,r=this._superApply(arguments),d.storeSelected&&(3===a.options.selectMode?(o=(o=e.map(a.getSelectedNodes(!0),function(e){return e.key})).join(t.options.persist.cookieDelimiter),d._data(d.cookiePrefix+s,o)):d._appendKey(s,l.key,l.selected)),r}}),e.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";function t(t,n){n=n||"",t||e.error("Assertion failed "+n)}function n(e,t){e.visit(function(e){var n=e.tr;if(n&&(n.style.display=e.hide||!t?"none":""),!e.expanded)return"skip"})}return e.ui.fancytree.registerExtension({name:"table",version:"2.35.0",options:{checkboxColumnIdx:null,indentation:16,mergeStatusColumns:!0,nodeColumnIdx:0},treeInit:function(n){var i,r,o,a,s=n.tree,l=n.options,d=l.table,c=s.widget.element;if(null!=d.customStatus&&(null==l.renderStatusColumns?(s.warn("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' instead."),l.renderStatusColumns=d.customStatus):e.error("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' only instead.")),l.renderStatusColumns&&!0===l.renderStatusColumns&&(l.renderStatusColumns=l.renderColumns),c.addClass("fancytree-container fancytree-ext-table"),(a=c.find(">tbody")).length||(c.find(">tr").length&&e.error("Expected table > tbody > tr. If you see this please open an issue."),a=e("<tbody>").appendTo(c)),s.tbody=a[0],s.columnCount=e("thead >tr",c).last().find(">th",c).length,(o=a.children("tr").first()).length)r=o.children("td").length,s.columnCount&&r!==s.columnCount&&(s.warn("Column count mismatch between thead ("+s.columnCount+") and tbody ("+r+"): using tbody."),s.columnCount=r),o=o.clone();else for(t(s.columnCount>=1,"Need either <thead> or <tbody> with <td> elements to determine column count."),o=e("<tr />"),i=0;i<s.columnCount;i++)o.append("<td />");o.find(">td").eq(d.nodeColumnIdx).html("<span class='fancytree-node' />"),l.aria&&(o.attr("role","row"),o.find("td").attr("role","gridcell")),s.rowFragment=document.createDocumentFragment(),s.rowFragment.appendChild(o.get(0)),a.empty(),s.statusClassPropName="tr",s.ariaPropName="tr",this.nodeContainerAttrName="tr",s.$container=c,this._superApply(arguments),e(s.rootNode.ul).remove(),s.rootNode.ul=null,this.$container.attr("tabindex",l.tabindex),l.aria&&s.$container.attr("role","treegrid").attr("aria-readonly",!0)},nodeRemoveChildMarkup:function(t){t.node.visit(function(t){t.tr&&(e(t.tr).remove(),t.tr=null)})},nodeRemoveMarkup:function(t){var n=t.node;n.tr&&(e(n.tr).remove(),n.tr=null),this.nodeRemoveChildMarkup(t)},nodeRender:function(i,r,o,a,s){var l,d,c,u,f,h,p,g,y=i.tree,v=i.node,m=i.options,x=!v.parent;if(!1!==y._enableUpdate){if(s||(i.hasCollapsedParents=v.parent&&!v.parent.expanded),!x)if(v.tr&&r&&this.nodeRemoveMarkup(i),v.tr)r?this.nodeRenderTitle(i):this.nodeRenderStatus(i);else{if(i.hasCollapsedParents&&!o)return;f=y.rowFragment.firstChild.cloneNode(!0),t(h=function(n){var i,r,o=n.parent,a=o?o.children:null;if(a&&a.length>1&&a[0]!==n)for(t((r=a[e.inArray(n,a)-1]).tr);r.children&&r.children.length&&(i=r.children[r.children.length-1]).tr;)r=i;else r=o;return r}(v)),!0===a&&s?f.style.display="none":o&&i.hasCollapsedParents&&(f.style.display="none"),h.tr?function(e,t){e.parentNode.insertBefore(t,e.nextSibling)}(h.tr,f):(t(!h.parent,"prev. row must have a tr, or be system root"),function(e,t){e.insertBefore(t,e.firstChild)}(y.tbody,f)),v.tr=f,v.key&&m.generateIds&&(v.tr.id=m.idPrefix+v.key),v.tr.ftnode=v,v.span=e("span.fancytree-node",v.tr).get(0),this.nodeRenderTitle(i),m.createNode&&m.createNode.call(y,{type:"createNode"},i)}if(m.renderNode&&m.renderNode.call(y,{type:"renderNode"},i),(l=v.children)&&(x||o||v.expanded))for(c=0,u=l.length;c<u;c++)(g=e.extend({},i,{node:l[c]})).hasCollapsedParents=g.hasCollapsedParents||!v.expanded,this.nodeRender(g,r,o,a,!0);l&&!s&&(p=v.tr||null,d=y.tbody.firstChild,v.visit(function(e){if(e.tr){if(e.parent.expanded||"none"===e.tr.style.display||(e.tr.style.display="none",n(e,!1)),e.tr.previousSibling!==p){v.debug("_fixOrder: mismatch at node: "+e);var t=p?p.nextSibling:d;y.tbody.insertBefore(e.tr,t)}p=e.tr}}))}},nodeRenderTitle:function(t,n){var i,r,o=t.tree,a=t.node,s=t.options,l=a.isStatusNode();return r=this._super(t,n),a.isRootNode()?r:(s.checkbox&&!l&&null!=s.table.checkboxColumnIdx&&(i=e("span.fancytree-checkbox",a.span),e(a.tr).find("td").eq(+s.table.checkboxColumnIdx).html(i)),this.nodeRenderStatus(t),l?s.renderStatusColumns?s.renderStatusColumns.call(o,{type:"renderStatusColumns"},t):s.table.mergeStatusColumns&&a.isTopLevel()&&e(a.tr).find(">td").eq(0).prop("colspan",o.columnCount).text(a.title).addClass("fancytree-status-merged").nextAll().remove():s.renderColumns&&s.renderColumns.call(o,{type:"renderColumns"},t),r)},nodeRenderStatus:function(t){var n,i=t.node,r=t.options;this._super(t),e(i.tr).removeClass("fancytree-node"),n=(i.getLevel()-1)*r.table.indentation,r.rtl?e(i.span).css({paddingRight:n+"px"}):e(i.span).css({paddingLeft:n+"px"})},nodeSetExpanded:function(t,i,r){function o(e){n(t.node,i),e?i&&t.options.autoScroll&&!r.noAnimation&&t.node.hasChildren()?t.node.getLastChild().scrollIntoView(!0,{topNode:t.node}).always(function(){r.noEvents||t.tree._triggerNodeEvent(i?"expand":"collapse",t),a.resolveWith(t.node)}):(r.noEvents||t.tree._triggerNodeEvent(i?"expand":"collapse",t),a.resolveWith(t.node)):(r.noEvents||t.tree._triggerNodeEvent(i?"expand":"collapse",t),a.rejectWith(t.node))}if(i=!1!==i,t.node.expanded&&i||!t.node.expanded&&!i)return this._superApply(arguments);var a=new e.Deferred,s=e.extend({},r,{noEvents:!0,noAnimation:!0});return r=r||{},this._super(t,i,s).done(function(){o(!0)}).fail(function(){o(!1)}),a.promise()},nodeSetStatus:function(t,n,i,r){if("ok"===n){var o=t.node,a=o.children?o.children[0]:null;a&&a.isStatusNode()&&e(a.tr).remove()}return this._superApply(arguments)},treeClear:function(e){return this.nodeRemoveChildMarkup(this._makeHookContext(this.rootNode)),this._superApply(arguments)},treeDestroy:function(e){return this.$container.find("tbody").empty(),this.$source&&this.$source.removeClass("fancytree-helper-hidden"),this._superApply(arguments)}}),e.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";return e.ui.fancytree.registerExtension({name:"themeroller",version:"2.35.0",options:{activeClass:"ui-state-active",addClass:"ui-corner-all",focusClass:"ui-state-focus",hoverClass:"ui-state-hover",selectedClass:"ui-state-highlight"},treeInit:function(t){var n=t.widget.element,i=t.options.themeroller;this._superApply(arguments),"TABLE"===n[0].nodeName?(n.addClass("ui-widget ui-corner-all"),n.find(">thead tr").addClass("ui-widget-header"),n.find(">tbody").addClass("ui-widget-conent")):n.addClass("ui-widget ui-widget-content ui-corner-all"),n.on("mouseenter mouseleave",".fancytree-node",function(t){var n=e.ui.fancytree.getNode(t.target),r="mouseenter"===t.type;e(n.tr?n.tr:n.span).toggleClass(i.hoverClass+" "+i.addClass,r)})},treeDestroy:function(e){this._superApply(arguments),e.widget.element.removeClass("ui-widget ui-widget-content ui-corner-all")},nodeRenderStatus:function(t){var n={},i=t.node,r=e(i.tr?i.tr:i.span),o=t.options.themeroller;this._super(t),n[o.activeClass]=!1,n[o.focusClass]=!1,n[o.selectedClass]=!1,i.isActive()&&(n[o.activeClass]=!0),i.hasFocus()&&(n[o.focusClass]=!0),i.isSelected()&&!i.isActive()&&(n[o.selectedClass]=!0),r.toggleClass(o.activeClass,n[o.activeClass]),r.toggleClass(o.focusClass,n[o.focusClass]),r.toggleClass(o.selectedClass,n[o.selectedClass]),r.addClass(o.addClass)}}),e.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";function t(t,n){var i=e("#"+(t="fancytree-style-"+t));if(!n)return i.remove(),null;i.length||(i=e("<style />").attr("id",t).addClass("fancytree-style").prop("type","text/css").appendTo("head"));try{i.html(n)}catch(e){i[0].styleSheet.cssText=n}return i}function n(e,t,n,i,r,o){var a,s="#"+e+" span.fancytree-level-",l=[];for(a=0;a<t;a++)l.push(s+(a+1)+" span.fancytree-title { padding-left: "+(a*n+i)+o+"; }");return l.push("#"+e+" div.ui-effects-wrapper ul li span.fancytree-title, #"+e+" li.fancytree-animating span.fancytree-title { padding-left: "+r+o+"; position: static; width: auto; }"),l.join("\n")}var i=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;return e.ui.fancytree.registerExtension({name:"wide",version:"2.35.0",options:{iconWidth:null,iconSpacing:null,labelSpacing:null,levelOfs:null},treeCreate:function(r){this._superApply(arguments),this.$container.addClass("fancytree-ext-wide");var o,a,s,l,d,c=r.options.wide,u=e("<li id='fancytreeTemp'><span class='fancytree-node'><span class='fancytree-icon' /><span class='fancytree-title' /></span><ul />").appendTo(r.tree.$container),f=u.find(".fancytree-icon"),h=u.find("ul"),p=c.iconSpacing||f.css("margin-left"),g=c.iconWidth||f.css("width"),y=c.labelSpacing||"3px",v=c.levelOfs||h.css("padding-left");u.remove(),a=p.match(i)[2],p=parseFloat(p,10),s=y.match(i)[2],y=parseFloat(y,10),l=g.match(i)[2],g=parseFloat(g,10),d=v.match(i)[2],a===l&&d===l&&s===l||e.error("iconWidth, iconSpacing, and levelOfs must have the same css measure unit"),this._local.measureUnit=l,this._local.levelOfs=parseFloat(v),this._local.lineOfs=(1+(r.options.checkbox?1:0)+(!1===r.options.icon?0:1))*(g+p)+p,this._local.labelOfs=y,this._local.maxDepth=10,t(o=this.$container.uniqueId().attr("id"),n(o,this._local.maxDepth,this._local.levelOfs,this._local.lineOfs,this._local.labelOfs,this._local.measureUnit))},treeDestroy:function(e){return t(this.$container.attr("id"),null),this._superApply(arguments)},nodeRenderStatus:function(i){var r,o,a=i.node,s=a.getLevel();return o=this._super(i),s>this._local.maxDepth&&(r=this.$container.attr("id"),this._local.maxDepth*=2,a.debug("Define global ext-wide css up to level "+this._local.maxDepth),t(r,n(r,this._local.maxDepth,this._local.levelOfs,this._local.lineOfs,this._local.labelSpacing,this._local.measureUnit))),e(a.span).addClass("fancytree-level-"+s),o}}),e.ui.fancytree}),e.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";function t(t,n,i,r){var o=i.map,a=o[r],s=e(t),l=s.find(".fancytree-childcounter"),d=n+" "+(o._addClass||"");"string"==typeof a?(t.innerHTML="",s.attr("class",d+" "+a).append(l)):a&&(a.text?t.textContent=""+a.text:a.html?t.innerHTML=a.html:t.innerHTML="",s.attr("class",d+" "+(a.addClass||"")).append(l))}var n=e.ui.fancytree,i={awesome3:{_addClass:"",checkbox:"icon-check-empty",checkboxSelected:"icon-check",checkboxUnknown:"icon-check icon-muted",dragHelper:"icon-caret-right",dropMarker:"icon-caret-right",error:"icon-exclamation-sign",expanderClosed:"icon-caret-right",expanderLazy:"icon-angle-right",expanderOpen:"icon-caret-down",loading:"icon-refresh icon-spin",nodata:"icon-meh",noExpander:"",radio:"icon-circle-blank",radioSelected:"icon-circle",doc:"icon-file-alt",docOpen:"icon-file-alt",folder:"icon-folder-close-alt",folderOpen:"icon-folder-open-alt"},awesome4:{_addClass:"fa",checkbox:"fa-square-o",checkboxSelected:"fa-check-square-o",checkboxUnknown:"fa-square fancytree-helper-indeterminate-cb",dragHelper:"fa-arrow-right",dropMarker:"fa-long-arrow-right",error:"fa-warning",expanderClosed:"fa-caret-right",expanderLazy:"fa-angle-right",expanderOpen:"fa-caret-down",loading:{html:"<span class='fa fa-spinner fa-pulse' />"},nodata:"fa-meh-o",noExpander:"",radio:"fa-circle-thin",radioSelected:"fa-circle",doc:"fa-file-o",docOpen:"fa-file-o",folder:"fa-folder-o",folderOpen:"fa-folder-open-o"},awesome5:{_addClass:"",checkbox:"far fa-square",checkboxSelected:"far fa-check-square",checkboxUnknown:"fas fa-square fancytree-helper-indeterminate-cb",radio:"far fa-circle",radioSelected:"fas fa-circle",radioUnknown:"far fa-dot-circle",dragHelper:"fas fa-arrow-right",dropMarker:"fas fa-long-arrow-alt-right",error:"fas fa-exclamation-triangle",expanderClosed:"fas fa-caret-right",expanderLazy:"fas fa-angle-right",expanderOpen:"fas fa-caret-down",loading:"fas fa-spinner fa-pulse",nodata:"far fa-meh",noExpander:"",doc:"far fa-file",docOpen:"far fa-file",folder:"far fa-folder",folderOpen:"far fa-folder-open"},bootstrap3:{_addClass:"glyphicon",checkbox:"glyphicon-unchecked",checkboxSelected:"glyphicon-check",checkboxUnknown:"glyphicon-expand fancytree-helper-indeterminate-cb",dragHelper:"glyphicon-play",dropMarker:"glyphicon-arrow-right",error:"glyphicon-warning-sign",expanderClosed:"glyphicon-menu-right",expanderLazy:"glyphicon-menu-right",expanderOpen:"glyphicon-menu-down",loading:"glyphicon-refresh fancytree-helper-spin",nodata:"glyphicon-info-sign",noExpander:"",radio:"glyphicon-remove-circle",radioSelected:"glyphicon-ok-circle",doc:"glyphicon-file",docOpen:"glyphicon-file",folder:"glyphicon-folder-close",folderOpen:"glyphicon-folder-open"},material:{_addClass:"material-icons",checkbox:{text:"check_box_outline_blank"},checkboxSelected:{text:"check_box"},checkboxUnknown:{text:"indeterminate_check_box"},dragHelper:{text:"play_arrow"},dropMarker:{text:"arrow-forward"},error:{text:"warning"},expanderClosed:{text:"chevron_right"},expanderLazy:{text:"last_page"},expanderOpen:{text:"expand_more"},loading:{text:"autorenew",addClass:"fancytree-helper-spin"},nodata:{text:"info"},noExpander:{text:""},radio:{text:"radio_button_unchecked"},radioSelected:{text:"radio_button_checked"},doc:{text:"insert_drive_file"},docOpen:{text:"insert_drive_file"},folder:{text:"folder"},folderOpen:{text:"folder_open"}}};return e.ui.fancytree.registerExtension({name:"glyph",version:"2.35.0",options:{preset:null,map:{}},treeInit:function(t){var r=t.tree,o=t.options.glyph;o.preset?(n.assert(!!i[o.preset],"Invalid value for `options.glyph.preset`: "+o.preset),o.map=e.extend({},i[o.preset],o.map)):r.warn("ext-glyph: missing `preset` option."),this._superApply(arguments),r.$container.addClass("fancytree-ext-glyph")},nodeRenderStatus:function(i){var r,o,a,s=i.node,l=e(s.span),d=i.options.glyph;return o=this._super(i),s.isRootNode()?o:((a=l.children("span.fancytree-expander").get(0))&&t(a,"fancytree-expander",d,s.expanded&&s.hasChildren()?"expanderOpen":s.isUndefined()?"expanderLazy":s.hasChildren()?"expanderClosed":"noExpander"),(a=s.tr?e("td",s.tr).find("span.fancytree-checkbox").get(0):l.children("span.fancytree-checkbox").get(0))&&(r=n.evalOption("checkbox",s,s,d,!1),s.parent&&s.parent.radiogroup||"radio"===r?t(a,"fancytree-checkbox fancytree-radio",d,s.selected?"radioSelected":"radio"):t(a,"fancytree-checkbox",d,s.selected?"checkboxSelected":s.partsel?"checkboxUnknown":"checkbox")),(a=l.children("span.fancytree-icon").get(0))&&t(a,"fancytree-icon",d,s.statusNodeType?s.statusNodeType:s.folder?s.expanded&&s.hasChildren()?"folderOpen":"folder":s.expanded?"docOpen":"doc"),o)},nodeSetStatus:function(n,i,r,o){var a,s,l=n.options.glyph,d=n.node;return a=this._superApply(arguments),"error"!==i&&"loading"!==i&&"nodata"!==i||(d.parent?(s=e("span.fancytree-expander",d.span).get(0))&&t(s,"fancytree-expander",l,i):(s=e(".fancytree-statusnode-"+i,d[this.nodeContainerAttrName]).find("span.fancytree-icon").get(0))&&t(s,"fancytree-icon",l,i)),a}}),e.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";function t(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var n="__not_found__",i=e.ui.fancytree.escapeHtml;return e.ui.fancytree._FancytreeClass.prototype._applyFilterImpl=function(r,o,a){var s,l,d,c,u,f,h=0,p=this.options,g=p.escapeTitles,y=p.autoCollapse,v=e.extend({},p.filter,a),m="hide"===v.mode,x=!!v.leavesOnly&&!o;if("string"==typeof r){if(""===r)return this.warn("Fancytree passing an empty string as a filter is handled as clearFilter()."),void this.clearFilter();s=v.fuzzy?r.split("").reduce(function(e,t){return e+"[^"+t+"]*"+t}):t(r),d=new RegExp(".*"+s+".*","i"),c=new RegExp(t(r),"gi"),r=function(t){if(!t.title)return!1;var n=g?t.title:function(t){return t.indexOf(">")>=0?e("<div/>").html(t).text():t}(t.title),r=!!d.test(n);return r&&v.highlight&&(g?(u=n.replace(c,function(e){return"\ufff7"+e+"\ufff8"}),t.titleWithHighlight=i(u).replace(/\uFFF7/g,"<mark>").replace(/\uFFF8/g,"</mark>")):t.titleWithHighlight=n.replace(c,function(e){return"<mark>"+e+"</mark>"})),r}}return this.enableFilter=!0,this.lastFilterArgs=arguments,f=this.enableUpdate(!1),this.$div.addClass("fancytree-ext-filter"),m?this.$div.addClass("fancytree-ext-filter-hide"):this.$div.addClass("fancytree-ext-filter-dimm"),this.$div.toggleClass("fancytree-ext-filter-hide-expanders",!!v.hideExpanders),this.rootNode.subMatchCount=0,this.visit(function(e){delete e.match,delete e.titleWithHighlight,e.subMatchCount=0}),(l=this.getRootNode()._findDirectChild(n))&&l.remove(),p.autoCollapse=!1,this.visit(function(e){if(!x||null==e.children){var t=r(e),n=!1;if("skip"===t)return e.visit(function(e){e.match=!1},!0),"skip";t||!o&&"branch"!==t||!e.parent.match||(t=!0,n=!0),t&&(h++,e.match=!0,e.visitParents(function(t){t!==e&&(t.subMatchCount+=1),!v.autoExpand||n||t.expanded||(t.setExpanded(!0,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),t._filterAutoExpanded=!0)},!0))}}),p.autoCollapse=y,0===h&&v.nodata&&m&&(l=v.nodata,e.isFunction(l)&&(l=l()),!0===l?l={}:"string"==typeof l&&(l={title:l}),l=e.extend({statusNodeType:"nodata",key:n,title:this.options.strings.noData},l),this.getRootNode().addNode(l).match=!0),this._callHook("treeStructureChanged",this,"applyFilter"),this.enableUpdate(f),h},e.ui.fancytree._FancytreeClass.prototype.filterNodes=function(e,t){return"boolean"==typeof t&&(t={leavesOnly:t},this.warn("Fancytree.filterNodes() leavesOnly option is deprecated since 2.9.0 / 2015-04-19. Use opts.leavesOnly instead.")),this._applyFilterImpl(e,!1,t)},e.ui.fancytree._FancytreeClass.prototype.filterBranches=function(e,t){return this._applyFilterImpl(e,!0,t)},e.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){var t,i=this.getRootNode()._findDirectChild(n),r=this.options.escapeTitles,o=this.options.enhanceTitle,a=this.enableUpdate(!1);i&&i.remove(),delete this.rootNode.match,delete this.rootNode.subMatchCount,this.visit(function(n){n.match&&n.span&&(t=e(n.span).find(">span.fancytree-title"),r?t.text(n.title):t.html(n.title),o&&o({type:"enhanceTitle"},{node:n,$title:t})),delete n.match,delete n.subMatchCount,delete n.titleWithHighlight,n.$subMatchBadge&&(n.$subMatchBadge.remove(),delete n.$subMatchBadge),n._filterAutoExpanded&&n.expanded&&n.setExpanded(!1,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),delete n._filterAutoExpanded}),this.enableFilter=!1,this.lastFilterArgs=null,this.$div.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide"),this._callHook("treeStructureChanged",this,"clearFilter"),this.enableUpdate(a)},e.ui.fancytree._FancytreeClass.prototype.isFilterActive=function(){return!!this.enableFilter},e.ui.fancytree._FancytreeNodeClass.prototype.isMatched=function(){return!(this.tree.enableFilter&&!this.match)},e.ui.fancytree.registerExtension({name:"filter",version:"2.35.0",options:{autoApply:!0,autoExpand:!1,counter:!0,fuzzy:!1,hideExpandedCounter:!0,hideExpanders:!1,highlight:!0,leavesOnly:!1,nodata:!0,mode:"dimm"},nodeLoadChildren:function(e,t){var n=e.tree;return this._superApply(arguments).done(function(){n.enableFilter&&n.lastFilterArgs&&e.options.filter.autoApply&&n._applyFilterImpl.apply(n,n.lastFilterArgs)})},nodeSetExpanded:function(e,t,n){var i=e.node;return delete i._filterAutoExpanded,!t&&e.options.filter.hideExpandedCounter&&i.$subMatchBadge&&i.$subMatchBadge.show(),this._superApply(arguments)},nodeRenderStatus:function(t){var n,i=t.node,r=t.tree,o=t.options.filter,a=e(i.span).find("span.fancytree-title"),s=e(i[r.statusClassPropName]),l=t.options.enhanceTitle,d=t.options.escapeTitles;return n=this._super(t),s.length&&r.enableFilter?(s.toggleClass("fancytree-match",!!i.match).toggleClass("fancytree-submatch",!!i.subMatchCount).toggleClass("fancytree-hide",!(i.match||i.subMatchCount)),!o.counter||!i.subMatchCount||i.isExpanded()&&o.hideExpandedCounter?i.$subMatchBadge&&i.$subMatchBadge.hide():(i.$subMatchBadge||(i.$subMatchBadge=e("<span class='fancytree-childcounter'/>"),e("span.fancytree-icon, span.fancytree-custom-icon",i.span).append(i.$subMatchBadge)),i.$subMatchBadge.show().text(i.subMatchCount)),!i.span||i.isEditing&&i.isEditing.call(i)||(i.titleWithHighlight?a.html(i.titleWithHighlight):d?a.text(i.title):a.html(i.title),l&&l({type:"enhanceTitle"},{node:i,$title:a})),n):n}}),e.ui.fancytree});var fancyTree=function(){var e={featureInfo:{name:"APEX-Fancy-Tree-Select",info:{scriptVersion:"2.0.2",utilVersion:"1.3.4",url:"https://github.com/RonnyWeiss",license:"MIT"}},isDefinedAndNotNull:function(e){return void 0!==e&&null!==e&&""!=e},isAPEX:function(){return"undefined"!=typeof apex},varType:function(e){if("object"!=typeof e)return typeof e;var t=[].constructor,n={}.constructor;return e.constructor===t?"array":e.constructor===n?"json":void 0},debug:{info:function(){if(e.isAPEX()){var t=0,n=[];for(var i in arguments)n[t]=arguments[i],t++;n.push(e.featureInfo),apex.debug.info.apply(this,n)}},error:function(){var t=0,n=[];for(var i in arguments)n[t]=arguments[i],t++;n.push(e.featureInfo),e.isAPEX()?apex.debug.error.apply(this,n):console.error.apply(this,n)}},convertJSON2LowerCase:function(t){try{var n={};for(var i in t)"[object Object]"===Object.prototype.toString.apply(t[i])?n[i.toLowerCase()]=e.convertJSON2LowerCase(t[i]):"[object Array]"===Object.prototype.toString.apply(t[i])?(n[i.toLowerCase()]=[],n[i.toLowerCase()].push(e.convertJSON2LowerCase(t[i][0]))):n[i.toLowerCase()]=t[i];return n}catch(t){return void e.debug.error({msg:"Error while to lower json",err:t})}},jsonSaveExtend:function(t,n){var i={},r={};if("string"==typeof n)try{r=JSON.parse(n)}catch(t){e.debug.error({msg:"Error while try to parse targetConfig. Please check your Config JSON. Standard Config will be used.",err:t,targetConfig:n})}else r=$.extend(!0,{},n);try{i=$.extend(!0,{},t,r)}catch(n){i=$.extend(!0,{},t),e.debug.error({msg:"Error while try to merge 2 JSONs into standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used.",err:n,finalConfig:i})}return i},setItemValue:function(t,n){e.isAPEX()?apex.item(t)&&0!=apex.item(t).node?apex.item(t).setValue(n):e.debug.error("Please choose a set item. Because the value ("+n+") can not be set on item ("+t+")"):e.debug.error("Error while try to call apex.item")},getItemValue:function(t){if(!t)return"";if(e.isAPEX()){if(apex.item(t)&&0!=apex.item(t).node)return apex.item(t).getValue();e.debug.error("Please choose a get item. Because the value could not be get from item("+t+")")}else e.debug.error("Error while try to call apex.item")},printDOMMessage:{show:function(e,t,n,i){var r=$("<div></div>").css("margin","12px").css("text-align","center").css("padding","35px 0").addClass("dominfomessagediv"),o=$("<div></div>"),a=$("<span></span>").addClass("fa").addClass(n||"fa-info-circle-o").addClass("fa-2x").css("height","32px").css("width","32px").css("color","#D0D0D0").css("margin-bottom","16px").css("color",i||"inhherit");o.append(a);var s=$("<span></span>").text(t).css("display","block").css("color","#707070").css("text-overflow","ellipsis").css("overflow","hidden").css("white-space","nowrap").css("font-size","12px");r.append(o).append(s),$(e).append(r)},hide:function(e){$(e).children(".dominfomessagediv").remove()}},link:function(e,t){if(!t)return window.parent.location.href=e;window.open(e,"_blank")},noDataMessage:{show:function(t,n){e.printDOMMessage.show(t,n,"fa-search")},hide:function(t){e.printDOMMessage.hide(t)}},errorMessage:{show:function(t,n){e.printDOMMessage.show(t,n,"fa-exclamation-triangle","#FFCB3D")},hide:function(t){e.printDOMMessage.hide(t)}},loader:{start:function(t,n){if(n&&$(t).css("min-height","100px"),e.isAPEX())apex.util.showSpinner($(t));else{var i=$("<span></span>");i.attr("id","loader"+t),i.addClass("ct-loader"),i.css("text-align","center"),i.css("width","100%"),i.css("display","block");var r=$("<i></i>");r.addClass("fa fa-refresh fa-2x fa-anim-spin"),r.css("background","rgba(121,121,121,0.6)"),r.css("border-radius","100%"),r.css("padding","15px"),r.css("color","white"),i.append(r),$(t).append(i)}},stop:function(e,t){t&&$(e).css("min-height",""),$(e+" > .u-Processing").remove(),$(e+" > .ct-loader").remove()}},copyJSONObject:function(t){try{var n,i={};for(n in t)i[n]=t[n];return i}catch(t){e.debug.error({msg:"Error while try to copy object",err:t})}}};return{initTree:function(t,n,i,r,o,a,s,l,d){function c(){var t,n=$.ui.fancytree.getTree(p.regionID),i=e.getItemValue(l);e.debug.info({tree:n,sStr:i}),t=n.filterBranches.call(n,i),e.noDataMessage.hide(p.regionID),0===t&&e.noDataMessage.show(p.regionID,p.noDataMessage),e.debug.info({num:t})}function u(){if(p.typeSettings){var t=[];p.typeSettings.forEach(function(n){t.push(e.copyJSONObject(n))}),$.each($(p.regionID).fancytree("getTree").getSelectedNodes(),function(n,i){t.forEach(function(n,r){n.id?i.type?i.type==n.id&&(void 0===t[r].data&&(t[r].data=[]),-1===t[r].data.indexOf(i.data.value)&&(i.data.value&&3!=p.selectMode||!1===i.parent.selected||null===i.parent.li||!0===p.forceSelectionSet)&&t[r].data.push(i.data.value)):e.debug.error({featureInfo:featureInfo,module:"setItems",msg:"type in not set in data"}):e.debug.error({featureInfo:featureInfo,module:"setItems",msg:"id is not defined in config json in types. Please check help for config json."})})}),t.forEach(function(t){t.storeItem?t.data&&t.data.length>0?(t.data.sort(y),e.setItemValue(t.storeItem,t.data.join(":"))):e.setItemValue(t.storeItem,null):e.debug.error({featureInfo:featureInfo,module:"setItems",msg:"storeItem is not defined in config json in types. Please check help for config json."})})}else e.debug.error({featureInfo:featureInfo,module:"setItems",msg:"Types is not defined in config json but you have set setItemsOnInit: true or try to select a node. Please check help for config json."})}function f(t){if(p.markNodesWithChildren){t&&$(p.regionID).find(".fancytree-custom-icon").removeClass(p.markerModifier);var n=$(p.regionID).fancytree("getTree"),i=n.getSelectedNodes();$.each(i,function(e,t){$.each(t.getParentList(!0),function(e,t){$(t.span).find(".fancytree-custom-icon").addClass(p.markerModifier)})});var r=n.getActiveNode();e.isDefinedAndNotNull(r)&&$.each(r.getParentList(!0),function(e,t){$(t.span).find(".fancytree-custom-icon").addClass(p.markerModifier)})}}function h(){if(p.openParentOfSelected){var e=$(p.regionID).fancytree("getTree").getSelectedNodes();$.each(e,function(e,t){$.each(t.getParentList(!0),function(e,t){t.setExpanded(!0)})})}}e.debug.info({module:"initTree",arguments:{regionID:t,ajaxID:n,noDataMessage:i,errMessage:r,udConfigJSON:o,items2Submit:a,escapeHTML:s,searchItemName:l,activeNodeItemName:d}});var p={};(p=e.jsonSaveExtend({animationDuration:200,autoExpand2Level:0,checkbox:"fa-square-o",checkboxSelected:"fa-check-square",checkboxUnknown:"fa-square",enableCheckBox:!0,enableKeyBoard:!0,enableQuicksearch:!0,forceSelectionSet:!0,markNodesWithChildren:!1,markerModifier:"fam-plus fam-is-info",openParentOfActiveNode:!0,openParentOfSelected:!0,refresh:0,search:{autoExpand:!0,leavesOnly:!1,highlight:!0,counter:!0,hideUnmatched:!0},selectMode:2,setActiveNode:!0,setItemsOnInit:!1},o)).regionID=t,p.ajaxID=n,p.noDataMessage=i,p.errMessage=r,p.items2Submit=a,!isNaN(p.animationDuration)&&p.animationDuration>=0?p.animationDuration={effect:"slideToggle",duration:p.animationDuration}:p.animationDuration=!1,!1!==s&&(p.escapeHTML=!0);var g=function(t){e.loader.start(p.regionID,!0);try{apex.server.plugin(p.ajaxID,{pageItems:p.items2Submit},{success:t,error:function(t){e.loader.stop(p.regionID,!0),$(p.regionID).empty(),e.errorMessage.show(p.regionID,p.errMessage),e.debug.error({featureInfo:featureInfo,module:"getData",msg:"Error while try to get new data",err:t})},dataType:"json"})}catch(t){e.debug.error({featureInfo:featureInfo,module:"getData",msg:"Error while try to get new data",err:t})}},y=function(e,t){return e-t},v=function(t){try{var n,i=e.convertJSON2LowerCase(t.row),r=!1;e.isDefinedAndNotNull(d)?n=e.getItemValue(d):p.setActiveNode=!1,$.each(i,function(e,t){p.typeSettings&&p.typeSettings.forEach(function(e){e.id==t.type&&(t.icon&&0!=t.icon.length||(t.icon="fa "+e.icon))}),!r&&n&&t.id==n&&(t.active=1,r=!0)});var o=[];for(var a in i)o.push(i[a]);return i=function(e){var t,n,i,r,o,a,s,l,d,c,u,f,h,p,g;for(r=e.id||"id",a=e.parent_id||"parent_id",l=[],s={},t={},o=[],i=c=0,f=(p=e.q).length;c<f;i=++c)s[(n=p[i])[r]]=i,null==t[n[a]]&&(t[n[a]]=[]),t[n[a]].push(e.q[i][r]);for(u=0,h=(g=e.q).length;u<h;u++)null==s[(n=g[u])[a]]&&l.push(n[r]);for(;l.length;)d=l.splice(0,1),o.push(e.q[s[d]]),null!=t[d]&&(l=t[d].concat(l));return o}({q:o}),i=function(e){var t,n,i,r,o,a,s,l,d;for(i=e.id||"id",o=e.parent_id||"parent_id",t=e.children||"children",a={},r=[],s=0,l=(d=e.q).length;s<l;s++)(n=d[s])[t]=[],a[n[i]]=n,null!=a[n[o]]?a[n[o]][t].push(n):r.push(n);return r}({q:i}),t.row&&t.row.length>0?e.noDataMessage.hide(p.regionID):(e.noDataMessage.hide(p.regionID),e.noDataMessage.show(p.regionID,p.noDataMessage)),i}catch(t){e.loader.stop(p.regionID,!0),$(p.regionID).empty(),e.errorMessage.show(p.regionID,p.errMessage),e.debug.error({featureInfo:featureInfo,module:"prepareData",msg:"Error while try to prepare data for tree",err:t})}},m=function(t){var n=v(t);if($(p.regionID).fancytree("getTree").reload(n),p.autoExpand2Level>0&&$(p.regionID).fancytree("getRootNode").visit(function(e){e.getLevel()<p.autoExpand2Level&&e.setExpanded(!0)}),e.isDefinedAndNotNull(l)){var i=e.getItemValue(l);e.isDefinedAndNotNull(i)&&i.length>0&&c()}f(),h(),e.loader.stop(p.regionID,!0)},x="#"+t.substring(4);g(function(t){var n=v(t);if($(p.regionID).fancytree({extensions:["glyph","filter"],quicksearch:!0,clones:{highlightClones:!0},nodata:!1,activeVisible:p.openParentOfActiveNode,escapeTitles:p.escapeHTML,checkbox:p.enableCheckBox,toggleEffect:p.animationDuration,selectMode:p.selectMode,debugLevel:0,keyboard:p.enableKeyBoard,quicksearch:p.enableQuicksearch,glyph:{preset:"awesome4",map:{_addClass:"fa",checkbox:p.checkbox,checkboxSelected:p.checkboxSelected,checkboxUnknown:p.checkboxUnknown,dragHelper:"fa-arrow-right",dropMarker:"fa-long-arrow-right",error:"fa-warning",expanderClosed:"fa-caret-right",expanderLazy:"fa-angle-right",expanderOpen:"fa-caret-down",loading:"fa-spinner fa-pulse",nodata:"fa-meh-o",noExpander:"",radio:"fa-circle-thin",radioSelected:"fa-circle",doc:"fa-file-o",docOpen:"fa-file-o",folder:"fa-folder-o",folderOpen:"fa-folder-open-o"}},filter:{autoApply:!0,autoExpand:p.search.autoExpand,counter:p.search.counter,fuzzy:!1,hideExpandedCounter:!0,hideExpanders:!1,highlight:p.search.highlight,leavesOnly:p.search.leavesOnly,nodata:!1,mode:p.search.hideUnmatched?"hide":"dimm"},source:n,init:function(e,t){f(),h(),p.setItemsOnInit&&u()},expand:function(e,t){f()},select:function(t,n){e.debug.info({selectEvent:t,selectData:n}),f(!0),""!=n.node.extraClasses&&($(n.node.li).find(".fancytree-node").hasClass("fancytree-selected")?$("."+n.node.extraClasses).addClass("fancytree-selected"):$("."+n.node.extraClasses).removeClass("fancytree-selected")),u()},beforeActivate:function(t,n){if(n.node&&n.node.data){var i=n.node.data;e.isDefinedAndNotNull(i.link)&&e.link(i.link)}return!!p.setActiveNode},activate:function(t,n){if(n.node&&n.node.data){var i=n.node.data;e.isDefinedAndNotNull(i.value)&&e.setItemValue(d,i.value)}f(!0)}}),e.isDefinedAndNotNull(l)){$("#"+l).on("keyup change",function(e){c()});var i=e.getItemValue(l);e.isDefinedAndNotNull(i)&&i.length>0&&c()}p.autoExpand2Level>0&&$(p.regionID).fancytree("getRootNode").visit(function(e){e.getLevel()<p.autoExpand2Level&&e.setExpanded(!0)}),e.loader.stop(p.regionID,!0),$(x).on("expandAll",function(){e.debug.info("expandAll fired"),$(p.regionID).fancytree("getTree").expandAll()}),$(x).on("collapseAll",function(){e.debug.info("collapseAll fired"),$(p.regionID).fancytree("getTree").expandAll(!1)})}),$(x).bind("apexrefresh",function(){0==$(p.regionID).children("span").length&&g(m)}),p.refresh>0&&setInterval(function(){0==$(p.regionID).children("span").length&&g(m)},1e3*p.refresh)}}}();