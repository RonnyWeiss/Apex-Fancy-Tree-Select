!function(k){k.ui=k.ui||{};k.ui.version="1.12.1";var i,n=0,s=Array.prototype.slice;k.cleanData=(i=k.cleanData,function(e){for(var t,n,r=0;null!=(n=e[r]);r++)try{(t=k._data(n,"events"))&&t.remove&&k(n).triggerHandler("remove")}catch(e){}i(e)}),k.widget=function(e,n,t){var r,i,o,a={},s=e.split(".")[0],l=s+"-"+(e=e.split(".")[1]);return t||(t=n,n=k.Widget),k.isArray(t)&&(t=k.extend.apply(null,[{}].concat(t))),k.expr[":"][l.toLowerCase()]=function(e){return!!k.data(e,l)},k[s]=k[s]||{},r=k[s][e],i=k[s][e]=function(e,t){if(!this._createWidget)return new i(e,t);arguments.length&&this._createWidget(e,t)},k.extend(i,r,{version:t.version,_proto:k.extend({},t),_childConstructors:[]}),(o=new n).options=k.widget.extend({},o.options),k.each(t,function(t,r){function i(){return n.prototype[t].apply(this,arguments)}function o(e){return n.prototype[t].apply(this,e)}k.isFunction(r)?a[t]=function(){var e,t=this._super,n=this._superApply;return this._super=i,this._superApply=o,e=r.apply(this,arguments),this._super=t,this._superApply=n,e}:a[t]=r}),i.prototype=k.widget.extend(o,{widgetEventPrefix:r&&o.widgetEventPrefix||e},a,{constructor:i,namespace:s,widgetName:e,widgetFullName:l}),r?(k.each(r._childConstructors,function(e,t){var n=t.prototype;k.widget(n.namespace+"."+n.widgetName,i,t._proto)}),delete r._childConstructors):n._childConstructors.push(i),k.widget.bridge(e,i),i},k.widget.extend=function(e){for(var t,n,r=s.call(arguments,1),i=0,o=r.length;i<o;i++)for(t in r[i])n=r[i][t],r[i].hasOwnProperty(t)&&void 0!==n&&(k.isPlainObject(n)?e[t]=k.isPlainObject(e[t])?k.widget.extend({},e[t],n):k.widget.extend({},n):e[t]=n);return e},k.widget.bridge=function(o,t){var a=t.prototype.widgetFullName||o;k.fn[o]=function(n){var e="string"==typeof n,r=s.call(arguments,1),i=this;return e?this.length||"instance"!==n?this.each(function(){var e,t=k.data(this,a);return"instance"===n?(i=t,!1):t?k.isFunction(t[n])&&"_"!==n.charAt(0)?(e=t[n].apply(t,r))!==t&&void 0!==e?(i=e&&e.jquery?i.pushStack(e.get()):e,!1):void 0:k.error("no such method '"+n+"' for "+o+" widget instance"):k.error("cannot call methods on "+o+" prior to initialization; attempted to call method '"+n+"'")}):i=void 0:(r.length&&(n=k.widget.extend.apply(null,[n].concat(r))),this.each(function(){var e=k.data(this,a);e?(e.option(n||{}),e._init&&e._init()):k.data(this,a,new t(n,this))})),i}},k.Widget=function(){},k.Widget._childConstructors=[],k.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,t){t=k(t||this.defaultElement||this)[0],this.element=k(t),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=k(),this.hoverable=k(),this.focusable=k(),this.classesElementLookup={},t!==this&&(k.data(t,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===t&&this.destroy()}}),this.document=k(t.style?t.ownerDocument:t.document||t),this.window=k(this.document[0].defaultView||this.document[0].parentWindow)),this.options=k.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:k.noop,_create:k.noop,_init:k.noop,destroy:function(){var n=this;this._destroy(),k.each(this.classesElementLookup,function(e,t){n._removeClass(t,e)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:k.noop,widget:function(){return this.element},option:function(e,t){var n,r,i,o=e;if(0===arguments.length)return k.widget.extend({},this.options);if("string"==typeof e)if(o={},e=(n=e.split(".")).shift(),n.length){for(r=o[e]=k.widget.extend({},this.options[e]),i=0;i<n.length-1;i++)r[n[i]]=r[n[i]]||{},r=r[n[i]];if(e=n.pop(),1===arguments.length)return void 0===r[e]?null:r[e];r[e]=t}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];o[e]=t}return this._setOptions(o),this},_setOptions:function(e){for(var t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return"classes"===e&&this._setOptionClasses(t),this.options[e]=t,"disabled"===e&&this._setOptionDisabled(t),this},_setOptionClasses:function(e){var t,n,r;for(t in e)r=this.classesElementLookup[t],e[t]!==this.options.classes[t]&&r&&r.length&&(n=k(r.get()),this._removeClass(r,t),n.addClass(this._classes({element:n,keys:t,classes:e,add:!0})))},_setOptionDisabled:function(e){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!e),e&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(i){var o=[],a=this;function e(e,t){for(var n,r=0;r<e.length;r++)n=a.classesElementLookup[e[r]]||k(),n=i.add?k(k.unique(n.get().concat(i.element.get()))):k(n.not(i.element).get()),a.classesElementLookup[e[r]]=n,o.push(e[r]),t&&i.classes[e[r]]&&o.push(i.classes[e[r]])}return i=k.extend({element:this.element,classes:this.options.classes||{}},i),this._on(i.element,{remove:"_untrackClassesElement"}),i.keys&&e(i.keys.match(/\S+/g)||[],!0),i.extra&&e(i.extra.match(/\S+/g)||[]),o.join(" ")},_untrackClassesElement:function(n){var r=this;k.each(r.classesElementLookup,function(e,t){-1!==k.inArray(n.target,t)&&(r.classesElementLookup[e]=k(t.not(n.target).get()))})},_removeClass:function(e,t,n){return this._toggleClass(e,t,n,!1)},_addClass:function(e,t,n){return this._toggleClass(e,t,n,!0)},_toggleClass:function(e,t,n,r){var i="string"==typeof e||null===e,n={extra:i?t:n,keys:i?e:t,element:i?this.element:e,add:r="boolean"==typeof r?r:n};return n.element.toggleClass(this._classes(n),r),this},_on:function(i,o,e){var a,s=this;"boolean"!=typeof i&&(e=o,o=i,i=!1),e?(o=a=k(o),this.bindings=this.bindings.add(o)):(e=o,o=this.element,a=this.widget()),k.each(e,function(e,t){function n(){if(i||!0!==s.options.disabled&&!k(this).hasClass("ui-state-disabled"))return("string"==typeof t?s[t]:t).apply(s,arguments)}"string"!=typeof t&&(n.guid=t.guid=t.guid||n.guid||k.guid++);var r=e.match(/^([\w:-]*)\s*(.*)$/),e=r[1]+s.eventNamespace,r=r[2];r?a.on(e,r,n):o.on(e,n)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(t).off(t),this.bindings=k(this.bindings.not(e).get()),this.focusable=k(this.focusable.not(e).get()),this.hoverable=k(this.hoverable.not(e).get())},_delay:function(e,t){var n=this;return setTimeout(function(){return("string"==typeof e?n[e]:e).apply(n,arguments)},t||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(k(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(k(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(k(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(k(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,t,n){var r,i,o=this.options[e];if(n=n||{},(t=k.Event(t)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),t.target=this.element[0],i=t.originalEvent)for(r in i)r in t||(t[r]=i[r]);return this.element.trigger(t,n),!(k.isFunction(o)&&!1===o.apply(this.element[0],[t].concat(n))||t.isDefaultPrevented())}},k.each({show:"fadeIn",hide:"fadeOut"},function(o,a){k.Widget.prototype["_"+o]=function(t,e,n){var r=(e="string"==typeof e?{effect:e}:e)?!0!==e&&"number"!=typeof e&&e.effect||a:o,i=!k.isEmptyObject(e="number"==typeof(e=e||{})?{duration:e}:e);e.complete=n,e.delay&&t.delay(e.delay),i&&k.effects&&k.effects.effect[r]?t[o](e):r!==o&&t[r]?t[r](e.duration,e.easing,n):t.queue(function(e){k(this)[o](),n&&n.call(t[0]),e()})}});var r,w,_,o,a,l,d,c,N;k.widget;function S(e,t,n){return[parseFloat(e[0])*(c.test(e[0])?t/100:1),parseFloat(e[1])*(c.test(e[1])?n/100:1)]}function E(e,t){return parseInt(k.css(e,t),10)||0}w=Math.max,_=Math.abs,o=/left|center|right/,a=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,d=/^\w+/,c=/%$/,N=k.fn.position,k.position={scrollbarWidth:function(){if(void 0!==r)return r;var e,t=k("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),n=t.children()[0];return k("body").append(t),e=n.offsetWidth,t.css("overflow","scroll"),e===(n=n.offsetWidth)&&(n=t[0].clientWidth),t.remove(),r=e-n},getScrollInfo:function(e){var t=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),n=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),t="scroll"===t||"auto"===t&&e.width<e.element[0].scrollWidth;return{width:"scroll"===n||"auto"===n&&e.height<e.element[0].scrollHeight?k.position.scrollbarWidth():0,height:t?k.position.scrollbarWidth():0}},getWithinInfo:function(e){var t=k(e||window),n=k.isWindow(t[0]),r=!!t[0]&&9===t[0].nodeType;return{element:t,isWindow:n,isDocument:r,offset:!n&&!r?k(e).offset():{left:0,top:0},scrollLeft:t.scrollLeft(),scrollTop:t.scrollTop(),width:t.outerWidth(),height:t.outerHeight()}}},k.fn.position=function(u){if(!u||!u.of)return N.apply(this,arguments);u=k.extend({},u);var h,f,p,g,y,e,v=k(u.of),m=k.position.getWithinInfo(u.within),b=k.position.getScrollInfo(m),x=(u.collision||"flip").split(" "),C={},t=9===(e=(t=v)[0]).nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:k.isWindow(e)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:e.preventDefault?{width:0,height:0,offset:{top:e.pageY,left:e.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()};return v[0].preventDefault&&(u.at="left top"),f=t.width,p=t.height,y=k.extend({},g=t.offset),k.each(["my","at"],function(){var e,t,n=(u[this]||"").split(" ");(n=1===n.length?o.test(n[0])?n.concat(["center"]):a.test(n[0])?["center"].concat(n):["center","center"]:n)[0]=o.test(n[0])?n[0]:"center",n[1]=a.test(n[1])?n[1]:"center",e=l.exec(n[0]),t=l.exec(n[1]),C[this]=[e?e[0]:0,t?t[0]:0],u[this]=[d.exec(n[0])[0],d.exec(n[1])[0]]}),1===x.length&&(x[1]=x[0]),"right"===u.at[0]?y.left+=f:"center"===u.at[0]&&(y.left+=f/2),"bottom"===u.at[1]?y.top+=p:"center"===u.at[1]&&(y.top+=p/2),h=S(C.at,f,p),y.left+=h[0],y.top+=h[1],this.each(function(){var n,e,a=k(this),s=a.outerWidth(),l=a.outerHeight(),t=E(this,"marginLeft"),r=E(this,"marginTop"),i=s+t+E(this,"marginRight")+b.width,o=l+r+E(this,"marginBottom")+b.height,d=k.extend({},y),c=S(C.my,a.outerWidth(),a.outerHeight());"right"===u.my[0]?d.left-=s:"center"===u.my[0]&&(d.left-=s/2),"bottom"===u.my[1]?d.top-=l:"center"===u.my[1]&&(d.top-=l/2),d.left+=c[0],d.top+=c[1],n={marginLeft:t,marginTop:r},k.each(["left","top"],function(e,t){k.ui.position[x[e]]&&k.ui.position[x[e]][t](d,{targetWidth:f,targetHeight:p,elemWidth:s,elemHeight:l,collisionPosition:n,collisionWidth:i,collisionHeight:o,offset:[h[0]+c[0],h[1]+c[1]],my:u.my,at:u.at,within:m,elem:a})}),u.using&&(e=function(e){var t=g.left-d.left,n=t+f-s,r=g.top-d.top,i=r+p-l,o={target:{element:v,left:g.left,top:g.top,width:f,height:p},element:{element:a,left:d.left,top:d.top,width:s,height:l},horizontal:n<0?"left":0<t?"right":"center",vertical:i<0?"top":0<r?"bottom":"middle"};f<s&&_(t+n)<f&&(o.horizontal="center"),p<l&&_(r+i)<p&&(o.vertical="middle"),w(_(t),_(n))>w(_(r),_(i))?o.important="horizontal":o.important="vertical",u.using.call(this,e,o)}),a.offset(k.extend(d,{using:e}))})},k.ui.position={fit:{left:function(e,t){var n=t.within,r=n.isWindow?n.scrollLeft:n.offset.left,i=n.width,o=e.left-t.collisionPosition.marginLeft,a=r-o,s=o+t.collisionWidth-i-r;t.collisionWidth>i?0<a&&s<=0?(n=e.left+a+t.collisionWidth-i-r,e.left+=a-n):e.left=!(0<s&&a<=0)&&s<a?r+i-t.collisionWidth:r:0<a?e.left+=a:0<s?e.left-=s:e.left=w(e.left-o,e.left)},top:function(e,t){var n=t.within,r=n.isWindow?n.scrollTop:n.offset.top,i=t.within.height,o=e.top-t.collisionPosition.marginTop,a=r-o,s=o+t.collisionHeight-i-r;t.collisionHeight>i?0<a&&s<=0?(n=e.top+a+t.collisionHeight-i-r,e.top+=a-n):e.top=!(0<s&&a<=0)&&s<a?r+i-t.collisionHeight:r:0<a?e.top+=a:0<s?e.top-=s:e.top=w(e.top-o,e.top)}},flip:{left:function(e,t){var n=t.within,r=n.offset.left+n.scrollLeft,i=n.width,o=n.isWindow?n.scrollLeft:n.offset.left,a=e.left-t.collisionPosition.marginLeft,s=a-o,l=a+t.collisionWidth-i-o,d="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,n="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,a=-2*t.offset[0];s<0?((r=e.left+d+n+a+t.collisionWidth-i-r)<0||r<_(s))&&(e.left+=d+n+a):0<l&&(0<(o=e.left-t.collisionPosition.marginLeft+d+n+a-o)||_(o)<l)&&(e.left+=d+n+a)},top:function(e,t){var n=t.within,r=n.offset.top+n.scrollTop,i=n.height,o=n.isWindow?n.scrollTop:n.offset.top,a=e.top-t.collisionPosition.marginTop,s=a-o,l=a+t.collisionHeight-i-o,d="top"===t.my[1]?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,n="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,a=-2*t.offset[1];s<0?((r=e.top+d+n+a+t.collisionHeight-i-r)<0||r<_(s))&&(e.top+=d+n+a):0<l&&(0<(o=e.top-t.collisionPosition.marginTop+d+n+a-o)||_(o)<l)&&(e.top+=d+n+a)}},flipfit:{left:function(){k.ui.position.flip.left.apply(this,arguments),k.ui.position.fit.left.apply(this,arguments)},top:function(){k.ui.position.flip.top.apply(this,arguments),k.ui.position.fit.top.apply(this,arguments)}}};var e;k.ui.position,k.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},k.fn.scrollParent=function(e){var t=this.css("position"),n="absolute"===t,r=e?/(auto|scroll|hidden)/:/(auto|scroll)/,e=this.parents().filter(function(){var e=k(this);return(!n||"static"!==e.css("position"))&&r.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==t&&e.length?e:k(this[0].ownerDocument||document)},k.fn.extend({uniqueId:(e=0,function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&k(this).removeAttr("id")})}})}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){var t;return t=function(C){"use strict";if(!C.ui||!C.ui.fancytree){for(var e,h=null,c=new RegExp(/\.|\//),t=/[&<>"'/]/g,n=/[<>"'/]/g,f="$recursive_request",p="$request_target_invalid",r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},i={16:!0,17:!0,18:!0},u={8:"backspace",9:"tab",10:"return",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},g={16:"shift",17:"ctrl",18:"alt",91:"meta",93:"meta"},o={0:"",1:"left",2:"middle",3:"right"},y="active expanded focus folder lazy radiogroup selected unselectable unselectableIgnore".split(" "),v={},m="columns types".split(" "),b="checkbox expanded extraClasses folder icon iconTooltip key lazy partsel radiogroup refKey selected statusNodeType title tooltip type unselectable unselectableIgnore unselectableStatus".split(" "),a={},x={},s={active:!0,children:!0,data:!0,focus:!0},l=0;l<y.length;l++)v[y[l]]=!0;for(l=0;l<b.length;l++)e=b[l],a[e]=!0,e!==e.toLowerCase()&&(x[e.toLowerCase()]=e);return k(C.ui,"Fancytree requires jQuery UI (http://jqueryui.com)"),Date.now||(Date.now=function(){return(new Date).getTime()}),D.prototype={_findDirectChild:function(e){var t,n,r=this.children;if(r)if("string"==typeof e){for(t=0,n=r.length;t<n;t++)if(r[t].key===e)return r[t]}else{if("number"==typeof e)return this.children[e];if(e.parent===this)return e}return null},_setChildren:function(e){k(e&&(!this.children||0===this.children.length),"only init supported"),this.children=[];for(var t=0,n=e.length;t<n;t++)this.children.push(new D(this,e[t]));this.tree._callHook("treeStructureChanged",this.tree,"setChildren")},addChildren:function(e,t){var n,r,i,o,a=this.getFirstChild(),s=this.getLastChild(),l=[];for(C.isPlainObject(e)&&(e=[e]),this.children||(this.children=[]),n=0,r=e.length;n<r;n++)l.push(new D(this,e[n]));if(o=l[0],null==t?this.children=this.children.concat(l):(t=this._findDirectChild(t),k(0<=(i=C.inArray(t,this.children)),"insertBefore must be an existing child"),this.children.splice.apply(this.children,[i,0].concat(l))),a&&!t){for(n=0,r=l.length;n<r;n++)l[n].render();a!==this.getFirstChild()&&a.renderStatus(),s!==this.getLastChild()&&s.renderStatus()}else this.parent&&!this.parent.ul&&!this.tr||this.render();return 3===this.tree.options.selectMode&&this.fixSelection3FromEndNodes(),this.triggerModifyChild("add",1===l.length?l[0]:null),o},addClass:function(e){return this.toggleClass(e,!0)},addNode:function(e,t){switch(t=void 0===t||"over"===t?"child":t){case"after":return this.getParent().addChildren(e,this.getNextSibling());case"before":return this.getParent().addChildren(e,this);case"firstChild":var n=this.children?this.children[0]:null;return this.addChildren(e,n);case"child":case"over":return this.addChildren(e)}k(!1,"Invalid mode: "+t)},addPagingNode:function(e,t){var n,r;if(t=t||"child",!1!==e)return e=C.extend({title:this.tree.options.strings.moreData,statusNodeType:"paging",icon:!1},e),this.partload=!0,this.addNode(e,t);for(n=this.children.length-1;0<=n;n--)"paging"===(r=this.children[n]).statusNodeType&&this.removeChild(r);this.partload=!1},appendSibling:function(e){return this.addNode(e,"after")},applyCommand:function(e,t){return this.tree.applyCommand(e,this,t)},applyPatch:function(e){if(null===e)return this.remove(),_(this);var t,n,r={children:!0,expanded:!0,parent:!0};for(t in e)e.hasOwnProperty(t)&&(n=e[t],r[t]||C.isFunction(n)||(a[t]?this[t]=n:this.data[t]=n));return e.hasOwnProperty("children")&&(this.removeChildren(),e.children&&this._setChildren(e.children)),this.isVisible()&&(this.renderTitle(),this.renderStatus()),e.hasOwnProperty("expanded")?this.setExpanded(e.expanded):_(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(e,t,n){return e.addNode(this.toDict(!0,n),t)},countChildren:function(e){var t,n,r,i=this.children;if(!i)return 0;if(r=i.length,!1!==e)for(t=0,n=r;t<n;t++)r+=i[t].countChildren();return r},debug:function(e){4<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("log",arguments))},discard:function(){return this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead."),this.resetLazy()},discardMarkup:function(e){this.tree._callHook(e?"nodeRemoveMarkup":"nodeRemoveChildMarkup",this)},error:function(e){1<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("error",arguments))},findAll:function(t){t=C.isFunction(t)?t:T(t);var n=[];return this.visit(function(e){t(e)&&n.push(e)}),n},findFirst:function(t){t=C.isFunction(t)?t:T(t);var n=null;return this.visit(function(e){if(t(e))return n=e,!1}),n},findRelatedNode:function(e,t){return this.tree.findRelatedNode(this,e,t)},_changeSelectStatusAttrs:function(e){var t=!1,n=this.tree.options,r=h.evalOption("unselectable",this,this,n,!1),n=h.evalOption("unselectableStatus",this,this,n,void 0);switch(e=r&&null!=n?n:e){case!1:t=this.selected||this.partsel,this.selected=!1,this.partsel=!1;break;case!0:t=!this.selected||!this.partsel,this.selected=!0,this.partsel=!0;break;case void 0:t=this.selected||!this.partsel,this.selected=!1,this.partsel=!0;break;default:k(!1,"invalid state: "+e)}return t&&this.renderStatus(),t},fixSelection3AfterClick:function(e){var t=this.isSelected();this.visit(function(e){if(e._changeSelectStatusAttrs(t),e.radiogroup)return"skip"}),this.fixSelection3FromEndNodes(e)},fixSelection3FromEndNodes:function(e){var u=this.tree.options;k(3===u.selectMode,"expected selectMode 3"),function e(t){var n,r,i,o,a,s,l,d,c=t.children;if(c&&c.length){for(l=!(s=!0),n=0,r=c.length;n<r;n++)o=e(i=c[n]),h.evalOption("unselectableIgnore",i,i,u,!1)||(!1!==o&&(l=!0),!0!==o&&(s=!1));a=!!s||!!l&&void 0}else a=null==(d=h.evalOption("unselectableStatus",t,t,u,void 0))?!!t.selected:!!d;return t.partsel&&!t.selected&&t.lazy&&null==t.children&&(a=void 0),t._changeSelectStatusAttrs(a),a}(this),this.visitParents(function(e){for(var t,n,r,i=e.children,o=!0,a=!1,s=0,l=i.length;s<l;s++)t=i[s],h.evalOption("unselectableIgnore",t,t,u,!1)||(((n=null==(r=h.evalOption("unselectableStatus",t,t,u,void 0))?!!t.selected:!!r)||t.partsel)&&(a=!0),n||(o=!1));e._changeSelectStatusAttrs(n=!!o||!!a&&void 0)})},fromDict:function(e){for(var t in e)a[t]?this[t]=e[t]:"data"===t?C.extend(this.data,e.data):C.isFunction(e[t])||s[t]||(this.data[t]=e[t]);e.children&&(this.removeChildren(),this.addChildren(e.children)),this.renderTitle()},getChildren:function(){if(void 0!==this.hasChildren())return this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return C.inArray(this,this.parent.children)},getIndexHier:function(e,n){e=e||".";var r,i=[];return C.each(this.getParentList(!1,!0),function(e,t){r=""+(t.getIndex()+1),n&&(r=("0000000"+r).substr(-n)),i.push(r)}),i.join(e)},getKeyPath:function(e){var t=this.tree.options.keyPathSeparator;return t+this.getPath(!e,"key",t)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},getNextSibling:function(){if(this.parent)for(var e=this.parent.children,t=0,n=e.length-1;t<n;t++)if(e[t]===this)return e[t+1];return null},getParent:function(){return this.parent},getParentList:function(e,t){for(var n=[],r=t?this:this.parent;r;)(e||r.parent)&&n.unshift(r),r=r.parent;return n},getPath:function(e,t,n){e=!1!==e,t=t||"title",n=n||"/";var r,i=[],o=C.isFunction(t);return this.visitParents(function(e){e.parent&&(r=o?t(e):e[t],i.unshift(r))},e),i.join(n)},getPrevSibling:function(){if(this.parent)for(var e=this.parent.children,t=1,n=e.length;t<n;t++)if(e[t]===this)return e[t-1];return null},getSelectedNodes:function(t){var n=[];return this.visit(function(e){if(e.selected&&(n.push(e),!0===t))return"skip"}),n},hasChildren:function(){return this.lazy?null==this.children?void 0:0!==this.children.length&&(1!==this.children.length||!this.children[0].isStatusNode()||void 0):!(!this.children||!this.children.length)},hasClass:function(e){return 0<=(" "+(this.extraClasses||"")+" ").indexOf(" "+e+" ")},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},info:function(e){3<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("info",arguments))},isActive:function(){return this.tree.activeNode===this},isBelowOf:function(e){return this.getIndexHier(".",5)>e.getIndexHier(".",5)},isChildOf:function(e){return this.parent&&this.parent===e},isDescendantOf:function(e){if(!e||e.tree!==this.tree)return!1;for(var t=this.parent;t;){if(t===e)return!0;t===t.parent&&C.error("Recursive parent link: "+t),t=t.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var e=this.parent;return!e||e.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var e=this.parent;return!e||e.children[e.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||void 0!==this.hasChildren()},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.isRootNode()},isPartsel:function(){return!this.selected&&!!this.partsel},isPartload:function(){return!!this.partload},isRootNode:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isPagingNode:function(){return"paging"===this.statusNodeType},isTopLevel:function(){return this.tree.rootNode===this.parent},isUndefined:function(){return void 0===this.hasChildren()},isVisible:function(){var e,t,n=this.tree.enableFilter,r=this.getParentList(!1,!1);if(n&&!this.match&&!this.subMatchCount)return!1;for(e=0,t=r.length;e<t;e++)if(!r[e].expanded)return!1;return!0},lazyLoad:function(e){C.error("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead.")},load:function(e){var t=this,n=this.isExpanded();return k(this.isLazy(),"load() requires a lazy node"),e||this.isUndefined()?(this.isLoaded()&&this.resetLazy(),!1===(e=this.tree._triggerNodeEvent("lazyLoad",this))?_(this):(k("boolean"!=typeof e,"lazyLoad event must return source in data.result"),e=this.tree._callHook("nodeLoadChildren",this,e),n?(this.expanded=!0,e.always(function(){t.render()})):e.always(function(){t.renderStatus()}),e)):_(this)},makeVisible:function(e){for(var t=this,n=[],r=new C.Deferred,i=this.getParentList(!1,!1),o=i.length,a=!(e&&!0===e.noAnimation),s=!(e&&!1===e.scrollIntoView),l=o-1;0<=l;l--)n.push(i[l].setExpanded(!0,e));return C.when.apply(C,n).done(function(){s?t.scrollIntoView(a).done(function(){r.resolve()}):r.resolve()}),r.promise()},moveTo:function(t,e,n){void 0===e||"over"===e?e="child":"firstChild"===e&&(t.children&&t.children.length?(e="before",t=t.children[0]):e="child");var r,i=this.tree,o=this.parent,a="child"===e?t:t.parent;if(this!==t){if(this.parent?a.isDescendantOf(this)&&C.error("Cannot move a node to its own descendant"):C.error("Cannot move system root"),a!==o&&o.triggerModifyChild("remove",this),1===this.parent.children.length){if(this.parent===a)return;this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1}else k(0<=(r=C.inArray(this,this.parent.children)),"invalid source parent"),this.parent.children.splice(r,1);if((this.parent=a).hasChildren())switch(e){case"child":a.children.push(this);break;case"before":k(0<=(r=C.inArray(t,a.children)),"invalid target parent"),a.children.splice(r,0,this);break;case"after":k(0<=(r=C.inArray(t,a.children)),"invalid target parent"),a.children.splice(r+1,0,this);break;default:C.error("Invalid mode "+e)}else a.children=[this];n&&t.visit(n,!0),a===o?a.triggerModifyChild("move",this):a.triggerModifyChild("add",this),i!==t.tree&&(this.warn("Cross-tree moveTo is experimental!"),this.visit(function(e){e.tree=t.tree},!0)),i._callHook("treeStructureChanged",i,"moveTo"),o.isDescendantOf(a)||o.render(),a.isDescendantOf(o)||a===o||a.render()}},navigate:function(e,t){var n=C.ui.keyCode;switch(e){case"left":case n.LEFT:if(this.expanded)return this.setExpanded(!1);break;case"right":case n.RIGHT:if(!this.expanded&&(this.children||this.lazy))return this.setExpanded()}if(n=this.findRelatedNode(e)){try{n.makeVisible({scrollIntoView:!1})}catch(e){}return!1===t?(n.setFocus(),_()):n.setActive()}return this.warn("Could not find related node '"+e+"'."),_()},remove:function(){return this.parent.removeChild(this)},removeChild:function(e){return this.tree._callHook("nodeRemoveChild",this,e)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},removeClass:function(e){return this.toggleClass(e,!1)},render:function(e,t){return this.tree._callHook("nodeRender",this,e,t)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},replaceWith:function(e){var n=this.parent,r=C.inArray(this,n.children),i=this;return k(this.isPagingNode(),"replaceWith() currently requires a paging status node"),(e=this.tree._callHook("nodeLoadChildren",this,e)).done(function(e){var t=i.children;for(l=0;l<t.length;l++)t[l].parent=n;n.children.splice.apply(n.children,[r+1,0].concat(t)),i.children=null,i.remove(),n.render()}).fail(function(){i.setExpanded()}),e},resetLazy:function(){this.removeChildren(),this.expanded=!1,this.lazy=!0,this.children=void 0,this.renderStatus()},scheduleAction:function(e,t){this.tree.timer&&(clearTimeout(this.tree.timer),this.tree.debug("clearTimeout(%o)",this.tree.timer)),this.tree.timer=null;var n=this;switch(e){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger expand"),n.setExpanded(!0)},t);break;case"activate":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger activate"),n.setActive(!0)},t);break;default:C.error("Invalid mode "+e)}},scrollIntoView:function(e,t){if(void 0!==t&&((p=t).tree&&void 0!==p.statusNodeType))throw Error("scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead.");var n=C.extend({effects:!0===e?{duration:200,queue:!1}:e,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent,topNode:null},t),r=n.scrollParent,i=this.tree.$container,o=i.css("overflow-y");r?r.jquery||(r=C(r)):r=!this.tree.tbody&&("scroll"===o||"auto"===o)?i:i.scrollParent(),r[0]!==document&&r[0]!==document.body||(this.debug("scrollIntoView(): normalizing scrollParent to 'window':",r[0]),r=C(window));var a,s,l=new C.Deferred,d=this,c=C(this.span).height(),u=n.scrollOfs.top||0,h=n.scrollOfs.bottom||0,f=r.height(),p=r.scrollTop(),e=r,t=r[0]===window,o=n.topNode||null,i=null;return this.isRootNode()||!this.isVisible()?(this.info("scrollIntoView(): node is invisible."),_()):(t?(s=C(this.span).offset().top,a=o&&o.span?C(o.span).offset().top:0,e=C("html,body")):(k(r[0]!==document&&r[0]!==document.body,"scrollParent should be a simple element or `window`, not document or body."),t=r.offset().top,s=C(this.span).offset().top-t+p,a=o?C(o.span).offset().top-t+p:0,f-=Math.max(0,r.innerHeight()-r[0].clientHeight)),s<p+u?i=s-u:p+f-h<s+c&&(i=s+c-f+h,o&&(k(o.isRootNode()||o.isVisible(),"topNode must be visible"),a<i&&(i=a-u))),null===i?l.resolveWith(this):n.effects?(n.effects.complete=function(){l.resolveWith(d)},e.stop(!0).animate({scrollTop:i},n.effects)):(e[0].scrollTop=i,l.resolveWith(this)),l.promise())},setActive:function(e,t){return this.tree._callHook("nodeSetActive",this,e,t)},setExpanded:function(e,t){return this.tree._callHook("nodeSetExpanded",this,e,t)},setFocus:function(e){return this.tree._callHook("nodeSetFocus",this,e)},setSelected:function(e,t){return this.tree._callHook("nodeSetSelected",this,e,t)},setStatus:function(e,t,n){return this.tree._callHook("nodeSetStatus",this,e,t,n)},setTitle:function(e){this.title=e,this.renderTitle(),this.triggerModify("rename")},sortChildren:function(e,t){var n,r,i=this.children;if(i){if(i.sort(e=e||function(e,t){e=e.title.toLowerCase(),t=t.title.toLowerCase();return e===t?0:t<e?1:-1}),t)for(n=0,r=i.length;n<r;n++)i[n].children&&i[n].sortChildren(e,"$norender$");"$norender$"!==t&&this.render(),this.triggerModifyChild("sort")}},toDict:function(e,t){var n,r,i,o,a={},s=this;if(C.each(b,function(e,t){!s[t]&&!1!==s[t]||(a[t]=s[t])}),C.isEmptyObject(this.data)||(a.data=C.extend({},this.data),C.isEmptyObject(a.data)&&delete a.data),t){if(!1===(o=t(a,s)))return!1;"skip"===o&&(e=!1)}if(e&&C.isArray(this.children))for(a.children=[],n=0,r=this.children.length;n<r;n++)(i=this.children[n]).isStatusNode()||!1!==(o=i.toDict(!0,t))&&a.children.push(o);return a},toggleClass:function(e,t){var n,r,i=e.match(/\S+/g)||[],o=0,a=!1,s=this[this.tree.statusClassPropName],l=" "+(this.extraClasses||"")+" ";for(s&&C(s).toggleClass(e,t);n=i[o++];)if(r=0<=l.indexOf(" "+n+" "),t=void 0===t?!r:!!t)r||(l+=n+" ",a=!0);else for(;-1<l.indexOf(" "+n+" ");)l=l.replace(" "+n+" "," ");return this.extraClasses=C.trim(l),a},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"FancytreeNode@"+this.key+"[title='"+this.title+"']"},triggerModifyChild:function(e,t,n){var r=this.tree.options.modifyChild;r&&(t&&t.parent!==this&&C.error("childNode "+t+" is not a child of "+this),t={node:this,tree:this.tree,operation:e,childNode:t||null},n&&C.extend(t,n),r({type:"modifyChild"},t))},triggerModify:function(e,t){this.parent.triggerModifyChild(e,this,t)},visit:function(e,t){var n,r,i=!0,o=this.children;if(!0===t&&(!1===(i=e(this))||"skip"===i))return i;if(o)for(n=0,r=o.length;n<r&&!1!==(i=o[n].visit(e,!0));n++);return i},visitAndLoad:function(n,e,t){var r,i,o,a=this;return!n||!0!==e||!1!==(i=n(a))&&"skip"!==i?a.children||a.lazy?(r=new C.Deferred,o=[],a.load().done(function(){for(var e=0,t=a.children.length;e<t;e++){if(!1===(i=a.children[e].visitAndLoad(n,!0,!0))){r.reject();break}"skip"!==i&&o.push(i)}C.when.apply(this,o).then(function(){r.resolve()})}),r.promise()):_():t?i:_()},visitParents:function(e,t){if(t&&!1===e(this))return!1;for(var n=this.parent;n;){if(!1===e(n))return!1;n=n.parent}return!0},visitSiblings:function(e,t){for(var n,r=this.parent.children,i=0,o=r.length;i<o;i++)if(n=r[i],(t||n!==this)&&!1===e(n))return!1;return!0},warn:function(e){2<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("warn",arguments))}},O.prototype={_makeHookContext:function(e,t,n){var r,i;return void 0!==e.node?(t&&e.originalEvent!==t&&C.error("invalid args"),r=e):e.tree?r={node:e,tree:i=e.tree,widget:i.widget,options:i.widget.options,originalEvent:t,typeInfo:i.types[e.type]||{}}:e.widget?r={node:null,tree:e,widget:e.widget,options:e.widget.options,originalEvent:t}:C.error("invalid args"),n&&C.extend(r,n),r},_callHook:function(e,t,n){var r=this._makeHookContext(t),i=this[e],t=Array.prototype.slice.call(arguments,2);return C.isFunction(i)||C.error("_callHook('"+e+"') is not a function"),t.unshift(r),i.apply(this,t)},_setExpiringValue:function(e,t,n){this._tempCache[e]={value:t,expire:Date.now()+(+n||50)}},_getExpiringValue:function(e){var t=this._tempCache[e];return t&&t.expire>Date.now()?t.value:(delete this._tempCache[e],null)},_usesExtension:function(e){return 0<=C.inArray(e,this.options.extensions)},_requireExtension:function(e,t,n,r){null!=n&&(n=!!n);var i=this._local.name,o=this.options.extensions,a=C.inArray(e,o)<C.inArray(i,o),o=t&&null==this.ext[e],a=!o&&null!=n&&n!==a;return k(i&&i!==e,"invalid or same name '"+i+"' (require yourself?)"),!o&&!a||(r||(o||t?(r="'"+i+"' extension requires '"+e+"'",a&&(r+=" to be registered "+(n?"before":"after")+" itself")):r="If used together, `"+e+"` must be registered "+(n?"before":"after")+" `"+i+"`"),C.error(r),!1)},activateKey:function(e,t){e=this.getNodeByKey(e);return e?e.setActive(!0,t):this.activeNode&&this.activeNode.setActive(!1,t),e},addPagingNode:function(e,t){return this.rootNode.addPagingNode(e,t)},applyCommand:function(e,t,n){var r;switch(t=t||this.getActiveNode(),e){case"moveUp":(r=t.getPrevSibling())&&(t.moveTo(r,"before"),t.setActive());break;case"moveDown":(r=t.getNextSibling())&&(t.moveTo(r,"after"),t.setActive());break;case"indent":(r=t.getPrevSibling())&&(t.moveTo(r,"child"),r.setExpanded(),t.setActive());break;case"outdent":t.isTopLevel()||(t.moveTo(t.getParent(),"after"),t.setActive());break;case"remove":r=t.getPrevSibling()||t.getParent(),t.remove(),r&&r.setActive();break;case"addChild":t.editCreateNode("child","");break;case"addSibling":t.editCreateNode("after","");break;case"rename":t.editStart();break;case"down":case"first":case"last":case"left":case"parent":case"right":case"up":return t.navigate(e);default:C.error("Unhandled command: '"+e+"'")}},applyPatch:function(e){for(var t,n,r,i,o=e.length,a=[],s=0;s<o;s++)k(2===(t=e[s]).length,"patchList must be an array of length-2-arrays"),n=t[0],r=t[1],(i=null===n?this.rootNode:this.getNodeByKey(n))?(t=new C.Deferred,a.push(t),i.applyPatch(r).always(S(t,i))):this.warn("could not find node with key '"+n+"'");return C.when.apply(C,a).promise()},clear:function(e){this._callHook("treeClear",this)},count:function(){return this.rootNode.countChildren()},debug:function(e){4<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("log",arguments))},destroy:function(){this.widget.destroy()},enable:function(e){!1===e?this.widget.disable():this.widget.enable()},enableUpdate:function(e){return!!this._enableUpdate==!!(e=!1!==e)?e:((this._enableUpdate=e)?(this.debug("enableUpdate(true): redraw "),this._callHook("treeStructureChanged",this,"enableUpdate"),this.render()):this.debug("enableUpdate(false)..."),!e)},error:function(e){1<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("error",arguments))},expandAll:function(t,n){var e=this.enableUpdate(!1);t=!1!==t,this.visit(function(e){!1!==e.hasChildren()&&e.isExpanded()!==t&&e.setExpanded(t,n)}),this.enableUpdate(e)},findAll:function(e){return this.rootNode.findAll(e)},findFirst:function(e){return this.rootNode.findFirst(e)},findNextNode:function(t,n){var r,i=null,e=this.getFirstChild();function o(e){if((i=t(e)?e:i)||e===n)return!1}return t="string"==typeof t?(r=new RegExp("^"+t,"i"),function(e){return r.test(e.title)}):t,n=n||e,this.visitRows(o,{start:n,includeSelf:!1}),i||n===e||this.visitRows(o,{start:e,includeSelf:!0}),i},findRelatedNode:function(e,t,n){var r=null,i=C.ui.keyCode;switch(t){case"parent":case i.BACKSPACE:e.parent&&e.parent.parent&&(r=e.parent);break;case"first":case i.HOME:this.visit(function(e){if(e.isVisible())return r=e,!1});break;case"last":case i.END:this.visit(function(e){e.isVisible()&&(r=e)});break;case"left":case i.LEFT:e.expanded?e.setExpanded(!1):e.parent&&e.parent.parent&&(r=e.parent);break;case"right":case i.RIGHT:e.expanded||!e.children&&!e.lazy?e.children&&e.children.length&&(r=e.children[0]):(e.setExpanded(),r=e);break;case"up":case i.UP:this.visitRows(function(e){return r=e,!1},{start:e,reverse:!0,includeSelf:!1});break;case"down":case i.DOWN:this.visitRows(function(e){return r=e,!1},{start:e,includeSelf:!1});break;default:this.tree.warn("Unknown relation '"+t+"'.")}return r},generateFormElements:function(e,t,n){n=n||{};var r="string"==typeof e?e:"ft_"+this._id+"[]",i="string"==typeof t?t:"ft_"+this._id+"_active",o="fancytree_result_"+this._id,a=C("#"+o),s=3===this.options.selectMode&&!1!==n.stopOnParents;function l(e){a.append(C("<input>",{type:"checkbox",name:r,value:e.key,checked:!0}))}a.length?a.empty():a=C("<div>",{id:o}).hide().insertAfter(this.$container),!1!==t&&this.activeNode&&a.append(C("<input>",{type:"radio",name:i,value:this.activeNode.key,checked:!0})),n.filter?this.visit(function(e){var t=n.filter(e);if("skip"===t)return t;!1!==t&&l(e)}):!1!==e&&(s=this.getSelectedNodes(s),C.each(s,function(e,t){l(t)}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(){return this.focusNode},getOption:function(e){return this.widget.option(e)},getNodeByKey:function(t,e){var n,r;return!e&&(n=document.getElementById(this.options.idPrefix+t))?n.ftnode||null:(e=e||this.rootNode,r=null,t=""+t,e.visit(function(e){if(e.key===t)return r=e,!1},!0),r)},getRootNode:function(){return this.rootNode},getSelectedNodes:function(e){return this.rootNode.getSelectedNodes(e)},hasFocus:function(){return!!this._hasFocus},info:function(e){3<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("info",arguments))},isLoading:function(){var t=!1;return this.rootNode.visit(function(e){if(e._isLoading||e._requestId)return!(t=!0)},!0),t},loadKeyPath:function(e,t){var r,n,i,o=this,a=new C.Deferred,s=this.getRootNode(),l=this.options.keyPathSeparator,d=[],c=C.extend({},t);for("function"==typeof t?r=t:t&&t.callback&&(r=t.callback),c.callback=function(e,t,n){r&&r.call(e,t,n),a.notifyWith(e,[{node:t,status:n}])},null==c.matchKey&&(c.matchKey=function(e,t){return e.key===t}),C.isArray(e)||(e=[e]),n=0;n<e.length;n++)(i=e[n]).charAt(0)===l&&(i=i.substr(1)),d.push(i.split(l));return setTimeout(function(){o._loadKeyPathImpl(a,c,s,d).done(function(){a.resolve()})},0),a.promise()},_loadKeyPathImpl:function(e,o,t,n){var r,i,a,s,l,d,c,u,h,f,p=this;for(c={},i=0;i<n.length;i++)for(h=n[i],u=t;h.length;){if(a=h.shift(),!(s=function(e,t){var n,r,i=e.children;if(i)for(n=0,r=i.length;n<r;n++)if(o.matchKey(i[n],t))return i[n];return null}(u,a))){this.warn("loadKeyPath: key not found: "+a+" (parent: "+u+")"),o.callback(this,a,"error");break}if(0===h.length){o.callback(this,s,"ok");break}if(s.lazy&&void 0===s.hasChildren()){o.callback(this,s,"loaded"),c[a=s.key]?c[a].pathSegList.push(h):c[a]={parent:s,pathSegList:[h]};break}o.callback(this,s,"loaded"),u=s}for(l in r=[],c)c.hasOwnProperty(l)&&(d=c[l],f=new C.Deferred,r.push(f),function(t,n,e){o.callback(p,n,"loading"),n.load().done(function(){p._loadKeyPathImpl.call(p,t,o,n,e).always(S(t,p))}).fail(function(e){p.warn("loadKeyPath: error loading lazy "+n),o.callback(p,s,"error"),t.rejectWith(p)})}(f,d.parent,d.pathSegList));return C.when.apply(C,r).promise()},reactivate:function(e){var t,n=this.activeNode;return n?(this.activeNode=null,t=n.setActive(!0,{noFocus:!0}),e&&n.setFocus(),t):_()},reload:function(e){return this._callHook("treeClear",this),this._callHook("treeLoad",this,e)},render:function(e,t){return this.rootNode.render(e,t)},selectAll:function(t){this.visit(function(e){e.setSelected(t)})},setFocus:function(e){return this._callHook("treeSetFocus",this,e)},setOption:function(e,t){return this.widget.option(e,t)},debugTime:function(e){4<=this.options.debugLevel&&window.console.time(this+" - "+e)},debugTimeEnd:function(e){4<=this.options.debugLevel&&window.console.timeEnd(this+" - "+e)},toDict:function(e,t){t=this.rootNode.toDict(!0,t);return e?t:t.children},toString:function(){return"Fancytree@"+this._id},_triggerNodeEvent:function(e,t,n,r){r=this._makeHookContext(t,n,r),n=this.widget._trigger(e,n,r);return!1!==n&&void 0!==r.result?r.result:n},_triggerTreeEvent:function(e,t,n){n=this._makeHookContext(this,t,n),t=this.widget._trigger(e,t,n);return!1!==t&&void 0!==n.result?n.result:t},visit:function(e){return this.rootNode.visit(e,!1)},visitRows:function(t,e){if(!this.rootNode.hasChildren())return!1;if(e&&e.reverse)return delete e.reverse,this._visitRowsUp(t,e);for(var n,r,i,o=0,a=!1===(e=e||{}).includeSelf,s=!!e.includeHidden,l=!s&&this.enableFilter,d=e.start||this.rootNode.children[0],c=d.parent;c;){for(k(0<=(r=(i=c.children).indexOf(d)+o),"Could not find "+d+" in parent's children: "+c),n=r;n<i.length;n++)if(d=i[n],!l||d.match||d.subMatchCount){if(!a&&!1===t(d))return!1;if(a=!1,d.children&&d.children.length&&(s||d.expanded)&&!1===d.visit(function(e){return!l||e.match||e.subMatchCount?!1!==t(e)&&(s||!e.children||e.expanded?void 0:"skip"):"skip"},!1))return!1}c=(d=c).parent,o=1}return!0},_visitRowsUp:function(e,t){for(var n,r,i,o=!!t.includeHidden,a=t.start||this.rootNode.children[0];;){if((n=(i=a.parent).children)[0]===a){if(!(a=i).parent)break;n=i.children}else for(r=n.indexOf(a),a=n[r-1];(o||a.expanded)&&a.children&&a.children.length;)a=(n=(i=a).children)[n.length-1];if((o||a.isVisible())&&!1===e(a))return!1}},warn:function(e){2<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("warn",arguments))}},C.extend(O.prototype,{nodeClick:function(e){var t,n,r=e.targetType,i=e.node;if("expander"===r)i.isLoading()?i.debug("Got 2nd click while loading: ignored"):this._callHook("nodeToggleExpanded",e);else if("checkbox"===r)this._callHook("nodeToggleSelected",e),e.options.focusOnSelect&&this._callHook("nodeSetFocus",e,!0);else{if(t=!(n=!1),i.folder)switch(e.options.clickFolderMode){case 2:t=!(n=!0);break;case 3:n=t=!0}t&&(this.nodeSetFocus(e),this._callHook("nodeSetActive",e,!0)),n&&this._callHook("nodeToggleExpanded",e)}},nodeCollapseSiblings:function(e,t){var n,r,i,o=e.node;if(o.parent)for(r=0,i=(n=o.parent.children).length;r<i;r++)n[r]!==o&&n[r].expanded&&this._callHook("nodeSetExpanded",n[r],!1,t)},nodeDblclick:function(e){"title"===e.targetType&&4===e.options.clickFolderMode&&this._callHook("nodeToggleExpanded",e),"title"===e.targetType&&e.originalEvent.preventDefault()},nodeKeydown:function(e){var t=e.originalEvent,n=e.node,r=e.tree,i=e.options,o=t.which,a=t.key||String.fromCharCode(o),s=!!(t.altKey||t.ctrlKey||t.metaKey),l=!g[o]&&!u[o]&&!s,o=C(t.target),d=!0,c=!(t.ctrlKey||!i.autoActivate);if(n||(s=this.getActiveNode()||this.getFirstChild())&&(s.setFocus(),(n=e.node=this.focusNode).debug("Keydown force focus on active node")),i.quicksearch&&l&&!o.is(":input:enabled"))return 500<(o=Date.now())-r.lastQuicksearchTime&&(r.lastQuicksearchTerm=""),r.lastQuicksearchTime=o,r.lastQuicksearchTerm+=a,(a=r.findNextNode(r.lastQuicksearchTerm,r.getActiveNode()))&&a.setActive(),void t.preventDefault();switch(h.eventToString(t)){case"+":case"=":r.nodeSetExpanded(e,!0);break;case"-":r.nodeSetExpanded(e,!1);break;case"space":n.isPagingNode()?r._triggerNodeEvent("clickPaging",e,t):h.evalOption("checkbox",n,n,i,!1)?r.nodeToggleSelected(e):r.nodeSetActive(e,!0);break;case"return":r.nodeSetActive(e,!0);break;case"home":case"end":case"backspace":case"left":case"right":case"up":case"down":n.navigate(t.which,c);break;default:d=!1}d&&t.preventDefault()},nodeLoadChildren:function(o,a){var t,n,s,e=null,r=!0,l=o.tree,d=o.node,c=d.parent,i="nodeLoadChildren",u=Date.now();return C.isFunction(a)&&(a=a.call(l,{type:"source"},o),k(!C.isFunction(a),"source callback must not return another function")),C.isFunction(a.then)?e=a:a.url?e=(t=C.extend({},o.options.ajax,a)).debugDelay?(n=t.debugDelay,delete t.debugDelay,C.isArray(n)&&(n=n[0]+Math.random()*(n[1]-n[0])),d.warn("nodeLoadChildren waiting debugDelay "+Math.round(n)+" ms ..."),C.Deferred(function(e){setTimeout(function(){C.ajax(t).done(function(){e.resolveWith(this,arguments)}).fail(function(){e.rejectWith(this,arguments)})},n)})):C.ajax(t):C.isPlainObject(a)||C.isArray(a)?r=!(e={then:function(e,t){e(a,null,null)}}):C.error("Invalid source type: "+a),d._requestId&&(d.warn("Recursive load request #"+u+" while #"+d._requestId+" is pending."),d._requestId=u),r&&(l.debugTime(i),l.nodeSetStatus(o,"loading")),s=new C.Deferred,e.then(function(e,t,n){var r,i;if("json"!==a.dataType&&"jsonp"!==a.dataType||"string"!=typeof e||C.error("Ajax request returned a string (did you get the JSON dataType wrong?)."),d._requestId&&d._requestId>u)s.rejectWith(this,[f]);else if(null!==d.parent||null===c){if(o.options.postProcess){try{(i=l._triggerNodeEvent("postProcess",o,o.originalEvent,{response:e,error:null,dataType:a.dataType})).error&&l.warn("postProcess returned error:",i)}catch(e){i={error:e,message:""+e,details:"postProcess failed"}}if(i.error)return r=C.isPlainObject(i.error)?i.error:{message:i.error},r=l._makeHookContext(d,null,r),void s.rejectWith(this,[r]);(C.isArray(i)||C.isPlainObject(i)&&C.isArray(i.children))&&(e=i)}else e&&e.hasOwnProperty("d")&&o.options.enableAspx&&(42===o.options.enableAspx&&l.warn("The default for enableAspx will change to `false` in the fututure. Pass `enableAspx: true` or implement postProcess to silence this warning."),e="string"==typeof e.d?C.parseJSON(e.d):e.d);s.resolveWith(this,[e])}else s.rejectWith(this,[p])},function(e,t,n){n=l._makeHookContext(d,null,{error:e,args:Array.prototype.slice.call(arguments),message:n,details:e.status+": "+n});s.rejectWith(this,[n])}),s.done(function(e){var t,n,r;l.nodeSetStatus(o,"ok"),C.isPlainObject(e)?(k(d.isRootNode(),"source may only be an object for root nodes (expecting an array of child objects otherwise)"),k(C.isArray(e.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),t=(n=e).children,delete n.children,C.each(m,function(e,t){void 0!==n[t]&&(l[t]=n[t],delete n[t])}),C.extend(l.data,n)):t=e,k(C.isArray(t),"expected array of children"),d._setChildren(t),l.options.nodata&&0===t.length&&(C.isFunction(l.options.nodata)?r=l.options.nodata.call(l,{type:"nodata"},o):!0===l.options.nodata&&d.isRootNode()?r=l.options.strings.noData:"string"==typeof l.options.nodata&&d.isRootNode()&&(r=l.options.nodata),r&&d.setStatus("nodata",r)),l._triggerNodeEvent("loadChildren",d)}).fail(function(e){var t;e!==f?e!==p?(e.node&&e.error&&e.message?t=e:"[object Object]"===(t=l._makeHookContext(d,null,{error:e,args:Array.prototype.slice.call(arguments),message:e?e.message||e.toString():""})).message&&(t.message=""),d.warn("Load children failed ("+t.message+")",t),!1!==l._triggerNodeEvent("loadError",t,null)&&l.nodeSetStatus(o,"error",t.message,t.details)):d.warn("Lazy parent node was removed while loading: discarding response."):d.warn("Ignored response for obsolete load request #"+u+" (expected #"+d._requestId+")")}).always(function(){d._requestId=null,r&&l.debugTimeEnd(i)}),s.promise()},nodeLoadKeyPath:function(e,t){},nodeRemoveChild:function(e,t){var n=e.node,r=C.extend({},e,{node:t}),i=n.children;if(1===i.length)return k(t===i[0],"invalid single child"),this.nodeRemoveChildren(e);this.activeNode&&(t===this.activeNode||this.activeNode.isDescendantOf(t))&&this.activeNode.setActive(!1),this.focusNode&&(t===this.focusNode||this.focusNode.isDescendantOf(t))&&(this.focusNode=null),this.nodeRemoveMarkup(r),this.nodeRemoveChildren(r),k(0<=(r=C.inArray(t,i)),"invalid child"),n.triggerModifyChild("remove",t),t.visit(function(e){e.parent=null},!0),this._callHook("treeRegisterNode",this,!1,t),i.splice(r,1)},nodeRemoveChildMarkup:function(e){e=e.node;e.ul&&(e.isRootNode()?C(e.ul).empty():(C(e.ul).remove(),e.ul=null),e.visit(function(e){e.li=e.ul=null}))},nodeRemoveChildren:function(e){var t=e.tree,n=e.node;n.children&&(this.activeNode&&this.activeNode.isDescendantOf(n)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(n)&&(this.focusNode=null),this.nodeRemoveChildMarkup(e),n.triggerModifyChild("remove",null),n.visit(function(e){e.parent=null,t._callHook("treeRegisterNode",t,!1,e)}),n.lazy?n.children=[]:n.children=null,n.isRootNode()||(n.expanded=!1),this.nodeRenderStatus(e))},nodeRemoveMarkup:function(e){var t=e.node;t.li&&(C(t.li).remove(),t.li=null),this.nodeRemoveChildMarkup(e)},nodeRender:function(e,t,n,r,i){var o,a,s,l,d,c,u,h=e.node,f=e.tree,p=e.options,g=p.aria,y=!1,v=h.parent,m=!v,b=h.children,x=null;if(!1!==f._enableUpdate&&(m||v.ul)){if(k(m||v.ul,"parent UL must exist"),m||(h.li&&(t||h.li.parentNode!==h.parent.ul)&&(h.li.parentNode===h.parent.ul?x=h.li.nextSibling:this.debug("Unlinking "+h+" (must be child of "+h.parent+")"),this.nodeRemoveMarkup(e)),h.li?this.nodeRenderStatus(e):(y=!0,h.li=document.createElement("li"),(h.li.ftnode=h).key&&p.generateIds&&(h.li.id=p.idPrefix+h.key),h.span=document.createElement("span"),h.span.className="fancytree-node",g&&!h.tr&&C(h.li).attr("role","treeitem"),h.li.appendChild(h.span),this.nodeRenderTitle(e),p.createNode&&p.createNode.call(f,{type:"createNode"},e)),p.renderNode&&p.renderNode.call(f,{type:"renderNode"},e)),b){if(m||h.expanded||!0===n){for(h.ul||(h.ul=document.createElement("ul"),(!0!==r||i)&&h.expanded||(h.ul.style.display="none"),g&&C(h.ul).attr("role","group"),h.li?h.li.appendChild(h.ul):h.tree.$div.append(h.ul)),l=0,d=b.length;l<d;l++)u=C.extend({},e,{node:b[l]}),this.nodeRender(u,t,n,!1,!0);for(o=h.ul.firstChild;o;)o=(s=o.ftnode)&&s.parent!==h?(h.debug("_fixParent: remove missing "+s,o),c=o.nextSibling,o.parentNode.removeChild(o),c):o.nextSibling;for(o=h.ul.firstChild,l=0,d=b.length-1;l<d;l++)(a=b[l])===(s=o.ftnode)?o=o.nextSibling:h.ul.insertBefore(a.li,s.li)}}else h.ul&&(this.warn("remove child markup for "+h),this.nodeRemoveChildMarkup(e));m||y&&v.ul.insertBefore(h.li,x)}},nodeRenderTitle:function(e,t){var n,r,i=e.node,o=e.tree,a=e.options,s=a.aria,l=i.getLevel(),d=[];void 0!==t&&(i.title=t),i.span&&!1!==o._enableUpdate&&(t=s&&!1!==i.hasChildren()?" role='button'":"",l<a.minExpandLevel?(i.lazy||(i.expanded=!0),1<l&&d.push("<span "+t+" class='fancytree-expander fancytree-expander-fixed'></span>")):d.push("<span "+t+" class='fancytree-expander'></span>"),(l=h.evalOption("checkbox",i,i,a,!1))&&!i.isStatusNode()&&(n="fancytree-checkbox",("radio"===l||i.parent&&i.parent.radiogroup)&&(n+=" fancytree-radio"),d.push("<span "+(t=s?" role='checkbox'":"")+" class='"+n+"'></span>")),void 0!==i.data.iconClass&&(i.icon?C.error("'iconClass' node option is deprecated since v2.14.0: use 'icon' only instead"):(i.warn("'iconClass' node option is deprecated since v2.14.0: use 'icon' instead"),i.icon=i.data.iconClass)),!1!==(n=h.evalOption("icon",i,i,a,!0))&&(t=s?" role='presentation'":"",r=(r=h.evalOption("iconTooltip",i,i,a,null))?" title='"+A(r)+"'":"","string"==typeof n?c.test(n)?(n="/"===n.charAt(0)?n:(a.imagePath||"")+n,d.push("<img src='"+n+"' class='fancytree-icon'"+r+" alt='' />")):d.push("<span "+t+" class='fancytree-custom-icon "+n+"'"+r+"></span>"):n.text?d.push("<span "+t+" class='fancytree-custom-icon "+(n.addClass||"")+"'"+r+">"+h.escapeHtml(n.text)+"</span>"):n.html?d.push("<span "+t+" class='fancytree-custom-icon "+(n.addClass||"")+"'"+r+">"+n.html+"</span>"):d.push("<span "+t+" class='fancytree-icon'"+r+"></span>")),t="",t=(t=a.renderTitle?a.renderTitle.call(o,{type:"renderTitle"},e)||"":t)||"<span class='fancytree-title'"+(r=(r=!0===(r=h.evalOption("tooltip",i,i,a,null))?i.title:r)?" title='"+A(r)+"'":"")+(a.titlesTabbable?" tabindex='0'":"")+">"+(a.escapeTitles?h.escapeHtml(i.title):i.title)+"</span>",d.push(t),i.span.innerHTML=d.join(""),this.nodeRenderStatus(e),a.enhanceTitle&&(e.$title=C(">span.fancytree-title",i.span),a.enhanceTitle.call(o,{type:"enhanceTitle"},e)))},nodeRenderStatus:function(e){var t,n=e.node,r=e.tree,i=e.options,o=n.hasChildren(),a=n.isLastSibling(),s=i.aria,l=i._classNames,d=[],e=n[r.statusClassPropName];e&&!1!==r._enableUpdate&&(s&&(t=C(n.tr||n.li)),d.push(l.node),r.activeNode===n&&d.push(l.active),r.focusNode===n&&d.push(l.focused),n.expanded&&d.push(l.expanded),s&&(!1===o?t.removeAttr("aria-expanded"):t.attr("aria-expanded",Boolean(n.expanded))),n.folder&&d.push(l.folder),!1!==o&&d.push(l.hasChildren),a&&d.push(l.lastsib),n.lazy&&null==n.children&&d.push(l.lazy),n.partload&&d.push(l.partload),n.partsel&&d.push(l.partsel),h.evalOption("unselectable",n,n,i,!1)&&d.push(l.unselectable),n._isLoading&&d.push(l.loading),n._error&&d.push(l.error),n.statusNodeType&&d.push(l.statusNodePrefix+n.statusNodeType),n.selected?(d.push(l.selected),s&&t.attr("aria-selected",!0)):s&&t.attr("aria-selected",!1),n.extraClasses&&d.push(n.extraClasses),!1===o?d.push(l.combinedExpanderPrefix+"n"+(a?"l":"")):d.push(l.combinedExpanderPrefix+(n.expanded?"e":"c")+(n.lazy&&null==n.children?"d":"")+(a?"l":"")),d.push(l.combinedIconPrefix+(n.expanded?"e":"c")+(n.folder?"f":"")),e.className=d.join(" "),n.li&&C(n.li).toggleClass(l.lastsib,a))},nodeSetActive:function(e,t,n){var r=e.node,i=e.tree,o=e.options,a=!0===(n=n||{}).noEvents,s=!0===n.noFocus,n=!1!==n.scrollIntoView;return r===i.activeNode===(t=!1!==t)?_(r):(n&&e.originalEvent&&C(e.originalEvent.target).is("a,:checkbox")&&(r.info("Not scrolling while clicking an embedded link."),n=!1),t&&!a&&!1===this._triggerNodeEvent("beforeActivate",r,e.originalEvent)?N(r,["rejected"]):(t?(i.activeNode&&(k(i.activeNode!==r,"node was active (inconsistency)"),t=C.extend({},e,{node:i.activeNode}),i.nodeSetActive(t,!1),k(null===i.activeNode,"deactivate was out of sync?")),o.activeVisible&&r.makeVisible({scrollIntoView:n}),i.activeNode=r,i.nodeRenderStatus(e),s||i.nodeSetFocus(e),a||i._triggerNodeEvent("activate",r,e.originalEvent)):(k(i.activeNode===r,"node was not active (inconsistency)"),i.activeNode=null,this.nodeRenderStatus(e),a||e.tree._triggerNodeEvent("deactivate",r,e.originalEvent)),_(r)))},nodeSetExpanded:function(r,i,e){var t,n,o,a,s,l,d=r.node,c=r.tree,u=r.options,h=!0===(e=e||{}).noAnimation,f=!0===e.noEvents;if(i=!1!==i,C(d.li).hasClass(u._classNames.animating))return d.warn("setExpanded("+i+") while animating: ignored."),N(d,["recursion"]);if(d.expanded&&i||!d.expanded&&!i)return _(d);if(i&&!d.lazy&&!d.hasChildren())return _(d);if(!i&&d.getLevel()<u.minExpandLevel)return N(d,["locked"]);if(!f&&!1===this._triggerNodeEvent("beforeExpand",d,r.originalEvent))return N(d,["rejected"]);if(h||d.isVisible()||(h=e.noAnimation=!0),n=new C.Deferred,i&&!d.expanded&&u.autoCollapse){s=d.getParentList(!1,!0),l=u.autoCollapse;try{for(u.autoCollapse=!1,o=0,a=s.length;o<a;o++)this._callHook("nodeCollapseSiblings",s[o],e)}finally{u.autoCollapse=l}}return n.done(function(){var e=d.getLastChild();i&&u.autoScroll&&!h&&e&&c._enableUpdate?e.scrollIntoView(!0,{topNode:d}).always(function(){f||r.tree._triggerNodeEvent(i?"expand":"collapse",r)}):f||r.tree._triggerNodeEvent(i?"expand":"collapse",r)}),t=function(e){var t=u._classNames,n=u.toggleEffect;if(d.expanded=i,c._callHook("treeStructureChanged",r,i?"expand":"collapse"),c._callHook("nodeRender",r,!1,!1,!0),d.ul)if("none"!==d.ul.style.display==!!d.expanded)d.warn("nodeSetExpanded: UL.style.display already set");else{if(n&&!h)return C(d.li).addClass(t.animating),void(C.isFunction(C(d.ul)[n.effect])?C(d.ul)[n.effect]({duration:n.duration,always:function(){C(this).removeClass(t.animating),C(d.li).removeClass(t.animating),e()}}):(C(d.ul).stop(!0,!0),C(d.ul).parent().find(".ui-effects-placeholder").remove(),C(d.ul).toggle(n.effect,n.options,n.duration,function(){C(this).removeClass(t.animating),C(d.li).removeClass(t.animating),e()})));d.ul.style.display=d.expanded||!parent?"":"none"}e()},i&&d.lazy&&void 0===d.hasChildren()?d.load().done(function(){n.notifyWith&&n.notifyWith(d,["loaded"]),t(function(){n.resolveWith(d)})}).fail(function(e){t(function(){n.rejectWith(d,["load failed ("+e+")"])})}):t(function(){n.resolveWith(d)}),n.promise()},nodeSetFocus:function(e,t){var n,r=e.tree,i=e.node,o=r.options,a=!!e.originalEvent&&C(e.originalEvent.target).is(":input");if(t=!1!==t,r.focusNode){if(r.focusNode===i&&t)return;n=C.extend({},e,{node:r.focusNode}),r.focusNode=null,this._triggerNodeEvent("blur",n),this._callHook("nodeRenderStatus",n)}t&&(this.hasFocus()||(i.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",e,!0,{calledByNode:!0})),i.makeVisible({scrollIntoView:!1}),r.focusNode=i,o.titlesTabbable&&(a||C(i.span).find(".fancytree-title").focus()),o.aria&&C(r.$container).attr("aria-activedescendant",C(i.tr||i.li).uniqueId().attr("id")),this._triggerNodeEvent("focus",e),document.activeElement===r.$container.get(0)||1<=C(document.activeElement,r.$container).length||C(r.$container).focus(),o.autoScroll&&i.scrollIntoView(),this._callHook("nodeRenderStatus",e))},nodeSetSelected:function(e,t,n){var r=e.node,i=e.tree,o=e.options,a=!0===(n=n||{}).noEvents,s=r.parent;if(t=!1!==t,!h.evalOption("unselectable",r,r,o,!1))return r._lastSelectIntent=t,!!r.selected!==t||3===o.selectMode&&r.partsel&&!t?a||!1!==this._triggerNodeEvent("beforeSelect",r,e.originalEvent)?(t&&1===o.selectMode?(i.lastSelectedNode&&i.lastSelectedNode.setSelected(!1),r.selected=t):3!==o.selectMode||!s||s.radiogroup||r.radiogroup?s&&s.radiogroup?r.visitSiblings(function(e){e._changeSelectStatusAttrs(t&&e===r)},!0):r.selected=t:(r.selected=t,r.fixSelection3AfterClick(n)),this.nodeRenderStatus(e),i.lastSelectedNode=t?r:null,void(a||i._triggerNodeEvent("select",e))):!!r.selected:t},nodeSetStatus:function(r,e,t,n){var i=r.node,o=r.tree;function a(e,t){var n=i.children?i.children[0]:null;return n&&n.isStatusNode()?(C.extend(n,e),n.statusNodeType=t,o._callHook("nodeRenderTitle",n)):(i._setChildren([e]),o._callHook("treeStructureChanged",r,"setStatusNode"),i.children[0].statusNodeType=t,o.render()),i.children[0]}switch(e){case"ok":!function(){var e=i.children?i.children[0]:null;if(e&&e.isStatusNode()){try{i.ul&&(i.ul.removeChild(e.li),e.li=null)}catch(e){}1===i.children.length?i.children=[]:i.children.shift(),o._callHook("treeStructureChanged",r,"clearStatusNode")}}(),i._isLoading=!1,i._error=null,i.renderStatus();break;case"loading":i.parent||a({title:o.options.strings.loading+(t?" ("+t+")":""),checkbox:!1,tooltip:n},e),i._isLoading=!0,i._error=null,i.renderStatus();break;case"error":a({title:o.options.strings.loadError+(t?" ("+t+")":""),checkbox:!1,tooltip:n},e),i._isLoading=!1,i._error={message:t,details:n},i.renderStatus();break;case"nodata":a({title:t||o.options.strings.noData,checkbox:!1,tooltip:n},e),i._isLoading=!1,i._error=null,i.renderStatus();break;default:C.error("invalid node status "+e)}},nodeToggleExpanded:function(e){return this.nodeSetExpanded(e,!e.node.expanded)},nodeToggleSelected:function(e){var t=e.node,n=!t.selected;return t.partsel&&!t.selected&&!0===t._lastSelectIntent&&(t.selected=!(n=!1)),t._lastSelectIntent=n,this.nodeSetSelected(e,n)},treeClear:function(e){var t=e.tree;t.activeNode=null,t.focusNode=null,t.$div.find(">ul.fancytree-container").empty(),t.rootNode.children=null,t._callHook("treeStructureChanged",e,"clear")},treeCreate:function(e){},treeDestroy:function(e){this.$div.find(">ul.fancytree-container").remove(),this.$source&&this.$source.removeClass("fancytree-helper-hidden")},treeInit:function(e){var n=e.tree,r=n.options;n.$container.attr("tabindex",r.tabindex),C.each(m,function(e,t){void 0!==r[t]&&(n.info("Move option "+t+" to tree"),n[t]=r[t],delete r[t])}),r.checkboxAutoHide&&n.$container.addClass("fancytree-checkbox-auto-hide"),r.rtl?n.$container.attr("DIR","RTL").addClass("fancytree-rtl"):n.$container.removeAttr("DIR").removeClass("fancytree-rtl"),r.aria&&(n.$container.attr("role","tree"),1!==r.selectMode&&n.$container.attr("aria-multiselectable",!0)),this.treeLoad(e)},treeLoad:function(e,t){var n,r,i,o=e.tree,a=e.widget.element,s=C.extend({},e,{node:this.rootNode});if(o.rootNode.children&&this.treeClear(e),t=t||this.options.source)"string"==typeof t&&C.error("Not implemented");else switch(r=a.data("type")||"html"){case"html":(i=a.find(">ul").not(".fancytree-container").first()).length?(i.addClass("ui-fancytree-source fancytree-helper-hidden"),t=C.ui.fancytree.parseHtml(i),this.data=C.extend(this.data,E(i))):(h.warn("No `source` option was passed and container does not contain `<ul>`: assuming `source: []`."),t=[]);break;case"json":t=C.parseJSON(a.text()),a.contents().filter(function(){return 3===this.nodeType}).remove(),C.isPlainObject(t)&&(k(C.isArray(t.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),t=(n=t).children,delete n.children,C.each(m,function(e,t){void 0!==n[t]&&(o[t]=n[t],delete n[t])}),C.extend(o.data,n));break;default:C.error("Invalid data-type: "+r)}return o._triggerTreeEvent("preInit",null),this.nodeLoadChildren(s,t).done(function(){o._callHook("treeStructureChanged",e,"loadChildren"),o.render(),3===e.options.selectMode&&o.rootNode.fixSelection3FromEndNodes(),o.activeNode&&o.options.activeVisible&&o.activeNode.makeVisible(),o._triggerTreeEvent("init",null,{status:!0})}).fail(function(){o.render(),o._triggerTreeEvent("init",null,{status:!1})})},treeRegisterNode:function(e,t,n){e.tree._callHook("treeStructureChanged",e,t?"addNode":"removeNode")},treeSetFocus:function(e,t,n){var r;(t=!1!==t)!==this.hasFocus()&&(!(this._hasFocus=t)&&this.focusNode?this.focusNode.setFocus(!1):!t||n&&n.calledByNode||C(this.$container).focus(),this.$container.toggleClass("fancytree-treefocus",t),this._triggerTreeEvent(t?"focusTree":"blurTree"),t&&!this.activeNode&&(r=this._lastMousedownNode||this.getFirstChild())&&r.setFocus())},treeSetOption:function(e,t,n){var r=e.tree,i=!0,o=!1,a=!1;switch(t){case"aria":case"checkbox":case"icon":case"minExpandLevel":case"tabindex":a=o=!0;break;case"checkboxAutoHide":r.$container.toggleClass("fancytree-checkbox-auto-hide",!!n);break;case"escapeTitles":case"tooltip":a=!0;break;case"rtl":!1===n?r.$container.removeAttr("DIR").removeClass("fancytree-rtl"):r.$container.attr("DIR","RTL").addClass("fancytree-rtl"),a=!0;break;case"source":i=!1,r._callHook("treeLoad",r,n),a=!0}r.debug("set option "+t+"="+n+" <"+typeof n+">"),i&&(this.widget._super||C.Widget.prototype._setOption).call(this.widget,t,n),o&&r._callHook("treeCreate",r),a&&r.render(!0,!1)},treeStructureChanged:function(e,t){}}),C.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!0,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,copyFunctionsToData:!1,debugLevel:null,disabled:!1,enableAspx:42,escapeTitles:!1,extensions:[],focusOnSelect:!1,generateIds:!1,icon:!0,idPrefix:"ft_",keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,nodata:!0,quicksearch:!1,rtl:!1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading...",loadError:"Load error!",moreData:"More...",noData:"No data."},tabindex:"0",titlesTabbable:!1,toggleEffect:{effect:"slideToggle",duration:200},tooltip:!1,treeId:null,_classNames:{active:"fancytree-active",animating:"fancytree-animating",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",error:"fancytree-error",expanded:"fancytree-expanded",focused:"fancytree-focused",folder:"fancytree-folder",hasChildren:"fancytree-has-children",lastsib:"fancytree-lastsib",lazy:"fancytree-lazy",loading:"fancytree-loading",node:"fancytree-node",partload:"fancytree-partload",partsel:"fancytree-partsel",radio:"fancytree-radio",selected:"fancytree-selected",statusNodePrefix:"fancytree-statusnode-",unselectable:"fancytree-unselectable"},lazyLoad:null,postProcess:null},_deprecationWarning:function(e){var t=this.tree;t&&3<=t.options.debugLevel&&t.warn("$().fancytree('"+e+"') is deprecated (see https://wwwendt.de/tech/fancytree/doc/jsdoc/Fancytree_Widget.html")},_create:function(){this.tree=new O(this),this.$source=this.source||"json"===this.element.data("type")?this.element:this.element.find(">ul").first();for(var e,t,n=this.options,r=n.extensions,i=(this.tree,0);i<r.length;i++)t=r[i],(e=C.ui.fancytree._extensions[t])||C.error("Could not apply extension '"+t+"' (it is not registered, did you forget to include it?)"),this.tree.options[t]=function e(t){var n,r,i,o,a=t||{},s=1,l=arguments.length;if("object"==typeof a||C.isFunction(a)||(a={}),s===l)throw Error("need at least two args");for(;s<l;s++)if(null!=(n=arguments[s]))for(r in n)n.hasOwnProperty(r)&&(o=a[r],a!==(i=n[r])&&(i&&C.isPlainObject(i)?(o=o&&C.isPlainObject(o)?o:{},a[r]=e(o,i)):void 0!==i&&(a[r]=i)));return a}({},e.options,this.tree.options[t]),k(void 0===this.tree.ext[t],"Extension name must not exist as Fancytree.ext attribute: '"+t+"'"),this.tree.ext[t]={},function(e,t,n){for(var r in t)"function"==typeof t[r]?"function"==typeof e[r]?e[r]=w(r,e,0,t,n):"_"===r.charAt(0)?e.ext[n][r]=w(r,e,0,t,n):C.error("Could not override tree."+r+". Use prefix '_' to create tree."+n+"._"+r):"options"!==r&&(e.ext[n][r]=t[r])}(this.tree,e,t),0;void 0!==n.icons&&(!0===n.icon?(this.tree.warn("'icons' tree option is deprecated since v2.14.0: use 'icon' instead"),n.icon=n.icons):C.error("'icons' tree option is deprecated since v2.14.0: use 'icon' only instead")),void 0!==n.iconClass&&(n.icon?C.error("'iconClass' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'iconClass' tree option is deprecated since v2.14.0: use 'icon' instead"),n.icon=n.iconClass)),void 0!==n.tabbable&&(n.tabindex=n.tabbable?"0":"-1",this.tree.warn("'tabbable' tree option is deprecated since v2.17.0: use 'tabindex='"+n.tabindex+"' instead")),this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree),this._bind()},_setOption:function(e,t){return this.tree._callHook("treeSetOption",this.tree,e,t)},_destroy:function(){this._unbind(),this.tree._callHook("treeDestroy",this.tree)},_unbind:function(){var e=this.tree._ns;this.element.off(e),this.tree.$container.off(e),C(document).off(e)},_bind:function(){var a=this,s=this.options,o=this.tree,e=o._ns;this._unbind(),o.$container.on("focusin"+e+" focusout"+e,function(e){var t=h.getNode(e),n="focusin"===e.type;if(!n&&t&&C(e.target).is("a"))t.debug("Ignored focusout on embedded <a> element.");else{if(n){if(o._getExpiringValue("focusin"))return void o.debug("Ignored double focusin.");o._setExpiringValue("focusin",!0,50),t||(t=o._getExpiringValue("mouseDownNode"))&&o.debug("Reconstruct mouse target for focusin from recent event.")}t?o._callHook("nodeSetFocus",o._makeHookContext(t,e),n):o.tbody&&C(e.target).parents("table.fancytree-container > thead").length?o.debug("Ignore focus event outside table body.",e):o._callHook("treeSetFocus",o,n)}}).on("selectstart"+e,"span.fancytree-title",function(e){e.preventDefault()}).on("keydown"+e,function(e){if(s.disabled||!1===s.keyboard)return!0;var t,n=o.focusNode,r=o._makeHookContext(n||o,e),i=o.phase;try{return o.phase="userEvent","preventNav"===(t=n?o._triggerNodeEvent("keydown",n,e):o._triggerTreeEvent("keydown",e))?t=!0:!1!==t&&(t=o._callHook("nodeKeydown",r)),t}finally{o.phase=i}}).on("mousedown"+e,function(e){e=h.getEventTarget(e);o._lastMousedownNode=e?e.node:null,o._setExpiringValue("mouseDownNode",o._lastMousedownNode)}).on("click"+e+" dblclick"+e,function(e){if(s.disabled)return!0;var t,n=h.getEventTarget(e),r=n.node,i=a.tree,o=i.phase;if(!r)return!0;t=i._makeHookContext(r,e);try{switch(i.phase="userEvent",e.type){case"click":return t.targetType=n.type,r.isPagingNode()?!0===i._triggerNodeEvent("clickPaging",t,e):!1!==i._triggerNodeEvent("click",t,e)&&i._callHook("nodeClick",t);case"dblclick":return t.targetType=n.type,!1!==i._triggerNodeEvent("dblclick",t,e)&&i._callHook("nodeDblclick",t)}}finally{i.phase=o}})},getActiveNode:function(){return this._deprecationWarning("getActiveNode"),this.tree.activeNode},getNodeByKey:function(e){return this._deprecationWarning("getNodeByKey"),this.tree.getNodeByKey(e)},getRootNode:function(){return this._deprecationWarning("getRootNode"),this.tree.rootNode},getTree:function(){return this._deprecationWarning("getTree"),this.tree}}),h=C.ui.fancytree,C.extend(C.ui.fancytree,{version:"2.38.0",buildType:"production",debugLevel:3,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:O,_FancytreeNodeClass:D,jquerySupports:{positionMyOfs:function(e){for(var t,n,r=C.map(C.trim(e).split("."),function(e){return parseInt(e,10)}),i=C.map(Array.prototype.slice.call(arguments,1),function(e){return parseInt(e,10)}),o=0;o<i.length;o++)if((t=r[o]||0)!==(n=i[o]||0))return n<t;return!0}(C.ui.version,1,9)},assert:k,createTree:function(e,t){t=C(e).fancytree(t);return h.getTree(t)},debounce:function(t,n,r,i){var o;return 3===arguments.length&&"boolean"!=typeof r&&(i=r,r=!1),function(){var e=arguments;i=i||this,r&&!o&&n.apply(i,e),clearTimeout(o),o=setTimeout(function(){r||n.apply(i,e),o=null},t)}},debug:function(e){4<=C.ui.fancytree.debugLevel&&d("log",arguments)},error:function(e){1<=C.ui.fancytree.debugLevel&&d("error",arguments)},escapeHtml:function(e){return(""+e).replace(t,function(e){return r[e]})},fixPositionOptions:function(e){var t,n,r,i;return(e.offset||0<=(""+e.my+e.at).indexOf("%"))&&C.error("expected new position syntax (but '%' is not supported)"),C.ui.fancytree.jquerySupports.positionMyOfs||(t=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(e.my),n=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(e.at),r=(t[2]?+t[2]:0)+(n[2]?+n[2]:0),i=(t[4]?+t[4]:0)+(n[4]?+n[4]:0),e=C.extend({},e,{my:t[1]+" "+t[3],at:n[1]+" "+n[3]}),(r||i)&&(e.offset=r+" "+i)),e},getEventTarget:function(e){var t=e&&e.target?e.target.className:"",n={node:this.getNode(e.target),type:void 0};return/\bfancytree-title\b/.test(t)?n.type="title":/\bfancytree-expander\b/.test(t)?n.type=!1===n.node.hasChildren()?"prefix":"expander":/\bfancytree-checkbox\b/.test(t)?n.type="checkbox":/\bfancytree(-custom)?-icon\b/.test(t)?n.type="icon":/\bfancytree-node\b/.test(t)?n.type="title":e&&e.target&&((e=C(e.target)).is("ul[role=group]")?((n.node&&n.node.tree||h).debug("Ignoring click on outer UL."),n.node=null):e.closest(".fancytree-title").length?n.type="title":e.closest(".fancytree-checkbox").length?n.type="checkbox":e.closest(".fancytree-expander").length&&(n.type="expander")),n},getEventTargetType:function(e){return this.getEventTarget(e).type},getNode:function(e){if(e instanceof D)return e;for(e instanceof C?e=e[0]:void 0!==e.originalEvent&&(e=e.target);e;){if(e.ftnode)return e.ftnode;e=e.parentNode}return null},getTree:function(e){var t=e;return e instanceof O?e:("number"==typeof(e=void 0===e?0:e)?e=C(".fancytree-container").eq(e):"string"==typeof e?(e=C("#ft-id-"+t).eq(0)).length||(e=C(t).eq(0)):e instanceof Element||e instanceof HTMLDocument?e=C(e):e instanceof C?e=e.eq(0):void 0!==e.originalEvent&&(e=C(e.target)),(e=(e=e.closest(":ui-fancytree")).data("ui-fancytree")||e.data("fancytree"))?e.tree:null)},evalOption:function(e,t,n,r,i){var o,a=t.tree,r=r[e],n=n[e];return C.isFunction(r)?(o={node:t,tree:a,widget:a.widget,options:a.widget.options,typeInfo:a.types[t.type]||{}},null==(o=r.call(a,{type:e},o))&&(o=n)):o=null==n?r:n,o=null==o?i:o},setSpanIcon:function(e,t,n){var r=C(e);"string"==typeof n?r.attr("class",t+" "+n):(n.text?r.text(""+n.text):n.html&&(e.innerHTML=n.html),r.attr("class",t+" "+(n.addClass||"")))},eventToString:function(e){var t=e.which,n=e.type,r=[];return e.altKey&&r.push("alt"),e.ctrlKey&&r.push("ctrl"),e.metaKey&&r.push("meta"),e.shiftKey&&r.push("shift"),"click"===n||"dblclick"===n?r.push(o[e.button]+n):"wheel"===n?r.push(n):i[t]||r.push(u[t]||String.fromCharCode(t).toLowerCase()),r.join("+")},info:function(e){3<=C.ui.fancytree.debugLevel&&d("info",arguments)},keyEventToString:function(e){return this.warn("keyEventToString() is deprecated: use eventToString()"),this.eventToString(e)},overrideMethod:function(e,t,n,r){var i,o=e[t]||C.noop;e[t]=function(){var e=r||this;try{return i=e._super,e._super=o,n.apply(e,arguments)}finally{e._super=i}}},parseHtml:function(a){var s,l,d,c,u,h,f,p,e=a.find(">li"),g=[];return e.each(function(){var e,t,n=C(this),r=n.find(">span",this).first(),i=r.length?null:n.find(">a").first(),o={tooltip:null,data:{}};for(r.length?o.title=r.html():i&&i.length?(o.title=i.html(),o.data.href=i.attr("href"),o.data.target=i.attr("target"),o.tooltip=i.attr("title")):(o.title=n.html(),0<=(u=o.title.search(/<ul/i))&&(o.title=o.title.substring(0,u))),o.title=C.trim(o.title),c=0,h=y.length;c<h;c++)o[y[c]]=void 0;for(s=this.className.split(" "),d=[],c=0,h=s.length;c<h;c++)l=s[c],v[l]?o[l]=!0:d.push(l);if(o.extraClasses=d.join(" "),(f=n.attr("title"))&&(o.tooltip=f),(f=n.attr("id"))&&(o.key=f),n.attr("hideCheckbox")&&(o.checkbox=!1),(e=E(n))&&!C.isEmptyObject(e)){for(t in x)e.hasOwnProperty(t)&&(e[x[t]]=e[t],delete e[t]);for(c=0,h=b.length;c<h;c++)f=b[c],null!=(p=e[f])&&(delete e[f],o[f]=p);C.extend(o.data,e)}(a=n.find(">ul").first()).length?o.children=C.ui.fancytree.parseHtml(a):o.children=o.lazy?void 0:null,g.push(o)}),g},registerExtension:function(e){k(null!=e.name,"extensions must have a `name` property."),k(null!=e.version,"extensions must have a `version` property."),C.ui.fancytree._extensions[e.name]=e},unescapeHtml:function(e){var t=document.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue},warn:function(e){2<=C.ui.fancytree.debugLevel&&d("warn",arguments)}}),C.ui.fancytree}function k(e,t){e||(C.ui.fancytree.error(t="Fancytree assertion failed"+(t=t?": "+t:"")),C.error(t))}function d(t,n){var r,i,t=window.console?window.console[t]:null;if(t)try{t.apply(window.console,n)}catch(e){for(i="",r=0;r<n.length;r++)i+=n[r];t(i)}}function w(e,r,t,n,i){var o,a,s;function l(){return o.apply(r,arguments)}function d(e){return o.apply(r,e)}return o=r[e],a=n[e],s=r.ext[i],function(){var e=r._local,t=r._super,n=r._superApply;try{return r._local=s,r._super=l,r._superApply=d,a.apply(r,arguments)}finally{r._local=e,r._super=t,r._superApply=n}}}function _(e,t){return(void 0===e?C.Deferred(function(){this.resolve()}):C.Deferred(function(){this.resolveWith(e,t)})).promise()}function N(e,t){return(void 0===e?C.Deferred(function(){this.reject()}):C.Deferred(function(){this.rejectWith(e,t)})).promise()}function S(e,t){return function(){e.resolveWith(t)}}function E(e){var t=C.extend({},e.data()),e=t.json;return delete t.fancytree,delete t.uiFancytree,e&&(delete t.json,t=C.extend(t,e)),t}function A(e){return(""+e).replace(n,function(e){return r[e]})}function T(t){return t=t.toLowerCase(),function(e){return 0<=e.title.toLowerCase().indexOf(t)}}function D(e,t){var n,r,i;for(this.parent=e,this.tree=e.tree,this.ul=null,this.li=null,this.statusNodeType=null,this._isLoading=!1,this._error=null,this.data={},n=0,r=b.length;n<r;n++)this[i=b[n]]=t[i];for(i in null==this.unselectableIgnore&&null==this.unselectableStatus||(this.unselectable=!0),t.hideCheckbox&&C.error("'hideCheckbox' node option was removed in v2.23.0: use 'checkbox: false'"),t.data&&C.extend(this.data,t.data),t)a[i]||!this.tree.options.copyFunctionsToData&&C.isFunction(t[i])||s[i]||(this.data[i]=t[i]);null==this.key?this.tree.options.defaultKey?(this.key=""+this.tree.options.defaultKey(this),k(this.key,"defaultKey() must return a unique key")):this.key="_"+h._nextNodeKey++:this.key=""+this.key,t.active&&(k(null===this.tree.activeNode,"only one active node allowed"),this.tree.activeNode=this),t.selected&&(this.tree.lastSelectedNode=this),(e=t.children)?e.length?this._setChildren(e):this.children=this.lazy?[]:null:this.children=null,this.tree._callHook("treeRegisterNode",this.tree,!0,this)}function O(e){this.widget=e,this.$div=e.element,this.options=e.options,this.options&&(void 0!==this.options.lazyload&&C.error("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead."),void 0!==this.options.loaderror&&C.error("The 'loaderror' event was renamed since 2014-07-03. Use 'loadError' (with uppercase E) instead."),void 0!==this.options.fx&&C.error("The 'fx' option was replaced by 'toggleEffect' since 2014-11-30."),void 0!==this.options.removeNode&&C.error("The 'removeNode' event was replaced by 'modifyChild' since 2.20 (2016-09-10).")),this.ext={},this.types={},this.columns={},this.data=E(this.$div),this._id=""+(this.options.treeId||C.ui.fancytree._nextId++),this._ns=".fancytree-"+this._id,this.activeNode=null,this.focusNode=null,this._hasFocus=null,this._tempCache={},this._lastMousedownNode=null,this._enableUpdate=!0,this.lastSelectedNode=null,this.systemFocusElement=null,this.lastQuicksearchTerm="",this.lastQuicksearchTime=0,this.viewport=null,this.statusClassPropName="span",this.ariaPropName="li",this.nodeContainerAttrName="li",this.$div.find(">ul.fancytree-container").remove(),this.rootNode=new D({tree:this},{title:"root",key:"root_"+this._id,children:null,expanded:!0}),this.rootNode.parent=null,e=C("<ul>",{id:"ft-id-"+this._id,class:"ui-fancytree fancytree-container fancytree-plain"}).appendTo(this.$div),this.$container=e,this.rootNode.ul=e[0],null==this.options.debugLevel&&(this.options.debugLevel=h.debugLevel)}C.ui.fancytree.warn("Fancytree: ignored duplicate include")},"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree.ui-deps"],t):"object"==typeof module&&module.exports?(require("./jquery.fancytree.ui-deps"),module.exports=t(require("jquery"))):t(jQuery),t=function(o){"use strict";return o.ui.fancytree._FancytreeClass.prototype.countSelected=function(e){this.options;return this.getSelectedNodes(e).length},o.ui.fancytree._FancytreeNodeClass.prototype.updateCounters=function(){var e=this,t=o("span.fancytree-childcounter",e.span),n=e.tree.options.childcounter,r=e.countChildren(n.deep);!(e.data.childCounter=r)&&n.hideZeros||e.isExpanded()&&n.hideExpanded?t.remove():(t=!t.length?o("<span class='fancytree-childcounter'/>").appendTo(o("span.fancytree-icon,span.fancytree-custom-icon",e.span)):t).text(r),!n.deep||e.isTopLevel()||e.isRootNode()||e.parent.updateCounters()},o.ui.fancytree.prototype.widgetMethod1=function(e){this.tree;return e},o.ui.fancytree.registerExtension({name:"childcounter",version:"2.38.0",options:{deep:!0,hideZeros:!0,hideExpanded:!1},foo:42,_appendCounter:function(e){},treeInit:function(e){e.options,e.options.childcounter;this._superApply(arguments),this.$container.addClass("fancytree-ext-childcounter")},treeDestroy:function(e){this._superApply(arguments)},nodeRenderTitle:function(e,t){var n=e.node,r=e.options.childcounter,i=null==n.data.childCounter?n.countChildren(r.deep):+n.data.childCounter;this._super(e,t),!i&&r.hideZeros||n.isExpanded()&&r.hideExpanded||o("span.fancytree-icon,span.fancytree-custom-icon",n.span).append(o("<span class='fancytree-childcounter'/>").text(i))},nodeSetExpanded:function(e,t,n){var r=e.tree;e.node;return this._superApply(arguments).always(function(){r.nodeRenderTitle(e)})}}),o.ui.fancytree},"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],t):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=t(require("jquery"))):t(jQuery),t=function(c){"use strict";var u=c.ui.fancytree.assert;function n(e,t,n){for(var r,i,o=3&e.length,a=e.length-o,s=n,l=3432918353,d=461845907,c=0;c<a;)i=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,s=27492+(65535&(r=5*(65535&(s=(s^=i=(65535&(i=(i=(65535&i)*l+(((i>>>16)*l&65535)<<16)&4294967295)<<15|i>>>17))*d+(((i>>>16)*d&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(r>>>16)&65535)<<16);switch(i=0,o){case 3:i^=(255&e.charCodeAt(c+2))<<16;case 2:i^=(255&e.charCodeAt(c+1))<<8;case 1:s^=i=(65535&(i=(i=(65535&(i^=255&e.charCodeAt(c)))*l+(((i>>>16)*l&65535)<<16)&4294967295)<<15|i>>>17))*d+(((i>>>16)*d&65535)<<16)&4294967295}return s^=e.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,s^=s>>>16,t?("0000000"+(s>>>0).toString(16)).substr(-8):s>>>0}return c.ui.fancytree._FancytreeNodeClass.prototype.getCloneList=function(e){var t,n=this.tree,r=n.refMap[this.refKey]||null,i=n.keyMap;return r&&(t=this.key,e?r=c.map(r,function(e){return i[e]}):(r=c.map(r,function(e){return e===t?null:i[e]})).length<1&&(r=null)),r},c.ui.fancytree._FancytreeNodeClass.prototype.isClone=function(){var e=this.refKey||null,e=e&&this.tree.refMap[e]||null;return!!(e&&1<e.length)},c.ui.fancytree._FancytreeNodeClass.prototype.reRegister=function(t,e){t=null==t?null:""+t,e=null==e?null:""+e;var n=this.tree,r=this.key,i=this.refKey,o=n.keyMap,a=n.refMap,s=a[i]||null,n=!1;return null!=t&&t!==this.key&&(o[t]&&c.error("[ext-clones] reRegister("+t+"): already exists: "+this),delete o[r],o[t]=this,s&&(a[i]=c.map(s,function(e){return e===r?t:e})),this.key=t,n=!0),null!=e&&e!==this.refKey&&(s&&(1===s.length?delete a[i]:a[i]=c.map(s,function(e){return e===r?null:e})),a[e]?a[e].append(t):a[e]=[this.key],this.refKey=e,n=!0),n},c.ui.fancytree._FancytreeNodeClass.prototype.setRefKey=function(e){return this.reRegister(null,e)},c.ui.fancytree._FancytreeClass.prototype.getNodesByRef=function(e,t){var n=this.keyMap,e=this.refMap[e]||null;return e=e&&(e=t?c.map(e,function(e){e=n[e];return e.isDescendantOf(t)?e:null}):c.map(e,function(e){return n[e]})).length<1?null:e},c.ui.fancytree._FancytreeClass.prototype.changeRefKey=function(e,t){var n,r=this.keyMap,i=this.refMap[e]||null;if(i){for(n=0;n<i.length;n++)r[i[n]].refKey=t;delete this.refMap[e],this.refMap[t]=i}},c.ui.fancytree.registerExtension({name:"clones",version:"2.38.0",options:{highlightActiveClones:!0,highlightClones:!1},treeCreate:function(e){this._superApply(arguments),e.tree.refMap={},e.tree.keyMap={}},treeInit:function(e){this.$container.addClass("fancytree-ext-clones"),u(null==e.options.defaultKey),e.options.defaultKey=function(e){return t=e,"id_"+(t=n(e=(e=c.map(e.getParentList(!1,!0),function(e){return e.refKey||e.key})).join("/"),!0))+n(t+e,!0);var t},this._superApply(arguments)},treeClear:function(e){return e.tree.refMap={},e.tree.keyMap={},this._superApply(arguments)},treeRegisterNode:function(e,t,n){var r,i,o=e.tree,a=o.keyMap,s=o.refMap,l=n.key,d=n&&null!=n.refKey?""+n.refKey:null;return n.isStatusNode()||(t?(null!=a[n.key]&&(i=a[n.key],i="clones.treeRegisterNode: duplicate key '"+n.key+"': /"+n.getPath(!0)+" => "+i.getPath(!0),o.error(i),c.error(i)),a[l]=n,d&&((r=s[d])?(r.push(l),2===r.length&&e.options.clones.highlightClones&&a[r[0]].renderStatus()):s[d]=[l])):(null==a[l]&&c.error("clones.treeRegisterNode: node.key not registered: "+n.key),delete a[l],d&&(r=s[d])&&((i=r.length)<=1?(u(1===i),u(r[0]===l),delete s[d]):(function(e,t){for(var n=e.length-1;0<=n;n--)if(e[n]===t)return e.splice(n,1)}(r,l),2===i&&e.options.clones.highlightClones&&a[r[0]].renderStatus())))),this._super(e,t,n)},nodeRenderStatus:function(e){var t,n=e.node,r=this._super(e);return e.options.clones.highlightClones&&(t=c(n[e.tree.statusClassPropName])).length&&n.isClone()&&t.addClass("fancytree-clone"),r},nodeSetActive:function(e,n,t){var r=e.tree.statusClassPropName,i=e.node,o=this._superApply(arguments);return e.options.clones.highlightActiveClones&&i.isClone()&&c.each(i.getCloneList(!0),function(e,t){c(t[r]).toggleClass("fancytree-active-clone",!1!==n)}),o}}),c.ui.fancytree},"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],t):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=t(require("jquery"))):t(jQuery),t=function(f){"use strict";var s,l,p=f.ui.fancytree,o=/Mac/.test(navigator.platform),d="fancytree-drag-source",c="fancytree-drag-remove",g="fancytree-drop-accept",y="fancytree-drop-after",v="fancytree-drop-before",m="fancytree-drop-over",b="fancytree-drop-reject",x="fancytree-drop-target",u="application/x-fancytree-node",C=null,h=null,k=null,w=null,_=null,a=null,N=null,S=null,E=null,A=null;function T(){k=h=a=S=N=A=_=null,w&&w.removeClass(d+" "+c),w=null,C&&C.hide(),l&&(l.remove(),l=null)}function D(e){return 0===e?"":0<e?"+"+e:""+e}function O(e,t){var n,r=t.tree,i=t.dataTransfer;"dragstart"===e.type?(t.effectAllowed=r.options.dnd5.effectAllowed,t.dropEffect=r.options.dnd5.dropEffectDefault):(t.effectAllowed=S,t.dropEffect=N),t.dropEffectSuggested=(n=e,r=(e=r).options.dnd5.dropEffectDefault,o?n.metaKey&&n.altKey||n.ctrlKey?r="link":n.metaKey?r="move":n.altKey&&(r="copy"):n.ctrlKey?r="copy":n.shiftKey?r="move":n.altKey&&(r="link"),r!==a&&e.info("evalEffectModifiers: "+n.type+" - evalEffectModifiers(): "+a+" -> "+r),a=r),t.isMove="move"===t.dropEffect,t.files=i.files||[]}function F(e,t,n){var r=t.tree,i=t.dataTransfer;return"dragstart"!==e.type&&S!==t.effectAllowed&&r.warn("effectAllowed should only be changed in dragstart event: "+e.type+": data.effectAllowed changed from "+S+" -> "+t.effectAllowed),!1===n&&(r.info("applyDropEffectCallback: allowDrop === false"),t.effectAllowed="none",t.dropEffect="none"),t.isMove="move"===t.dropEffect,"dragstart"===e.type&&(S=t.effectAllowed,N=t.dropEffect),i.effectAllowed=S,i.dropEffect=N}function M(e,t){if(t.options.dnd5.scroll&&(h=t.tree,a=e,i=h.options.dnd5,o=h.$scrollParent[0],l=i.scrollSensitivity,u=i.scrollSpeed,r=0,o!==document&&"HTML"!==o.tagName?(i=h.$scrollParent.offset(),d=o.scrollTop,i.top+o.offsetHeight-a.pageY<l?0<o.scrollHeight-h.$scrollParent.innerHeight()-d&&(o.scrollTop=r=d+u):0<d&&a.pageY-i.top<l&&(o.scrollTop=r=d-u)):0<(d=f(document).scrollTop())&&a.pageY-d<l?(r=d-u,f(document).scrollTop(r)):f(window).height()-(a.pageY-d)<l&&(r=d+u,f(document).scrollTop(r)),r&&h.debug("autoScroll: "+r+"px")),!t.node)return t.tree.warn("Ignored dragover for non-node"),E;var n,r,i=null,o=t.tree,a=o.options,s=a.dnd5,l=t.node,d=t.otherNode,c="center",u=f(l.span),h=u.find("span.fancytree-title");if(!1===_)return o.debug("Ignored dragover, since dragenter returned false."),!1;if("string"==typeof _&&f.error("assert failed: dragenter returned string"),r=u.offset(),u=(e.pageY-r.top)/u.height(),void 0===e.pageY&&o.warn("event.pageY is undefined: see issue #1013."),_.after&&.75<u||!_.over&&_.after&&.5<u?i="after":_.before&&u<=.25||!_.over&&_.before&&u<=.5?i="before":_.over&&(i="over"),s.preventVoidMoves&&"move"===t.dropEffect&&(l===d?(l.debug("Drop over source node prevented."),i=null):"before"===i&&d&&l===d.getNextSibling()?(l.debug("Drop after source node prevented."),i=null):"after"===i&&d&&l===d.getPrevSibling()?(l.debug("Drop before source node prevented."),i=null):"over"===i&&d&&d.parent===l&&d.isLastSibling()&&(l.debug("Drop last child over own parent prevented."),i=null)),(t.hitMode=i)&&s.dragOver&&(O(e,t),s.dragOver(l,t),F(e,t,!!i),i=t.hitMode),"after"===(E=i)||"before"===i||"over"===i){switch(n=s.dropMarkerOffsetX||0,i){case"before":c="top",n+=s.dropMarkerInsertOffsetX||0;break;case"after":c="bottom",n+=s.dropMarkerInsertOffsetX||0}h={my:"left"+D(n)+" center",at:"left "+c,of:h},a.rtl&&(h.my="right"+D(-n)+" center",h.at="right "+c),C.toggleClass(y,"after"===i).toggleClass(m,"over"===i).toggleClass(v,"before"===i).show().position(p.fixPositionOptions(h))}else C.hide();return f(l.span).toggleClass(x,"after"===i||"before"===i||"over"===i).toggleClass(y,"after"===i).toggleClass(v,"before"===i).toggleClass(g,"over"===i).toggleClass(b,!1===i),i}function j(e){var t,n=this,r=n.options.dnd5,i=null,o=p.getNode(e),a=e.dataTransfer||e.originalEvent.dataTransfer,s={tree:n,node:o,options:n.options,originalEvent:e.originalEvent,widget:n.widget,hitMode:_,dataTransfer:a,otherNode:h||null,otherNodeList:k||null,otherNodeData:null,useDefaultImage:!0,dropEffect:void 0,dropEffectSuggested:void 0,effectAllowed:void 0,files:null,isCancelled:void 0,isMove:void 0};switch(e.type){case"dragenter":if(A=null,!o){n.debug("Ignore non-node "+e.type+": "+e.target.tagName+"."+e.target.className),_=!1;break}if(f(o.span).addClass(m).removeClass(g+" "+b),t=0<=f.inArray(u,a.types),r.preventNonNodes&&!t){o.debug("Reject dropping a non-node."),_=!1;break}if(r.preventForeignNodes&&(!h||h.tree!==o.tree)){o.debug("Reject dropping a foreign node."),_=!1;break}if(r.preventSameParent&&s.otherNode&&s.otherNode.tree===o.tree&&o.parent===s.otherNode.parent){o.debug("Reject dropping as sibling (same parent)."),_=!1;break}if(r.preventRecursion&&s.otherNode&&s.otherNode.tree===o.tree&&o.isDescendantOf(s.otherNode)){o.debug("Reject dropping below own ancestor."),_=!1;break}if(r.preventLazyParents&&!o.isLoaded()){o.warn("Drop over unloaded target node prevented."),_=!1;break}C.show(),O(e,s),t=r.dragEnter(o,s),t=!!(t=t)&&(t=f.isPlainObject(t)?{over:!!t.over,before:!!t.before,after:!!t.after}:f.isArray(t)?{over:0<=f.inArray("over",t),before:0<=f.inArray("before",t),after:0<=f.inArray("after",t)}:{over:!0===t||"over"===t,before:!0===t||"before"===t,after:!0===t||"after"===t},0!==Object.keys(t).length&&t),F(e,s,i=(_=t)&&(t.over||t.before||t.after));break;case"dragover":if(!o){n.debug("Ignore non-node "+e.type+": "+e.target.tagName+"."+e.target.className);break}O(e,s),i=!!(E=M(e,s)),("over"===E||!1===E)&&!o.expanded&&!1!==o.hasChildren()?A?!(r.autoExpandMS&&Date.now()-A>r.autoExpandMS)||o.isLoading()||r.dragExpand&&!1===r.dragExpand(o,s)||o.setExpanded():A=Date.now():A=null;break;case"dragleave":if(!o){n.debug("Ignore non-node "+e.type+": "+e.target.tagName+"."+e.target.className);break}if(!f(o.span).hasClass(m)){o.debug("Ignore dragleave (multi).");break}f(o.span).removeClass(m+" "+g+" "+b),o.scheduleAction("cancel"),r.dragLeave(o,s),C.hide();break;case"drop":if(0<=f.inArray(u,a.types)&&(d=a.getData(u),n.info(e.type+": getData('application/x-fancytree-node'): '"+d+"'")),d||(d=a.getData("text"),n.info(e.type+": getData('text'): '"+d+"'")),d)try{void 0!==(l=JSON.parse(d)).title&&(s.otherNodeData=l)}catch(e){}n.debug(e.type+": nodeData: '"+d+"', otherNodeData: ",s.otherNodeData),f(o.span).removeClass(m+" "+g+" "+b),s.hitMode=E,O(e,s),s.isCancelled=!E;var l=h&&h.span,d=h&&h.tree;r.dragDrop(o,s),e.preventDefault(),l&&!document.body.contains(l)&&(d===n?(n.debug("Drop handler removed source element: generating dragEnd."),r.dragEnd(h,s)):n.warn("Drop handler removed source element: dragend event may be lost.")),T()}if(i)return e.preventDefault(),!1}return f.ui.fancytree.getDragNodeList=function(){return k||[]},f.ui.fancytree.getDragNode=function(){return h},f.ui.fancytree.registerExtension({name:"dnd5",version:"2.38.0",options:{autoExpandMS:1500,dropMarkerInsertOffsetX:-16,dropMarkerOffsetX:-24,dropMarkerParent:"body",multiSource:!1,effectAllowed:"all",dropEffectDefault:"move",preventForeignNodes:!1,preventLazyParents:!0,preventNonNodes:!1,preventRecursion:!0,preventSameParent:!1,preventVoidMoves:!0,scroll:!0,scrollSensitivity:20,scrollSpeed:5,setTextTypeJson:!1,sourceCopyHook:null,dragStart:null,dragDrag:f.noop,dragEnd:f.noop,dragEnter:null,dragOver:f.noop,dragExpand:f.noop,dragDrop:f.noop,dragLeave:f.noop},treeInit:function(e){var t=e.tree,n=e.options,r=n.glyph||null,i=n.dnd5;0<=f.inArray("dnd",n.extensions)&&f.error("Extensions 'dnd' and 'dnd5' are mutually exclusive."),i.dragStop&&f.error("dragStop is not used by ext-dnd5. Use dragEnd instead."),null!=i.preventRecursiveMoves&&f.error("preventRecursiveMoves was renamed to preventRecursion."),i.dragStart&&p.overrideMethod(e.options,"createNode",function(e,t){this._super.apply(this,arguments),t.node.span?t.node.span.draggable=!0:t.node.warn("Cannot add `draggable`: no span tag")}),this._superApply(arguments),this.$container.addClass("fancytree-ext-dnd5"),e=f("<span>").appendTo(this.$container),this.$scrollParent=e.scrollParent(),e.remove(),(C=f("#fancytree-drop-marker")).length||(C=f("<div id='fancytree-drop-marker'></div>").hide().css({"z-index":1e3,"pointer-events":"none"}).prependTo(i.dropMarkerParent),r&&p.setSpanIcon(C[0],r.map._addClass,r.map.dropMarker)),C.toggleClass("fancytree-rtl",!!n.rtl),i.dragStart&&t.$container.on("dragstart drag dragend",function(e){var t=this,n=t.options.dnd5,r=p.getNode(e),i=e.dataTransfer||e.originalEvent.dataTransfer,o={tree:t,node:r,options:t.options,originalEvent:e.originalEvent,widget:t.widget,dataTransfer:i,useDefaultImage:!0,dropEffect:void 0,dropEffectSuggested:void 0,effectAllowed:void 0,files:void 0,isCancelled:void 0,isMove:void 0};switch(e.type){case"dragstart":if(!r)return t.info("Ignored dragstart on a non-node."),!1;h=r,k=!1===n.multiSource?[r]:!0===n.multiSource?r.isSelected()?t.getSelectedNodes():[r]:n.multiSource(r,o),(w=f(f.map(k,function(e){return e.span}))).addClass(d);var a=r.toDict(!0,n.sourceCopyHook);a.treeId=r.tree._id,a=JSON.stringify(a);try{i.setData(u,a),i.setData("text/html",f(r.span).html()),i.setData("text/plain",r.title)}catch(e){t.warn("Could not set data (IE only accepts 'text') - "+e)}return(n.setTextTypeJson?i.setData("text",a):i.setData("text",r.title),O(e,o),!1===n.dragStart(r,o))?(T(),!1):(F(e,o),l=null,o.useDefaultImage&&(s=f(r.span).find(".fancytree-title"),k&&1<k.length&&(l=f("<span class='fancytree-childcounter'/>").text("+"+(k.length-1)).appendTo(s)),i.setDragImage&&i.setDragImage(s[0],-10,-10)),!0);case"drag":O(e,o),n.dragDrag(r,o),F(e,o),w.toggleClass(c,o.isMove);break;case"dragend":O(e,o),T(),o.isCancelled=!E,n.dragEnd(r,o,!E)}}.bind(t)),i.dragEnter&&t.$container.on("dragenter dragover dragleave drop",j.bind(t))}}),f.ui.fancytree},"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],t):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=t(require("jquery"))):t(jQuery),t=function(d){"use strict";var t=/Mac/.test(navigator.platform),c=d.ui.fancytree.escapeHtml,s=d.ui.fancytree.unescapeHtml;return d.ui.fancytree._FancytreeNodeClass.prototype.editStart=function(){var t,n=this,e=this.tree,r=e.ext.edit,i=e.options.edit,o=d(".fancytree-title",n.span),a={node:n,tree:e,options:e.options,isNew:d(n[e.statusClassPropName]).hasClass("fancytree-edit-new"),orgTitle:n.title,input:null,dirty:!1};if(!1===i.beforeEdit.call(n,{type:"beforeEdit"},a))return!1;d.ui.fancytree.assert(!r.currentNode,"recursive edit"),r.currentNode=this,r.eventData=a,e.widget._unbind(),r.lastDraggableAttrValue=n.span.draggable,r.lastDraggableAttrValue&&(n.span.draggable=!1),d(document).on("mousedown.fancytree-edit",function(e){d(e.target).hasClass("fancytree-edit-input")||n.editEnd(!0,e)}),t=d("<input />",{class:"fancytree-edit-input",type:"text",value:e.options.escapeTitles?a.orgTitle:s(a.orgTitle)}),r.eventData.input=t,null!=i.adjustWidthOfs&&t.width(o.width()+i.adjustWidthOfs),null!=i.inputCss&&t.css(i.inputCss),o.html(t),t.focus().change(function(e){t.addClass("fancytree-edit-dirty")}).on("keydown",function(e){switch(e.which){case d.ui.keyCode.ESCAPE:n.editEnd(!1,e);break;case d.ui.keyCode.ENTER:return n.editEnd(!0,e),!1}e.stopPropagation()}).blur(function(e){return n.editEnd(!0,e)}),i.edit.call(n,{type:"edit"},a)},d.ui.fancytree._FancytreeNodeClass.prototype.editEnd=function(e,t){var n,r=this,i=this.tree,o=i.ext.edit,a=o.eventData,s=i.options.edit,l=d(".fancytree-title",r.span).find("input.fancytree-edit-input");return s.trim&&l.val(d.trim(l.val())),n=l.val(),a.dirty=n!==r.title,a.originalEvent=t,!1===e?a.save=!1:a.isNew?a.save=""!==n:a.save=a.dirty&&""!==n,!1!==s.beforeClose.call(r,{type:"beforeClose"},a)&&((!a.save||!1!==s.save.call(r,{type:"save"},a))&&(l.removeClass("fancytree-edit-dirty").off(),d(document).off(".fancytree-edit"),a.save?(r.setTitle(i.options.escapeTitles?n:c(n)),r.setFocus()):a.isNew?(r.remove(),r=a.node=null,o.relatedNode.setFocus()):(r.renderTitle(),r.setFocus()),o.eventData=null,o.currentNode=null,o.relatedNode=null,i.widget._bind(),r&&o.lastDraggableAttrValue&&(r.span.draggable=!0),i.$container.get(0).focus({preventScroll:!0}),a.input=null,s.close.call(r,{type:"close"},a),!0))},d.ui.fancytree._FancytreeNodeClass.prototype.editCreateNode=function(e,t){var n,r=this.tree,i=this;e=e||"child",null==t?t={title:""}:"string"==typeof t?t={title:t}:d.ui.fancytree.assert(d.isPlainObject(t)),"child"!==e||this.isExpanded()||!1===this.hasChildren()?((n=this.addNode(t,e)).match=!0,d(n[r.statusClassPropName]).removeClass("fancytree-hide").addClass("fancytree-match"),n.makeVisible().done(function(){d(n[r.statusClassPropName]).addClass("fancytree-edit-new"),i.tree.ext.edit.relatedNode=i,n.editStart()})):this.setExpanded().done(function(){i.editCreateNode(e,t)})},d.ui.fancytree._FancytreeClass.prototype.isEditing=function(){return this.ext.edit?this.ext.edit.currentNode:null},d.ui.fancytree._FancytreeNodeClass.prototype.isEditing=function(){return!!this.tree.ext.edit&&this.tree.ext.edit.currentNode===this},d.ui.fancytree.registerExtension({name:"edit",version:"2.38.0",options:{adjustWidthOfs:4,allowEmpty:!1,inputCss:{minWidth:"3em"},triggerStart:["f2","mac+enter","shift+click"],trim:!0,beforeClose:d.noop,beforeEdit:d.noop,close:d.noop,edit:d.noop,save:d.noop},currentNode:null,treeInit:function(e){var r=e.tree;this._superApply(arguments),this.$container.addClass("fancytree-ext-edit").on("fancytreebeforeupdateviewport",function(e,t){var n=r.isEditing();n&&(n.info("Cancel edit due to scroll event."),n.editEnd(!1,e))})},nodeClick:function(e){var t=d.ui.fancytree.eventToString(e.originalEvent),n=e.options.edit.triggerStart;return"shift+click"===t&&0<=d.inArray("shift+click",n)&&e.originalEvent.shiftKey||"click"===t&&0<=d.inArray("clickActive",n)&&e.node.isActive()&&!e.node.isEditing()&&d(e.originalEvent.target).hasClass("fancytree-title")?(e.node.editStart(),!1):this._superApply(arguments)},nodeDblclick:function(e){return 0<=d.inArray("dblclick",e.options.edit.triggerStart)?(e.node.editStart(),!1):this._superApply(arguments)},nodeKeydown:function(e){switch(e.originalEvent.which){case 113:if(0<=d.inArray("f2",e.options.edit.triggerStart))return e.node.editStart(),!1;break;case d.ui.keyCode.ENTER:if(0<=d.inArray("mac+enter",e.options.edit.triggerStart)&&t)return e.node.editStart(),!1}return this._superApply(arguments)}}),d.ui.fancytree},"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],t):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=t(require("jquery"))):t(jQuery),t=function(y){"use strict";var v="__not_found__",m=y.ui.fancytree.escapeHtml;function b(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function x(e,t,n){for(var r=[],i=1;i<t.length;i++){var o=t[i].length+(1===i?0:1)+(r[r.length-1]||0);r.push(o)}var a=e.split("");return n?r.forEach(function(e){a[e]=""+a[e]+""}):r.forEach(function(e){a[e]="<mark>"+a[e]+"</mark>"}),a.join("")}return y.ui.fancytree._FancytreeClass.prototype._applyFilterImpl=function(r,i,e){var t,o,a,s,l,d,c=0,n=this.options,u=n.escapeTitles,h=n.autoCollapse,f=y.extend({},n.filter,e),p="hide"===f.mode,g=!!f.leavesOnly&&!i;if("string"==typeof r){if(""===r)return this.warn("Fancytree passing an empty string as a filter is handled as clearFilter()."),void this.clearFilter();t=f.fuzzy?r.split("").map(b).reduce(function(e,t){return e+"([^"+t+"]*)"+t},""):b(r),o=new RegExp(t,"i"),a=new RegExp(b(r),"gi"),u&&(s=new RegExp(b(""),"g"),l=new RegExp(b(""),"g")),r=function(e){if(!e.title)return!1;var t,n=u?e.title:0<=(t=e.title).indexOf(">")?y("<div/>").html(t).text():t,t=n.match(o);return t&&f.highlight&&(u?(d=f.fuzzy?x(n,t,u):n.replace(a,function(e){return""+e+""}),e.titleWithHighlight=m(d).replace(s,"<mark>").replace(l,"</mark>")):f.fuzzy?e.titleWithHighlight=x(n,t):e.titleWithHighlight=n.replace(a,function(e){return"<mark>"+e+"</mark>"})),!!t}}return this.enableFilter=!0,this.lastFilterArgs=arguments,e=this.enableUpdate(!1),this.$div.addClass("fancytree-ext-filter"),p?this.$div.addClass("fancytree-ext-filter-hide"):this.$div.addClass("fancytree-ext-filter-dimm"),this.$div.toggleClass("fancytree-ext-filter-hide-expanders",!!f.hideExpanders),this.rootNode.subMatchCount=0,this.visit(function(e){delete e.match,delete e.titleWithHighlight,e.subMatchCount=0}),(t=this.getRootNode()._findDirectChild(v))&&t.remove(),n.autoCollapse=!1,this.visit(function(t){if(!g||null==t.children){var e=r(t),n=!1;if("skip"===e)return t.visit(function(e){e.match=!1},!0),"skip";e||!i&&"branch"!==e||!t.parent.match||(n=e=!0),e&&(c++,t.match=!0,t.visitParents(function(e){e!==t&&(e.subMatchCount+=1),!f.autoExpand||n||e.expanded||(e.setExpanded(!0,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),e._filterAutoExpanded=!0)},!0))}}),n.autoCollapse=h,0===c&&f.nodata&&p&&(t=f.nodata,!0===(t=y.isFunction(t)?t():t)?t={}:"string"==typeof t&&(t={title:t}),t=y.extend({statusNodeType:"nodata",key:v,title:this.options.strings.noData},t),this.getRootNode().addNode(t).match=!0),this._callHook("treeStructureChanged",this,"applyFilter"),this.enableUpdate(e),c},y.ui.fancytree._FancytreeClass.prototype.filterNodes=function(e,t){return"boolean"==typeof t&&(t={leavesOnly:t},this.warn("Fancytree.filterNodes() leavesOnly option is deprecated since 2.9.0 / 2015-04-19. Use opts.leavesOnly instead.")),this._applyFilterImpl(e,!1,t)},y.ui.fancytree._FancytreeClass.prototype.filterBranches=function(e,t){return this._applyFilterImpl(e,!0,t)},y.ui.fancytree._FancytreeClass.prototype.updateFilter=function(){this.enableFilter&&this.lastFilterArgs&&this.options.filter.autoApply?this._applyFilterImpl.apply(this,this.lastFilterArgs):this.warn("updateFilter(): no filter active.")},y.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){var t,e=this.getRootNode()._findDirectChild(v),n=this.options.escapeTitles,r=this.options.enhanceTitle,i=this.enableUpdate(!1);e&&e.remove(),delete this.rootNode.match,delete this.rootNode.subMatchCount,this.visit(function(e){e.match&&e.span&&(t=y(e.span).find(">span.fancytree-title"),n?t.text(e.title):t.html(e.title),r&&r({type:"enhanceTitle"},{node:e,$title:t})),delete e.match,delete e.subMatchCount,delete e.titleWithHighlight,e.$subMatchBadge&&(e.$subMatchBadge.remove(),delete e.$subMatchBadge),e._filterAutoExpanded&&e.expanded&&e.setExpanded(!1,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),delete e._filterAutoExpanded}),this.enableFilter=!1,this.lastFilterArgs=null,this.$div.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide"),this._callHook("treeStructureChanged",this,"clearFilter"),this.enableUpdate(i)},y.ui.fancytree._FancytreeClass.prototype.isFilterActive=function(){return!!this.enableFilter},y.ui.fancytree._FancytreeNodeClass.prototype.isMatched=function(){return!(this.tree.enableFilter&&!this.match)},y.ui.fancytree.registerExtension({name:"filter",version:"2.38.0",options:{autoApply:!0,autoExpand:!1,counter:!0,fuzzy:!1,hideExpandedCounter:!0,hideExpanders:!1,highlight:!0,leavesOnly:!1,nodata:!0,mode:"dimm"},nodeLoadChildren:function(e,t){var n=e.tree;return this._superApply(arguments).done(function(){n.enableFilter&&n.lastFilterArgs&&e.options.filter.autoApply&&n._applyFilterImpl.apply(n,n.lastFilterArgs)})},nodeSetExpanded:function(e,t,n){var r=e.node;return delete r._filterAutoExpanded,!t&&e.options.filter.hideExpandedCounter&&r.$subMatchBadge&&r.$subMatchBadge.show(),this._superApply(arguments)},nodeRenderStatus:function(e){var t=e.node,n=e.tree,r=e.options.filter,i=y(t.span).find("span.fancytree-title"),o=y(t[n.statusClassPropName]),a=e.options.enhanceTitle,s=e.options.escapeTitles,e=this._super(e);return o.length&&n.enableFilter&&(o.toggleClass("fancytree-match",!!t.match).toggleClass("fancytree-submatch",!!t.subMatchCount).toggleClass("fancytree-hide",!(t.match||t.subMatchCount)),!r.counter||!t.subMatchCount||t.isExpanded()&&r.hideExpandedCounter?t.$subMatchBadge&&t.$subMatchBadge.hide():(t.$subMatchBadge||(t.$subMatchBadge=y("<span class='fancytree-childcounter'/>"),y("span.fancytree-icon, span.fancytree-custom-icon",t.span).append(t.$subMatchBadge)),t.$subMatchBadge.show().text(t.subMatchCount)),!t.span||t.isEditing&&t.isEditing.call(t)||(t.titleWithHighlight?i.html(t.titleWithHighlight):s?i.text(t.title):i.html(t.title),a&&a({type:"enhanceTitle"},{node:t,$title:i}))),e}}),y.ui.fancytree},"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],t):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=t(require("jquery"))):t(jQuery),t=function(l){"use strict";var s=l.ui.fancytree,n={awesome3:{_addClass:"",checkbox:"icon-check-empty",checkboxSelected:"icon-check",checkboxUnknown:"icon-check icon-muted",dragHelper:"icon-caret-right",dropMarker:"icon-caret-right",error:"icon-exclamation-sign",expanderClosed:"icon-caret-right",expanderLazy:"icon-angle-right",expanderOpen:"icon-caret-down",loading:"icon-refresh icon-spin",nodata:"icon-meh",noExpander:"",radio:"icon-circle-blank",radioSelected:"icon-circle",doc:"icon-file-alt",docOpen:"icon-file-alt",folder:"icon-folder-close-alt",folderOpen:"icon-folder-open-alt"},awesome4:{_addClass:"fa",checkbox:"fa-square-o",checkboxSelected:"fa-check-square-o",checkboxUnknown:"fa-square fancytree-helper-indeterminate-cb",dragHelper:"fa-arrow-right",dropMarker:"fa-long-arrow-right",error:"fa-warning",expanderClosed:"fa-caret-right",expanderLazy:"fa-angle-right",expanderOpen:"fa-caret-down",loading:{html:"<span class='fa fa-spinner fa-pulse' />"},nodata:"fa-meh-o",noExpander:"",radio:"fa-circle-thin",radioSelected:"fa-circle",doc:"fa-file-o",docOpen:"fa-file-o",folder:"fa-folder-o",folderOpen:"fa-folder-open-o"},awesome5:{_addClass:"",checkbox:"far fa-square",checkboxSelected:"far fa-check-square",checkboxUnknown:"fas fa-square fancytree-helper-indeterminate-cb",radio:"far fa-circle",radioSelected:"fas fa-circle",radioUnknown:"far fa-dot-circle",dragHelper:"fas fa-arrow-right",dropMarker:"fas fa-long-arrow-alt-right",error:"fas fa-exclamation-triangle",expanderClosed:"fas fa-caret-right",expanderLazy:"fas fa-angle-right",expanderOpen:"fas fa-caret-down",loading:"fas fa-spinner fa-pulse",nodata:"far fa-meh",noExpander:"",doc:"far fa-file",docOpen:"far fa-file",folder:"far fa-folder",folderOpen:"far fa-folder-open"},bootstrap3:{_addClass:"glyphicon",checkbox:"glyphicon-unchecked",checkboxSelected:"glyphicon-check",checkboxUnknown:"glyphicon-expand fancytree-helper-indeterminate-cb",dragHelper:"glyphicon-play",dropMarker:"glyphicon-arrow-right",error:"glyphicon-warning-sign",expanderClosed:"glyphicon-menu-right",expanderLazy:"glyphicon-menu-right",expanderOpen:"glyphicon-menu-down",loading:"glyphicon-refresh fancytree-helper-spin",nodata:"glyphicon-info-sign",noExpander:"",radio:"glyphicon-remove-circle",radioSelected:"glyphicon-ok-circle",doc:"glyphicon-file",docOpen:"glyphicon-file",folder:"glyphicon-folder-close",folderOpen:"glyphicon-folder-open"},material:{_addClass:"material-icons",checkbox:{text:"check_box_outline_blank"},checkboxSelected:{text:"check_box"},checkboxUnknown:{text:"indeterminate_check_box"},dragHelper:{text:"play_arrow"},dropMarker:{text:"arrow-forward"},error:{text:"warning"},expanderClosed:{text:"chevron_right"},expanderLazy:{text:"last_page"},expanderOpen:{text:"expand_more"},loading:{text:"autorenew",addClass:"fancytree-helper-spin"},nodata:{text:"info"},noExpander:{text:""},radio:{text:"radio_button_unchecked"},radioSelected:{text:"radio_button_checked"},doc:{text:"insert_drive_file"},docOpen:{text:"insert_drive_file"},folder:{text:"folder"},folderOpen:{text:"folder_open"}}};function d(e,t,n,r,i){var o=r.map,a=o[i],s=l(t),r=s.find(".fancytree-childcounter"),o=n+" "+(o._addClass||"");"string"==typeof(a=l.isFunction(a)?a.call(this,e,t,i):a)?(t.innerHTML="",s.attr("class",o+" "+a).append(r)):a&&(a.text?t.textContent=""+a.text:a.html?t.innerHTML=a.html:t.innerHTML="",s.attr("class",o+" "+(a.addClass||"")).append(r))}return l.ui.fancytree.registerExtension({name:"glyph",version:"2.38.0",options:{preset:null,map:{}},treeInit:function(e){var t=e.tree,e=e.options.glyph;e.preset?(s.assert(!!n[e.preset],"Invalid value for `options.glyph.preset`: "+e.preset),e.map=l.extend({},n[e.preset],e.map)):t.warn("ext-glyph: missing `preset` option."),this._superApply(arguments),t.$container.addClass("fancytree-ext-glyph")},nodeRenderStatus:function(e){var t,n,r=e.node,i=l(r.span),o=e.options.glyph,a=this._super(e);return r.isRootNode()||((n=i.children(".fancytree-expander").get(0))&&(t=r.expanded&&r.hasChildren()?"expanderOpen":r.isUndefined()?"expanderLazy":r.hasChildren()?"expanderClosed":"noExpander",d(r,n,"fancytree-expander",o,t)),(n=(r.tr?l("td",r.tr).find(".fancytree-checkbox"):i.children(".fancytree-checkbox")).get(0))&&(e=s.evalOption("checkbox",r,r,o,!1),r.parent&&r.parent.radiogroup||"radio"===e?d(r,n,"fancytree-checkbox fancytree-radio",o,t=r.selected?"radioSelected":"radio"):d(r,n,"fancytree-checkbox",o,t=r.selected?"checkboxSelected":r.partsel?"checkboxUnknown":"checkbox")),(n=i.children(".fancytree-icon").get(0))&&(t=r.statusNodeType||(r.folder?r.expanded&&r.hasChildren()?"folderOpen":"folder":r.expanded?"docOpen":"doc"),d(r,n,"fancytree-icon",o,t))),a},nodeSetStatus:function(e,t,n,r){var i,o=e.options.glyph,a=e.node,e=this._superApply(arguments);return"error"!==t&&"loading"!==t&&"nodata"!==t||(a.parent?(i=l(".fancytree-expander",a.span).get(0))&&d(a,i,"fancytree-expander",o,t):(i=l(".fancytree-statusnode-"+t,a[this.nodeContainerAttrName]).find(".fancytree-icon").get(0))&&d(a,i,"fancytree-icon",o,t)),e}}),l.ui.fancytree},"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],t):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=t(require("jquery"))):t(jQuery),t=function(c){"use strict";var u=c.ui.keyCode,o={text:[u.UP,u.DOWN],checkbox:[u.UP,u.DOWN,u.LEFT,u.RIGHT],link:[u.UP,u.DOWN,u.LEFT,u.RIGHT],radiobutton:[u.UP,u.DOWN,u.LEFT,u.RIGHT],"select-one":[u.LEFT,u.RIGHT],"select-multiple":[u.LEFT,u.RIGHT]};function a(e,t){var n,r,i,o,a,s,l=e.closest("td"),d=null;switch(t){case u.LEFT:d=l.prev();break;case u.RIGHT:d=l.next();break;case u.UP:case u.DOWN:for(n=l.parent(),i=n,a=l.get(0),s=0,i.children().each(function(){return this!==a&&(o=c(this).prop("colspan"),void(s+=o||1))}),r=s;(n=t===u.UP?n.prev():n.next()).length&&(n.is(":hidden")||!(d=function(e,t){var n,r=null,i=0;return e.children().each(function(){return t<=i?(r=c(this),!1):(n=c(this).prop("colspan"),void(i+=n||1))}),r}(n,r))||!d.find(":input,a").length););}return d}return c.ui.fancytree.registerExtension({name:"gridnav",version:"2.38.0",options:{autofocusInput:!1,handleCursorKeys:!0},treeInit:function(n){this._requireExtension("table",!0,!0),this._superApply(arguments),this.$container.addClass("fancytree-ext-gridnav"),this.$container.on("focusin",function(e){var t=c.ui.fancytree.getNode(e.target);t&&!t.isActive()&&(e=n.tree._makeHookContext(t,e),n.tree._callHook("nodeSetActive",e,!0))})},nodeSetActive:function(e,t,n){var r=e.options.gridnav,i=e.node,o=e.originalEvent||{},o=c(o.target).is(":input");t=!1!==t,this._superApply(arguments),t&&(e.options.titlesTabbable?(o||(c(i.span).find("span.fancytree-title").focus(),i.setFocus()),e.tree.$container.attr("tabindex","-1")):r.autofocusInput&&!o&&c(i.tr||i.span).find(":input:enabled").first().focus())},nodeKeydown:function(e){var t,n,r=e.options.gridnav,i=e.originalEvent,e=c(i.target);return e.is(":input:enabled")?t=e.prop("type"):e.is("a")&&(t="link"),t&&r.handleCursorKeys?!((t=o[t])&&0<=c.inArray(i.which,t)&&(n=a(e,i.which))&&n.length)||(n.find(":input:enabled,a").focus(),!1):this._superApply(arguments)}}),c.ui.fancytree},"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree","./jquery.fancytree.table"],t):"object"==typeof module&&module.exports?(require("./jquery.fancytree.table"),module.exports=t(require("jquery"))):t(jQuery),t=function(a){"use strict";return a.ui.fancytree.registerExtension({name:"multi",version:"2.38.0",options:{allowNoSelect:!1,mode:"sameParent"},treeInit:function(e){this._superApply(arguments),this.$container.addClass("fancytree-ext-multi"),1===e.options.selectMode&&a.error("Fancytree ext-multi: selectMode: 1 (single) is not compatible.")},nodeClick:function(e){var t=e.tree,n=e.node,r=t.getActiveNode()||t.getFirstChild(),i="checkbox"===e.targetType,o="expander"===e.targetType;switch(a.ui.fancytree.eventToString(e.originalEvent)){case"click":if(o)break;i||(t.selectAll(!1),n.setSelected());break;case"shift+click":t.visitRows(function(e){if(e.setSelected(),e===n)return!1},{start:r,reverse:r.isBelowOf(n)});break;case"ctrl+click":case"meta+click":return void n.toggleSelected()}return this._superApply(arguments)},nodeKeydown:function(e){var t=e.tree,n=e.node,r=e.originalEvent;switch(a.ui.fancytree.eventToString(r)){case"up":case"down":t.selectAll(!1),n.navigate(r.which,!0),t.getActiveNode().setSelected();break;case"shift+up":case"shift+down":n.navigate(r.which,!0),t.getActiveNode().setSelected()}return this._superApply(arguments)}}),a.ui.fancytree},"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],t):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=t(require("jquery"))):t(jQuery),t=function(p){"use strict";var t=null,n=null,r=null,i=p.ui.fancytree.assert,u="active",g="expanded",h="focus",f="selected";try{i(window.localStorage&&window.localStorage.getItem),n={get:function(e){return window.localStorage.getItem(e)},set:function(e,t){window.localStorage.setItem(e,t)},remove:function(e){window.localStorage.removeItem(e)}}}catch(e){p.ui.fancytree.warn("Could not access window.localStorage",e)}try{i(window.sessionStorage&&window.sessionStorage.getItem),r={get:function(e){return window.sessionStorage.getItem(e)},set:function(e,t){window.sessionStorage.setItem(e,t)},remove:function(e){window.sessionStorage.removeItem(e)}}}catch(e){p.ui.fancytree.warn("Could not access window.sessionStorage",e)}return"function"==typeof Cookies?t={get:Cookies.get,set:function(e,t){Cookies.set(e,t,this.options.persist.cookie)},remove:Cookies.remove}:p&&"function"==typeof p.cookie&&(t={get:p.cookie,set:function(e,t){p.cookie.set(e,t,this.options.persist.cookie)},remove:p.removeCookie}),p.ui.fancytree._FancytreeClass.prototype.clearPersistData=function(e){var t=this.ext.persist,n=t.cookiePrefix;0<=(e=e||"active expanded focus selected").indexOf(u)&&t._data(n+u,null),0<=e.indexOf(g)&&t._data(n+g,null),0<=e.indexOf(h)&&t._data(n+h,null),0<=e.indexOf(f)&&t._data(n+f,null)},p.ui.fancytree._FancytreeClass.prototype.clearCookies=function(e){return this.warn("'tree.clearCookies()' is deprecated since v2.27.0: use 'clearPersistData()' instead."),this.clearPersistData(e)},p.ui.fancytree._FancytreeClass.prototype.getPersistData=function(){var e=this.ext.persist,t=e.cookiePrefix,n=e.cookieDelimiter,r={};return r[u]=e._data(t+u),r[g]=(e._data(t+g)||"").split(n),r[f]=(e._data(t+f)||"").split(n),r[h]=e._data(t+h),r},p.ui.fancytree.registerExtension({name:"persist",version:"2.38.0",options:{cookieDelimiter:"~",cookiePrefix:void 0,cookie:{raw:!1,expires:"",path:"",domain:"",secure:!1},expandLazy:!1,expandOpts:void 0,fireActivate:!0,overrideSource:!0,store:"auto",types:"active expanded focus selected"},_data:function(e,t){var n=this._local.store;if(void 0===t)return n.get.call(this,e);null===t?n.remove.call(this,e):n.set.call(this,e,t)},_appendKey:function(e,t,n){t=""+t;var r=this._local,i=this.options.persist.cookieDelimiter,o=r.cookiePrefix+e,a=r._data(o),e=a?a.split(i):[],a=p.inArray(t,e);0<=a&&e.splice(a,1),n&&e.push(t),r._data(o,e.join(i))},treeInit:function(e){var s=e.tree,l=e.options,d=this._local,c=this.options.persist;return d.cookiePrefix=c.cookiePrefix||"fancytree-"+s._id+"-",d.storeActive=0<=c.types.indexOf(u),d.storeExpanded=0<=c.types.indexOf(g),d.storeSelected=0<=c.types.indexOf(f),d.storeFocus=0<=c.types.indexOf(h),d.store=null,"auto"===c.store&&(c.store=n?"local":"cookie"),p.isPlainObject(c.store)?d.store=c.store:"cookie"===c.store?d.store=t:"local"!==c.store&&"session"!==c.store||(d.store="local"===c.store?n:r),i(d.store,"Need a valid store."),s.$div.on("fancytreeinit",function(e){var t,n,r,i,o,a;!1!==s._triggerTreeEvent("beforeRestore",null,{})&&(r=d._data(d.cookiePrefix+h),i=!1===c.fireActivate,o=d._data(d.cookiePrefix+g),a=o&&o.split(c.cookieDelimiter),(d.storeExpanded?function e(t,n,r,i,o){var a,s,l,d,c=!1,u=t.options.persist.expandOpts,h=[],f=[];for(r=r||[],o=o||p.Deferred(),a=0,l=r.length;a<l;a++)s=r[a],(d=t.getNodeByKey(s))?i&&d.isUndefined()?(c=!0,t.debug("_loadLazyNodes: "+d+" is lazy: loading..."),"expand"===i?h.push(d.setExpanded(!0,u)):h.push(d.load())):(t.debug("_loadLazyNodes: "+d+" already loaded."),d.setExpanded(!0,u)):(f.push(s),t.debug("_loadLazyNodes: "+d+" was not yet found."));return p.when.apply(p,h).always(function(){if(c&&0<f.length)e(t,n,f,i,o);else{if(f.length)for(t.warn("_loadLazyNodes: could not load those keys: ",f),a=0,l=f.length;a<l;a++)s=r[a],n._appendKey(g,r[a],!1);o.resolve()}}),o}(s,d,a,!!c.expandLazy&&"expand",null):(new p.Deferred).resolve()).done(function(){if(d.storeSelected){if(o=d._data(d.cookiePrefix+f))for(a=o.split(c.cookieDelimiter),t=0;t<a.length;t++)(n=s.getNodeByKey(a[t]))?(void 0===n.selected||c.overrideSource&&!1===n.selected)&&(n.selected=!0,n.renderStatus()):d._appendKey(f,a[t],!1);3===s.options.selectMode&&s.visit(function(e){if(e.selected)return e.fixSelection3AfterClick(),"skip"})}d.storeActive&&(!(o=d._data(d.cookiePrefix+u))||!l.persist.overrideSource&&s.activeNode||(n=s.getNodeByKey(o))&&(n.debug("persist: set active",o),n.setActive(!0,{noFocus:!0,noEvents:i}))),d.storeFocus&&r&&(n=s.getNodeByKey(r))&&(s.options.titlesTabbable?p(n.span).find(".fancytree-title"):p(s.$container)).focus(),s._triggerTreeEvent("restore",null,{})}))}),this._superApply(arguments)},nodeSetActive:function(e,t,n){var r=this._local;return t=!1!==t,t=this._superApply(arguments),r.storeActive&&r._data(r.cookiePrefix+u,this.activeNode?this.activeNode.key:null),t},nodeSetExpanded:function(e,t,n){var r=e.node,i=this._local;return t=!1!==t,e=this._superApply(arguments),i.storeExpanded&&i._appendKey(g,r.key,t),e},nodeSetFocus:function(e,t){var n=this._local;return t=!1!==t,t=this._superApply(arguments),n.storeFocus&&n._data(n.cookiePrefix+h,this.focusNode?this.focusNode.key:null),t},nodeSetSelected:function(e,t,n){var r=e.tree,i=e.node,o=this._local;return t=!1!==t,t=this._superApply(arguments),o.storeSelected&&(3===r.options.selectMode?(r=(r=p.map(r.getSelectedNodes(!0),function(e){return e.key})).join(e.options.persist.cookieDelimiter),o._data(o.cookiePrefix+f,r)):o._appendKey(f,i.key,i.selected)),t}}),p.ui.fancytree},"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],t):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=t(require("jquery"))):t(jQuery),t=function(b){"use strict";var x=b.ui.fancytree.assert;function C(e,n){e.visit(function(e){var t=e.tr;if(t&&(t.style.display=e.hide||!n?"none":""),!e.expanded)return"skip"})}return b.ui.fancytree.registerExtension({name:"table",version:"2.38.0",options:{checkboxColumnIdx:null,indentation:16,mergeStatusColumns:!0,nodeColumnIdx:0},treeInit:function(e){var t,n,r,i=e.tree,o=e.options,a=o.table,s=i.widget.element;if(null!=a.customStatus&&(null==o.renderStatusColumns?(i.warn("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' instead."),o.renderStatusColumns=a.customStatus):b.error("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' only instead.")),o.renderStatusColumns&&!0===o.renderStatusColumns&&(o.renderStatusColumns=o.renderColumns),s.addClass("fancytree-container fancytree-ext-table"),(r=s.find(">tbody")).length||(s.find(">tr").length&&b.error("Expected table > tbody > tr. If you see this please open an issue."),r=b("<tbody>").appendTo(s)),i.tbody=r[0],i.columnCount=b("thead >tr",s).last().find(">th",s).length,(n=r.children("tr").first()).length)e=n.children("td").length,i.columnCount&&e!==i.columnCount&&(i.warn("Column count mismatch between thead ("+i.columnCount+") and tbody ("+e+"): using tbody."),i.columnCount=e),n=n.clone();else for(x(1<=i.columnCount,"Need either <thead> or <tbody> with <td> elements to determine column count."),n=b("<tr />"),t=0;t<i.columnCount;t++)n.append("<td />");n.find(">td").eq(a.nodeColumnIdx).html("<span class='fancytree-node' />"),o.aria&&(n.attr("role","row"),n.find("td").attr("role","gridcell")),i.rowFragment=document.createDocumentFragment(),i.rowFragment.appendChild(n.get(0)),r.empty(),i.statusClassPropName="tr",i.ariaPropName="tr",this.nodeContainerAttrName="tr",i.$container=s,this._superApply(arguments),b(i.rootNode.ul).remove(),i.rootNode.ul=null,this.$container.attr("tabindex",o.tabindex),o.aria&&i.$container.attr("role","treegrid").attr("aria-readonly",!0)},nodeRemoveChildMarkup:function(e){e.node.visit(function(e){e.tr&&(b(e.tr).remove(),e.tr=null)})},nodeRemoveMarkup:function(e){var t=e.node;t.tr&&(b(t.tr).remove(),t.tr=null),this.nodeRemoveChildMarkup(e)},nodeRender:function(e,t,n,r,i){var o,a,s,l,d,c,u,h,f,p,g=e.tree,y=e.node,v=e.options,m=!y.parent;if(!1!==g._enableUpdate){if(i||(e.hasCollapsedParents=y.parent&&!y.parent.expanded),!m)if(y.tr&&t&&this.nodeRemoveMarkup(e),y.tr)t?this.nodeRenderTitle(e):this.nodeRenderStatus(e);else{if(e.hasCollapsedParents&&!n)return;d=g.rowFragment.firstChild.cloneNode(!0),h=function(e){var t,n,r=e.parent,i=r?r.children:null;if(i&&1<i.length&&i[0]!==e)for(n=i[b.inArray(e,i)-1],x(n.tr);n.children&&n.children.length&&(t=n.children[n.children.length-1]).tr;)n=t;else n=r;return n}(y),x(h),(!0===r&&i||n&&e.hasCollapsedParents)&&(d.style.display="none"),h.tr?(f=h.tr,p=d,f.parentNode.insertBefore(p,f.nextSibling)):(x(!h.parent,"prev. row must have a tr, or be system root"),f=g.tbody,h=d,f.insertBefore(h,f.firstChild)),y.tr=d,y.key&&v.generateIds&&(y.tr.id=v.idPrefix+y.key),(y.tr.ftnode=y).span=b("span.fancytree-node",y.tr).get(0),this.nodeRenderTitle(e),v.createNode&&v.createNode.call(g,{type:"createNode"},e)}if(v.renderNode&&v.renderNode.call(g,{type:"renderNode"},e),(o=y.children)&&(m||n||y.expanded))for(s=0,l=o.length;s<l;s++)(u=b.extend({},e,{node:o[s]})).hasCollapsedParents=u.hasCollapsedParents||!y.expanded,this.nodeRender(u,t,n,r,!0);o&&!i&&(c=y.tr||null,a=g.tbody.firstChild,y.visit(function(e){var t;e.tr&&(e.parent.expanded||"none"===e.tr.style.display||(e.tr.style.display="none",C(e,!1)),e.tr.previousSibling!==c&&(y.debug("_fixOrder: mismatch at node: "+e),t=c?c.nextSibling:a,g.tbody.insertBefore(e.tr,t)),c=e.tr)}))}},nodeRenderTitle:function(e,t){var n=e.tree,r=e.node,i=e.options,o=r.isStatusNode(),a=this._super(e,t);return r.isRootNode()||(i.checkbox&&!o&&null!=i.table.checkboxColumnIdx&&(t=b("span.fancytree-checkbox",r.span),b(r.tr).find("td").eq(+i.table.checkboxColumnIdx).html(t)),this.nodeRenderStatus(e),o?i.renderStatusColumns?i.renderStatusColumns.call(n,{type:"renderStatusColumns"},e):i.table.mergeStatusColumns&&r.isTopLevel()&&b(r.tr).find(">td").eq(0).prop("colspan",n.columnCount).text(r.title).addClass("fancytree-status-merged").nextAll().remove():i.renderColumns&&i.renderColumns.call(n,{type:"renderColumns"},e)),a},nodeRenderStatus:function(e){var t=e.node,n=e.options;this._super(e),b(t.tr).removeClass("fancytree-node"),e=(t.getLevel()-1)*n.table.indentation,n.rtl?b(t.span).css({paddingRight:e+"px"}):b(t.span).css({paddingLeft:e+"px"})},nodeSetExpanded:function(t,n,r){if(n=!1!==n,t.node.expanded&&n||!t.node.expanded&&!n)return this._superApply(arguments);var i=new b.Deferred,e=b.extend({},r,{noEvents:!0,noAnimation:!0});function o(e){C(t.node,n),e?n&&t.options.autoScroll&&!r.noAnimation&&t.node.hasChildren()?t.node.getLastChild().scrollIntoView(!0,{topNode:t.node}).always(function(){r.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),i.resolveWith(t.node)}):(r.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),i.resolveWith(t.node)):(r.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),i.rejectWith(t.node))}return r=r||{},this._super(t,n,e).done(function(){o(!0)}).fail(function(){o(!1)}),i.promise()},nodeSetStatus:function(e,t,n,r){return"ok"!==t||(e=(e=e.node).children?e.children[0]:null)&&e.isStatusNode()&&b(e.tr).remove(),this._superApply(arguments)},treeClear:function(e){return this.nodeRemoveChildMarkup(this._makeHookContext(this.rootNode)),this._superApply(arguments)},treeDestroy:function(e){return this.$container.find("tbody").empty(),this.$source&&this.$source.removeClass("fancytree-helper-hidden"),this._superApply(arguments)}}),b.ui.fancytree},"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],t):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=t(require("jquery"))):t(jQuery),t=function(o){"use strict";return o.ui.fancytree.registerExtension({name:"themeroller",version:"2.38.0",options:{activeClass:"ui-state-active",addClass:"ui-corner-all",focusClass:"ui-state-focus",hoverClass:"ui-state-hover",selectedClass:"ui-state-highlight"},treeInit:function(e){var t=e.widget.element,n=e.options.themeroller;this._superApply(arguments),"TABLE"===t[0].nodeName?(t.addClass("ui-widget ui-corner-all"),t.find(">thead tr").addClass("ui-widget-header"),t.find(">tbody").addClass("ui-widget-conent")):t.addClass("ui-widget ui-widget-content ui-corner-all"),t.on("mouseenter mouseleave",".fancytree-node",function(e){var t=o.ui.fancytree.getNode(e.target),e="mouseenter"===e.type;o(t.tr||t.span).toggleClass(n.hoverClass+" "+n.addClass,e)})},treeDestroy:function(e){this._superApply(arguments),e.widget.element.removeClass("ui-widget ui-widget-content ui-corner-all")},nodeRenderStatus:function(e){var t={},n=e.node,r=o(n.tr||n.span),i=e.options.themeroller;this._super(e),t[i.activeClass]=!1,t[i.focusClass]=!1,t[i.selectedClass]=!1,n.isActive()&&(t[i.activeClass]=!0),n.hasFocus()&&(t[i.focusClass]=!0),n.isSelected()&&!n.isActive()&&(t[i.selectedClass]=!0),r.toggleClass(i.activeClass,t[i.activeClass]),r.toggleClass(i.focusClass,t[i.focusClass]),r.toggleClass(i.selectedClass,t[i.selectedClass]),r.addClass(i.addClass)}}),o.ui.fancytree},"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],t):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=t(require("jquery"))):t(jQuery),t=function(d){"use strict";var c=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;function u(e,t){var n=d("#"+(e="fancytree-style-"+e));if(t){n.length||(n=d("<style />").attr("id",e).addClass("fancytree-style").prop("type","text/css").appendTo("head"));try{n.html(t)}catch(e){n[0].styleSheet.cssText=t}return n}n.remove()}function h(e,t,n,r,i,o){for(var a="#"+e+" span.fancytree-level-",s=[],l=0;l<t;l++)s.push(a+(l+1)+" span.fancytree-title { padding-left: "+(l*n+r)+o+"; }");return s.push("#"+e+" div.ui-effects-wrapper ul li span.fancytree-title, #"+e+" li.fancytree-animating span.fancytree-title { padding-left: "+i+o+"; position: static; width: auto; }"),s.join("\n")}return d.ui.fancytree.registerExtension({name:"wide",version:"2.38.0",options:{iconWidth:null,iconSpacing:null,labelSpacing:null,levelOfs:null},treeCreate:function(e){this._superApply(arguments),this.$container.addClass("fancytree-ext-wide");var t=e.options.wide,n=d("<li id='fancytreeTemp'><span class='fancytree-node'><span class='fancytree-icon' /><span class='fancytree-title' /></span><ul />").appendTo(e.tree.$container),r=n.find(".fancytree-icon"),i=n.find("ul"),o=t.iconSpacing||r.css("margin-left"),a=t.iconWidth||r.css("width"),s=t.labelSpacing||"3px",l=t.levelOfs||i.css("padding-left");n.remove(),r=o.match(c)[2],o=parseFloat(o,10),t=s.match(c)[2],s=parseFloat(s,10),i=a.match(c)[2],a=parseFloat(a,10),n=l.match(c)[2],r===i&&n===i&&t===i||d.error("iconWidth, iconSpacing, and levelOfs must have the same css measure unit"),this._local.measureUnit=i,this._local.levelOfs=parseFloat(l),this._local.lineOfs=(1+(e.options.checkbox?1:0)+(!1===e.options.icon?0:1))*(a+o)+o,this._local.labelOfs=s,this._local.maxDepth=10,u(s=this.$container.uniqueId().attr("id"),h(s,this._local.maxDepth,this._local.levelOfs,this._local.lineOfs,this._local.labelOfs,this._local.measureUnit))},treeDestroy:function(e){return u(this.$container.attr("id"),null),this._superApply(arguments)},nodeRenderStatus:function(e){var t=e.node,n=t.getLevel(),r=this._super(e);return n>this._local.maxDepth&&(e=this.$container.attr("id"),this._local.maxDepth*=2,t.debug("Define global ext-wide css up to level "+this._local.maxDepth),u(e,h(e,this._local.maxDepth,this._local.levelOfs,this._local.lineOfs,this._local.labelSpacing,this._local.measureUnit))),d(t.span).addClass("fancytree-level-"+n),r}}),d.ui.fancytree},"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],t):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=t(require("jquery"))):t(jQuery),e.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree.ui-deps"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree.ui-deps"),module.exports=e(require("jquery"))):e(jQuery)}(function(C){"use strict";if(!C.ui||!C.ui.fancytree){for(var e,h=null,c=new RegExp(/\.|\//),t=/[&<>"'/]/g,n=/[<>"'/]/g,f="$recursive_request",p="$request_target_invalid",r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},i={16:!0,17:!0,18:!0},u={8:"backspace",9:"tab",10:"return",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},g={16:"shift",17:"ctrl",18:"alt",91:"meta",93:"meta"},o={0:"",1:"left",2:"middle",3:"right"},y="active expanded focus folder lazy radiogroup selected unselectable unselectableIgnore".split(" "),v={},m="columns types".split(" "),b="checkbox expanded extraClasses folder icon iconTooltip key lazy partsel radiogroup refKey selected statusNodeType title tooltip type unselectable unselectableIgnore unselectableStatus".split(" "),a={},x={},s={active:!0,children:!0,data:!0,focus:!0},l=0;l<y.length;l++)v[y[l]]=!0;for(l=0;l<b.length;l++)e=b[l],a[e]=!0,e!==e.toLowerCase()&&(x[e.toLowerCase()]=e);return k(C.ui,"Fancytree requires jQuery UI (http://jqueryui.com)"),Date.now||(Date.now=function(){return(new Date).getTime()}),D.prototype={_findDirectChild:function(e){var t,n,r=this.children;if(r)if("string"==typeof e){for(t=0,n=r.length;t<n;t++)if(r[t].key===e)return r[t]}else{if("number"==typeof e)return this.children[e];if(e.parent===this)return e}return null},_setChildren:function(e){k(e&&(!this.children||0===this.children.length),"only init supported"),this.children=[];for(var t=0,n=e.length;t<n;t++)this.children.push(new D(this,e[t]));this.tree._callHook("treeStructureChanged",this.tree,"setChildren")},addChildren:function(e,t){var n,r,i,o,a=this.getFirstChild(),s=this.getLastChild(),l=[];for(C.isPlainObject(e)&&(e=[e]),this.children||(this.children=[]),n=0,r=e.length;n<r;n++)l.push(new D(this,e[n]));if(o=l[0],null==t?this.children=this.children.concat(l):(t=this._findDirectChild(t),k(0<=(i=C.inArray(t,this.children)),"insertBefore must be an existing child"),this.children.splice.apply(this.children,[i,0].concat(l))),a&&!t){for(n=0,r=l.length;n<r;n++)l[n].render();a!==this.getFirstChild()&&a.renderStatus(),s!==this.getLastChild()&&s.renderStatus()}else this.parent&&!this.parent.ul&&!this.tr||this.render();return 3===this.tree.options.selectMode&&this.fixSelection3FromEndNodes(),this.triggerModifyChild("add",1===l.length?l[0]:null),o},addClass:function(e){return this.toggleClass(e,!0)},addNode:function(e,t){switch(t=void 0===t||"over"===t?"child":t){case"after":return this.getParent().addChildren(e,this.getNextSibling());case"before":return this.getParent().addChildren(e,this);case"firstChild":var n=this.children?this.children[0]:null;return this.addChildren(e,n);case"child":case"over":return this.addChildren(e)}k(!1,"Invalid mode: "+t)},addPagingNode:function(e,t){var n,r;if(t=t||"child",!1!==e)return e=C.extend({title:this.tree.options.strings.moreData,statusNodeType:"paging",icon:!1},e),this.partload=!0,this.addNode(e,t);for(n=this.children.length-1;0<=n;n--)"paging"===(r=this.children[n]).statusNodeType&&this.removeChild(r);this.partload=!1},appendSibling:function(e){return this.addNode(e,"after")},applyCommand:function(e,t){return this.tree.applyCommand(e,this,t)},applyPatch:function(e){if(null===e)return this.remove(),_(this);var t,n,r={children:!0,expanded:!0,parent:!0};for(t in e)e.hasOwnProperty(t)&&(n=e[t],r[t]||C.isFunction(n)||(a[t]?this[t]=n:this.data[t]=n));return e.hasOwnProperty("children")&&(this.removeChildren(),e.children&&this._setChildren(e.children)),this.isVisible()&&(this.renderTitle(),this.renderStatus()),e.hasOwnProperty("expanded")?this.setExpanded(e.expanded):_(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(e,t,n){return e.addNode(this.toDict(!0,n),t)},countChildren:function(e){var t,n,r,i=this.children;if(!i)return 0;if(r=i.length,!1!==e)for(t=0,n=r;t<n;t++)r+=i[t].countChildren();return r},debug:function(e){4<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("log",arguments))},discard:function(){return this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead."),this.resetLazy()},discardMarkup:function(e){this.tree._callHook(e?"nodeRemoveMarkup":"nodeRemoveChildMarkup",this)},error:function(e){1<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("error",arguments))},findAll:function(t){t=C.isFunction(t)?t:T(t);var n=[];return this.visit(function(e){t(e)&&n.push(e)}),n},findFirst:function(t){t=C.isFunction(t)?t:T(t);var n=null;return this.visit(function(e){if(t(e))return n=e,!1}),n},findRelatedNode:function(e,t){return this.tree.findRelatedNode(this,e,t)},_changeSelectStatusAttrs:function(e){var t=!1,n=this.tree.options,r=h.evalOption("unselectable",this,this,n,!1),n=h.evalOption("unselectableStatus",this,this,n,void 0);switch(e=r&&null!=n?n:e){case!1:t=this.selected||this.partsel,this.selected=!1,this.partsel=!1;break;case!0:t=!this.selected||!this.partsel,this.selected=!0,this.partsel=!0;break;case void 0:t=this.selected||!this.partsel,this.selected=!1,this.partsel=!0;break;default:k(!1,"invalid state: "+e)}return t&&this.renderStatus(),t},fixSelection3AfterClick:function(e){var t=this.isSelected();this.visit(function(e){if(e._changeSelectStatusAttrs(t),e.radiogroup)return"skip"}),this.fixSelection3FromEndNodes(e)},fixSelection3FromEndNodes:function(e){var u=this.tree.options;k(3===u.selectMode,"expected selectMode 3"),function e(t){var n,r,i,o,a,s,l,d,c=t.children;if(c&&c.length){for(l=!(s=!0),n=0,r=c.length;n<r;n++)o=e(i=c[n]),h.evalOption("unselectableIgnore",i,i,u,!1)||(!1!==o&&(l=!0),!0!==o&&(s=!1));a=!!s||!!l&&void 0}else a=null==(d=h.evalOption("unselectableStatus",t,t,u,void 0))?!!t.selected:!!d;return t.partsel&&!t.selected&&t.lazy&&null==t.children&&(a=void 0),t._changeSelectStatusAttrs(a),a}(this),this.visitParents(function(e){for(var t,n,r,i=e.children,o=!0,a=!1,s=0,l=i.length;s<l;s++)t=i[s],h.evalOption("unselectableIgnore",t,t,u,!1)||(((n=null==(r=h.evalOption("unselectableStatus",t,t,u,void 0))?!!t.selected:!!r)||t.partsel)&&(a=!0),n||(o=!1));e._changeSelectStatusAttrs(n=!!o||!!a&&void 0)})},fromDict:function(e){for(var t in e)a[t]?this[t]=e[t]:"data"===t?C.extend(this.data,e.data):C.isFunction(e[t])||s[t]||(this.data[t]=e[t]);e.children&&(this.removeChildren(),this.addChildren(e.children)),this.renderTitle()},getChildren:function(){if(void 0!==this.hasChildren())return this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return C.inArray(this,this.parent.children)},getIndexHier:function(e,n){e=e||".";var r,i=[];return C.each(this.getParentList(!1,!0),function(e,t){r=""+(t.getIndex()+1),n&&(r=("0000000"+r).substr(-n)),i.push(r)}),i.join(e)},getKeyPath:function(e){var t=this.tree.options.keyPathSeparator;return t+this.getPath(!e,"key",t)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},getNextSibling:function(){if(this.parent)for(var e=this.parent.children,t=0,n=e.length-1;t<n;t++)if(e[t]===this)return e[t+1];return null},getParent:function(){return this.parent},getParentList:function(e,t){for(var n=[],r=t?this:this.parent;r;)(e||r.parent)&&n.unshift(r),r=r.parent;return n},getPath:function(e,t,n){e=!1!==e,t=t||"title",n=n||"/";var r,i=[],o=C.isFunction(t);return this.visitParents(function(e){e.parent&&(r=o?t(e):e[t],i.unshift(r))},e),i.join(n)},getPrevSibling:function(){if(this.parent)for(var e=this.parent.children,t=1,n=e.length;t<n;t++)if(e[t]===this)return e[t-1];return null},getSelectedNodes:function(t){var n=[];return this.visit(function(e){if(e.selected&&(n.push(e),!0===t))return"skip"}),n},hasChildren:function(){return this.lazy?null==this.children?void 0:0!==this.children.length&&(1!==this.children.length||!this.children[0].isStatusNode()||void 0):!(!this.children||!this.children.length)},hasClass:function(e){return 0<=(" "+(this.extraClasses||"")+" ").indexOf(" "+e+" ")},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},info:function(e){3<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("info",arguments))},isActive:function(){return this.tree.activeNode===this},isBelowOf:function(e){return this.getIndexHier(".",5)>e.getIndexHier(".",5)},isChildOf:function(e){return this.parent&&this.parent===e},isDescendantOf:function(e){if(!e||e.tree!==this.tree)return!1;for(var t=this.parent;t;){if(t===e)return!0;t===t.parent&&C.error("Recursive parent link: "+t),t=t.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var e=this.parent;return!e||e.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var e=this.parent;return!e||e.children[e.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||void 0!==this.hasChildren()},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.isRootNode()},isPartsel:function(){return!this.selected&&!!this.partsel},isPartload:function(){return!!this.partload},isRootNode:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isPagingNode:function(){return"paging"===this.statusNodeType},isTopLevel:function(){return this.tree.rootNode===this.parent},isUndefined:function(){return void 0===this.hasChildren()},isVisible:function(){var e,t,n=this.tree.enableFilter,r=this.getParentList(!1,!1);if(n&&!this.match&&!this.subMatchCount)return!1;for(e=0,t=r.length;e<t;e++)if(!r[e].expanded)return!1;return!0},lazyLoad:function(e){C.error("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead.")},load:function(e){var t=this,n=this.isExpanded();return k(this.isLazy(),"load() requires a lazy node"),e||this.isUndefined()?(this.isLoaded()&&this.resetLazy(),!1===(e=this.tree._triggerNodeEvent("lazyLoad",this))?_(this):(k("boolean"!=typeof e,"lazyLoad event must return source in data.result"),e=this.tree._callHook("nodeLoadChildren",this,e),n?(this.expanded=!0,e.always(function(){t.render()})):e.always(function(){t.renderStatus()}),e)):_(this)},makeVisible:function(e){for(var t=this,n=[],r=new C.Deferred,i=this.getParentList(!1,!1),o=i.length,a=!(e&&!0===e.noAnimation),s=!(e&&!1===e.scrollIntoView),l=o-1;0<=l;l--)n.push(i[l].setExpanded(!0,e));return C.when.apply(C,n).done(function(){s?t.scrollIntoView(a).done(function(){r.resolve()}):r.resolve()}),r.promise()},moveTo:function(t,e,n){void 0===e||"over"===e?e="child":"firstChild"===e&&(t.children&&t.children.length?(e="before",t=t.children[0]):e="child");var r,i=this.tree,o=this.parent,a="child"===e?t:t.parent;if(this!==t){if(this.parent?a.isDescendantOf(this)&&C.error("Cannot move a node to its own descendant"):C.error("Cannot move system root"),a!==o&&o.triggerModifyChild("remove",this),1===this.parent.children.length){if(this.parent===a)return;this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1}else k(0<=(r=C.inArray(this,this.parent.children)),"invalid source parent"),this.parent.children.splice(r,1);if((this.parent=a).hasChildren())switch(e){case"child":a.children.push(this);break;case"before":k(0<=(r=C.inArray(t,a.children)),"invalid target parent"),a.children.splice(r,0,this);break;case"after":k(0<=(r=C.inArray(t,a.children)),"invalid target parent"),a.children.splice(r+1,0,this);break;default:C.error("Invalid mode "+e)}else a.children=[this];n&&t.visit(n,!0),a===o?a.triggerModifyChild("move",this):a.triggerModifyChild("add",this),i!==t.tree&&(this.warn("Cross-tree moveTo is experimental!"),this.visit(function(e){e.tree=t.tree},!0)),i._callHook("treeStructureChanged",i,"moveTo"),o.isDescendantOf(a)||o.render(),a.isDescendantOf(o)||a===o||a.render()}},navigate:function(e,t){var n=C.ui.keyCode;switch(e){case"left":case n.LEFT:if(this.expanded)return this.setExpanded(!1);break;case"right":case n.RIGHT:if(!this.expanded&&(this.children||this.lazy))return this.setExpanded()}if(n=this.findRelatedNode(e)){try{n.makeVisible({scrollIntoView:!1})}catch(e){}return!1===t?(n.setFocus(),_()):n.setActive()}return this.warn("Could not find related node '"+e+"'."),_()},remove:function(){return this.parent.removeChild(this)},removeChild:function(e){return this.tree._callHook("nodeRemoveChild",this,e)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},removeClass:function(e){return this.toggleClass(e,!1)},render:function(e,t){return this.tree._callHook("nodeRender",this,e,t)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},replaceWith:function(e){var n=this.parent,r=C.inArray(this,n.children),i=this;return k(this.isPagingNode(),"replaceWith() currently requires a paging status node"),(e=this.tree._callHook("nodeLoadChildren",this,e)).done(function(e){var t=i.children;for(l=0;l<t.length;l++)t[l].parent=n;n.children.splice.apply(n.children,[r+1,0].concat(t)),i.children=null,i.remove(),n.render()}).fail(function(){i.setExpanded()}),e},resetLazy:function(){this.removeChildren(),this.expanded=!1,this.lazy=!0,this.children=void 0,this.renderStatus()},scheduleAction:function(e,t){this.tree.timer&&(clearTimeout(this.tree.timer),this.tree.debug("clearTimeout(%o)",this.tree.timer)),this.tree.timer=null;var n=this;switch(e){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger expand"),n.setExpanded(!0)},t);break;case"activate":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger activate"),n.setActive(!0)},t);break;default:C.error("Invalid mode "+e)}},scrollIntoView:function(e,t){if(void 0!==t&&((p=t).tree&&void 0!==p.statusNodeType))throw Error("scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead.");var n=C.extend({effects:!0===e?{duration:200,queue:!1}:e,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent,topNode:null},t),r=n.scrollParent,i=this.tree.$container,o=i.css("overflow-y");r?r.jquery||(r=C(r)):r=!this.tree.tbody&&("scroll"===o||"auto"===o)?i:i.scrollParent(),r[0]!==document&&r[0]!==document.body||(this.debug("scrollIntoView(): normalizing scrollParent to 'window':",r[0]),r=C(window));var a,s,l=new C.Deferred,d=this,c=C(this.span).height(),u=n.scrollOfs.top||0,h=n.scrollOfs.bottom||0,f=r.height(),p=r.scrollTop(),e=r,t=r[0]===window,o=n.topNode||null,i=null;return this.isRootNode()||!this.isVisible()?(this.info("scrollIntoView(): node is invisible."),_()):(t?(s=C(this.span).offset().top,a=o&&o.span?C(o.span).offset().top:0,e=C("html,body")):(k(r[0]!==document&&r[0]!==document.body,"scrollParent should be a simple element or `window`, not document or body."),t=r.offset().top,s=C(this.span).offset().top-t+p,a=o?C(o.span).offset().top-t+p:0,f-=Math.max(0,r.innerHeight()-r[0].clientHeight)),s<p+u?i=s-u:p+f-h<s+c&&(i=s+c-f+h,o&&(k(o.isRootNode()||o.isVisible(),"topNode must be visible"),a<i&&(i=a-u))),null===i?l.resolveWith(this):n.effects?(n.effects.complete=function(){l.resolveWith(d)},e.stop(!0).animate({scrollTop:i},n.effects)):(e[0].scrollTop=i,l.resolveWith(this)),l.promise())},setActive:function(e,t){return this.tree._callHook("nodeSetActive",this,e,t)},setExpanded:function(e,t){return this.tree._callHook("nodeSetExpanded",this,e,t)},setFocus:function(e){return this.tree._callHook("nodeSetFocus",this,e)},setSelected:function(e,t){return this.tree._callHook("nodeSetSelected",this,e,t)},setStatus:function(e,t,n){return this.tree._callHook("nodeSetStatus",this,e,t,n)},setTitle:function(e){this.title=e,this.renderTitle(),this.triggerModify("rename")},sortChildren:function(e,t){var n,r,i=this.children;if(i){if(i.sort(e=e||function(e,t){e=e.title.toLowerCase(),t=t.title.toLowerCase();return e===t?0:t<e?1:-1}),t)for(n=0,r=i.length;n<r;n++)i[n].children&&i[n].sortChildren(e,"$norender$");"$norender$"!==t&&this.render(),this.triggerModifyChild("sort")}},toDict:function(e,t){var n,r,i,o,a={},s=this;if(C.each(b,function(e,t){!s[t]&&!1!==s[t]||(a[t]=s[t])}),C.isEmptyObject(this.data)||(a.data=C.extend({},this.data),C.isEmptyObject(a.data)&&delete a.data),t){if(!1===(o=t(a,s)))return!1;"skip"===o&&(e=!1)}if(e&&C.isArray(this.children))for(a.children=[],n=0,r=this.children.length;n<r;n++)(i=this.children[n]).isStatusNode()||!1!==(o=i.toDict(!0,t))&&a.children.push(o);return a},toggleClass:function(e,t){var n,r,i=e.match(/\S+/g)||[],o=0,a=!1,s=this[this.tree.statusClassPropName],l=" "+(this.extraClasses||"")+" ";for(s&&C(s).toggleClass(e,t);n=i[o++];)if(r=0<=l.indexOf(" "+n+" "),t=void 0===t?!r:!!t)r||(l+=n+" ",a=!0);else for(;-1<l.indexOf(" "+n+" ");)l=l.replace(" "+n+" "," ");return this.extraClasses=C.trim(l),a},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"FancytreeNode@"+this.key+"[title='"+this.title+"']"},triggerModifyChild:function(e,t,n){var r=this.tree.options.modifyChild;r&&(t&&t.parent!==this&&C.error("childNode "+t+" is not a child of "+this),t={node:this,tree:this.tree,operation:e,childNode:t||null},n&&C.extend(t,n),r({type:"modifyChild"},t))},triggerModify:function(e,t){this.parent.triggerModifyChild(e,this,t)},visit:function(e,t){var n,r,i=!0,o=this.children;if(!0===t&&(!1===(i=e(this))||"skip"===i))return i;if(o)for(n=0,r=o.length;n<r&&!1!==(i=o[n].visit(e,!0));n++);return i},visitAndLoad:function(n,e,t){var r,i,o,a=this;return!n||!0!==e||!1!==(i=n(a))&&"skip"!==i?a.children||a.lazy?(r=new C.Deferred,o=[],a.load().done(function(){for(var e=0,t=a.children.length;e<t;e++){if(!1===(i=a.children[e].visitAndLoad(n,!0,!0))){r.reject();break}"skip"!==i&&o.push(i)}C.when.apply(this,o).then(function(){r.resolve()})}),r.promise()):_():t?i:_()},visitParents:function(e,t){if(t&&!1===e(this))return!1;for(var n=this.parent;n;){if(!1===e(n))return!1;n=n.parent}return!0},visitSiblings:function(e,t){for(var n,r=this.parent.children,i=0,o=r.length;i<o;i++)if(n=r[i],(t||n!==this)&&!1===e(n))return!1;return!0},warn:function(e){2<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("warn",arguments))}},O.prototype={_makeHookContext:function(e,t,n){var r,i;return void 0!==e.node?(t&&e.originalEvent!==t&&C.error("invalid args"),r=e):e.tree?r={node:e,tree:i=e.tree,widget:i.widget,options:i.widget.options,originalEvent:t,typeInfo:i.types[e.type]||{}}:e.widget?r={node:null,tree:e,widget:e.widget,options:e.widget.options,originalEvent:t}:C.error("invalid args"),n&&C.extend(r,n),r},_callHook:function(e,t,n){var r=this._makeHookContext(t),i=this[e],t=Array.prototype.slice.call(arguments,2);return C.isFunction(i)||C.error("_callHook('"+e+"') is not a function"),t.unshift(r),i.apply(this,t)},_setExpiringValue:function(e,t,n){this._tempCache[e]={value:t,expire:Date.now()+(+n||50)}},_getExpiringValue:function(e){var t=this._tempCache[e];return t&&t.expire>Date.now()?t.value:(delete this._tempCache[e],null)},_usesExtension:function(e){return 0<=C.inArray(e,this.options.extensions)},_requireExtension:function(e,t,n,r){null!=n&&(n=!!n);var i=this._local.name,o=this.options.extensions,a=C.inArray(e,o)<C.inArray(i,o),o=t&&null==this.ext[e],a=!o&&null!=n&&n!==a;return k(i&&i!==e,"invalid or same name '"+i+"' (require yourself?)"),!o&&!a||(r||(o||t?(r="'"+i+"' extension requires '"+e+"'",a&&(r+=" to be registered "+(n?"before":"after")+" itself")):r="If used together, `"+e+"` must be registered "+(n?"before":"after")+" `"+i+"`"),C.error(r),!1)},activateKey:function(e,t){e=this.getNodeByKey(e);return e?e.setActive(!0,t):this.activeNode&&this.activeNode.setActive(!1,t),e},addPagingNode:function(e,t){return this.rootNode.addPagingNode(e,t)},applyCommand:function(e,t,n){var r;switch(t=t||this.getActiveNode(),e){case"moveUp":(r=t.getPrevSibling())&&(t.moveTo(r,"before"),t.setActive());break;case"moveDown":(r=t.getNextSibling())&&(t.moveTo(r,"after"),t.setActive());break;case"indent":(r=t.getPrevSibling())&&(t.moveTo(r,"child"),r.setExpanded(),t.setActive());break;case"outdent":t.isTopLevel()||(t.moveTo(t.getParent(),"after"),t.setActive());break;case"remove":r=t.getPrevSibling()||t.getParent(),t.remove(),r&&r.setActive();break;case"addChild":t.editCreateNode("child","");break;case"addSibling":t.editCreateNode("after","");break;case"rename":t.editStart();break;case"down":case"first":case"last":case"left":case"parent":case"right":case"up":return t.navigate(e);default:C.error("Unhandled command: '"+e+"'")}},applyPatch:function(e){for(var t,n,r,i,o=e.length,a=[],s=0;s<o;s++)k(2===(t=e[s]).length,"patchList must be an array of length-2-arrays"),n=t[0],r=t[1],(i=null===n?this.rootNode:this.getNodeByKey(n))?(t=new C.Deferred,a.push(t),i.applyPatch(r).always(S(t,i))):this.warn("could not find node with key '"+n+"'");return C.when.apply(C,a).promise()},clear:function(e){this._callHook("treeClear",this)},count:function(){return this.rootNode.countChildren()},debug:function(e){4<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("log",arguments))},destroy:function(){this.widget.destroy()},enable:function(e){!1===e?this.widget.disable():this.widget.enable()},enableUpdate:function(e){return!!this._enableUpdate==!!(e=!1!==e)?e:((this._enableUpdate=e)?(this.debug("enableUpdate(true): redraw "),this._callHook("treeStructureChanged",this,"enableUpdate"),this.render()):this.debug("enableUpdate(false)..."),!e)},error:function(e){1<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("error",arguments))},expandAll:function(t,n){var e=this.enableUpdate(!1);t=!1!==t,this.visit(function(e){!1!==e.hasChildren()&&e.isExpanded()!==t&&e.setExpanded(t,n)}),this.enableUpdate(e)},findAll:function(e){return this.rootNode.findAll(e)},findFirst:function(e){return this.rootNode.findFirst(e)},findNextNode:function(t,n){var r,i=null,e=this.getFirstChild();function o(e){if((i=t(e)?e:i)||e===n)return!1}return t="string"==typeof t?(r=new RegExp("^"+t,"i"),function(e){return r.test(e.title)}):t,n=n||e,this.visitRows(o,{start:n,includeSelf:!1}),i||n===e||this.visitRows(o,{start:e,includeSelf:!0}),i},findRelatedNode:function(e,t,n){var r=null,i=C.ui.keyCode;switch(t){case"parent":case i.BACKSPACE:e.parent&&e.parent.parent&&(r=e.parent);break;case"first":case i.HOME:this.visit(function(e){if(e.isVisible())return r=e,!1});break;case"last":case i.END:this.visit(function(e){e.isVisible()&&(r=e)});break;case"left":case i.LEFT:e.expanded?e.setExpanded(!1):e.parent&&e.parent.parent&&(r=e.parent);break;case"right":case i.RIGHT:e.expanded||!e.children&&!e.lazy?e.children&&e.children.length&&(r=e.children[0]):(e.setExpanded(),r=e);break;case"up":case i.UP:this.visitRows(function(e){return r=e,!1},{start:e,reverse:!0,includeSelf:!1});break;case"down":case i.DOWN:this.visitRows(function(e){return r=e,!1},{start:e,includeSelf:!1});break;default:this.tree.warn("Unknown relation '"+t+"'.")}return r},generateFormElements:function(e,t,n){n=n||{};var r="string"==typeof e?e:"ft_"+this._id+"[]",i="string"==typeof t?t:"ft_"+this._id+"_active",o="fancytree_result_"+this._id,a=C("#"+o),s=3===this.options.selectMode&&!1!==n.stopOnParents;function l(e){a.append(C("<input>",{type:"checkbox",name:r,value:e.key,checked:!0}))}a.length?a.empty():a=C("<div>",{id:o}).hide().insertAfter(this.$container),!1!==t&&this.activeNode&&a.append(C("<input>",{type:"radio",name:i,value:this.activeNode.key,checked:!0})),n.filter?this.visit(function(e){var t=n.filter(e);if("skip"===t)return t;!1!==t&&l(e)}):!1!==e&&(s=this.getSelectedNodes(s),C.each(s,function(e,t){l(t)}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(){return this.focusNode},getOption:function(e){return this.widget.option(e)},getNodeByKey:function(t,e){var n,r;return!e&&(n=document.getElementById(this.options.idPrefix+t))?n.ftnode||null:(e=e||this.rootNode,r=null,t=""+t,e.visit(function(e){if(e.key===t)return r=e,!1},!0),r)},getRootNode:function(){return this.rootNode},getSelectedNodes:function(e){return this.rootNode.getSelectedNodes(e)},hasFocus:function(){return!!this._hasFocus},info:function(e){3<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("info",arguments))},isLoading:function(){var t=!1;return this.rootNode.visit(function(e){if(e._isLoading||e._requestId)return!(t=!0)},!0),t},loadKeyPath:function(e,t){var r,n,i,o=this,a=new C.Deferred,s=this.getRootNode(),l=this.options.keyPathSeparator,d=[],c=C.extend({},t);for("function"==typeof t?r=t:t&&t.callback&&(r=t.callback),c.callback=function(e,t,n){r&&r.call(e,t,n),a.notifyWith(e,[{node:t,status:n}])},null==c.matchKey&&(c.matchKey=function(e,t){return e.key===t}),C.isArray(e)||(e=[e]),n=0;n<e.length;n++)(i=e[n]).charAt(0)===l&&(i=i.substr(1)),d.push(i.split(l));return setTimeout(function(){o._loadKeyPathImpl(a,c,s,d).done(function(){a.resolve()})},0),a.promise()},_loadKeyPathImpl:function(e,o,t,n){var r,i,a,s,l,d,c,u,h,f,p=this;for(c={},i=0;i<n.length;i++)for(h=n[i],u=t;h.length;){if(a=h.shift(),!(s=function(e,t){var n,r,i=e.children;if(i)for(n=0,r=i.length;n<r;n++)if(o.matchKey(i[n],t))return i[n];return null}(u,a))){this.warn("loadKeyPath: key not found: "+a+" (parent: "+u+")"),o.callback(this,a,"error");break}if(0===h.length){o.callback(this,s,"ok");break}if(s.lazy&&void 0===s.hasChildren()){o.callback(this,s,"loaded"),c[a=s.key]?c[a].pathSegList.push(h):c[a]={parent:s,pathSegList:[h]};break}o.callback(this,s,"loaded"),u=s}for(l in r=[],c)c.hasOwnProperty(l)&&(d=c[l],f=new C.Deferred,r.push(f),function(t,n,e){o.callback(p,n,"loading"),n.load().done(function(){p._loadKeyPathImpl.call(p,t,o,n,e).always(S(t,p))}).fail(function(e){p.warn("loadKeyPath: error loading lazy "+n),o.callback(p,s,"error"),t.rejectWith(p)})}(f,d.parent,d.pathSegList));return C.when.apply(C,r).promise()},reactivate:function(e){var t,n=this.activeNode;return n?(this.activeNode=null,t=n.setActive(!0,{noFocus:!0}),e&&n.setFocus(),t):_()},reload:function(e){return this._callHook("treeClear",this),this._callHook("treeLoad",this,e)},render:function(e,t){return this.rootNode.render(e,t)},selectAll:function(t){this.visit(function(e){e.setSelected(t)})},setFocus:function(e){return this._callHook("treeSetFocus",this,e)},setOption:function(e,t){return this.widget.option(e,t)},debugTime:function(e){4<=this.options.debugLevel&&window.console.time(this+" - "+e)},debugTimeEnd:function(e){4<=this.options.debugLevel&&window.console.timeEnd(this+" - "+e)},toDict:function(e,t){t=this.rootNode.toDict(!0,t);return e?t:t.children},toString:function(){return"Fancytree@"+this._id},_triggerNodeEvent:function(e,t,n,r){r=this._makeHookContext(t,n,r),n=this.widget._trigger(e,n,r);return!1!==n&&void 0!==r.result?r.result:n},_triggerTreeEvent:function(e,t,n){n=this._makeHookContext(this,t,n),t=this.widget._trigger(e,t,n);return!1!==t&&void 0!==n.result?n.result:t},visit:function(e){return this.rootNode.visit(e,!1)},visitRows:function(t,e){if(!this.rootNode.hasChildren())return!1;if(e&&e.reverse)return delete e.reverse,this._visitRowsUp(t,e);for(var n,r,i,o=0,a=!1===(e=e||{}).includeSelf,s=!!e.includeHidden,l=!s&&this.enableFilter,d=e.start||this.rootNode.children[0],c=d.parent;c;){for(k(0<=(r=(i=c.children).indexOf(d)+o),"Could not find "+d+" in parent's children: "+c),n=r;n<i.length;n++)if(d=i[n],!l||d.match||d.subMatchCount){if(!a&&!1===t(d))return!1;if(a=!1,d.children&&d.children.length&&(s||d.expanded)&&!1===d.visit(function(e){return!l||e.match||e.subMatchCount?!1!==t(e)&&(s||!e.children||e.expanded?void 0:"skip"):"skip"},!1))return!1}c=(d=c).parent,o=1}return!0},_visitRowsUp:function(e,t){for(var n,r,i,o=!!t.includeHidden,a=t.start||this.rootNode.children[0];;){if((n=(i=a.parent).children)[0]===a){if(!(a=i).parent)break;n=i.children}else for(r=n.indexOf(a),a=n[r-1];(o||a.expanded)&&a.children&&a.children.length;)a=(n=(i=a).children)[n.length-1];if((o||a.isVisible())&&!1===e(a))return!1}},warn:function(e){2<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),d("warn",arguments))}},C.extend(O.prototype,{nodeClick:function(e){var t,n,r=e.targetType,i=e.node;if("expander"===r)i.isLoading()?i.debug("Got 2nd click while loading: ignored"):this._callHook("nodeToggleExpanded",e);else if("checkbox"===r)this._callHook("nodeToggleSelected",e),e.options.focusOnSelect&&this._callHook("nodeSetFocus",e,!0);else{if(t=!(n=!1),i.folder)switch(e.options.clickFolderMode){case 2:t=!(n=!0);break;case 3:n=t=!0}t&&(this.nodeSetFocus(e),this._callHook("nodeSetActive",e,!0)),n&&this._callHook("nodeToggleExpanded",e)}},nodeCollapseSiblings:function(e,t){var n,r,i,o=e.node;if(o.parent)for(r=0,i=(n=o.parent.children).length;r<i;r++)n[r]!==o&&n[r].expanded&&this._callHook("nodeSetExpanded",n[r],!1,t)},nodeDblclick:function(e){"title"===e.targetType&&4===e.options.clickFolderMode&&this._callHook("nodeToggleExpanded",e),"title"===e.targetType&&e.originalEvent.preventDefault()},nodeKeydown:function(e){var t=e.originalEvent,n=e.node,r=e.tree,i=e.options,o=t.which,a=t.key||String.fromCharCode(o),s=!!(t.altKey||t.ctrlKey||t.metaKey),l=!g[o]&&!u[o]&&!s,o=C(t.target),d=!0,c=!(t.ctrlKey||!i.autoActivate);if(n||(s=this.getActiveNode()||this.getFirstChild())&&(s.setFocus(),(n=e.node=this.focusNode).debug("Keydown force focus on active node")),i.quicksearch&&l&&!o.is(":input:enabled"))return 500<(o=Date.now())-r.lastQuicksearchTime&&(r.lastQuicksearchTerm=""),r.lastQuicksearchTime=o,r.lastQuicksearchTerm+=a,(a=r.findNextNode(r.lastQuicksearchTerm,r.getActiveNode()))&&a.setActive(),void t.preventDefault();switch(h.eventToString(t)){case"+":case"=":r.nodeSetExpanded(e,!0);break;case"-":r.nodeSetExpanded(e,!1);break;case"space":n.isPagingNode()?r._triggerNodeEvent("clickPaging",e,t):h.evalOption("checkbox",n,n,i,!1)?r.nodeToggleSelected(e):r.nodeSetActive(e,!0);break;case"return":r.nodeSetActive(e,!0);break;case"home":case"end":case"backspace":case"left":case"right":case"up":case"down":n.navigate(t.which,c);break;default:d=!1}d&&t.preventDefault()},nodeLoadChildren:function(o,a){var t,n,s,e=null,r=!0,l=o.tree,d=o.node,c=d.parent,i="nodeLoadChildren",u=Date.now();return C.isFunction(a)&&(a=a.call(l,{type:"source"},o),k(!C.isFunction(a),"source callback must not return another function")),C.isFunction(a.then)?e=a:a.url?e=(t=C.extend({},o.options.ajax,a)).debugDelay?(n=t.debugDelay,delete t.debugDelay,C.isArray(n)&&(n=n[0]+Math.random()*(n[1]-n[0])),d.warn("nodeLoadChildren waiting debugDelay "+Math.round(n)+" ms ..."),C.Deferred(function(e){setTimeout(function(){C.ajax(t).done(function(){e.resolveWith(this,arguments)}).fail(function(){e.rejectWith(this,arguments)})},n)})):C.ajax(t):C.isPlainObject(a)||C.isArray(a)?r=!(e={then:function(e,t){e(a,null,null)}}):C.error("Invalid source type: "+a),d._requestId&&(d.warn("Recursive load request #"+u+" while #"+d._requestId+" is pending."),d._requestId=u),r&&(l.debugTime(i),l.nodeSetStatus(o,"loading")),s=new C.Deferred,e.then(function(e,t,n){var r,i;if("json"!==a.dataType&&"jsonp"!==a.dataType||"string"!=typeof e||C.error("Ajax request returned a string (did you get the JSON dataType wrong?)."),d._requestId&&d._requestId>u)s.rejectWith(this,[f]);else if(null!==d.parent||null===c){if(o.options.postProcess){try{(i=l._triggerNodeEvent("postProcess",o,o.originalEvent,{response:e,error:null,dataType:a.dataType})).error&&l.warn("postProcess returned error:",i)}catch(e){i={error:e,message:""+e,details:"postProcess failed"}}if(i.error)return r=C.isPlainObject(i.error)?i.error:{message:i.error},r=l._makeHookContext(d,null,r),void s.rejectWith(this,[r]);(C.isArray(i)||C.isPlainObject(i)&&C.isArray(i.children))&&(e=i)}else e&&e.hasOwnProperty("d")&&o.options.enableAspx&&(42===o.options.enableAspx&&l.warn("The default for enableAspx will change to `false` in the fututure. Pass `enableAspx: true` or implement postProcess to silence this warning."),e="string"==typeof e.d?C.parseJSON(e.d):e.d);s.resolveWith(this,[e])}else s.rejectWith(this,[p])},function(e,t,n){n=l._makeHookContext(d,null,{error:e,args:Array.prototype.slice.call(arguments),message:n,details:e.status+": "+n});s.rejectWith(this,[n])}),s.done(function(e){var t,n,r;l.nodeSetStatus(o,"ok"),C.isPlainObject(e)?(k(d.isRootNode(),"source may only be an object for root nodes (expecting an array of child objects otherwise)"),k(C.isArray(e.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),t=(n=e).children,delete n.children,C.each(m,function(e,t){void 0!==n[t]&&(l[t]=n[t],delete n[t])}),C.extend(l.data,n)):t=e,k(C.isArray(t),"expected array of children"),d._setChildren(t),l.options.nodata&&0===t.length&&(C.isFunction(l.options.nodata)?r=l.options.nodata.call(l,{type:"nodata"},o):!0===l.options.nodata&&d.isRootNode()?r=l.options.strings.noData:"string"==typeof l.options.nodata&&d.isRootNode()&&(r=l.options.nodata),r&&d.setStatus("nodata",r)),l._triggerNodeEvent("loadChildren",d)}).fail(function(e){var t;e!==f?e!==p?(e.node&&e.error&&e.message?t=e:"[object Object]"===(t=l._makeHookContext(d,null,{error:e,args:Array.prototype.slice.call(arguments),message:e?e.message||e.toString():""})).message&&(t.message=""),d.warn("Load children failed ("+t.message+")",t),!1!==l._triggerNodeEvent("loadError",t,null)&&l.nodeSetStatus(o,"error",t.message,t.details)):d.warn("Lazy parent node was removed while loading: discarding response."):d.warn("Ignored response for obsolete load request #"+u+" (expected #"+d._requestId+")")}).always(function(){d._requestId=null,r&&l.debugTimeEnd(i)}),s.promise()},nodeLoadKeyPath:function(e,t){},nodeRemoveChild:function(e,t){var n=e.node,r=C.extend({},e,{node:t}),i=n.children;if(1===i.length)return k(t===i[0],"invalid single child"),this.nodeRemoveChildren(e);this.activeNode&&(t===this.activeNode||this.activeNode.isDescendantOf(t))&&this.activeNode.setActive(!1),this.focusNode&&(t===this.focusNode||this.focusNode.isDescendantOf(t))&&(this.focusNode=null),this.nodeRemoveMarkup(r),this.nodeRemoveChildren(r),k(0<=(r=C.inArray(t,i)),"invalid child"),n.triggerModifyChild("remove",t),t.visit(function(e){e.parent=null},!0),this._callHook("treeRegisterNode",this,!1,t),i.splice(r,1)},nodeRemoveChildMarkup:function(e){e=e.node;e.ul&&(e.isRootNode()?C(e.ul).empty():(C(e.ul).remove(),e.ul=null),e.visit(function(e){e.li=e.ul=null}))},nodeRemoveChildren:function(e){var t=e.tree,n=e.node;n.children&&(this.activeNode&&this.activeNode.isDescendantOf(n)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(n)&&(this.focusNode=null),this.nodeRemoveChildMarkup(e),n.triggerModifyChild("remove",null),n.visit(function(e){e.parent=null,t._callHook("treeRegisterNode",t,!1,e)}),n.lazy?n.children=[]:n.children=null,n.isRootNode()||(n.expanded=!1),this.nodeRenderStatus(e))},nodeRemoveMarkup:function(e){var t=e.node;t.li&&(C(t.li).remove(),t.li=null),this.nodeRemoveChildMarkup(e)},nodeRender:function(e,t,n,r,i){var o,a,s,l,d,c,u,h=e.node,f=e.tree,p=e.options,g=p.aria,y=!1,v=h.parent,m=!v,b=h.children,x=null;if(!1!==f._enableUpdate&&(m||v.ul)){if(k(m||v.ul,"parent UL must exist"),m||(h.li&&(t||h.li.parentNode!==h.parent.ul)&&(h.li.parentNode===h.parent.ul?x=h.li.nextSibling:this.debug("Unlinking "+h+" (must be child of "+h.parent+")"),this.nodeRemoveMarkup(e)),h.li?this.nodeRenderStatus(e):(y=!0,h.li=document.createElement("li"),(h.li.ftnode=h).key&&p.generateIds&&(h.li.id=p.idPrefix+h.key),h.span=document.createElement("span"),h.span.className="fancytree-node",g&&!h.tr&&C(h.li).attr("role","treeitem"),h.li.appendChild(h.span),this.nodeRenderTitle(e),p.createNode&&p.createNode.call(f,{type:"createNode"},e)),p.renderNode&&p.renderNode.call(f,{type:"renderNode"},e)),b){if(m||h.expanded||!0===n){for(h.ul||(h.ul=document.createElement("ul"),(!0!==r||i)&&h.expanded||(h.ul.style.display="none"),g&&C(h.ul).attr("role","group"),h.li?h.li.appendChild(h.ul):h.tree.$div.append(h.ul)),l=0,d=b.length;l<d;l++)u=C.extend({},e,{node:b[l]}),this.nodeRender(u,t,n,!1,!0);for(o=h.ul.firstChild;o;)o=(s=o.ftnode)&&s.parent!==h?(h.debug("_fixParent: remove missing "+s,o),c=o.nextSibling,o.parentNode.removeChild(o),c):o.nextSibling;for(o=h.ul.firstChild,l=0,d=b.length-1;l<d;l++)(a=b[l])===(s=o.ftnode)?o=o.nextSibling:h.ul.insertBefore(a.li,s.li)}}else h.ul&&(this.warn("remove child markup for "+h),this.nodeRemoveChildMarkup(e));m||y&&v.ul.insertBefore(h.li,x)}},nodeRenderTitle:function(e,t){var n,r,i=e.node,o=e.tree,a=e.options,s=a.aria,l=i.getLevel(),d=[];void 0!==t&&(i.title=t),i.span&&!1!==o._enableUpdate&&(t=s&&!1!==i.hasChildren()?" role='button'":"",l<a.minExpandLevel?(i.lazy||(i.expanded=!0),1<l&&d.push("<span "+t+" class='fancytree-expander fancytree-expander-fixed'></span>")):d.push("<span "+t+" class='fancytree-expander'></span>"),(l=h.evalOption("checkbox",i,i,a,!1))&&!i.isStatusNode()&&(n="fancytree-checkbox",("radio"===l||i.parent&&i.parent.radiogroup)&&(n+=" fancytree-radio"),d.push("<span "+(t=s?" role='checkbox'":"")+" class='"+n+"'></span>")),void 0!==i.data.iconClass&&(i.icon?C.error("'iconClass' node option is deprecated since v2.14.0: use 'icon' only instead"):(i.warn("'iconClass' node option is deprecated since v2.14.0: use 'icon' instead"),i.icon=i.data.iconClass)),!1!==(n=h.evalOption("icon",i,i,a,!0))&&(t=s?" role='presentation'":"",r=(r=h.evalOption("iconTooltip",i,i,a,null))?" title='"+A(r)+"'":"","string"==typeof n?c.test(n)?(n="/"===n.charAt(0)?n:(a.imagePath||"")+n,d.push("<img src='"+n+"' class='fancytree-icon'"+r+" alt='' />")):d.push("<span "+t+" class='fancytree-custom-icon "+n+"'"+r+"></span>"):n.text?d.push("<span "+t+" class='fancytree-custom-icon "+(n.addClass||"")+"'"+r+">"+h.escapeHtml(n.text)+"</span>"):n.html?d.push("<span "+t+" class='fancytree-custom-icon "+(n.addClass||"")+"'"+r+">"+n.html+"</span>"):d.push("<span "+t+" class='fancytree-icon'"+r+"></span>")),t="",t=(t=a.renderTitle?a.renderTitle.call(o,{type:"renderTitle"},e)||"":t)||"<span class='fancytree-title'"+(r=(r=!0===(r=h.evalOption("tooltip",i,i,a,null))?i.title:r)?" title='"+A(r)+"'":"")+(a.titlesTabbable?" tabindex='0'":"")+">"+(a.escapeTitles?h.escapeHtml(i.title):i.title)+"</span>",d.push(t),i.span.innerHTML=d.join(""),this.nodeRenderStatus(e),a.enhanceTitle&&(e.$title=C(">span.fancytree-title",i.span),a.enhanceTitle.call(o,{type:"enhanceTitle"},e)))},nodeRenderStatus:function(e){var t,n=e.node,r=e.tree,i=e.options,o=n.hasChildren(),a=n.isLastSibling(),s=i.aria,l=i._classNames,d=[],e=n[r.statusClassPropName];e&&!1!==r._enableUpdate&&(s&&(t=C(n.tr||n.li)),d.push(l.node),r.activeNode===n&&d.push(l.active),r.focusNode===n&&d.push(l.focused),n.expanded&&d.push(l.expanded),s&&(!1===o?t.removeAttr("aria-expanded"):t.attr("aria-expanded",Boolean(n.expanded))),n.folder&&d.push(l.folder),!1!==o&&d.push(l.hasChildren),a&&d.push(l.lastsib),n.lazy&&null==n.children&&d.push(l.lazy),n.partload&&d.push(l.partload),n.partsel&&d.push(l.partsel),h.evalOption("unselectable",n,n,i,!1)&&d.push(l.unselectable),n._isLoading&&d.push(l.loading),n._error&&d.push(l.error),n.statusNodeType&&d.push(l.statusNodePrefix+n.statusNodeType),n.selected?(d.push(l.selected),s&&t.attr("aria-selected",!0)):s&&t.attr("aria-selected",!1),n.extraClasses&&d.push(n.extraClasses),!1===o?d.push(l.combinedExpanderPrefix+"n"+(a?"l":"")):d.push(l.combinedExpanderPrefix+(n.expanded?"e":"c")+(n.lazy&&null==n.children?"d":"")+(a?"l":"")),d.push(l.combinedIconPrefix+(n.expanded?"e":"c")+(n.folder?"f":"")),e.className=d.join(" "),n.li&&C(n.li).toggleClass(l.lastsib,a))},nodeSetActive:function(e,t,n){var r=e.node,i=e.tree,o=e.options,a=!0===(n=n||{}).noEvents,s=!0===n.noFocus,n=!1!==n.scrollIntoView;return r===i.activeNode===(t=!1!==t)?_(r):(n&&e.originalEvent&&C(e.originalEvent.target).is("a,:checkbox")&&(r.info("Not scrolling while clicking an embedded link."),n=!1),t&&!a&&!1===this._triggerNodeEvent("beforeActivate",r,e.originalEvent)?N(r,["rejected"]):(t?(i.activeNode&&(k(i.activeNode!==r,"node was active (inconsistency)"),t=C.extend({},e,{node:i.activeNode}),i.nodeSetActive(t,!1),k(null===i.activeNode,"deactivate was out of sync?")),o.activeVisible&&r.makeVisible({scrollIntoView:n}),i.activeNode=r,i.nodeRenderStatus(e),s||i.nodeSetFocus(e),a||i._triggerNodeEvent("activate",r,e.originalEvent)):(k(i.activeNode===r,"node was not active (inconsistency)"),i.activeNode=null,this.nodeRenderStatus(e),a||e.tree._triggerNodeEvent("deactivate",r,e.originalEvent)),_(r)))},nodeSetExpanded:function(r,i,e){var t,n,o,a,s,l,d=r.node,c=r.tree,u=r.options,h=!0===(e=e||{}).noAnimation,f=!0===e.noEvents;if(i=!1!==i,C(d.li).hasClass(u._classNames.animating))return d.warn("setExpanded("+i+") while animating: ignored."),N(d,["recursion"]);if(d.expanded&&i||!d.expanded&&!i)return _(d);if(i&&!d.lazy&&!d.hasChildren())return _(d);if(!i&&d.getLevel()<u.minExpandLevel)return N(d,["locked"]);if(!f&&!1===this._triggerNodeEvent("beforeExpand",d,r.originalEvent))return N(d,["rejected"]);if(h||d.isVisible()||(h=e.noAnimation=!0),n=new C.Deferred,i&&!d.expanded&&u.autoCollapse){s=d.getParentList(!1,!0),l=u.autoCollapse;try{for(u.autoCollapse=!1,o=0,a=s.length;o<a;o++)this._callHook("nodeCollapseSiblings",s[o],e)}finally{u.autoCollapse=l}}return n.done(function(){var e=d.getLastChild();i&&u.autoScroll&&!h&&e&&c._enableUpdate?e.scrollIntoView(!0,{topNode:d}).always(function(){f||r.tree._triggerNodeEvent(i?"expand":"collapse",r)}):f||r.tree._triggerNodeEvent(i?"expand":"collapse",r)}),t=function(e){var t=u._classNames,n=u.toggleEffect;if(d.expanded=i,c._callHook("treeStructureChanged",r,i?"expand":"collapse"),c._callHook("nodeRender",r,!1,!1,!0),d.ul)if("none"!==d.ul.style.display==!!d.expanded)d.warn("nodeSetExpanded: UL.style.display already set");else{if(n&&!h)return C(d.li).addClass(t.animating),void(C.isFunction(C(d.ul)[n.effect])?C(d.ul)[n.effect]({duration:n.duration,always:function(){C(this).removeClass(t.animating),C(d.li).removeClass(t.animating),e()}}):(C(d.ul).stop(!0,!0),C(d.ul).parent().find(".ui-effects-placeholder").remove(),C(d.ul).toggle(n.effect,n.options,n.duration,function(){C(this).removeClass(t.animating),C(d.li).removeClass(t.animating),e()})));d.ul.style.display=d.expanded||!parent?"":"none"}e()},i&&d.lazy&&void 0===d.hasChildren()?d.load().done(function(){n.notifyWith&&n.notifyWith(d,["loaded"]),t(function(){n.resolveWith(d)})}).fail(function(e){t(function(){n.rejectWith(d,["load failed ("+e+")"])})}):t(function(){n.resolveWith(d)}),n.promise()},nodeSetFocus:function(e,t){var n,r=e.tree,i=e.node,o=r.options,a=!!e.originalEvent&&C(e.originalEvent.target).is(":input");if(t=!1!==t,r.focusNode){if(r.focusNode===i&&t)return;n=C.extend({},e,{node:r.focusNode}),r.focusNode=null,this._triggerNodeEvent("blur",n),this._callHook("nodeRenderStatus",n)}t&&(this.hasFocus()||(i.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",e,!0,{calledByNode:!0})),i.makeVisible({scrollIntoView:!1}),r.focusNode=i,o.titlesTabbable&&(a||C(i.span).find(".fancytree-title").focus()),o.aria&&C(r.$container).attr("aria-activedescendant",C(i.tr||i.li).uniqueId().attr("id")),this._triggerNodeEvent("focus",e),document.activeElement===r.$container.get(0)||1<=C(document.activeElement,r.$container).length||C(r.$container).focus(),o.autoScroll&&i.scrollIntoView(),this._callHook("nodeRenderStatus",e))},nodeSetSelected:function(e,t,n){var r=e.node,i=e.tree,o=e.options,a=!0===(n=n||{}).noEvents,s=r.parent;if(t=!1!==t,!h.evalOption("unselectable",r,r,o,!1))return r._lastSelectIntent=t,!!r.selected!==t||3===o.selectMode&&r.partsel&&!t?a||!1!==this._triggerNodeEvent("beforeSelect",r,e.originalEvent)?(t&&1===o.selectMode?(i.lastSelectedNode&&i.lastSelectedNode.setSelected(!1),r.selected=t):3!==o.selectMode||!s||s.radiogroup||r.radiogroup?s&&s.radiogroup?r.visitSiblings(function(e){e._changeSelectStatusAttrs(t&&e===r)},!0):r.selected=t:(r.selected=t,r.fixSelection3AfterClick(n)),this.nodeRenderStatus(e),i.lastSelectedNode=t?r:null,void(a||i._triggerNodeEvent("select",e))):!!r.selected:t},nodeSetStatus:function(r,e,t,n){var i=r.node,o=r.tree;function a(e,t){var n=i.children?i.children[0]:null;return n&&n.isStatusNode()?(C.extend(n,e),n.statusNodeType=t,o._callHook("nodeRenderTitle",n)):(i._setChildren([e]),o._callHook("treeStructureChanged",r,"setStatusNode"),i.children[0].statusNodeType=t,o.render()),i.children[0]}switch(e){case"ok":!function(){var e=i.children?i.children[0]:null;if(e&&e.isStatusNode()){try{i.ul&&(i.ul.removeChild(e.li),e.li=null)}catch(e){}1===i.children.length?i.children=[]:i.children.shift(),o._callHook("treeStructureChanged",r,"clearStatusNode")}}(),i._isLoading=!1,i._error=null,i.renderStatus();break;case"loading":i.parent||a({title:o.options.strings.loading+(t?" ("+t+")":""),checkbox:!1,tooltip:n},e),i._isLoading=!0,i._error=null,i.renderStatus();break;case"error":a({title:o.options.strings.loadError+(t?" ("+t+")":""),checkbox:!1,tooltip:n},e),i._isLoading=!1,i._error={message:t,details:n},i.renderStatus();break;case"nodata":a({title:t||o.options.strings.noData,checkbox:!1,tooltip:n},e),i._isLoading=!1,i._error=null,i.renderStatus();break;default:C.error("invalid node status "+e)}},nodeToggleExpanded:function(e){return this.nodeSetExpanded(e,!e.node.expanded)},nodeToggleSelected:function(e){var t=e.node,n=!t.selected;return t.partsel&&!t.selected&&!0===t._lastSelectIntent&&(t.selected=!(n=!1)),t._lastSelectIntent=n,this.nodeSetSelected(e,n)},treeClear:function(e){var t=e.tree;t.activeNode=null,t.focusNode=null,t.$div.find(">ul.fancytree-container").empty(),t.rootNode.children=null,t._callHook("treeStructureChanged",e,"clear")},treeCreate:function(e){},treeDestroy:function(e){this.$div.find(">ul.fancytree-container").remove(),this.$source&&this.$source.removeClass("fancytree-helper-hidden")},treeInit:function(e){var n=e.tree,r=n.options;n.$container.attr("tabindex",r.tabindex),C.each(m,function(e,t){void 0!==r[t]&&(n.info("Move option "+t+" to tree"),n[t]=r[t],delete r[t])}),r.checkboxAutoHide&&n.$container.addClass("fancytree-checkbox-auto-hide"),r.rtl?n.$container.attr("DIR","RTL").addClass("fancytree-rtl"):n.$container.removeAttr("DIR").removeClass("fancytree-rtl"),r.aria&&(n.$container.attr("role","tree"),1!==r.selectMode&&n.$container.attr("aria-multiselectable",!0)),this.treeLoad(e)},treeLoad:function(e,t){var n,r,i,o=e.tree,a=e.widget.element,s=C.extend({},e,{node:this.rootNode});if(o.rootNode.children&&this.treeClear(e),t=t||this.options.source)"string"==typeof t&&C.error("Not implemented");else switch(r=a.data("type")||"html"){case"html":(i=a.find(">ul").not(".fancytree-container").first()).length?(i.addClass("ui-fancytree-source fancytree-helper-hidden"),t=C.ui.fancytree.parseHtml(i),this.data=C.extend(this.data,E(i))):(h.warn("No `source` option was passed and container does not contain `<ul>`: assuming `source: []`."),t=[]);break;case"json":t=C.parseJSON(a.text()),a.contents().filter(function(){return 3===this.nodeType}).remove(),C.isPlainObject(t)&&(k(C.isArray(t.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),t=(n=t).children,delete n.children,C.each(m,function(e,t){void 0!==n[t]&&(o[t]=n[t],delete n[t])}),C.extend(o.data,n));break;default:C.error("Invalid data-type: "+r)}return o._triggerTreeEvent("preInit",null),this.nodeLoadChildren(s,t).done(function(){o._callHook("treeStructureChanged",e,"loadChildren"),o.render(),3===e.options.selectMode&&o.rootNode.fixSelection3FromEndNodes(),o.activeNode&&o.options.activeVisible&&o.activeNode.makeVisible(),o._triggerTreeEvent("init",null,{status:!0})}).fail(function(){o.render(),o._triggerTreeEvent("init",null,{status:!1})})},treeRegisterNode:function(e,t,n){e.tree._callHook("treeStructureChanged",e,t?"addNode":"removeNode")},treeSetFocus:function(e,t,n){var r;(t=!1!==t)!==this.hasFocus()&&(!(this._hasFocus=t)&&this.focusNode?this.focusNode.setFocus(!1):!t||n&&n.calledByNode||C(this.$container).focus(),this.$container.toggleClass("fancytree-treefocus",t),this._triggerTreeEvent(t?"focusTree":"blurTree"),t&&!this.activeNode&&(r=this._lastMousedownNode||this.getFirstChild())&&r.setFocus())},treeSetOption:function(e,t,n){var r=e.tree,i=!0,o=!1,a=!1;switch(t){case"aria":case"checkbox":case"icon":case"minExpandLevel":case"tabindex":a=o=!0;break;case"checkboxAutoHide":r.$container.toggleClass("fancytree-checkbox-auto-hide",!!n);break;case"escapeTitles":case"tooltip":a=!0;break;case"rtl":!1===n?r.$container.removeAttr("DIR").removeClass("fancytree-rtl"):r.$container.attr("DIR","RTL").addClass("fancytree-rtl"),a=!0;break;case"source":i=!1,r._callHook("treeLoad",r,n),a=!0}r.debug("set option "+t+"="+n+" <"+typeof n+">"),i&&(this.widget._super||C.Widget.prototype._setOption).call(this.widget,t,n),o&&r._callHook("treeCreate",r),a&&r.render(!0,!1)},treeStructureChanged:function(e,t){}}),C.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!0,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,copyFunctionsToData:!1,debugLevel:null,disabled:!1,enableAspx:42,escapeTitles:!1,extensions:[],focusOnSelect:!1,generateIds:!1,icon:!0,idPrefix:"ft_",keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,nodata:!0,quicksearch:!1,rtl:!1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading...",loadError:"Load error!",moreData:"More...",noData:"No data."},tabindex:"0",titlesTabbable:!1,toggleEffect:{effect:"slideToggle",duration:200},tooltip:!1,treeId:null,_classNames:{active:"fancytree-active",animating:"fancytree-animating",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",error:"fancytree-error",expanded:"fancytree-expanded",focused:"fancytree-focused",folder:"fancytree-folder",hasChildren:"fancytree-has-children",lastsib:"fancytree-lastsib",lazy:"fancytree-lazy",loading:"fancytree-loading",node:"fancytree-node",partload:"fancytree-partload",partsel:"fancytree-partsel",radio:"fancytree-radio",selected:"fancytree-selected",statusNodePrefix:"fancytree-statusnode-",unselectable:"fancytree-unselectable"},lazyLoad:null,postProcess:null},_deprecationWarning:function(e){var t=this.tree;t&&3<=t.options.debugLevel&&t.warn("$().fancytree('"+e+"') is deprecated (see https://wwwendt.de/tech/fancytree/doc/jsdoc/Fancytree_Widget.html")},_create:function(){this.tree=new O(this),this.$source=this.source||"json"===this.element.data("type")?this.element:this.element.find(">ul").first();for(var e,t,n=this.options,r=n.extensions,i=(this.tree,0);i<r.length;i++)t=r[i],(e=C.ui.fancytree._extensions[t])||C.error("Could not apply extension '"+t+"' (it is not registered, did you forget to include it?)"),this.tree.options[t]=function e(t){var n,r,i,o,a=t||{},s=1,l=arguments.length;if("object"==typeof a||C.isFunction(a)||(a={}),s===l)throw Error("need at least two args");for(;s<l;s++)if(null!=(n=arguments[s]))for(r in n)n.hasOwnProperty(r)&&(o=a[r],a!==(i=n[r])&&(i&&C.isPlainObject(i)?(o=o&&C.isPlainObject(o)?o:{},a[r]=e(o,i)):void 0!==i&&(a[r]=i)));return a}({},e.options,this.tree.options[t]),k(void 0===this.tree.ext[t],"Extension name must not exist as Fancytree.ext attribute: '"+t+"'"),this.tree.ext[t]={},function(e,t,n){for(var r in t)"function"==typeof t[r]?"function"==typeof e[r]?e[r]=w(r,e,0,t,n):"_"===r.charAt(0)?e.ext[n][r]=w(r,e,0,t,n):C.error("Could not override tree."+r+". Use prefix '_' to create tree."+n+"._"+r):"options"!==r&&(e.ext[n][r]=t[r])}(this.tree,e,t),0;void 0!==n.icons&&(!0===n.icon?(this.tree.warn("'icons' tree option is deprecated since v2.14.0: use 'icon' instead"),n.icon=n.icons):C.error("'icons' tree option is deprecated since v2.14.0: use 'icon' only instead")),void 0!==n.iconClass&&(n.icon?C.error("'iconClass' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'iconClass' tree option is deprecated since v2.14.0: use 'icon' instead"),n.icon=n.iconClass)),void 0!==n.tabbable&&(n.tabindex=n.tabbable?"0":"-1",this.tree.warn("'tabbable' tree option is deprecated since v2.17.0: use 'tabindex='"+n.tabindex+"' instead")),this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree),this._bind()},_setOption:function(e,t){return this.tree._callHook("treeSetOption",this.tree,e,t)},_destroy:function(){this._unbind(),this.tree._callHook("treeDestroy",this.tree)},_unbind:function(){var e=this.tree._ns;this.element.off(e),this.tree.$container.off(e),C(document).off(e)},_bind:function(){var a=this,s=this.options,o=this.tree,e=o._ns;this._unbind(),o.$container.on("focusin"+e+" focusout"+e,function(e){var t=h.getNode(e),n="focusin"===e.type;if(!n&&t&&C(e.target).is("a"))t.debug("Ignored focusout on embedded <a> element.");else{if(n){if(o._getExpiringValue("focusin"))return void o.debug("Ignored double focusin.");o._setExpiringValue("focusin",!0,50),t||(t=o._getExpiringValue("mouseDownNode"))&&o.debug("Reconstruct mouse target for focusin from recent event.")}t?o._callHook("nodeSetFocus",o._makeHookContext(t,e),n):o.tbody&&C(e.target).parents("table.fancytree-container > thead").length?o.debug("Ignore focus event outside table body.",e):o._callHook("treeSetFocus",o,n)}}).on("selectstart"+e,"span.fancytree-title",function(e){e.preventDefault()}).on("keydown"+e,function(e){if(s.disabled||!1===s.keyboard)return!0;var t,n=o.focusNode,r=o._makeHookContext(n||o,e),i=o.phase;try{return o.phase="userEvent","preventNav"===(t=n?o._triggerNodeEvent("keydown",n,e):o._triggerTreeEvent("keydown",e))?t=!0:!1!==t&&(t=o._callHook("nodeKeydown",r)),t}finally{o.phase=i}}).on("mousedown"+e,function(e){e=h.getEventTarget(e);o._lastMousedownNode=e?e.node:null,o._setExpiringValue("mouseDownNode",o._lastMousedownNode)}).on("click"+e+" dblclick"+e,function(e){if(s.disabled)return!0;var t,n=h.getEventTarget(e),r=n.node,i=a.tree,o=i.phase;if(!r)return!0;t=i._makeHookContext(r,e);try{switch(i.phase="userEvent",e.type){case"click":return t.targetType=n.type,r.isPagingNode()?!0===i._triggerNodeEvent("clickPaging",t,e):!1!==i._triggerNodeEvent("click",t,e)&&i._callHook("nodeClick",t);case"dblclick":return t.targetType=n.type,!1!==i._triggerNodeEvent("dblclick",t,e)&&i._callHook("nodeDblclick",t)}}finally{i.phase=o}})},getActiveNode:function(){return this._deprecationWarning("getActiveNode"),this.tree.activeNode},getNodeByKey:function(e){return this._deprecationWarning("getNodeByKey"),this.tree.getNodeByKey(e)},getRootNode:function(){return this._deprecationWarning("getRootNode"),this.tree.rootNode},getTree:function(){return this._deprecationWarning("getTree"),this.tree}}),h=C.ui.fancytree,C.extend(C.ui.fancytree,{version:"2.38.0",buildType:"production",debugLevel:3,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:O,_FancytreeNodeClass:D,jquerySupports:{positionMyOfs:function(e){for(var t,n,r=C.map(C.trim(e).split("."),function(e){return parseInt(e,10)}),i=C.map(Array.prototype.slice.call(arguments,1),function(e){return parseInt(e,10)}),o=0;o<i.length;o++)if((t=r[o]||0)!==(n=i[o]||0))return n<t;return!0}(C.ui.version,1,9)},assert:k,createTree:function(e,t){t=C(e).fancytree(t);return h.getTree(t)},debounce:function(t,n,r,i){var o;return 3===arguments.length&&"boolean"!=typeof r&&(i=r,r=!1),function(){var e=arguments;i=i||this,r&&!o&&n.apply(i,e),clearTimeout(o),o=setTimeout(function(){r||n.apply(i,e),o=null},t)}},debug:function(e){4<=C.ui.fancytree.debugLevel&&d("log",arguments)},error:function(e){1<=C.ui.fancytree.debugLevel&&d("error",arguments)},escapeHtml:function(e){return(""+e).replace(t,function(e){return r[e]})},fixPositionOptions:function(e){var t,n,r,i;return(e.offset||0<=(""+e.my+e.at).indexOf("%"))&&C.error("expected new position syntax (but '%' is not supported)"),C.ui.fancytree.jquerySupports.positionMyOfs||(t=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(e.my),n=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(e.at),r=(t[2]?+t[2]:0)+(n[2]?+n[2]:0),i=(t[4]?+t[4]:0)+(n[4]?+n[4]:0),e=C.extend({},e,{my:t[1]+" "+t[3],at:n[1]+" "+n[3]}),(r||i)&&(e.offset=r+" "+i)),e},getEventTarget:function(e){var t=e&&e.target?e.target.className:"",n={node:this.getNode(e.target),type:void 0};return/\bfancytree-title\b/.test(t)?n.type="title":/\bfancytree-expander\b/.test(t)?n.type=!1===n.node.hasChildren()?"prefix":"expander":/\bfancytree-checkbox\b/.test(t)?n.type="checkbox":/\bfancytree(-custom)?-icon\b/.test(t)?n.type="icon":/\bfancytree-node\b/.test(t)?n.type="title":e&&e.target&&((e=C(e.target)).is("ul[role=group]")?((n.node&&n.node.tree||h).debug("Ignoring click on outer UL."),n.node=null):e.closest(".fancytree-title").length?n.type="title":e.closest(".fancytree-checkbox").length?n.type="checkbox":e.closest(".fancytree-expander").length&&(n.type="expander")),n},getEventTargetType:function(e){return this.getEventTarget(e).type},getNode:function(e){if(e instanceof D)return e;for(e instanceof C?e=e[0]:void 0!==e.originalEvent&&(e=e.target);e;){if(e.ftnode)return e.ftnode;e=e.parentNode}return null},getTree:function(e){var t=e;return e instanceof O?e:("number"==typeof(e=void 0===e?0:e)?e=C(".fancytree-container").eq(e):"string"==typeof e?(e=C("#ft-id-"+t).eq(0)).length||(e=C(t).eq(0)):e instanceof Element||e instanceof HTMLDocument?e=C(e):e instanceof C?e=e.eq(0):void 0!==e.originalEvent&&(e=C(e.target)),(e=(e=e.closest(":ui-fancytree")).data("ui-fancytree")||e.data("fancytree"))?e.tree:null)},evalOption:function(e,t,n,r,i){var o,a=t.tree,r=r[e],n=n[e];return C.isFunction(r)?(o={node:t,tree:a,widget:a.widget,options:a.widget.options,typeInfo:a.types[t.type]||{}},null==(o=r.call(a,{type:e},o))&&(o=n)):o=null==n?r:n,o=null==o?i:o},setSpanIcon:function(e,t,n){var r=C(e);"string"==typeof n?r.attr("class",t+" "+n):(n.text?r.text(""+n.text):n.html&&(e.innerHTML=n.html),r.attr("class",t+" "+(n.addClass||"")))},eventToString:function(e){var t=e.which,n=e.type,r=[];return e.altKey&&r.push("alt"),e.ctrlKey&&r.push("ctrl"),e.metaKey&&r.push("meta"),e.shiftKey&&r.push("shift"),"click"===n||"dblclick"===n?r.push(o[e.button]+n):"wheel"===n?r.push(n):i[t]||r.push(u[t]||String.fromCharCode(t).toLowerCase()),r.join("+")},info:function(e){3<=C.ui.fancytree.debugLevel&&d("info",arguments)},keyEventToString:function(e){return this.warn("keyEventToString() is deprecated: use eventToString()"),this.eventToString(e)},overrideMethod:function(e,t,n,r){var i,o=e[t]||C.noop;e[t]=function(){var e=r||this;try{return i=e._super,e._super=o,n.apply(e,arguments)}finally{e._super=i}}},parseHtml:function(a){var s,l,d,c,u,h,f,p,e=a.find(">li"),g=[];return e.each(function(){var e,t,n=C(this),r=n.find(">span",this).first(),i=r.length?null:n.find(">a").first(),o={tooltip:null,data:{}};for(r.length?o.title=r.html():i&&i.length?(o.title=i.html(),o.data.href=i.attr("href"),o.data.target=i.attr("target"),o.tooltip=i.attr("title")):(o.title=n.html(),0<=(u=o.title.search(/<ul/i))&&(o.title=o.title.substring(0,u))),o.title=C.trim(o.title),c=0,h=y.length;c<h;c++)o[y[c]]=void 0;for(s=this.className.split(" "),d=[],c=0,h=s.length;c<h;c++)l=s[c],v[l]?o[l]=!0:d.push(l);if(o.extraClasses=d.join(" "),(f=n.attr("title"))&&(o.tooltip=f),(f=n.attr("id"))&&(o.key=f),n.attr("hideCheckbox")&&(o.checkbox=!1),(e=E(n))&&!C.isEmptyObject(e)){for(t in x)e.hasOwnProperty(t)&&(e[x[t]]=e[t],delete e[t]);for(c=0,h=b.length;c<h;c++)f=b[c],null!=(p=e[f])&&(delete e[f],o[f]=p);C.extend(o.data,e)}(a=n.find(">ul").first()).length?o.children=C.ui.fancytree.parseHtml(a):o.children=o.lazy?void 0:null,g.push(o)}),g},registerExtension:function(e){k(null!=e.name,"extensions must have a `name` property."),k(null!=e.version,"extensions must have a `version` property."),C.ui.fancytree._extensions[e.name]=e},unescapeHtml:function(e){var t=document.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue},warn:function(e){2<=C.ui.fancytree.debugLevel&&d("warn",arguments)}}),C.ui.fancytree}function k(e,t){e||(C.ui.fancytree.error(t="Fancytree assertion failed"+(t=t?": "+t:"")),C.error(t))}function d(t,n){var r,i,t=window.console?window.console[t]:null;if(t)try{t.apply(window.console,n)}catch(e){for(i="",r=0;r<n.length;r++)i+=n[r];t(i)}}function w(e,r,t,n,i){var o,a,s;function l(){return o.apply(r,arguments)}function d(e){return o.apply(r,e)}return o=r[e],a=n[e],s=r.ext[i],function(){var e=r._local,t=r._super,n=r._superApply;try{return r._local=s,r._super=l,r._superApply=d,a.apply(r,arguments)}finally{r._local=e,r._super=t,r._superApply=n}}}function _(e,t){return(void 0===e?C.Deferred(function(){this.resolve()}):C.Deferred(function(){this.resolveWith(e,t)})).promise()}function N(e,t){return(void 0===e?C.Deferred(function(){this.reject()}):C.Deferred(function(){this.rejectWith(e,t)})).promise()}function S(e,t){return function(){e.resolveWith(t)}}function E(e){var t=C.extend({},e.data()),e=t.json;return delete t.fancytree,delete t.uiFancytree,e&&(delete t.json,t=C.extend(t,e)),t}function A(e){return(""+e).replace(n,function(e){return r[e]})}function T(t){return t=t.toLowerCase(),function(e){return 0<=e.title.toLowerCase().indexOf(t)}}function D(e,t){var n,r,i;for(this.parent=e,this.tree=e.tree,this.ul=null,this.li=null,this.statusNodeType=null,this._isLoading=!1,this._error=null,this.data={},n=0,r=b.length;n<r;n++)this[i=b[n]]=t[i];for(i in null==this.unselectableIgnore&&null==this.unselectableStatus||(this.unselectable=!0),t.hideCheckbox&&C.error("'hideCheckbox' node option was removed in v2.23.0: use 'checkbox: false'"),t.data&&C.extend(this.data,t.data),t)a[i]||!this.tree.options.copyFunctionsToData&&C.isFunction(t[i])||s[i]||(this.data[i]=t[i]);null==this.key?this.tree.options.defaultKey?(this.key=""+this.tree.options.defaultKey(this),k(this.key,"defaultKey() must return a unique key")):this.key="_"+h._nextNodeKey++:this.key=""+this.key,t.active&&(k(null===this.tree.activeNode,"only one active node allowed"),this.tree.activeNode=this),t.selected&&(this.tree.lastSelectedNode=this),(e=t.children)?e.length?this._setChildren(e):this.children=this.lazy?[]:null:this.children=null,this.tree._callHook("treeRegisterNode",this.tree,!0,this)}function O(e){this.widget=e,this.$div=e.element,this.options=e.options,this.options&&(void 0!==this.options.lazyload&&C.error("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead."),void 0!==this.options.loaderror&&C.error("The 'loaderror' event was renamed since 2014-07-03. Use 'loadError' (with uppercase E) instead."),void 0!==this.options.fx&&C.error("The 'fx' option was replaced by 'toggleEffect' since 2014-11-30."),void 0!==this.options.removeNode&&C.error("The 'removeNode' event was replaced by 'modifyChild' since 2.20 (2016-09-10).")),this.ext={},this.types={},this.columns={},this.data=E(this.$div),this._id=""+(this.options.treeId||C.ui.fancytree._nextId++),this._ns=".fancytree-"+this._id,this.activeNode=null,this.focusNode=null,this._hasFocus=null,this._tempCache={},this._lastMousedownNode=null,this._enableUpdate=!0,this.lastSelectedNode=null,this.systemFocusElement=null,this.lastQuicksearchTerm="",this.lastQuicksearchTime=0,this.viewport=null,this.statusClassPropName="span",this.ariaPropName="li",this.nodeContainerAttrName="li",this.$div.find(">ul.fancytree-container").remove(),this.rootNode=new D({tree:this},{title:"root",key:"root_"+this._id,children:null,expanded:!0}),this.rootNode.parent=null,e=C("<ul>",{id:"ft-id-"+this._id,class:"ui-fancytree fancytree-container fancytree-plain"}).appendTo(this.$div),this.$container=e,this.rootNode.ul=e[0],null==this.options.debugLevel&&(this.options.debugLevel=h.debugLevel)}C.ui.fancytree.warn("Fancytree: ignored duplicate include")}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(o){"use strict";return o.ui.fancytree._FancytreeClass.prototype.countSelected=function(e){this.options;return this.getSelectedNodes(e).length},o.ui.fancytree._FancytreeNodeClass.prototype.updateCounters=function(){var e=this,t=o("span.fancytree-childcounter",e.span),n=e.tree.options.childcounter,r=e.countChildren(n.deep);!(e.data.childCounter=r)&&n.hideZeros||e.isExpanded()&&n.hideExpanded?t.remove():(t=!t.length?o("<span class='fancytree-childcounter'/>").appendTo(o("span.fancytree-icon,span.fancytree-custom-icon",e.span)):t).text(r),!n.deep||e.isTopLevel()||e.isRootNode()||e.parent.updateCounters()},o.ui.fancytree.prototype.widgetMethod1=function(e){this.tree;return e},o.ui.fancytree.registerExtension({name:"childcounter",version:"2.38.0",options:{deep:!0,hideZeros:!0,hideExpanded:!1},foo:42,_appendCounter:function(e){},treeInit:function(e){e.options,e.options.childcounter;this._superApply(arguments),this.$container.addClass("fancytree-ext-childcounter")},treeDestroy:function(e){this._superApply(arguments)},nodeRenderTitle:function(e,t){var n=e.node,r=e.options.childcounter,i=null==n.data.childCounter?n.countChildren(r.deep):+n.data.childCounter;this._super(e,t),!i&&r.hideZeros||n.isExpanded()&&r.hideExpanded||o("span.fancytree-icon,span.fancytree-custom-icon",n.span).append(o("<span class='fancytree-childcounter'/>").text(i))},nodeSetExpanded:function(e,t,n){var r=e.tree;e.node;return this._superApply(arguments).always(function(){r.nodeRenderTitle(e)})}}),o.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(c){"use strict";var u=c.ui.fancytree.assert;function n(e,t,n){for(var r,i,o=3&e.length,a=e.length-o,s=n,l=3432918353,d=461845907,c=0;c<a;)i=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,s=27492+(65535&(r=5*(65535&(s=(s^=i=(65535&(i=(i=(65535&i)*l+(((i>>>16)*l&65535)<<16)&4294967295)<<15|i>>>17))*d+(((i>>>16)*d&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(r>>>16)&65535)<<16);switch(i=0,o){case 3:i^=(255&e.charCodeAt(c+2))<<16;case 2:i^=(255&e.charCodeAt(c+1))<<8;case 1:s^=i=(65535&(i=(i=(65535&(i^=255&e.charCodeAt(c)))*l+(((i>>>16)*l&65535)<<16)&4294967295)<<15|i>>>17))*d+(((i>>>16)*d&65535)<<16)&4294967295}return s^=e.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,s^=s>>>16,t?("0000000"+(s>>>0).toString(16)).substr(-8):s>>>0}return c.ui.fancytree._FancytreeNodeClass.prototype.getCloneList=function(e){var t,n=this.tree,r=n.refMap[this.refKey]||null,i=n.keyMap;return r&&(t=this.key,e?r=c.map(r,function(e){return i[e]}):(r=c.map(r,function(e){return e===t?null:i[e]})).length<1&&(r=null)),r},c.ui.fancytree._FancytreeNodeClass.prototype.isClone=function(){var e=this.refKey||null,e=e&&this.tree.refMap[e]||null;return!!(e&&1<e.length)},c.ui.fancytree._FancytreeNodeClass.prototype.reRegister=function(t,e){t=null==t?null:""+t,e=null==e?null:""+e;var n=this.tree,r=this.key,i=this.refKey,o=n.keyMap,a=n.refMap,s=a[i]||null,n=!1;return null!=t&&t!==this.key&&(o[t]&&c.error("[ext-clones] reRegister("+t+"): already exists: "+this),delete o[r],o[t]=this,s&&(a[i]=c.map(s,function(e){return e===r?t:e})),this.key=t,n=!0),null!=e&&e!==this.refKey&&(s&&(1===s.length?delete a[i]:a[i]=c.map(s,function(e){return e===r?null:e})),a[e]?a[e].append(t):a[e]=[this.key],this.refKey=e,n=!0),n},c.ui.fancytree._FancytreeNodeClass.prototype.setRefKey=function(e){return this.reRegister(null,e)},c.ui.fancytree._FancytreeClass.prototype.getNodesByRef=function(e,t){var n=this.keyMap,e=this.refMap[e]||null;return e=e&&(e=t?c.map(e,function(e){e=n[e];return e.isDescendantOf(t)?e:null}):c.map(e,function(e){return n[e]})).length<1?null:e},c.ui.fancytree._FancytreeClass.prototype.changeRefKey=function(e,t){var n,r=this.keyMap,i=this.refMap[e]||null;if(i){for(n=0;n<i.length;n++)r[i[n]].refKey=t;delete this.refMap[e],this.refMap[t]=i}},c.ui.fancytree.registerExtension({name:"clones",version:"2.38.0",options:{highlightActiveClones:!0,highlightClones:!1},treeCreate:function(e){this._superApply(arguments),e.tree.refMap={},e.tree.keyMap={}},treeInit:function(e){this.$container.addClass("fancytree-ext-clones"),u(null==e.options.defaultKey),e.options.defaultKey=function(e){return t=e,"id_"+(t=n(e=(e=c.map(e.getParentList(!1,!0),function(e){return e.refKey||e.key})).join("/"),!0))+n(t+e,!0);var t},this._superApply(arguments)},treeClear:function(e){return e.tree.refMap={},e.tree.keyMap={},this._superApply(arguments)},treeRegisterNode:function(e,t,n){var r,i,o=e.tree,a=o.keyMap,s=o.refMap,l=n.key,d=n&&null!=n.refKey?""+n.refKey:null;return n.isStatusNode()||(t?(null!=a[n.key]&&(i=a[n.key],i="clones.treeRegisterNode: duplicate key '"+n.key+"': /"+n.getPath(!0)+" => "+i.getPath(!0),o.error(i),c.error(i)),a[l]=n,d&&((r=s[d])?(r.push(l),2===r.length&&e.options.clones.highlightClones&&a[r[0]].renderStatus()):s[d]=[l])):(null==a[l]&&c.error("clones.treeRegisterNode: node.key not registered: "+n.key),delete a[l],d&&(r=s[d])&&((i=r.length)<=1?(u(1===i),u(r[0]===l),delete s[d]):(function(e,t){for(var n=e.length-1;0<=n;n--)if(e[n]===t)return e.splice(n,1)}(r,l),2===i&&e.options.clones.highlightClones&&a[r[0]].renderStatus())))),this._super(e,t,n)},nodeRenderStatus:function(e){var t,n=e.node,r=this._super(e);return e.options.clones.highlightClones&&(t=c(n[e.tree.statusClassPropName])).length&&n.isClone()&&t.addClass("fancytree-clone"),r},nodeSetActive:function(e,n,t){var r=e.tree.statusClassPropName,i=e.node,o=this._superApply(arguments);return e.options.clones.highlightActiveClones&&i.isClone()&&c.each(i.getCloneList(!0),function(e,t){c(t[r]).toggleClass("fancytree-active-clone",!1!==n)}),o}}),c.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","jquery-ui/ui/widgets/draggable","jquery-ui/ui/widgets/droppable","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(g){"use strict";var n=!1,u="fancytree-drop-accept",h="fancytree-drop-after",f="fancytree-drop-before",p="fancytree-drop-reject";function y(e){return 0===e?"":0<e?"+"+e:""+e}function t(e){var t=e.options.dnd||null,i=e.options.glyph||null;t&&(n||(g.ui.plugin.add("draggable","connectToFancytree",{start:function(e,t){var n=g(this).data("ui-draggable")||g(this).data("draggable"),r=t.helper.data("ftSourceNode")||null;if(r)return n.offset.click.top=-2,n.offset.click.left=16,r.tree.ext.dnd._onDragEvent("start",r,null,e,t,n)},drag:function(e,t){var n,r=g(this).data("ui-draggable")||g(this).data("draggable"),i=t.helper.data("ftSourceNode")||null,o=t.helper.data("ftTargetNode")||null,a=g.ui.fancytree.getNode(e.target),s=i&&i.tree.options.dnd;e.target&&!a&&0<g(e.target).closest("div.fancytree-drag-helper,#fancytree-drop-marker").length?(i||o||g.ui.fancytree).debug("Drag event over helper: ignored."):(t.helper.data("ftTargetNode",a),s&&s.updateHelper&&(n=i.tree._makeHookContext(i,e,{otherNode:a,ui:t,draggable:r,dropMarker:g("#fancytree-drop-marker")}),s.updateHelper.call(i.tree,i,n)),o&&o!==a&&o.tree.ext.dnd._onDragEvent("leave",o,i,e,t,r),a&&a.tree.options.dnd.dragDrop&&(a===o||a.tree.ext.dnd._onDragEvent("enter",a,i,e,t,r),a.tree.ext.dnd._onDragEvent("over",a,i,e,t,r)))},stop:function(e,t){var n=g(this).data("ui-draggable")||g(this).data("draggable"),r=t.helper.data("ftSourceNode")||null,i=t.helper.data("ftTargetNode")||null,o="mouseup"===e.type&&1===e.which;o||(r||i||g.ui.fancytree).debug("Drag was cancelled"),i&&(o&&i.tree.ext.dnd._onDragEvent("drop",i,r,e,t,n),i.tree.ext.dnd._onDragEvent("leave",i,r,e,t,n)),r&&r.tree.ext.dnd._onDragEvent("stop",r,null,e,t,n)}}),n=!0)),t&&t.dragStart&&e.widget.element.draggable(g.extend({addClasses:!1,appendTo:e.$container,containment:!1,delay:0,distance:4,revert:!1,scroll:!0,scrollSpeed:7,scrollSensitivity:10,connectToFancytree:!0,helper:function(e){var t,n,r=g.ui.fancytree.getNode(e.target);return r?(n=r.tree.options.dnd,t=g(r.span),(t=g("<div class='fancytree-drag-helper'><span class='fancytree-drag-helper-img' /></div>").css({zIndex:3,position:"relative"}).append(t.find("span.fancytree-title").clone())).data("ftSourceNode",r),i&&t.find(".fancytree-drag-helper-img").addClass(i.map._addClass+" "+i.map.dragHelper),n.initHelper&&n.initHelper.call(r.tree,r,{node:r,tree:r.tree,originalEvent:e,ui:{helper:t}}),t):"<div>ERROR?: helper requested but sourceNode not found</div>"},start:function(e,t){return!!t.helper.data("ftSourceNode")}},e.options.dnd.draggable)),t&&t.dragDrop&&e.widget.element.droppable(g.extend({addClasses:!1,tolerance:"intersect",greedy:!1},e.options.dnd.droppable))}return g.ui.fancytree.registerExtension({name:"dnd",version:"2.38.0",options:{autoExpandMS:1e3,draggable:null,droppable:null,focusOnClick:!1,preventVoidMoves:!0,preventRecursiveMoves:!0,smartRevert:!0,dropMarkerOffsetX:-24,dropMarkerInsertOffsetX:-16,dragStart:null,dragStop:null,initHelper:null,updateHelper:null,dragEnter:null,dragOver:null,dragExpand:null,dragDrop:null,dragLeave:null},treeInit:function(n){var e=n.tree;this._superApply(arguments),e.options.dnd.dragStart&&e.$container.on("mousedown",function(e){var t;n.options.dnd.focusOnClick&&((t=g.ui.fancytree.getNode(e))&&t.debug("Re-enable focus that was prevented by jQuery UI draggable."),setTimeout(function(){g(e.target).closest(":tabbable").focus()},10))}),t(e)},_setDndStatus:function(e,t,n,r,i){var o,a="center",s=this._local,l=this.options.dnd,d=this.options.glyph,c=e?g(e.span):null,e=g(t.span),t=e.find("span.fancytree-title");if(s.$dropMarker||(s.$dropMarker=g("<div id='fancytree-drop-marker'></div>").hide().css({"z-index":1e3}).prependTo(g(this.$div).parent()),d&&s.$dropMarker.addClass(d.map._addClass+" "+d.map.dropMarker)),"after"===r||"before"===r||"over"===r){switch(o=l.dropMarkerOffsetX||0,r){case"before":a="top",o+=l.dropMarkerInsertOffsetX||0;break;case"after":a="bottom",o+=l.dropMarkerInsertOffsetX||0}t={my:"left"+y(o)+" center",at:"left "+a,of:t},this.options.rtl&&(t.my="right"+y(-o)+" center",t.at="right "+a),s.$dropMarker.toggleClass(h,"after"===r).toggleClass("fancytree-drop-over","over"===r).toggleClass(f,"before"===r).toggleClass("fancytree-rtl",!!this.options.rtl).show().position(g.ui.fancytree.fixPositionOptions(t))}else s.$dropMarker.hide();c&&c.toggleClass(u,!0===i).toggleClass(p,!1===i),e.toggleClass("fancytree-drop-target","after"===r||"before"===r||"over"===r).toggleClass(h,"after"===r).toggleClass(f,"before"===r).toggleClass(u,!0===i).toggleClass(p,!1===i),n.toggleClass(u,!0===i).toggleClass(p,!1===i)},_onDragEvent:function(e,t,n,r,i,o){var a,s,l,d,c=this.options.dnd,u=this._makeHookContext(t,r,{otherNode:n,ui:i,draggable:o}),h=null,f=this,p=g(t.span);switch(c.smartRevert&&(o.options.revert="invalid"),e){case"start":t.isStatusNode()?h=!1:c.dragStart&&(h=c.dragStart(t,u)),!1===h?(this.debug("tree.dragStart() cancelled"),i.helper.trigger("mouseup").hide()):(c.smartRevert&&(a=t[u.tree.nodeContainerAttrName].getBoundingClientRect(),s=g(o.options.appendTo)[0].getBoundingClientRect(),o.originalPosition.left=Math.max(0,a.left-s.left),o.originalPosition.top=Math.max(0,a.top-s.top)),p.addClass("fancytree-drag-source"),g(document).on("keydown.fancytree-dnd,mousedown.fancytree-dnd",function(e){("keydown"===e.type&&e.which===g.ui.keyCode.ESCAPE||"mousedown"===e.type)&&f.ext.dnd._cancelDrag()}));break;case"enter":h=!!(d=(!c.preventRecursiveMoves||!t.isDescendantOf(n))&&(c.dragEnter?c.dragEnter(t,u):null))&&(g.isArray(d)?{over:0<=g.inArray("over",d),before:0<=g.inArray("before",d),after:0<=g.inArray("after",d)}:{over:!0===d||"over"===d,before:!0===d||"before"===d,after:!0===d||"after"===d}),i.helper.data("enterResponse",h);break;case"over":l=null,!1===(s=i.helper.data("enterResponse"))||("string"==typeof s?l=s:(d=p.offset(),d={x:(d={x:r.pageX-d.left,y:r.pageY-d.top}).x/p.width(),y:d.y/p.height()},s.after&&.75<d.y||!s.over&&s.after&&.5<d.y?l="after":s.before&&d.y<=.25||!s.over&&s.before&&d.y<=.5?l="before":s.over&&(l="over"),c.preventVoidMoves&&(t===n?(this.debug("    drop over source node prevented"),l=null):"before"===l&&n&&t===n.getNextSibling()?(this.debug("    drop after source node prevented"),l=null):"after"===l&&n&&t===n.getPrevSibling()?(this.debug("    drop before source node prevented"),l=null):"over"===l&&n&&n.parent===t&&n.isLastSibling()&&(this.debug("    drop last child over own parent prevented"),l=null)),i.helper.data("hitMode",l))),"before"===l||"after"===l||!c.autoExpandMS||!1===t.hasChildren()||t.expanded||c.dragExpand&&!1===c.dragExpand(t,u)||t.scheduleAction("expand",c.autoExpandMS),l&&c.dragOver&&(u.hitMode=l,h=c.dragOver(t,u)),s=!1!==h&&null!==l,c.smartRevert&&(o.options.revert=!s),this._local._setDndStatus(n,t,i.helper,l,s);break;case"drop":(l=i.helper.data("hitMode"))&&c.dragDrop&&(u.hitMode=l,c.dragDrop(t,u));break;case"leave":t.scheduleAction("cancel"),i.helper.data("enterResponse",null),i.helper.data("hitMode",null),this._local._setDndStatus(n,t,i.helper,"out",void 0),c.dragLeave&&c.dragLeave(t,u);break;case"stop":p.removeClass("fancytree-drag-source"),g(document).off(".fancytree-dnd"),c.dragStop&&c.dragStop(t,u);break;default:g.error("Unsupported drag event: "+e)}return h},_cancelDrag:function(){var e=g.ui.ddmanager.current;e&&e.cancel()}}),g.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(f){"use strict";var s,l,p=f.ui.fancytree,o=/Mac/.test(navigator.platform),d="fancytree-drag-source",c="fancytree-drag-remove",g="fancytree-drop-accept",y="fancytree-drop-after",v="fancytree-drop-before",m="fancytree-drop-over",b="fancytree-drop-reject",x="fancytree-drop-target",u="application/x-fancytree-node",C=null,h=null,k=null,w=null,_=null,a=null,N=null,S=null,E=null,A=null;function T(){k=h=a=S=N=A=_=null,w&&w.removeClass(d+" "+c),w=null,C&&C.hide(),l&&(l.remove(),l=null)}function D(e){return 0===e?"":0<e?"+"+e:""+e}function O(e,t){var n,r=t.tree,i=t.dataTransfer;"dragstart"===e.type?(t.effectAllowed=r.options.dnd5.effectAllowed,t.dropEffect=r.options.dnd5.dropEffectDefault):(t.effectAllowed=S,t.dropEffect=N),t.dropEffectSuggested=(n=e,r=(e=r).options.dnd5.dropEffectDefault,o?n.metaKey&&n.altKey||n.ctrlKey?r="link":n.metaKey?r="move":n.altKey&&(r="copy"):n.ctrlKey?r="copy":n.shiftKey?r="move":n.altKey&&(r="link"),r!==a&&e.info("evalEffectModifiers: "+n.type+" - evalEffectModifiers(): "+a+" -> "+r),a=r),t.isMove="move"===t.dropEffect,t.files=i.files||[]}function F(e,t,n){var r=t.tree,i=t.dataTransfer;return"dragstart"!==e.type&&S!==t.effectAllowed&&r.warn("effectAllowed should only be changed in dragstart event: "+e.type+": data.effectAllowed changed from "+S+" -> "+t.effectAllowed),!1===n&&(r.info("applyDropEffectCallback: allowDrop === false"),t.effectAllowed="none",t.dropEffect="none"),t.isMove="move"===t.dropEffect,"dragstart"===e.type&&(S=t.effectAllowed,N=t.dropEffect),i.effectAllowed=S,i.dropEffect=N}function M(e,t){if(t.options.dnd5.scroll&&(h=t.tree,a=e,i=h.options.dnd5,o=h.$scrollParent[0],l=i.scrollSensitivity,u=i.scrollSpeed,r=0,o!==document&&"HTML"!==o.tagName?(i=h.$scrollParent.offset(),d=o.scrollTop,i.top+o.offsetHeight-a.pageY<l?0<o.scrollHeight-h.$scrollParent.innerHeight()-d&&(o.scrollTop=r=d+u):0<d&&a.pageY-i.top<l&&(o.scrollTop=r=d-u)):0<(d=f(document).scrollTop())&&a.pageY-d<l?(r=d-u,f(document).scrollTop(r)):f(window).height()-(a.pageY-d)<l&&(r=d+u,f(document).scrollTop(r)),r&&h.debug("autoScroll: "+r+"px")),!t.node)return t.tree.warn("Ignored dragover for non-node"),E;var n,r,i=null,o=t.tree,a=o.options,s=a.dnd5,l=t.node,d=t.otherNode,c="center",u=f(l.span),h=u.find("span.fancytree-title");if(!1===_)return o.debug("Ignored dragover, since dragenter returned false."),!1;if("string"==typeof _&&f.error("assert failed: dragenter returned string"),r=u.offset(),u=(e.pageY-r.top)/u.height(),void 0===e.pageY&&o.warn("event.pageY is undefined: see issue #1013."),_.after&&.75<u||!_.over&&_.after&&.5<u?i="after":_.before&&u<=.25||!_.over&&_.before&&u<=.5?i="before":_.over&&(i="over"),s.preventVoidMoves&&"move"===t.dropEffect&&(l===d?(l.debug("Drop over source node prevented."),i=null):"before"===i&&d&&l===d.getNextSibling()?(l.debug("Drop after source node prevented."),i=null):"after"===i&&d&&l===d.getPrevSibling()?(l.debug("Drop before source node prevented."),i=null):"over"===i&&d&&d.parent===l&&d.isLastSibling()&&(l.debug("Drop last child over own parent prevented."),i=null)),(t.hitMode=i)&&s.dragOver&&(O(e,t),s.dragOver(l,t),F(e,t,!!i),i=t.hitMode),"after"===(E=i)||"before"===i||"over"===i){switch(n=s.dropMarkerOffsetX||0,i){case"before":c="top",n+=s.dropMarkerInsertOffsetX||0;break;case"after":c="bottom",n+=s.dropMarkerInsertOffsetX||0}h={my:"left"+D(n)+" center",at:"left "+c,of:h},a.rtl&&(h.my="right"+D(-n)+" center",h.at="right "+c),C.toggleClass(y,"after"===i).toggleClass(m,"over"===i).toggleClass(v,"before"===i).show().position(p.fixPositionOptions(h))}else C.hide();return f(l.span).toggleClass(x,"after"===i||"before"===i||"over"===i).toggleClass(y,"after"===i).toggleClass(v,"before"===i).toggleClass(g,"over"===i).toggleClass(b,!1===i),i}function j(e){var t,n=this,r=n.options.dnd5,i=null,o=p.getNode(e),a=e.dataTransfer||e.originalEvent.dataTransfer,s={tree:n,node:o,options:n.options,originalEvent:e.originalEvent,widget:n.widget,hitMode:_,dataTransfer:a,otherNode:h||null,otherNodeList:k||null,otherNodeData:null,useDefaultImage:!0,dropEffect:void 0,dropEffectSuggested:void 0,effectAllowed:void 0,files:null,isCancelled:void 0,isMove:void 0};switch(e.type){case"dragenter":if(A=null,!o){n.debug("Ignore non-node "+e.type+": "+e.target.tagName+"."+e.target.className),_=!1;break}if(f(o.span).addClass(m).removeClass(g+" "+b),t=0<=f.inArray(u,a.types),r.preventNonNodes&&!t){o.debug("Reject dropping a non-node."),_=!1;break}if(r.preventForeignNodes&&(!h||h.tree!==o.tree)){o.debug("Reject dropping a foreign node."),_=!1;break}if(r.preventSameParent&&s.otherNode&&s.otherNode.tree===o.tree&&o.parent===s.otherNode.parent){o.debug("Reject dropping as sibling (same parent)."),_=!1;break}if(r.preventRecursion&&s.otherNode&&s.otherNode.tree===o.tree&&o.isDescendantOf(s.otherNode)){o.debug("Reject dropping below own ancestor."),_=!1;break}if(r.preventLazyParents&&!o.isLoaded()){o.warn("Drop over unloaded target node prevented."),_=!1;break}C.show(),O(e,s),t=r.dragEnter(o,s),t=!!(t=t)&&(t=f.isPlainObject(t)?{over:!!t.over,before:!!t.before,after:!!t.after}:f.isArray(t)?{over:0<=f.inArray("over",t),before:0<=f.inArray("before",t),after:0<=f.inArray("after",t)}:{over:!0===t||"over"===t,before:!0===t||"before"===t,after:!0===t||"after"===t},0!==Object.keys(t).length&&t),F(e,s,i=(_=t)&&(t.over||t.before||t.after));break;case"dragover":if(!o){n.debug("Ignore non-node "+e.type+": "+e.target.tagName+"."+e.target.className);break}O(e,s),i=!!(E=M(e,s)),("over"===E||!1===E)&&!o.expanded&&!1!==o.hasChildren()?A?!(r.autoExpandMS&&Date.now()-A>r.autoExpandMS)||o.isLoading()||r.dragExpand&&!1===r.dragExpand(o,s)||o.setExpanded():A=Date.now():A=null;break;case"dragleave":if(!o){n.debug("Ignore non-node "+e.type+": "+e.target.tagName+"."+e.target.className);break}if(!f(o.span).hasClass(m)){o.debug("Ignore dragleave (multi).");break}f(o.span).removeClass(m+" "+g+" "+b),o.scheduleAction("cancel"),r.dragLeave(o,s),C.hide();break;case"drop":if(0<=f.inArray(u,a.types)&&(d=a.getData(u),n.info(e.type+": getData('application/x-fancytree-node'): '"+d+"'")),d||(d=a.getData("text"),n.info(e.type+": getData('text'): '"+d+"'")),d)try{void 0!==(l=JSON.parse(d)).title&&(s.otherNodeData=l)}catch(e){}n.debug(e.type+": nodeData: '"+d+"', otherNodeData: ",s.otherNodeData),f(o.span).removeClass(m+" "+g+" "+b),s.hitMode=E,O(e,s),s.isCancelled=!E;var l=h&&h.span,d=h&&h.tree;r.dragDrop(o,s),e.preventDefault(),l&&!document.body.contains(l)&&(d===n?(n.debug("Drop handler removed source element: generating dragEnd."),r.dragEnd(h,s)):n.warn("Drop handler removed source element: dragend event may be lost.")),T()}if(i)return e.preventDefault(),!1}return f.ui.fancytree.getDragNodeList=function(){return k||[]},f.ui.fancytree.getDragNode=function(){return h},f.ui.fancytree.registerExtension({name:"dnd5",version:"2.38.0",options:{autoExpandMS:1500,dropMarkerInsertOffsetX:-16,dropMarkerOffsetX:-24,dropMarkerParent:"body",multiSource:!1,effectAllowed:"all",dropEffectDefault:"move",preventForeignNodes:!1,preventLazyParents:!0,preventNonNodes:!1,preventRecursion:!0,preventSameParent:!1,preventVoidMoves:!0,scroll:!0,scrollSensitivity:20,scrollSpeed:5,setTextTypeJson:!1,sourceCopyHook:null,dragStart:null,dragDrag:f.noop,dragEnd:f.noop,dragEnter:null,dragOver:f.noop,dragExpand:f.noop,dragDrop:f.noop,dragLeave:f.noop},treeInit:function(e){var t=e.tree,n=e.options,r=n.glyph||null,i=n.dnd5;0<=f.inArray("dnd",n.extensions)&&f.error("Extensions 'dnd' and 'dnd5' are mutually exclusive."),i.dragStop&&f.error("dragStop is not used by ext-dnd5. Use dragEnd instead."),null!=i.preventRecursiveMoves&&f.error("preventRecursiveMoves was renamed to preventRecursion."),i.dragStart&&p.overrideMethod(e.options,"createNode",function(e,t){this._super.apply(this,arguments),t.node.span?t.node.span.draggable=!0:t.node.warn("Cannot add `draggable`: no span tag")}),this._superApply(arguments),this.$container.addClass("fancytree-ext-dnd5"),e=f("<span>").appendTo(this.$container),this.$scrollParent=e.scrollParent(),e.remove(),(C=f("#fancytree-drop-marker")).length||(C=f("<div id='fancytree-drop-marker'></div>").hide().css({"z-index":1e3,"pointer-events":"none"}).prependTo(i.dropMarkerParent),r&&p.setSpanIcon(C[0],r.map._addClass,r.map.dropMarker)),C.toggleClass("fancytree-rtl",!!n.rtl),i.dragStart&&t.$container.on("dragstart drag dragend",function(e){var t=this,n=t.options.dnd5,r=p.getNode(e),i=e.dataTransfer||e.originalEvent.dataTransfer,o={tree:t,node:r,options:t.options,originalEvent:e.originalEvent,widget:t.widget,dataTransfer:i,useDefaultImage:!0,dropEffect:void 0,dropEffectSuggested:void 0,effectAllowed:void 0,files:void 0,isCancelled:void 0,isMove:void 0};switch(e.type){case"dragstart":if(!r)return t.info("Ignored dragstart on a non-node."),!1;h=r,k=!1===n.multiSource?[r]:!0===n.multiSource?r.isSelected()?t.getSelectedNodes():[r]:n.multiSource(r,o),(w=f(f.map(k,function(e){return e.span}))).addClass(d);var a=r.toDict(!0,n.sourceCopyHook);a.treeId=r.tree._id,a=JSON.stringify(a);try{i.setData(u,a),i.setData("text/html",f(r.span).html()),i.setData("text/plain",r.title)}catch(e){t.warn("Could not set data (IE only accepts 'text') - "+e)}return(n.setTextTypeJson?i.setData("text",a):i.setData("text",r.title),O(e,o),!1===n.dragStart(r,o))?(T(),!1):(F(e,o),l=null,o.useDefaultImage&&(s=f(r.span).find(".fancytree-title"),k&&1<k.length&&(l=f("<span class='fancytree-childcounter'/>").text("+"+(k.length-1)).appendTo(s)),i.setDragImage&&i.setDragImage(s[0],-10,-10)),!0);case"drag":O(e,o),n.dragDrag(r,o),F(e,o),w.toggleClass(c,o.isMove);break;case"dragend":O(e,o),T(),o.isCancelled=!E,n.dragEnd(r,o,!E)}}.bind(t)),i.dragEnter&&t.$container.on("dragenter dragover dragleave drop",j.bind(t))}}),f.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(d){"use strict";var t=/Mac/.test(navigator.platform),c=d.ui.fancytree.escapeHtml,s=d.ui.fancytree.unescapeHtml;return d.ui.fancytree._FancytreeNodeClass.prototype.editStart=function(){var t,n=this,e=this.tree,r=e.ext.edit,i=e.options.edit,o=d(".fancytree-title",n.span),a={node:n,tree:e,options:e.options,isNew:d(n[e.statusClassPropName]).hasClass("fancytree-edit-new"),orgTitle:n.title,input:null,dirty:!1};if(!1===i.beforeEdit.call(n,{type:"beforeEdit"},a))return!1;d.ui.fancytree.assert(!r.currentNode,"recursive edit"),r.currentNode=this,r.eventData=a,e.widget._unbind(),r.lastDraggableAttrValue=n.span.draggable,r.lastDraggableAttrValue&&(n.span.draggable=!1),d(document).on("mousedown.fancytree-edit",function(e){d(e.target).hasClass("fancytree-edit-input")||n.editEnd(!0,e)}),t=d("<input />",{class:"fancytree-edit-input",type:"text",value:e.options.escapeTitles?a.orgTitle:s(a.orgTitle)}),r.eventData.input=t,null!=i.adjustWidthOfs&&t.width(o.width()+i.adjustWidthOfs),null!=i.inputCss&&t.css(i.inputCss),o.html(t),t.focus().change(function(e){t.addClass("fancytree-edit-dirty")}).on("keydown",function(e){switch(e.which){case d.ui.keyCode.ESCAPE:n.editEnd(!1,e);break;case d.ui.keyCode.ENTER:return n.editEnd(!0,e),!1}e.stopPropagation()}).blur(function(e){return n.editEnd(!0,e)}),i.edit.call(n,{type:"edit"},a)},d.ui.fancytree._FancytreeNodeClass.prototype.editEnd=function(e,t){var n,r=this,i=this.tree,o=i.ext.edit,a=o.eventData,s=i.options.edit,l=d(".fancytree-title",r.span).find("input.fancytree-edit-input");return s.trim&&l.val(d.trim(l.val())),n=l.val(),a.dirty=n!==r.title,a.originalEvent=t,!1===e?a.save=!1:a.isNew?a.save=""!==n:a.save=a.dirty&&""!==n,!1!==s.beforeClose.call(r,{type:"beforeClose"},a)&&((!a.save||!1!==s.save.call(r,{type:"save"},a))&&(l.removeClass("fancytree-edit-dirty").off(),d(document).off(".fancytree-edit"),a.save?(r.setTitle(i.options.escapeTitles?n:c(n)),r.setFocus()):a.isNew?(r.remove(),r=a.node=null,o.relatedNode.setFocus()):(r.renderTitle(),r.setFocus()),o.eventData=null,o.currentNode=null,o.relatedNode=null,i.widget._bind(),r&&o.lastDraggableAttrValue&&(r.span.draggable=!0),i.$container.get(0).focus({preventScroll:!0}),a.input=null,s.close.call(r,{type:"close"},a),!0))},d.ui.fancytree._FancytreeNodeClass.prototype.editCreateNode=function(e,t){var n,r=this.tree,i=this;e=e||"child",null==t?t={title:""}:"string"==typeof t?t={title:t}:d.ui.fancytree.assert(d.isPlainObject(t)),"child"!==e||this.isExpanded()||!1===this.hasChildren()?((n=this.addNode(t,e)).match=!0,d(n[r.statusClassPropName]).removeClass("fancytree-hide").addClass("fancytree-match"),n.makeVisible().done(function(){d(n[r.statusClassPropName]).addClass("fancytree-edit-new"),i.tree.ext.edit.relatedNode=i,n.editStart()})):this.setExpanded().done(function(){i.editCreateNode(e,t)})},d.ui.fancytree._FancytreeClass.prototype.isEditing=function(){return this.ext.edit?this.ext.edit.currentNode:null},d.ui.fancytree._FancytreeNodeClass.prototype.isEditing=function(){return!!this.tree.ext.edit&&this.tree.ext.edit.currentNode===this},d.ui.fancytree.registerExtension({name:"edit",version:"2.38.0",options:{adjustWidthOfs:4,allowEmpty:!1,inputCss:{minWidth:"3em"},triggerStart:["f2","mac+enter","shift+click"],trim:!0,beforeClose:d.noop,beforeEdit:d.noop,close:d.noop,edit:d.noop,save:d.noop},currentNode:null,treeInit:function(e){var r=e.tree;this._superApply(arguments),this.$container.addClass("fancytree-ext-edit").on("fancytreebeforeupdateviewport",function(e,t){var n=r.isEditing();n&&(n.info("Cancel edit due to scroll event."),n.editEnd(!1,e))})},nodeClick:function(e){var t=d.ui.fancytree.eventToString(e.originalEvent),n=e.options.edit.triggerStart;return"shift+click"===t&&0<=d.inArray("shift+click",n)&&e.originalEvent.shiftKey||"click"===t&&0<=d.inArray("clickActive",n)&&e.node.isActive()&&!e.node.isEditing()&&d(e.originalEvent.target).hasClass("fancytree-title")?(e.node.editStart(),!1):this._superApply(arguments)},nodeDblclick:function(e){return 0<=d.inArray("dblclick",e.options.edit.triggerStart)?(e.node.editStart(),!1):this._superApply(arguments)},nodeKeydown:function(e){switch(e.originalEvent.which){case 113:if(0<=d.inArray("f2",e.options.edit.triggerStart))return e.node.editStart(),!1;break;case d.ui.keyCode.ENTER:if(0<=d.inArray("mac+enter",e.options.edit.triggerStart)&&t)return e.node.editStart(),!1}return this._superApply(arguments)}}),d.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(y){"use strict";var v="__not_found__",m=y.ui.fancytree.escapeHtml;function b(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function x(e,t,n){for(var r=[],i=1;i<t.length;i++){var o=t[i].length+(1===i?0:1)+(r[r.length-1]||0);r.push(o)}var a=e.split("");return n?r.forEach(function(e){a[e]=""+a[e]+""}):r.forEach(function(e){a[e]="<mark>"+a[e]+"</mark>"}),a.join("")}return y.ui.fancytree._FancytreeClass.prototype._applyFilterImpl=function(r,i,e){var t,o,a,s,l,d,c=0,n=this.options,u=n.escapeTitles,h=n.autoCollapse,f=y.extend({},n.filter,e),p="hide"===f.mode,g=!!f.leavesOnly&&!i;if("string"==typeof r){if(""===r)return this.warn("Fancytree passing an empty string as a filter is handled as clearFilter()."),void this.clearFilter();t=f.fuzzy?r.split("").map(b).reduce(function(e,t){return e+"([^"+t+"]*)"+t},""):b(r),o=new RegExp(t,"i"),a=new RegExp(b(r),"gi"),u&&(s=new RegExp(b(""),"g"),l=new RegExp(b(""),"g")),r=function(e){if(!e.title)return!1;var t,n=u?e.title:0<=(t=e.title).indexOf(">")?y("<div/>").html(t).text():t,t=n.match(o);return t&&f.highlight&&(u?(d=f.fuzzy?x(n,t,u):n.replace(a,function(e){return""+e+""}),e.titleWithHighlight=m(d).replace(s,"<mark>").replace(l,"</mark>")):f.fuzzy?e.titleWithHighlight=x(n,t):e.titleWithHighlight=n.replace(a,function(e){return"<mark>"+e+"</mark>"})),!!t}}return this.enableFilter=!0,this.lastFilterArgs=arguments,e=this.enableUpdate(!1),this.$div.addClass("fancytree-ext-filter"),p?this.$div.addClass("fancytree-ext-filter-hide"):this.$div.addClass("fancytree-ext-filter-dimm"),this.$div.toggleClass("fancytree-ext-filter-hide-expanders",!!f.hideExpanders),this.rootNode.subMatchCount=0,this.visit(function(e){delete e.match,delete e.titleWithHighlight,e.subMatchCount=0}),(t=this.getRootNode()._findDirectChild(v))&&t.remove(),n.autoCollapse=!1,this.visit(function(t){if(!g||null==t.children){var e=r(t),n=!1;if("skip"===e)return t.visit(function(e){e.match=!1},!0),"skip";e||!i&&"branch"!==e||!t.parent.match||(n=e=!0),e&&(c++,t.match=!0,t.visitParents(function(e){e!==t&&(e.subMatchCount+=1),!f.autoExpand||n||e.expanded||(e.setExpanded(!0,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),e._filterAutoExpanded=!0)},!0))}}),n.autoCollapse=h,0===c&&f.nodata&&p&&(t=f.nodata,!0===(t=y.isFunction(t)?t():t)?t={}:"string"==typeof t&&(t={title:t}),t=y.extend({statusNodeType:"nodata",key:v,title:this.options.strings.noData},t),this.getRootNode().addNode(t).match=!0),this._callHook("treeStructureChanged",this,"applyFilter"),this.enableUpdate(e),c},y.ui.fancytree._FancytreeClass.prototype.filterNodes=function(e,t){return"boolean"==typeof t&&(t={leavesOnly:t},this.warn("Fancytree.filterNodes() leavesOnly option is deprecated since 2.9.0 / 2015-04-19. Use opts.leavesOnly instead.")),this._applyFilterImpl(e,!1,t)},y.ui.fancytree._FancytreeClass.prototype.filterBranches=function(e,t){return this._applyFilterImpl(e,!0,t)},y.ui.fancytree._FancytreeClass.prototype.updateFilter=function(){this.enableFilter&&this.lastFilterArgs&&this.options.filter.autoApply?this._applyFilterImpl.apply(this,this.lastFilterArgs):this.warn("updateFilter(): no filter active.")},y.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){var t,e=this.getRootNode()._findDirectChild(v),n=this.options.escapeTitles,r=this.options.enhanceTitle,i=this.enableUpdate(!1);e&&e.remove(),delete this.rootNode.match,delete this.rootNode.subMatchCount,this.visit(function(e){e.match&&e.span&&(t=y(e.span).find(">span.fancytree-title"),n?t.text(e.title):t.html(e.title),r&&r({type:"enhanceTitle"},{node:e,$title:t})),delete e.match,delete e.subMatchCount,delete e.titleWithHighlight,e.$subMatchBadge&&(e.$subMatchBadge.remove(),delete e.$subMatchBadge),e._filterAutoExpanded&&e.expanded&&e.setExpanded(!1,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),delete e._filterAutoExpanded}),this.enableFilter=!1,this.lastFilterArgs=null,this.$div.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide"),this._callHook("treeStructureChanged",this,"clearFilter"),this.enableUpdate(i)},y.ui.fancytree._FancytreeClass.prototype.isFilterActive=function(){return!!this.enableFilter},y.ui.fancytree._FancytreeNodeClass.prototype.isMatched=function(){return!(this.tree.enableFilter&&!this.match)},y.ui.fancytree.registerExtension({name:"filter",version:"2.38.0",options:{autoApply:!0,autoExpand:!1,counter:!0,fuzzy:!1,hideExpandedCounter:!0,hideExpanders:!1,highlight:!0,leavesOnly:!1,nodata:!0,mode:"dimm"},nodeLoadChildren:function(e,t){var n=e.tree;return this._superApply(arguments).done(function(){n.enableFilter&&n.lastFilterArgs&&e.options.filter.autoApply&&n._applyFilterImpl.apply(n,n.lastFilterArgs)})},nodeSetExpanded:function(e,t,n){var r=e.node;return delete r._filterAutoExpanded,!t&&e.options.filter.hideExpandedCounter&&r.$subMatchBadge&&r.$subMatchBadge.show(),this._superApply(arguments)},nodeRenderStatus:function(e){var t=e.node,n=e.tree,r=e.options.filter,i=y(t.span).find("span.fancytree-title"),o=y(t[n.statusClassPropName]),a=e.options.enhanceTitle,s=e.options.escapeTitles,e=this._super(e);return o.length&&n.enableFilter&&(o.toggleClass("fancytree-match",!!t.match).toggleClass("fancytree-submatch",!!t.subMatchCount).toggleClass("fancytree-hide",!(t.match||t.subMatchCount)),!r.counter||!t.subMatchCount||t.isExpanded()&&r.hideExpandedCounter?t.$subMatchBadge&&t.$subMatchBadge.hide():(t.$subMatchBadge||(t.$subMatchBadge=y("<span class='fancytree-childcounter'/>"),y("span.fancytree-icon, span.fancytree-custom-icon",t.span).append(t.$subMatchBadge)),t.$subMatchBadge.show().text(t.subMatchCount)),!t.span||t.isEditing&&t.isEditing.call(t)||(t.titleWithHighlight?i.html(t.titleWithHighlight):s?i.text(t.title):i.html(t.title),a&&a({type:"enhanceTitle"},{node:t,$title:i}))),e}}),y.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(l){"use strict";var s=l.ui.fancytree,n={awesome3:{_addClass:"",checkbox:"icon-check-empty",checkboxSelected:"icon-check",checkboxUnknown:"icon-check icon-muted",dragHelper:"icon-caret-right",dropMarker:"icon-caret-right",error:"icon-exclamation-sign",expanderClosed:"icon-caret-right",expanderLazy:"icon-angle-right",expanderOpen:"icon-caret-down",loading:"icon-refresh icon-spin",nodata:"icon-meh",noExpander:"",radio:"icon-circle-blank",radioSelected:"icon-circle",doc:"icon-file-alt",docOpen:"icon-file-alt",folder:"icon-folder-close-alt",folderOpen:"icon-folder-open-alt"},awesome4:{_addClass:"fa",checkbox:"fa-square-o",checkboxSelected:"fa-check-square-o",checkboxUnknown:"fa-square fancytree-helper-indeterminate-cb",dragHelper:"fa-arrow-right",dropMarker:"fa-long-arrow-right",error:"fa-warning",expanderClosed:"fa-caret-right",expanderLazy:"fa-angle-right",expanderOpen:"fa-caret-down",loading:{html:"<span class='fa fa-spinner fa-pulse' />"},nodata:"fa-meh-o",noExpander:"",radio:"fa-circle-thin",radioSelected:"fa-circle",doc:"fa-file-o",docOpen:"fa-file-o",folder:"fa-folder-o",folderOpen:"fa-folder-open-o"},awesome5:{_addClass:"",checkbox:"far fa-square",checkboxSelected:"far fa-check-square",checkboxUnknown:"fas fa-square fancytree-helper-indeterminate-cb",radio:"far fa-circle",radioSelected:"fas fa-circle",radioUnknown:"far fa-dot-circle",dragHelper:"fas fa-arrow-right",dropMarker:"fas fa-long-arrow-alt-right",error:"fas fa-exclamation-triangle",expanderClosed:"fas fa-caret-right",expanderLazy:"fas fa-angle-right",expanderOpen:"fas fa-caret-down",loading:"fas fa-spinner fa-pulse",nodata:"far fa-meh",noExpander:"",doc:"far fa-file",docOpen:"far fa-file",folder:"far fa-folder",folderOpen:"far fa-folder-open"},bootstrap3:{_addClass:"glyphicon",checkbox:"glyphicon-unchecked",checkboxSelected:"glyphicon-check",checkboxUnknown:"glyphicon-expand fancytree-helper-indeterminate-cb",dragHelper:"glyphicon-play",dropMarker:"glyphicon-arrow-right",error:"glyphicon-warning-sign",expanderClosed:"glyphicon-menu-right",expanderLazy:"glyphicon-menu-right",expanderOpen:"glyphicon-menu-down",loading:"glyphicon-refresh fancytree-helper-spin",nodata:"glyphicon-info-sign",noExpander:"",radio:"glyphicon-remove-circle",radioSelected:"glyphicon-ok-circle",doc:"glyphicon-file",docOpen:"glyphicon-file",folder:"glyphicon-folder-close",folderOpen:"glyphicon-folder-open"},material:{_addClass:"material-icons",checkbox:{text:"check_box_outline_blank"},checkboxSelected:{text:"check_box"},checkboxUnknown:{text:"indeterminate_check_box"},dragHelper:{text:"play_arrow"},dropMarker:{text:"arrow-forward"},error:{text:"warning"},expanderClosed:{text:"chevron_right"},expanderLazy:{text:"last_page"},expanderOpen:{text:"expand_more"},loading:{text:"autorenew",addClass:"fancytree-helper-spin"},nodata:{text:"info"},noExpander:{text:""},radio:{text:"radio_button_unchecked"},radioSelected:{text:"radio_button_checked"},doc:{text:"insert_drive_file"},docOpen:{text:"insert_drive_file"},folder:{text:"folder"},folderOpen:{text:"folder_open"}}};function d(e,t,n,r,i){var o=r.map,a=o[i],s=l(t),r=s.find(".fancytree-childcounter"),o=n+" "+(o._addClass||"");"string"==typeof(a=l.isFunction(a)?a.call(this,e,t,i):a)?(t.innerHTML="",s.attr("class",o+" "+a).append(r)):a&&(a.text?t.textContent=""+a.text:a.html?t.innerHTML=a.html:t.innerHTML="",s.attr("class",o+" "+(a.addClass||"")).append(r))}return l.ui.fancytree.registerExtension({name:"glyph",version:"2.38.0",options:{preset:null,map:{}},treeInit:function(e){var t=e.tree,e=e.options.glyph;e.preset?(s.assert(!!n[e.preset],"Invalid value for `options.glyph.preset`: "+e.preset),e.map=l.extend({},n[e.preset],e.map)):t.warn("ext-glyph: missing `preset` option."),this._superApply(arguments),t.$container.addClass("fancytree-ext-glyph")},nodeRenderStatus:function(e){var t,n,r=e.node,i=l(r.span),o=e.options.glyph,a=this._super(e);return r.isRootNode()||((n=i.children(".fancytree-expander").get(0))&&(t=r.expanded&&r.hasChildren()?"expanderOpen":r.isUndefined()?"expanderLazy":r.hasChildren()?"expanderClosed":"noExpander",d(r,n,"fancytree-expander",o,t)),(n=(r.tr?l("td",r.tr).find(".fancytree-checkbox"):i.children(".fancytree-checkbox")).get(0))&&(e=s.evalOption("checkbox",r,r,o,!1),r.parent&&r.parent.radiogroup||"radio"===e?d(r,n,"fancytree-checkbox fancytree-radio",o,t=r.selected?"radioSelected":"radio"):d(r,n,"fancytree-checkbox",o,t=r.selected?"checkboxSelected":r.partsel?"checkboxUnknown":"checkbox")),(n=i.children(".fancytree-icon").get(0))&&(t=r.statusNodeType||(r.folder?r.expanded&&r.hasChildren()?"folderOpen":"folder":r.expanded?"docOpen":"doc"),d(r,n,"fancytree-icon",o,t))),a},nodeSetStatus:function(e,t,n,r){var i,o=e.options.glyph,a=e.node,e=this._superApply(arguments);return"error"!==t&&"loading"!==t&&"nodata"!==t||(a.parent?(i=l(".fancytree-expander",a.span).get(0))&&d(a,i,"fancytree-expander",o,t):(i=l(".fancytree-statusnode-"+t,a[this.nodeContainerAttrName]).find(".fancytree-icon").get(0))&&d(a,i,"fancytree-icon",o,t)),e}}),l.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree","./jquery.fancytree.table"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree.table"),module.exports=e(require("jquery"))):e(jQuery)}(function(c){"use strict";var u=c.ui.keyCode,o={text:[u.UP,u.DOWN],checkbox:[u.UP,u.DOWN,u.LEFT,u.RIGHT],link:[u.UP,u.DOWN,u.LEFT,u.RIGHT],radiobutton:[u.UP,u.DOWN,u.LEFT,u.RIGHT],"select-one":[u.LEFT,u.RIGHT],"select-multiple":[u.LEFT,u.RIGHT]};function a(e,t){var n,r,i,o,a,s,l=e.closest("td"),d=null;switch(t){case u.LEFT:d=l.prev();break;case u.RIGHT:d=l.next();break;case u.UP:case u.DOWN:for(n=l.parent(),i=n,a=l.get(0),s=0,i.children().each(function(){return this!==a&&(o=c(this).prop("colspan"),void(s+=o||1))}),r=s;(n=t===u.UP?n.prev():n.next()).length&&(n.is(":hidden")||!(d=function(e,t){var n,r=null,i=0;return e.children().each(function(){return t<=i?(r=c(this),!1):(n=c(this).prop("colspan"),void(i+=n||1))}),r}(n,r))||!d.find(":input,a").length););}return d}return c.ui.fancytree.registerExtension({name:"gridnav",version:"2.38.0",options:{autofocusInput:!1,handleCursorKeys:!0},treeInit:function(n){this._requireExtension("table",!0,!0),this._superApply(arguments),this.$container.addClass("fancytree-ext-gridnav"),this.$container.on("focusin",function(e){var t=c.ui.fancytree.getNode(e.target);t&&!t.isActive()&&(e=n.tree._makeHookContext(t,e),n.tree._callHook("nodeSetActive",e,!0))})},nodeSetActive:function(e,t,n){var r=e.options.gridnav,i=e.node,o=e.originalEvent||{},o=c(o.target).is(":input");t=!1!==t,this._superApply(arguments),t&&(e.options.titlesTabbable?(o||(c(i.span).find("span.fancytree-title").focus(),i.setFocus()),e.tree.$container.attr("tabindex","-1")):r.autofocusInput&&!o&&c(i.tr||i.span).find(":input:enabled").first().focus())},nodeKeydown:function(e){var t,n,r=e.options.gridnav,i=e.originalEvent,e=c(i.target);return e.is(":input:enabled")?t=e.prop("type"):e.is("a")&&(t="link"),t&&r.handleCursorKeys?!((t=o[t])&&0<=c.inArray(i.which,t)&&(n=a(e,i.which))&&n.length)||(n.find(":input:enabled,a").focus(),!1):this._superApply(arguments)}}),c.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(a){"use strict";return a.ui.fancytree.registerExtension({name:"multi",version:"2.38.0",options:{allowNoSelect:!1,mode:"sameParent"},treeInit:function(e){this._superApply(arguments),this.$container.addClass("fancytree-ext-multi"),1===e.options.selectMode&&a.error("Fancytree ext-multi: selectMode: 1 (single) is not compatible.")},nodeClick:function(e){var t=e.tree,n=e.node,r=t.getActiveNode()||t.getFirstChild(),i="checkbox"===e.targetType,o="expander"===e.targetType;switch(a.ui.fancytree.eventToString(e.originalEvent)){case"click":if(o)break;i||(t.selectAll(!1),n.setSelected());break;case"shift+click":t.visitRows(function(e){if(e.setSelected(),e===n)return!1},{start:r,reverse:r.isBelowOf(n)});break;case"ctrl+click":case"meta+click":return void n.toggleSelected()}return this._superApply(arguments)},nodeKeydown:function(e){var t=e.tree,n=e.node,r=e.originalEvent;switch(a.ui.fancytree.eventToString(r)){case"up":case"down":t.selectAll(!1),n.navigate(r.which,!0),t.getActiveNode().setSelected();break;case"shift+up":case"shift+down":n.navigate(r.which,!0),t.getActiveNode().setSelected()}return this._superApply(arguments)}}),a.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(p){"use strict";var t=null,n=null,r=null,i=p.ui.fancytree.assert,u="active",g="expanded",h="focus",f="selected";try{i(window.localStorage&&window.localStorage.getItem),n={get:function(e){return window.localStorage.getItem(e)},set:function(e,t){window.localStorage.setItem(e,t)},remove:function(e){window.localStorage.removeItem(e)}}}catch(e){p.ui.fancytree.warn("Could not access window.localStorage",e)}try{i(window.sessionStorage&&window.sessionStorage.getItem),r={get:function(e){return window.sessionStorage.getItem(e)},set:function(e,t){window.sessionStorage.setItem(e,t)},remove:function(e){window.sessionStorage.removeItem(e)}}}catch(e){p.ui.fancytree.warn("Could not access window.sessionStorage",e)}return"function"==typeof Cookies?t={get:Cookies.get,set:function(e,t){Cookies.set(e,t,this.options.persist.cookie)},remove:Cookies.remove}:p&&"function"==typeof p.cookie&&(t={get:p.cookie,set:function(e,t){p.cookie.set(e,t,this.options.persist.cookie)},remove:p.removeCookie}),p.ui.fancytree._FancytreeClass.prototype.clearPersistData=function(e){var t=this.ext.persist,n=t.cookiePrefix;0<=(e=e||"active expanded focus selected").indexOf(u)&&t._data(n+u,null),0<=e.indexOf(g)&&t._data(n+g,null),0<=e.indexOf(h)&&t._data(n+h,null),0<=e.indexOf(f)&&t._data(n+f,null)},p.ui.fancytree._FancytreeClass.prototype.clearCookies=function(e){return this.warn("'tree.clearCookies()' is deprecated since v2.27.0: use 'clearPersistData()' instead."),this.clearPersistData(e)},p.ui.fancytree._FancytreeClass.prototype.getPersistData=function(){var e=this.ext.persist,t=e.cookiePrefix,n=e.cookieDelimiter,r={};return r[u]=e._data(t+u),r[g]=(e._data(t+g)||"").split(n),r[f]=(e._data(t+f)||"").split(n),r[h]=e._data(t+h),r},p.ui.fancytree.registerExtension({name:"persist",version:"2.38.0",options:{cookieDelimiter:"~",cookiePrefix:void 0,cookie:{raw:!1,expires:"",path:"",domain:"",secure:!1},expandLazy:!1,expandOpts:void 0,fireActivate:!0,overrideSource:!0,store:"auto",types:"active expanded focus selected"},_data:function(e,t){var n=this._local.store;if(void 0===t)return n.get.call(this,e);null===t?n.remove.call(this,e):n.set.call(this,e,t)},_appendKey:function(e,t,n){t=""+t;var r=this._local,i=this.options.persist.cookieDelimiter,o=r.cookiePrefix+e,a=r._data(o),e=a?a.split(i):[],a=p.inArray(t,e);0<=a&&e.splice(a,1),n&&e.push(t),r._data(o,e.join(i))},treeInit:function(e){var s=e.tree,l=e.options,d=this._local,c=this.options.persist;return d.cookiePrefix=c.cookiePrefix||"fancytree-"+s._id+"-",d.storeActive=0<=c.types.indexOf(u),d.storeExpanded=0<=c.types.indexOf(g),d.storeSelected=0<=c.types.indexOf(f),d.storeFocus=0<=c.types.indexOf(h),d.store=null,"auto"===c.store&&(c.store=n?"local":"cookie"),p.isPlainObject(c.store)?d.store=c.store:"cookie"===c.store?d.store=t:"local"!==c.store&&"session"!==c.store||(d.store="local"===c.store?n:r),i(d.store,"Need a valid store."),s.$div.on("fancytreeinit",function(e){var t,n,r,i,o,a;!1!==s._triggerTreeEvent("beforeRestore",null,{})&&(r=d._data(d.cookiePrefix+h),i=!1===c.fireActivate,o=d._data(d.cookiePrefix+g),a=o&&o.split(c.cookieDelimiter),(d.storeExpanded?function e(t,n,r,i,o){var a,s,l,d,c=!1,u=t.options.persist.expandOpts,h=[],f=[];for(r=r||[],o=o||p.Deferred(),a=0,l=r.length;a<l;a++)s=r[a],(d=t.getNodeByKey(s))?i&&d.isUndefined()?(c=!0,t.debug("_loadLazyNodes: "+d+" is lazy: loading..."),"expand"===i?h.push(d.setExpanded(!0,u)):h.push(d.load())):(t.debug("_loadLazyNodes: "+d+" already loaded."),d.setExpanded(!0,u)):(f.push(s),t.debug("_loadLazyNodes: "+d+" was not yet found."));return p.when.apply(p,h).always(function(){if(c&&0<f.length)e(t,n,f,i,o);else{if(f.length)for(t.warn("_loadLazyNodes: could not load those keys: ",f),a=0,l=f.length;a<l;a++)s=r[a],n._appendKey(g,r[a],!1);o.resolve()}}),o}(s,d,a,!!c.expandLazy&&"expand",null):(new p.Deferred).resolve()).done(function(){if(d.storeSelected){if(o=d._data(d.cookiePrefix+f))for(a=o.split(c.cookieDelimiter),t=0;t<a.length;t++)(n=s.getNodeByKey(a[t]))?(void 0===n.selected||c.overrideSource&&!1===n.selected)&&(n.selected=!0,n.renderStatus()):d._appendKey(f,a[t],!1);3===s.options.selectMode&&s.visit(function(e){if(e.selected)return e.fixSelection3AfterClick(),"skip"})}d.storeActive&&(!(o=d._data(d.cookiePrefix+u))||!l.persist.overrideSource&&s.activeNode||(n=s.getNodeByKey(o))&&(n.debug("persist: set active",o),n.setActive(!0,{noFocus:!0,noEvents:i}))),d.storeFocus&&r&&(n=s.getNodeByKey(r))&&(s.options.titlesTabbable?p(n.span).find(".fancytree-title"):p(s.$container)).focus(),s._triggerTreeEvent("restore",null,{})}))}),this._superApply(arguments)},nodeSetActive:function(e,t,n){var r=this._local;return t=!1!==t,t=this._superApply(arguments),r.storeActive&&r._data(r.cookiePrefix+u,this.activeNode?this.activeNode.key:null),t},nodeSetExpanded:function(e,t,n){var r=e.node,i=this._local;return t=!1!==t,e=this._superApply(arguments),i.storeExpanded&&i._appendKey(g,r.key,t),e},nodeSetFocus:function(e,t){var n=this._local;return t=!1!==t,t=this._superApply(arguments),n.storeFocus&&n._data(n.cookiePrefix+h,this.focusNode?this.focusNode.key:null),t},nodeSetSelected:function(e,t,n){var r=e.tree,i=e.node,o=this._local;return t=!1!==t,t=this._superApply(arguments),o.storeSelected&&(3===r.options.selectMode?(r=(r=p.map(r.getSelectedNodes(!0),function(e){return e.key})).join(e.options.persist.cookieDelimiter),o._data(o.cookiePrefix+f,r)):o._appendKey(f,i.key,i.selected)),t}}),p.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(b){"use strict";var x=b.ui.fancytree.assert;function C(e,n){e.visit(function(e){var t=e.tr;if(t&&(t.style.display=e.hide||!n?"none":""),!e.expanded)return"skip"})}return b.ui.fancytree.registerExtension({name:"table",version:"2.38.0",options:{checkboxColumnIdx:null,indentation:16,mergeStatusColumns:!0,nodeColumnIdx:0},treeInit:function(e){var t,n,r,i=e.tree,o=e.options,a=o.table,s=i.widget.element;if(null!=a.customStatus&&(null==o.renderStatusColumns?(i.warn("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' instead."),o.renderStatusColumns=a.customStatus):b.error("The 'customStatus' option is deprecated since v2.15.0. Use 'renderStatusColumns' only instead.")),o.renderStatusColumns&&!0===o.renderStatusColumns&&(o.renderStatusColumns=o.renderColumns),s.addClass("fancytree-container fancytree-ext-table"),(r=s.find(">tbody")).length||(s.find(">tr").length&&b.error("Expected table > tbody > tr. If you see this please open an issue."),r=b("<tbody>").appendTo(s)),i.tbody=r[0],i.columnCount=b("thead >tr",s).last().find(">th",s).length,(n=r.children("tr").first()).length)e=n.children("td").length,i.columnCount&&e!==i.columnCount&&(i.warn("Column count mismatch between thead ("+i.columnCount+") and tbody ("+e+"): using tbody."),i.columnCount=e),n=n.clone();else for(x(1<=i.columnCount,"Need either <thead> or <tbody> with <td> elements to determine column count."),n=b("<tr />"),t=0;t<i.columnCount;t++)n.append("<td />");n.find(">td").eq(a.nodeColumnIdx).html("<span class='fancytree-node' />"),o.aria&&(n.attr("role","row"),n.find("td").attr("role","gridcell")),i.rowFragment=document.createDocumentFragment(),i.rowFragment.appendChild(n.get(0)),r.empty(),i.statusClassPropName="tr",i.ariaPropName="tr",this.nodeContainerAttrName="tr",i.$container=s,this._superApply(arguments),b(i.rootNode.ul).remove(),i.rootNode.ul=null,this.$container.attr("tabindex",o.tabindex),o.aria&&i.$container.attr("role","treegrid").attr("aria-readonly",!0)},nodeRemoveChildMarkup:function(e){e.node.visit(function(e){e.tr&&(b(e.tr).remove(),e.tr=null)})},nodeRemoveMarkup:function(e){var t=e.node;t.tr&&(b(t.tr).remove(),t.tr=null),this.nodeRemoveChildMarkup(e)},nodeRender:function(e,t,n,r,i){var o,a,s,l,d,c,u,h,f,p,g=e.tree,y=e.node,v=e.options,m=!y.parent;if(!1!==g._enableUpdate){if(i||(e.hasCollapsedParents=y.parent&&!y.parent.expanded),!m)if(y.tr&&t&&this.nodeRemoveMarkup(e),y.tr)t?this.nodeRenderTitle(e):this.nodeRenderStatus(e);else{if(e.hasCollapsedParents&&!n)return;d=g.rowFragment.firstChild.cloneNode(!0),h=function(e){var t,n,r=e.parent,i=r?r.children:null;if(i&&1<i.length&&i[0]!==e)for(n=i[b.inArray(e,i)-1],x(n.tr);n.children&&n.children.length&&(t=n.children[n.children.length-1]).tr;)n=t;else n=r;return n}(y),x(h),(!0===r&&i||n&&e.hasCollapsedParents)&&(d.style.display="none"),h.tr?(f=h.tr,p=d,f.parentNode.insertBefore(p,f.nextSibling)):(x(!h.parent,"prev. row must have a tr, or be system root"),f=g.tbody,h=d,f.insertBefore(h,f.firstChild)),y.tr=d,y.key&&v.generateIds&&(y.tr.id=v.idPrefix+y.key),(y.tr.ftnode=y).span=b("span.fancytree-node",y.tr).get(0),this.nodeRenderTitle(e),v.createNode&&v.createNode.call(g,{type:"createNode"},e)}if(v.renderNode&&v.renderNode.call(g,{type:"renderNode"},e),(o=y.children)&&(m||n||y.expanded))for(s=0,l=o.length;s<l;s++)(u=b.extend({},e,{node:o[s]})).hasCollapsedParents=u.hasCollapsedParents||!y.expanded,this.nodeRender(u,t,n,r,!0);o&&!i&&(c=y.tr||null,a=g.tbody.firstChild,y.visit(function(e){var t;e.tr&&(e.parent.expanded||"none"===e.tr.style.display||(e.tr.style.display="none",C(e,!1)),e.tr.previousSibling!==c&&(y.debug("_fixOrder: mismatch at node: "+e),t=c?c.nextSibling:a,g.tbody.insertBefore(e.tr,t)),c=e.tr)}))}},nodeRenderTitle:function(e,t){var n=e.tree,r=e.node,i=e.options,o=r.isStatusNode(),a=this._super(e,t);return r.isRootNode()||(i.checkbox&&!o&&null!=i.table.checkboxColumnIdx&&(t=b("span.fancytree-checkbox",r.span),b(r.tr).find("td").eq(+i.table.checkboxColumnIdx).html(t)),this.nodeRenderStatus(e),o?i.renderStatusColumns?i.renderStatusColumns.call(n,{type:"renderStatusColumns"},e):i.table.mergeStatusColumns&&r.isTopLevel()&&b(r.tr).find(">td").eq(0).prop("colspan",n.columnCount).text(r.title).addClass("fancytree-status-merged").nextAll().remove():i.renderColumns&&i.renderColumns.call(n,{type:"renderColumns"},e)),a},nodeRenderStatus:function(e){var t=e.node,n=e.options;this._super(e),b(t.tr).removeClass("fancytree-node"),e=(t.getLevel()-1)*n.table.indentation,n.rtl?b(t.span).css({paddingRight:e+"px"}):b(t.span).css({paddingLeft:e+"px"})},nodeSetExpanded:function(t,n,r){if(n=!1!==n,t.node.expanded&&n||!t.node.expanded&&!n)return this._superApply(arguments);var i=new b.Deferred,e=b.extend({},r,{noEvents:!0,noAnimation:!0});function o(e){C(t.node,n),e?n&&t.options.autoScroll&&!r.noAnimation&&t.node.hasChildren()?t.node.getLastChild().scrollIntoView(!0,{topNode:t.node}).always(function(){r.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),i.resolveWith(t.node)}):(r.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),i.resolveWith(t.node)):(r.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),i.rejectWith(t.node))}return r=r||{},this._super(t,n,e).done(function(){o(!0)}).fail(function(){o(!1)}),i.promise()},nodeSetStatus:function(e,t,n,r){return"ok"!==t||(e=(e=e.node).children?e.children[0]:null)&&e.isStatusNode()&&b(e.tr).remove(),this._superApply(arguments)},treeClear:function(e){return this.nodeRemoveChildMarkup(this._makeHookContext(this.rootNode)),this._superApply(arguments)},treeDestroy:function(e){return this.$container.find("tbody").empty(),this.$source&&this.$source.removeClass("fancytree-helper-hidden"),this._superApply(arguments)}}),b.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(o){"use strict";return o.ui.fancytree.registerExtension({name:"themeroller",version:"2.38.0",options:{activeClass:"ui-state-active",addClass:"ui-corner-all",focusClass:"ui-state-focus",hoverClass:"ui-state-hover",selectedClass:"ui-state-highlight"},treeInit:function(e){var t=e.widget.element,n=e.options.themeroller;this._superApply(arguments),"TABLE"===t[0].nodeName?(t.addClass("ui-widget ui-corner-all"),t.find(">thead tr").addClass("ui-widget-header"),t.find(">tbody").addClass("ui-widget-conent")):t.addClass("ui-widget ui-widget-content ui-corner-all"),t.on("mouseenter mouseleave",".fancytree-node",function(e){var t=o.ui.fancytree.getNode(e.target),e="mouseenter"===e.type;o(t.tr||t.span).toggleClass(n.hoverClass+" "+n.addClass,e)})},treeDestroy:function(e){this._superApply(arguments),e.widget.element.removeClass("ui-widget ui-widget-content ui-corner-all")},nodeRenderStatus:function(e){var t={},n=e.node,r=o(n.tr||n.span),i=e.options.themeroller;this._super(e),t[i.activeClass]=!1,t[i.focusClass]=!1,t[i.selectedClass]=!1,n.isActive()&&(t[i.activeClass]=!0),n.hasFocus()&&(t[i.focusClass]=!0),n.isSelected()&&!n.isActive()&&(t[i.selectedClass]=!0),r.toggleClass(i.activeClass,t[i.activeClass]),r.toggleClass(i.focusClass,t[i.focusClass]),r.toggleClass(i.selectedClass,t[i.selectedClass]),r.addClass(i.addClass)}}),o.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(d){"use strict";var c=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;function u(e,t){var n=d("#"+(e="fancytree-style-"+e));if(t){n.length||(n=d("<style />").attr("id",e).addClass("fancytree-style").prop("type","text/css").appendTo("head"));try{n.html(t)}catch(e){n[0].styleSheet.cssText=t}return n}n.remove()}function h(e,t,n,r,i,o){for(var a="#"+e+" span.fancytree-level-",s=[],l=0;l<t;l++)s.push(a+(l+1)+" span.fancytree-title { padding-left: "+(l*n+r)+o+"; }");return s.push("#"+e+" div.ui-effects-wrapper ul li span.fancytree-title, #"+e+" li.fancytree-animating span.fancytree-title { padding-left: "+i+o+"; position: static; width: auto; }"),s.join("\n")}return d.ui.fancytree.registerExtension({name:"wide",version:"2.38.0",options:{iconWidth:null,iconSpacing:null,labelSpacing:null,levelOfs:null},treeCreate:function(e){this._superApply(arguments),this.$container.addClass("fancytree-ext-wide");var t=e.options.wide,n=d("<li id='fancytreeTemp'><span class='fancytree-node'><span class='fancytree-icon' /><span class='fancytree-title' /></span><ul />").appendTo(e.tree.$container),r=n.find(".fancytree-icon"),i=n.find("ul"),o=t.iconSpacing||r.css("margin-left"),a=t.iconWidth||r.css("width"),s=t.labelSpacing||"3px",l=t.levelOfs||i.css("padding-left");n.remove(),r=o.match(c)[2],o=parseFloat(o,10),t=s.match(c)[2],s=parseFloat(s,10),i=a.match(c)[2],a=parseFloat(a,10),n=l.match(c)[2],r===i&&n===i&&t===i||d.error("iconWidth, iconSpacing, and levelOfs must have the same css measure unit"),this._local.measureUnit=i,this._local.levelOfs=parseFloat(l),this._local.lineOfs=(1+(e.options.checkbox?1:0)+(!1===e.options.icon?0:1))*(a+o)+o,this._local.labelOfs=s,this._local.maxDepth=10,u(s=this.$container.uniqueId().attr("id"),h(s,this._local.maxDepth,this._local.levelOfs,this._local.lineOfs,this._local.labelOfs,this._local.measureUnit))},treeDestroy:function(e){return u(this.$container.attr("id"),null),this._superApply(arguments)},nodeRenderStatus:function(e){var t=e.node,n=t.getLevel(),r=this._super(e);return n>this._local.maxDepth&&(e=this.$container.attr("id"),this._local.maxDepth*=2,t.debug("Define global ext-wide css up to level "+this._local.maxDepth),u(e,h(e,this._local.maxDepth,this._local.levelOfs,this._local.lineOfs,this._local.labelSpacing,this._local.measureUnit))),d(t.span).addClass("fancytree-level-"+n),r}}),d.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(l){"use strict";var s=l.ui.fancytree,n={awesome3:{_addClass:"",checkbox:"icon-check-empty",checkboxSelected:"icon-check",checkboxUnknown:"icon-check icon-muted",dragHelper:"icon-caret-right",dropMarker:"icon-caret-right",error:"icon-exclamation-sign",expanderClosed:"icon-caret-right",expanderLazy:"icon-angle-right",expanderOpen:"icon-caret-down",loading:"icon-refresh icon-spin",nodata:"icon-meh",noExpander:"",radio:"icon-circle-blank",radioSelected:"icon-circle",doc:"icon-file-alt",docOpen:"icon-file-alt",folder:"icon-folder-close-alt",folderOpen:"icon-folder-open-alt"},awesome4:{_addClass:"fa",checkbox:"fa-square-o",checkboxSelected:"fa-check-square-o",checkboxUnknown:"fa-square fancytree-helper-indeterminate-cb",dragHelper:"fa-arrow-right",dropMarker:"fa-long-arrow-right",error:"fa-warning",expanderClosed:"fa-caret-right",expanderLazy:"fa-angle-right",expanderOpen:"fa-caret-down",loading:{html:"<span class='fa fa-spinner fa-pulse' />"},nodata:"fa-meh-o",noExpander:"",radio:"fa-circle-thin",radioSelected:"fa-circle",doc:"fa-file-o",docOpen:"fa-file-o",folder:"fa-folder-o",folderOpen:"fa-folder-open-o"},awesome5:{_addClass:"",checkbox:"far fa-square",checkboxSelected:"far fa-check-square",checkboxUnknown:"fas fa-square fancytree-helper-indeterminate-cb",radio:"far fa-circle",radioSelected:"fas fa-circle",radioUnknown:"far fa-dot-circle",dragHelper:"fas fa-arrow-right",dropMarker:"fas fa-long-arrow-alt-right",error:"fas fa-exclamation-triangle",expanderClosed:"fas fa-caret-right",expanderLazy:"fas fa-angle-right",expanderOpen:"fas fa-caret-down",loading:"fas fa-spinner fa-pulse",nodata:"far fa-meh",noExpander:"",doc:"far fa-file",docOpen:"far fa-file",folder:"far fa-folder",folderOpen:"far fa-folder-open"},bootstrap3:{_addClass:"glyphicon",checkbox:"glyphicon-unchecked",checkboxSelected:"glyphicon-check",checkboxUnknown:"glyphicon-expand fancytree-helper-indeterminate-cb",dragHelper:"glyphicon-play",dropMarker:"glyphicon-arrow-right",error:"glyphicon-warning-sign",expanderClosed:"glyphicon-menu-right",expanderLazy:"glyphicon-menu-right",expanderOpen:"glyphicon-menu-down",loading:"glyphicon-refresh fancytree-helper-spin",nodata:"glyphicon-info-sign",noExpander:"",radio:"glyphicon-remove-circle",radioSelected:"glyphicon-ok-circle",doc:"glyphicon-file",docOpen:"glyphicon-file",folder:"glyphicon-folder-close",folderOpen:"glyphicon-folder-open"},material:{_addClass:"material-icons",checkbox:{text:"check_box_outline_blank"},checkboxSelected:{text:"check_box"},checkboxUnknown:{text:"indeterminate_check_box"},dragHelper:{text:"play_arrow"},dropMarker:{text:"arrow-forward"},error:{text:"warning"},expanderClosed:{text:"chevron_right"},expanderLazy:{text:"last_page"},expanderOpen:{text:"expand_more"},loading:{text:"autorenew",addClass:"fancytree-helper-spin"},nodata:{text:"info"},noExpander:{text:""},radio:{text:"radio_button_unchecked"},radioSelected:{text:"radio_button_checked"},doc:{text:"insert_drive_file"},docOpen:{text:"insert_drive_file"},folder:{text:"folder"},folderOpen:{text:"folder_open"}}};function d(e,t,n,r,i){var o=r.map,a=o[i],s=l(t),r=s.find(".fancytree-childcounter"),o=n+" "+(o._addClass||"");"string"==typeof(a=l.isFunction(a)?a.call(this,e,t,i):a)?(t.innerHTML="",s.attr("class",o+" "+a).append(r)):a&&(a.text?t.textContent=""+a.text:a.html?t.innerHTML=a.html:t.innerHTML="",s.attr("class",o+" "+(a.addClass||"")).append(r))}return l.ui.fancytree.registerExtension({name:"glyph",version:"2.38.0",options:{preset:null,map:{}},treeInit:function(e){var t=e.tree,e=e.options.glyph;e.preset?(s.assert(!!n[e.preset],"Invalid value for `options.glyph.preset`: "+e.preset),e.map=l.extend({},n[e.preset],e.map)):t.warn("ext-glyph: missing `preset` option."),this._superApply(arguments),t.$container.addClass("fancytree-ext-glyph")},nodeRenderStatus:function(e){var t,n,r=e.node,i=l(r.span),o=e.options.glyph,a=this._super(e);return r.isRootNode()||((n=i.children(".fancytree-expander").get(0))&&(t=r.expanded&&r.hasChildren()?"expanderOpen":r.isUndefined()?"expanderLazy":r.hasChildren()?"expanderClosed":"noExpander",d(r,n,"fancytree-expander",o,t)),(n=(r.tr?l("td",r.tr).find(".fancytree-checkbox"):i.children(".fancytree-checkbox")).get(0))&&(e=s.evalOption("checkbox",r,r,o,!1),r.parent&&r.parent.radiogroup||"radio"===e?d(r,n,"fancytree-checkbox fancytree-radio",o,t=r.selected?"radioSelected":"radio"):d(r,n,"fancytree-checkbox",o,t=r.selected?"checkboxSelected":r.partsel?"checkboxUnknown":"checkbox")),(n=i.children(".fancytree-icon").get(0))&&(t=r.statusNodeType||(r.folder?r.expanded&&r.hasChildren()?"folderOpen":"folder":r.expanded?"docOpen":"doc"),d(r,n,"fancytree-icon",o,t))),a},nodeSetStatus:function(e,t,n,r){var i,o=e.options.glyph,a=e.node,e=this._superApply(arguments);return"error"!==t&&"loading"!==t&&"nodata"!==t||(a.parent?(i=l(".fancytree-expander",a.span).get(0))&&d(a,i,"fancytree-expander",o,t):(i=l(".fancytree-statusnode-"+t,a[this.nodeContainerAttrName]).find(".fancytree-icon").get(0))&&d(a,i,"fancytree-icon",o,t)),e}}),l.ui.fancytree}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(y){"use strict";var v="__not_found__",m=y.ui.fancytree.escapeHtml;function b(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function x(e,t,n){for(var r=[],i=1;i<t.length;i++){var o=t[i].length+(1===i?0:1)+(r[r.length-1]||0);r.push(o)}var a=e.split("");return n?r.forEach(function(e){a[e]=""+a[e]+""}):r.forEach(function(e){a[e]="<mark>"+a[e]+"</mark>"}),a.join("")}return y.ui.fancytree._FancytreeClass.prototype._applyFilterImpl=function(r,i,e){var t,o,a,s,l,d,c=0,n=this.options,u=n.escapeTitles,h=n.autoCollapse,f=y.extend({},n.filter,e),p="hide"===f.mode,g=!!f.leavesOnly&&!i;if("string"==typeof r){if(""===r)return this.warn("Fancytree passing an empty string as a filter is handled as clearFilter()."),void this.clearFilter();t=f.fuzzy?r.split("").map(b).reduce(function(e,t){return e+"([^"+t+"]*)"+t},""):b(r),o=new RegExp(t,"i"),a=new RegExp(b(r),"gi"),u&&(s=new RegExp(b(""),"g"),l=new RegExp(b(""),"g")),r=function(e){if(!e.title)return!1;var t,n=u?e.title:0<=(t=e.title).indexOf(">")?y("<div/>").html(t).text():t,t=n.match(o);return t&&f.highlight&&(u?(d=f.fuzzy?x(n,t,u):n.replace(a,function(e){return""+e+""}),e.titleWithHighlight=m(d).replace(s,"<mark>").replace(l,"</mark>")):f.fuzzy?e.titleWithHighlight=x(n,t):e.titleWithHighlight=n.replace(a,function(e){return"<mark>"+e+"</mark>"})),!!t}}return this.enableFilter=!0,this.lastFilterArgs=arguments,e=this.enableUpdate(!1),this.$div.addClass("fancytree-ext-filter"),p?this.$div.addClass("fancytree-ext-filter-hide"):this.$div.addClass("fancytree-ext-filter-dimm"),this.$div.toggleClass("fancytree-ext-filter-hide-expanders",!!f.hideExpanders),this.rootNode.subMatchCount=0,this.visit(function(e){delete e.match,delete e.titleWithHighlight,e.subMatchCount=0}),(t=this.getRootNode()._findDirectChild(v))&&t.remove(),n.autoCollapse=!1,this.visit(function(t){if(!g||null==t.children){var e=r(t),n=!1;if("skip"===e)return t.visit(function(e){e.match=!1},!0),"skip";e||!i&&"branch"!==e||!t.parent.match||(n=e=!0),e&&(c++,t.match=!0,t.visitParents(function(e){e!==t&&(e.subMatchCount+=1),!f.autoExpand||n||e.expanded||(e.setExpanded(!0,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),e._filterAutoExpanded=!0)},!0))}}),n.autoCollapse=h,0===c&&f.nodata&&p&&(t=f.nodata,!0===(t=y.isFunction(t)?t():t)?t={}:"string"==typeof t&&(t={title:t}),t=y.extend({statusNodeType:"nodata",key:v,title:this.options.strings.noData},t),this.getRootNode().addNode(t).match=!0),this._callHook("treeStructureChanged",this,"applyFilter"),this.enableUpdate(e),c},y.ui.fancytree._FancytreeClass.prototype.filterNodes=function(e,t){return"boolean"==typeof t&&(t={leavesOnly:t},this.warn("Fancytree.filterNodes() leavesOnly option is deprecated since 2.9.0 / 2015-04-19. Use opts.leavesOnly instead.")),this._applyFilterImpl(e,!1,t)},y.ui.fancytree._FancytreeClass.prototype.filterBranches=function(e,t){return this._applyFilterImpl(e,!0,t)},y.ui.fancytree._FancytreeClass.prototype.updateFilter=function(){this.enableFilter&&this.lastFilterArgs&&this.options.filter.autoApply?this._applyFilterImpl.apply(this,this.lastFilterArgs):this.warn("updateFilter(): no filter active.")},y.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){var t,e=this.getRootNode()._findDirectChild(v),n=this.options.escapeTitles,r=this.options.enhanceTitle,i=this.enableUpdate(!1);e&&e.remove(),delete this.rootNode.match,delete this.rootNode.subMatchCount,this.visit(function(e){e.match&&e.span&&(t=y(e.span).find(">span.fancytree-title"),n?t.text(e.title):t.html(e.title),r&&r({type:"enhanceTitle"},{node:e,$title:t})),delete e.match,delete e.subMatchCount,delete e.titleWithHighlight,e.$subMatchBadge&&(e.$subMatchBadge.remove(),delete e.$subMatchBadge),e._filterAutoExpanded&&e.expanded&&e.setExpanded(!1,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),delete e._filterAutoExpanded}),this.enableFilter=!1,this.lastFilterArgs=null,this.$div.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide"),this._callHook("treeStructureChanged",this,"clearFilter"),this.enableUpdate(i)},y.ui.fancytree._FancytreeClass.prototype.isFilterActive=function(){return!!this.enableFilter},y.ui.fancytree._FancytreeNodeClass.prototype.isMatched=function(){return!(this.tree.enableFilter&&!this.match)},y.ui.fancytree.registerExtension({name:"filter",version:"2.38.0",options:{autoApply:!0,autoExpand:!1,counter:!0,fuzzy:!1,hideExpandedCounter:!0,hideExpanders:!1,highlight:!0,leavesOnly:!1,nodata:!0,mode:"dimm"},nodeLoadChildren:function(e,t){var n=e.tree;return this._superApply(arguments).done(function(){n.enableFilter&&n.lastFilterArgs&&e.options.filter.autoApply&&n._applyFilterImpl.apply(n,n.lastFilterArgs)})},nodeSetExpanded:function(e,t,n){var r=e.node;return delete r._filterAutoExpanded,!t&&e.options.filter.hideExpandedCounter&&r.$subMatchBadge&&r.$subMatchBadge.show(),this._superApply(arguments)},nodeRenderStatus:function(e){var t=e.node,n=e.tree,r=e.options.filter,i=y(t.span).find("span.fancytree-title"),o=y(t[n.statusClassPropName]),a=e.options.enhanceTitle,s=e.options.escapeTitles,e=this._super(e);return o.length&&n.enableFilter&&(o.toggleClass("fancytree-match",!!t.match).toggleClass("fancytree-submatch",!!t.subMatchCount).toggleClass("fancytree-hide",!(t.match||t.subMatchCount)),!r.counter||!t.subMatchCount||t.isExpanded()&&r.hideExpandedCounter?t.$subMatchBadge&&t.$subMatchBadge.hide():(t.$subMatchBadge||(t.$subMatchBadge=y("<span class='fancytree-childcounter'/>"),y("span.fancytree-icon, span.fancytree-custom-icon",t.span).append(t.$subMatchBadge)),t.$subMatchBadge.show().text(t.subMatchCount)),!t.span||t.isEditing&&t.isEditing.call(t)||(t.titleWithHighlight?i.html(t.titleWithHighlight):s?i.text(t.title):i.html(t.title),a&&a({type:"enhanceTitle"},{node:t,$title:i}))),e}}),y.ui.fancytree});var LZString={writeBit:function(e,t){t.val=t.val<<1|e,15==t.position?(t.position=0,t.string+=String.fromCharCode(t.val),t.val=0):t.position++},writeBits:function(e,t,n){"string"==typeof t&&(t=t.charCodeAt(0));for(var r=0;r<e;r++)this.writeBit(1&t,n),t>>=1},produceW:function(e){Object.prototype.hasOwnProperty.call(e.dictionaryToCreate,e.w)?(e.w.charCodeAt(0)<256?(this.writeBits(e.numBits,0,e.data),this.writeBits(8,e.w,e.data)):(this.writeBits(e.numBits,1,e.data),this.writeBits(16,e.w,e.data)),this.decrementEnlargeIn(e),delete e.dictionaryToCreate[e.w]):this.writeBits(e.numBits,e.dictionary[e.w],e.data),this.decrementEnlargeIn(e)},decrementEnlargeIn:function(e){e.enlargeIn--,0==e.enlargeIn&&(e.enlargeIn=Math.pow(2,e.numBits),e.numBits++)},compress:function(e){for(var t={dictionary:{},dictionaryToCreate:{},c:"",wc:"",w:"",enlargeIn:2,dictSize:3,numBits:2,result:"",data:{string:"",val:0,position:0}},n=0;n<e.length;n+=1)t.c=e.charAt(n),Object.prototype.hasOwnProperty.call(t.dictionary,t.c)||(t.dictionary[t.c]=t.dictSize++,t.dictionaryToCreate[t.c]=!0),t.wc=t.w+t.c,Object.prototype.hasOwnProperty.call(t.dictionary,t.wc)?t.w=t.wc:(this.produceW(t),t.dictionary[t.wc]=t.dictSize++,t.w=String(t.c));for(""!==t.w&&this.produceW(t),this.writeBits(t.numBits,2,t.data);0<t.data.val;)this.writeBit(0,t.data);return t.data.string},readBit:function(e){var t=e.val&e.position;return e.position>>=1,0==e.position&&(e.position=32768,e.val=e.string.charCodeAt(e.index++)),0<t?1:0},readBits:function(e,t){for(var n=0,r=Math.pow(2,e),i=1;i!=r;)n|=this.readBit(t)*i,i<<=1;return n},decompress:function(e){for(var t,n,r={},i=4,o=4,a=3,s="",l="",d=0,c={string:e,val:e.charCodeAt(0),position:32768,index:1},u=0;u<3;u+=1)r[u]=u;switch(this.readBits(2,c)){case 0:n=String.fromCharCode(this.readBits(8,c));break;case 1:n=String.fromCharCode(this.readBits(16,c));break;case 2:return""}for(t=l=r[3]=n;;){switch(n=this.readBits(a,c)){case 0:if(1e4<d++)return"Error";n=String.fromCharCode(this.readBits(8,c)),r[o++]=n,n=o-1,i--;break;case 1:n=String.fromCharCode(this.readBits(16,c)),r[o++]=n,n=o-1,i--;break;case 2:return l}if(0==i&&(i=Math.pow(2,a),a++),r[n])s=r[n];else{if(n!==o)return null;s=t+t.charAt(0)}l+=s,r[o++]=t+s.charAt(0),t=s,0==--i&&(i=Math.pow(2,a),a++)}return l}},fancyTree=function(N,S){"use strict";var E={featureDetails:{name:"APEX-Fancy-Tree-Select",info:{scriptVersion:"2.1.4.7",utilVersion:"1.6",url:"https://github.com/RonnyWeiss",license:"MIT"}},isDefinedAndNotNull:function(e){return null!=e&&""!=e},convertJSON2LowerCase:function(e){try{var t,n={};for(t in e)"[object Object]"===Object.prototype.toString.apply(e[t])?n[t.toLowerCase()]=E.convertJSON2LowerCase(e[t]):"[object Array]"===Object.prototype.toString.apply(e[t])?(n[t.toLowerCase()]=[],n[t.toLowerCase()].push(E.convertJSON2LowerCase(e[t][0]))):n[t.toLowerCase()]=e[t];return n}catch(e){return void N.debug.error({module:"util.js",msg:"Error while to lower json",err:e})}},jsonSaveExtend:function(t,n){var r={},e={};if("string"==typeof n)try{e=JSON.parse(n)}catch(e){N.debug.error({module:"util.js",msg:"Error while try to parse targetConfig. Please check your Config JSON. Standard Config will be used.",err:e,targetConfig:n})}else e=S.extend(!0,{},n);try{r=S.extend(!0,{},t,e)}catch(e){r=S.extend(!0,{},t),N.debug.error({module:"util.js",msg:"Error while try to merge 2 JSONs into standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used.",err:e,finalConfig:r})}return r},printDOMMessage:{show:function(e,t,n,r){var i,o,a,s;150<=S(e).height()?(o=S("<div></div>").css("margin","12px").css("text-align","center").css("padding","10px 0").addClass("dominfomessagediv"),i=S("<div></div>"),a=S("<span></span>").addClass("fa").addClass(n||"fa-info-circle-o").addClass("fa-2x").css("height","32px").css("width","32px").css("margin-bottom","16px").css("color",r||"#D0D0D0"),i.append(a),s=S("<span></span>").text(t).css("display","block").css("color","#707070").css("text-overflow","ellipsis").css("overflow","hidden").css("white-space","nowrap").css("font-size","12px"),o.append(i).append(s)):(o=S("<div></div>").css("margin","10px").css("text-align","center").addClass("dominfomessagediv"),a=S("<span></span>").addClass("fa").addClass(n||"fa-info-circle-o").css("font-size","22px").css("line-height","26px").css("margin-right","5px").css("color",r||"#D0D0D0"),s=S("<span></span>").text(t).css("color","#707070").css("text-overflow","ellipsis").css("overflow","hidden").css("white-space","nowrap").css("font-size","12px").css("line-height","20px"),o.append(a).append(s)),S(e).append(o)},hide:function(e){S(e).children(".dominfomessagediv").remove()}},noDataMessage:{show:function(e,t){E.printDOMMessage.show(e,t,"fa-search")},hide:function(e){E.printDOMMessage.hide(e)}},errorMessage:{show:function(e,t){E.printDOMMessage.show(e,t,"fa-exclamation-triangle","#FFCB3D")},hide:function(e){E.printDOMMessage.hide(e)}},link:function(e,t){if(!t)return window.parent.location.href=e;window.open(e,"_blank")},loader:{start:function(e,t){t&&S(e).css("min-height","100px"),N.util.showSpinner(S(e))},stop:function(e,t){t&&S(e).css("min-height",""),S(e+" > .u-Processing").remove(),S(e+" > .ct-loader").remove()}},copyJSONObject:function(e){try{var t,n={};for(t in e)n[t]=e[t];return n}catch(e){N.debug.error({module:"util.js",msg:"Error while try to copy object",err:e})}},debounce:function(r,i,o){var a;return function(){var e=this,t=arguments,n=o&&!a;clearTimeout(a),a=setTimeout(function(){a=null,o||r.apply(e,t)},i||300),n&&r.apply(e,t)}},localStorage:{check:function(){return"undefined"!=typeof Storage||(N.debug.info({module:"util.js",msg:"Your browser does not support local storage"}),!1)},set:function(e,t,n){try{E.localStorage.check&&("permanent"===n?localStorage:sessionStorage).setItem(e,t)}catch(e){N.debug.error({module:"util.js",msg:"Error while try to save item to local Storage. Confirm that you not exceed the storage limit of 5MB.",err:e})}},get:function(e,t){try{if(E.localStorage.check)return("permanent"===t?localStorage:sessionStorage).getItem(e)}catch(e){N.debug.error({module:"util.js",msg:"Error while try to read item from local Storage",err:e})}},remove:function(e,t){try{E.localStorage.check&&("permanent"===t?localStorage:sessionStorage).removeItem(e)}catch(e){N.debug.error({module:"util.js",msg:"Error while try remove item from local Storage",err:e})}}}};return{initTree:function(e,t,n,r,i,o,a,s,l,d,c,u){N.debug.info({fct:E.featureDetails.name+" - initTree",arguments:{regionID:e,ajaxID:t,noDataMessage:n,errMessage:r,udConfigJSON:i,items2Submit:o,escapeHTML:a,searchItemName:s,activeNodeItemName:l,pLocalStorage:d,pLocalStorageVersion:c,pExpandedNodesItem:u},featureDetails:E.featureDetails});var h={};function f(){return S(h.regionID).fancytree("getTree")}function p(r,i){i&&S(_).trigger("apexbeforerefresh"),E.loader.start(h.regionID,!0);try{if(h.localStorage.enabled){var e=E.localStorage.get(h.localStorage.keyFinal,h.localStorage.type);if(e){var t=LZString.decompress(e),n=JSON.parse(t);return N.debug.info({fct:E.featureDetails.name+" - getData",msg:"Read string from local storage",localStorageKey:h.localStorage.keyFinal,localStorageStr:t,localStorageCompressedStr:e,featureDetails:E.featureDetails}),r(n),void(i&&S(_).trigger("apexafterrefresh",n))}}N.server.plugin(h.ajaxID,{pageItems:h.items2Submit},{success:function(e){if(r(e),h.localStorage.enabled)try{var t=JSON.stringify(e,null,0),n=LZString.compress(t);E.localStorage.set(h.localStorage.keyFinal,n,h.localStorage.type),N.debug.info({fct:E.featureDetails.name+" - getData",msg:"Write string to local storage",localStorageKey:h.localStorage.keyFinal,localStorageStr:t,localStorageCompressedStr:n,featureDetails:E.featureDetails})}catch(e){N.debug.error({fct:E.featureDetails.name+" - getData",msg:"Error while try to store local cache. This could be because local cache is disabled in your browser or maximum sotrage of 5MB is exceeded.",err:e,featureDetails:E.featureDetails})}i&&S(_).trigger("apexafterrefresh",e)},error:function(e){E.loader.stop(h.regionID,!0),S(h.regionID).empty(),E.errorMessage.show(h.regionID,h.errMessage),N.debug.error({fct:E.featureDetails.name+" - getData",msg:"Error while try to get new data",err:e,featureDetails:E.featureDetails}),i&&S(_).trigger("apexafterrefresh")},dataType:"json"})}catch(e){N.debug.error({fct:E.featureDetails.name+" - getData",msg:"Error while try to get new data",err:e,featureDetails:E.featureDetails}),i&&S(_).trigger("apexafterrefresh")}}function g(e,t){return e-t}function y(e){try{var n,t=E.convertJSON2LowerCase(e.row),r=!1;E.isDefinedAndNotNull(l)?n=N.item(l).getValue():h.setActiveNode=!1,S.each(t,function(e,t){h.typeSettings&&h.typeSettings.forEach(function(e){e.id==t.type&&(t.icon&&0!=t.icon.length||(t.icon="fa "+e.icon))}),!r&&n&&t.id==n&&(t.active=1,r=!0)});var i,o=[];for(i in t)o.push(t[i]);return t=function(e){for(var t,n=e.id||"id",r=e.parent_id||"parent_id",i=e.children||"children",o={},a=[],s=e.q,l=0,d=s.length;l<d;l++)(t=s[l])[i]=[],o[t[n]]=t,(null!=o[t[r]]?o[t[r]][i]:a).push(t);return a}({q:t=function(e){for(var t,n,r,i,o,a,s=e.id||"id",l=e.parent_id||"parent_id",d=[],c={},u={},h=[],f=e.q,p=r=0,g=f.length;r<g;p=++r)c[(t=f[p])[s]]=p,null==u[t[l]]&&(u[t[l]]=[]),u[t[l]].push(e.q[p][s]);for(i=0,o=(a=e.q).length;i<o;i++)null==c[(t=a[i])[l]]&&d.push(t[s]);for(;d.length;)n=d.splice(0,1),h.push(e.q[c[n]]),null!=u[n]&&(d=u[n].concat(d));return h}({q:o})}),e.row&&0<e.row.length?E.noDataMessage.hide(h.regionID):(E.noDataMessage.hide(h.regionID),E.noDataMessage.show(h.regionID,h.noDataMessage)),t}catch(e){E.loader.stop(h.regionID,!0),S(h.regionID).empty(),E.errorMessage.show(h.regionID,h.errMessage),N.debug.error({fct:E.featureDetails.name+" - prepareData",msg:"Error while try to prepare data for tree",err:e,featureDetails:E.featureDetails})}}function v(e){e=y(e);f().reload(e),b(h.autoExpand2Level),E.isDefinedAndNotNull(s)&&(e=N.item(s).getValue(),E.isDefinedAndNotNull(e)&&0<e.length&&x()),k(),w(),E.loader.stop(h.regionID,!0)}function m(){var e,t;E.isDefinedAndNotNull(h.expandedNodesItem)&&(e=f().getRootNode(),t=[],e.visit(function(e){e.expanded&&t.push(e.data.id)}),N.item(h.expandedNodesItem).setValue(t.join(":")))}function b(t){0<t&&S(h.regionID).fancytree("getRootNode").visit(function(e){e.getLevel()<t?e.setExpanded(!0):e.setExpanded(!1)})}function x(){var e=f(),t=N.item(s).getValue(),t=e.filterBranches.call(e,t);E.noDataMessage.hide(h.regionID),0===t&&E.noDataMessage.show(h.regionID,h.noDataMessage)}function C(){var r,e;h.typeSettings?(r=[],h.typeSettings.forEach(function(e){r.push(E.copyJSONObject(e))}),e=f().getSelectedNodes(),S.each(e,function(e,n){r.forEach(function(e,t){e.id?n.type?n.type==e.id&&(void 0===r[t].data&&(r[t].data=[]),-1===r[t].data.indexOf(n.data.value)&&(n.data.value&&3!=h.selectMode||!1===n.parent.selected||null===n.parent.li||!0===h.forceSelectionSet)&&r[t].data.push(n.data.value)):N.debug.error({fct:E.featureDetails.name+" - setItems",msg:"type in not set in data",featureDetails:E.featureDetails}):N.debug.error({fct:E.featureDetails.name+" - setItems",msg:"id is not defined in config json in types. Please check help for config json.",featureDetails:E.featureDetails})})}),r.forEach(function(e){e.storeItem?e.data&&0<e.data.length?(e.data.sort(g),N.item(e.storeItem).setValue(e.data.join(":"))):N.item(e.storeItem).setValue(null):N.debug.error({fct:E.featureDetails.name+" - setItems",msg:"storeItem is not defined in config json in types. Please check help for config json.",featureDetails:E.featureDetails})})):N.debug.error({fct:E.featureDetails.name+" - setItems",msg:"Types is not defined in config json but you have set setItemsOnInit: true or try to select a node. Please check help for config json.",featureDetails:E.featureDetails})}function k(e){var t;h.markNodesWithChildren&&(e&&S(h.regionID).find(".fancytree-custom-icon").removeClass(h.markerModifier),e=(t=f()).getSelectedNodes(),S.each(e,function(e,t){S.each(t.getParentList(!0),function(e,t){S(t.span).find(".fancytree-custom-icon").addClass(h.markerModifier)})}),t=t.getActiveNode(),E.isDefinedAndNotNull(t)&&S.each(t.getParentList(!0),function(e,t){S(t.span).find(".fancytree-custom-icon").addClass(h.markerModifier)}))}function w(e){(h.openParentOfSelected||e)&&(e=f().getSelectedNodes(),S.each(e,function(e,t){S.each(t.getParentList(!0),function(e,t){t.setExpanded(!0)})}))}(h=E.jsonSaveExtend({animationDuration:200,autoExpand2Level:0,checkbox:"fa-square-o",checkboxSelected:"fa-check-square",checkboxUnknown:"fa-square",enableCheckBox:!0,enableKeyBoard:!0,enableQuicksearch:!0,forceSelectionSet:!0,forceRefreshEventOnStart:!1,markNodesWithChildren:!1,markerModifier:"fam-plus fam-is-info",openParentOfActiveNode:!0,openParentOfSelected:!0,refresh:0,search:{autoExpand:!0,leavesOnly:!1,highlight:!0,counter:!0,hideUnmatched:!0,debounce:{enabled:!0,time:400}},selectMode:2,setActiveNode:!0,setItemsOnInit:!1},i)).regionID=e,h.ajaxID=t,h.noDataMessage=n,h.errMessage=r,h.items2Submit=o,h.expandedNodesItem=u,h.localStorage={},h.localStorage.enabled="Y"===d,h.localStorage.enabled&&(h.session=N.item("pInstance").getValue(),h.version=c,h.localStorage.key=e,h.localStorage.type="session",h.localStorage.keyFinal=JSON.stringify({key:h.localStorage.key,plugin:E.featureDetails.name,session:h.session,version:h.version},null,0),E.localStorage.check&&S.each(sessionStorage,function(e,t){if("{"===e.substring(0,1))try{var n=JSON.parse(e);n.plugin!=E.featureDetails.name||n.key!=h.localStorage.key||n.session==h.session&&n.version==h.version||E.localStorage.remove(e)}catch(e){N.debug.error({fct:E.featureDetails.name+" - initTree",msg:"Error while try to parse local storage key json",err:e,featureDetails:E.featureDetails})}})),!isNaN(h.animationDuration)&&0<=h.animationDuration?h.animationDuration={effect:"slideToggle",duration:h.animationDuration}:h.animationDuration=!1,!1!==a&&(h.escapeHTML=!0);var _="#"+e.substring(4);p(function(e){e=y(e),S(h.regionID).fancytree({extensions:["glyph","filter"],quicksearch:!0,clones:{highlightClones:!0},nodata:!1,activeVisible:h.openParentOfActiveNode,escapeTitles:h.escapeHTML,focusOnSelect:!0,titlesTabbable:!0,checkbox:h.enableCheckBox,toggleEffect:h.animationDuration,selectMode:h.selectMode,debugLevel:0,keyboard:h.enableKeyBoard,quicksearch:h.enableQuicksearch,glyph:{preset:"awesome4",map:{_addClass:"fa",checkbox:h.checkbox,checkboxSelected:h.checkboxSelected,checkboxUnknown:h.checkboxUnknown,dragHelper:"fa-arrow-right",dropMarker:"fa-long-arrow-right",error:"fa-warning",expanderClosed:"fa-caret-right",expanderLazy:"fa-angle-right",expanderOpen:"fa-caret-down",loading:"fa-spinner fa-pulse",nodata:"fa-meh-o",noExpander:"",radio:"fa-circle-thin",radioSelected:"fa-circle",doc:"fa-file-o",docOpen:"fa-file-o",folder:"fa-folder-o",folderOpen:"fa-folder-open-o"}},filter:{autoApply:!0,autoExpand:h.search.autoExpand,counter:h.search.counter,fuzzy:!1,hideExpandedCounter:!0,hideExpanders:!1,highlight:h.search.highlight,leavesOnly:h.search.leavesOnly,nodata:!1,mode:h.search.hideUnmatched?"hide":"dimm"},source:e,init:function(e,t){k(),w(),h.setItemsOnInit&&(m(),C())},collapse:function(e,t){m(),S(_).trigger("collapsed",t.node)},expand:function(e,t){k(),m(),S(_).trigger("expanded",t.node)},select:function(e,t){N.debug.info({fct:E.featureDetails.name+" - drawTree",selectEvent:e,selectData:t,featureDetails:E.featureDetails}),k(!0),""!=t.node.extraClasses&&(S(t.node.li).find(".fancytree-node").hasClass("fancytree-selected")?S("."+t.node.extraClasses).addClass("fancytree-selected"):S("."+t.node.extraClasses).removeClass("fancytree-selected")),C()},click:function(e,t){var n;"title"!==t.targetType&&"icon"!==t.targetType||t.node&&t.node.data&&(n=t.node.data,E.isDefinedAndNotNull(n.link)?E.link(n.link):1===t.node.checkbox&&t.node.toggleSelected())},beforeActivate:function(e,t){return!!h.setActiveNode},activate:function(e,t){t.node&&t.node.data&&(t=t.node.data,E.isDefinedAndNotNull(t.value)&&N.item(l).setValue(t.value)),k(!0)}}),E.isDefinedAndNotNull(s)&&(h.search.debounce.enabled?S("#"+s).keyup(E.debounce(function(){x()},h.search.debounce.time)):S("#"+s).keyup(function(){x()}),S("#"+s).on("change",function(e){x()}),e=N.item(s).getValue(),E.isDefinedAndNotNull(e)&&0<e.length&&x()),b(h.autoExpand2Level),E.loader.stop(h.regionID,!0),S(_).on("expandAll",function(){N.debug.info({fct:E.featureDetails.name+" - drawTree",msg:"expandAll fired",featureDetails:E.featureDetails}),f().expandAll()}),S(_).on("collapseAll",function(){N.debug.info({fct:E.featureDetails.name+" - drawTree",msg:"collapseAll fired",featureDetails:E.featureDetails}),f().expandAll(!1)}),S(_).on("selectAll",function(){N.debug.info({fct:E.featureDetails.name+" - drawTree",msg:"selectAll fired",featureDetails:E.featureDetails}),f().selectAll(!0)}),S(_).on("unselectAll",function(){N.debug.info({fct:E.featureDetails.name+" - drawTree",msg:"unselectAll fired",featureDetails:E.featureDetails}),f().selectAll(!1)}),S(_).on("expandSelected",function(){N.debug.info({fct:E.featureDetails.name+" - drawTree",msg:"expandSelected fired",featureDetails:E.featureDetails}),w(!0)}),S(_).on("expandToLevel",function(e,t){N.debug.info({fct:E.featureDetails.name+" - drawTree",msg:"expandToLevel fired",i:e,d:t,featureDetails:E.featureDetails}),E.isDefinedAndNotNull(t)?b(t):b(h.autoExpand2Level)})},h.forceRefreshEventOnStart),S(_).bind("apexrefresh",function(){0==S(h.regionID).children("span").length&&(h.localStorage.enabled&&E.localStorage.remove(h.localStorage.keyFinal,h.localStorage.type),p(v,!0))}),0<h.refresh&&setInterval(function(){0==S(h.regionID).children("span").length&&(h.localStorage.enabled&&E.localStorage.remove(h.localStorage.keyFinal,h.localStorage.type),p(v,!0))},1e3*h.refresh)}}};